var saveAs=saveAs||function(a){"use strict";if("undefined"==typeof navigator||!/MSIE [1-9]\./.test(navigator.userAgent)){var b=a.document,c=function(){return a.URL||a.webkitURL||a},d=b.createElementNS("http://www.w3.org/1999/xhtml","a"),e="download"in d,f=function(a){var b=new MouseEvent("click");a.dispatchEvent(b)},g=a.webkitRequestFileSystem,h=a.requestFileSystem||g||a.mozRequestFileSystem,i=function(b){(a.setImmediate||a.setTimeout)(function(){throw b},0)},j="application/octet-stream",k=0,l=500,m=function(b){var d=function(){"string"==typeof b?c().revokeObjectURL(b):b.remove()};a.chrome?d():setTimeout(d,l)},n=function(a,b,c){b=[].concat(b);for(var d=b.length;d--;){var e=a["on"+b[d]];if("function"==typeof e)try{e.call(a,c||a)}catch(f){i(f)}}},o=function(a){return/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(a.type)?new Blob(["\ufeff",a],{type:a.type}):a},p=function(b,i,l){l||(b=o(b));var p,q,r,s=this,t=b.type,u=!1,v=function(){n(s,"writestart progress write writeend".split(" "))},w=function(){if((u||!p)&&(p=c().createObjectURL(b)),q)q.location.href=p;else{var d=a.open(p,"_blank");void 0==d&&"undefined"!=typeof safari&&(a.location.href=p)}s.readyState=s.DONE,v(),m(p)},x=function(a){return function(){return s.readyState!==s.DONE?a.apply(this,arguments):void 0}},y={create:!0,exclusive:!1};return s.readyState=s.INIT,i||(i="download"),e?(p=c().createObjectURL(b),d.href=p,d.download=i,void setTimeout(function(){f(d),v(),m(p),s.readyState=s.DONE})):(a.chrome&&t&&t!==j&&(r=b.slice||b.webkitSlice,b=r.call(b,0,b.size,j),u=!0),g&&"download"!==i&&(i+=".download"),(t===j||g)&&(q=a),h?(k+=b.size,void h(a.TEMPORARY,k,x(function(a){a.root.getDirectory("saved",y,x(function(a){var c=function(){a.getFile(i,y,x(function(a){a.createWriter(x(function(c){c.onwriteend=function(b){q.location.href=a.toURL(),s.readyState=s.DONE,n(s,"writeend",b),m(a)},c.onerror=function(){var a=c.error;a.code!==a.ABORT_ERR&&w()},"writestart progress write abort".split(" ").forEach(function(a){c["on"+a]=s["on"+a]}),c.write(b),s.abort=function(){c.abort(),s.readyState=s.DONE},s.readyState=s.WRITING}),w)}),w)};a.getFile(i,{create:!1},x(function(a){a.remove(),c()}),x(function(a){a.code===a.NOT_FOUND_ERR?c():w()}))}),w)}),w)):void w())},q=p.prototype,r=function(a,b,c){return new p(a,b,c)};return"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob?function(a,b,c){return c||(a=o(a)),navigator.msSaveOrOpenBlob(a,b||"download")}:(q.abort=function(){var a=this;a.readyState=a.DONE,n(a,"abort")},q.readyState=q.INIT=0,q.WRITING=1,q.DONE=2,q.error=q.onwritestart=q.onprogress=q.onwrite=q.onabort=q.onerror=q.onwriteend=null,r)}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content);"undefined"!=typeof module&&module.exports?module.exports.saveAs=saveAs:"undefined"!=typeof define&&null!==define&&null!=define.amd&&define([],function(){return saveAs}),function(a,b){if("object"==typeof exports&&"object"==typeof module)module.exports=b();else if("function"==typeof define&&define.amd)define(b);else{var c=b();for(var d in c)("object"==typeof exports?exports:a)[d]=c[d]}}(this,function(){return function(a){function b(d){if(c[d])return c[d].exports;var e=c[d]={exports:{},id:d,loaded:!1};return a[d].call(e.exports,e,e.exports,b),e.loaded=!0,e.exports}var c={};return b.m=a,b.c=c,b.p="",b(0)}([function(a,b,c){b.glMatrix=c(1),b.mat2=c(2),b.mat2d=c(3),b.mat3=c(4),b.mat4=c(5),b.quat=c(6),b.vec2=c(9),b.vec3=c(7),b.vec4=c(8)},function(a,b){var c={};c.EPSILON=1e-6,c.ARRAY_TYPE="undefined"!=typeof Float32Array?Float32Array:Array,c.RANDOM=Math.random,c.ENABLE_SIMD=!1,c.SIMD_AVAILABLE=c.ARRAY_TYPE===Float32Array&&"SIMD"in this,c.USE_SIMD=c.ENABLE_SIMD&&c.SIMD_AVAILABLE,c.setMatrixArrayType=function(a){c.ARRAY_TYPE=a};var d=Math.PI/180;c.toRadian=function(a){return a*d},a.exports=c},function(a,b,c){var d=c(1),e={};e.create=function(){var a=new d.ARRAY_TYPE(4);return a[0]=1,a[1]=0,a[2]=0,a[3]=1,a},e.clone=function(a){var b=new d.ARRAY_TYPE(4);return b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b},e.copy=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a},e.identity=function(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=1,a},e.transpose=function(a,b){if(a===b){var c=b[1];a[1]=b[2],a[2]=c}else a[0]=b[0],a[1]=b[2],a[2]=b[1],a[3]=b[3];return a},e.invert=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=c*f-e*d;return g?(g=1/g,a[0]=f*g,a[1]=-d*g,a[2]=-e*g,a[3]=c*g,a):null},e.adjoint=function(a,b){var c=b[0];return a[0]=b[3],a[1]=-b[1],a[2]=-b[2],a[3]=c,a},e.determinant=function(a){return a[0]*a[3]-a[2]*a[1]},e.multiply=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=c[0],i=c[1],j=c[2],k=c[3];return a[0]=d*h+f*i,a[1]=e*h+g*i,a[2]=d*j+f*k,a[3]=e*j+g*k,a},e.mul=e.multiply,e.rotate=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=Math.sin(c),i=Math.cos(c);return a[0]=d*i+f*h,a[1]=e*i+g*h,a[2]=d*-h+f*i,a[3]=e*-h+g*i,a},e.scale=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=c[0],i=c[1];return a[0]=d*h,a[1]=e*h,a[2]=f*i,a[3]=g*i,a},e.fromRotation=function(a,b){var c=Math.sin(b),d=Math.cos(b);return a[0]=d,a[1]=c,a[2]=-c,a[3]=d,a},e.fromScaling=function(a,b){return a[0]=b[0],a[1]=0,a[2]=0,a[3]=b[1],a},e.str=function(a){return"mat2("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"},e.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2))},e.LDU=function(a,b,c,d){return a[2]=d[2]/d[0],c[0]=d[0],c[1]=d[1],c[3]=d[3]-a[2]*c[1],[a,b,c]},a.exports=e},function(a,b,c){var d=c(1),e={};e.create=function(){var a=new d.ARRAY_TYPE(6);return a[0]=1,a[1]=0,a[2]=0,a[3]=1,a[4]=0,a[5]=0,a},e.clone=function(a){var b=new d.ARRAY_TYPE(6);return b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[4]=a[4],b[5]=a[5],b},e.copy=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[4]=b[4],a[5]=b[5],a},e.identity=function(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=1,a[4]=0,a[5]=0,a},e.invert=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=c*f-d*e;return i?(i=1/i,a[0]=f*i,a[1]=-d*i,a[2]=-e*i,a[3]=c*i,a[4]=(e*h-f*g)*i,a[5]=(d*g-c*h)*i,a):null},e.determinant=function(a){return a[0]*a[3]-a[1]*a[2]},e.multiply=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=c[0],k=c[1],l=c[2],m=c[3],n=c[4],o=c[5];return a[0]=d*j+f*k,a[1]=e*j+g*k,a[2]=d*l+f*m,a[3]=e*l+g*m,a[4]=d*n+f*o+h,a[5]=e*n+g*o+i,a},e.mul=e.multiply,e.rotate=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=Math.sin(c),k=Math.cos(c);return a[0]=d*k+f*j,a[1]=e*k+g*j,a[2]=d*-j+f*k,a[3]=e*-j+g*k,a[4]=h,a[5]=i,a},e.scale=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=c[0],k=c[1];return a[0]=d*j,a[1]=e*j,a[2]=f*k,a[3]=g*k,a[4]=h,a[5]=i,a},e.translate=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=c[0],k=c[1];return a[0]=d,a[1]=e,a[2]=f,a[3]=g,a[4]=d*j+f*k+h,a[5]=e*j+g*k+i,a},e.fromRotation=function(a,b){var c=Math.sin(b),d=Math.cos(b);return a[0]=d,a[1]=c,a[2]=-c,a[3]=d,a[4]=0,a[5]=0,a},e.fromScaling=function(a,b){return a[0]=b[0],a[1]=0,a[2]=0,a[3]=b[1],a[4]=0,a[5]=0,a},e.fromTranslation=function(a,b){return a[0]=1,a[1]=0,a[2]=0,a[3]=1,a[4]=b[0],a[5]=b[1],a},e.str=function(a){return"mat2d("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+")"},e.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+1)},a.exports=e},function(a,b,c){var d=c(1),e={};e.create=function(){var a=new d.ARRAY_TYPE(9);return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=1,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},e.fromMat4=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[4],a[4]=b[5],a[5]=b[6],a[6]=b[8],a[7]=b[9],a[8]=b[10],a},e.clone=function(a){var b=new d.ARRAY_TYPE(9);return b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[4]=a[4],b[5]=a[5],b[6]=a[6],b[7]=a[7],b[8]=a[8],b},e.copy=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[4]=b[4],a[5]=b[5],a[6]=b[6],a[7]=b[7],a[8]=b[8],a},e.identity=function(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=1,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},e.transpose=function(a,b){if(a===b){var c=b[1],d=b[2],e=b[5];a[1]=b[3],a[2]=b[6],a[3]=c,a[5]=b[7],a[6]=d,a[7]=e}else a[0]=b[0],a[1]=b[3],a[2]=b[6],a[3]=b[1],a[4]=b[4],a[5]=b[7],a[6]=b[2],a[7]=b[5],a[8]=b[8];return a},e.invert=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=b[6],j=b[7],k=b[8],l=k*g-h*j,m=-k*f+h*i,n=j*f-g*i,o=c*l+d*m+e*n;return o?(o=1/o,a[0]=l*o,a[1]=(-k*d+e*j)*o,a[2]=(h*d-e*g)*o,a[3]=m*o,a[4]=(k*c-e*i)*o,a[5]=(-h*c+e*f)*o,a[6]=n*o,a[7]=(-j*c+d*i)*o,a[8]=(g*c-d*f)*o,a):null},e.adjoint=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=b[6],j=b[7],k=b[8];return a[0]=g*k-h*j,a[1]=e*j-d*k,a[2]=d*h-e*g,a[3]=h*i-f*k,a[4]=c*k-e*i,a[5]=e*f-c*h,a[6]=f*j-g*i,a[7]=d*i-c*j,a[8]=c*g-d*f,a},e.determinant=function(a){var b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],h=a[6],i=a[7],j=a[8];return b*(j*f-g*i)+c*(-j*e+g*h)+d*(i*e-f*h)},e.multiply=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=b[6],k=b[7],l=b[8],m=c[0],n=c[1],o=c[2],p=c[3],q=c[4],r=c[5],s=c[6],t=c[7],u=c[8];return a[0]=m*d+n*g+o*j,a[1]=m*e+n*h+o*k,a[2]=m*f+n*i+o*l,a[3]=p*d+q*g+r*j,a[4]=p*e+q*h+r*k,a[5]=p*f+q*i+r*l,a[6]=s*d+t*g+u*j,a[7]=s*e+t*h+u*k,a[8]=s*f+t*i+u*l,a},e.mul=e.multiply,e.translate=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=b[6],k=b[7],l=b[8],m=c[0],n=c[1];return a[0]=d,a[1]=e,a[2]=f,a[3]=g,a[4]=h,a[5]=i,a[6]=m*d+n*g+j,a[7]=m*e+n*h+k,a[8]=m*f+n*i+l,a},e.rotate=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=b[6],k=b[7],l=b[8],m=Math.sin(c),n=Math.cos(c);return a[0]=n*d+m*g,a[1]=n*e+m*h,a[2]=n*f+m*i,a[3]=n*g-m*d,a[4]=n*h-m*e,a[5]=n*i-m*f,a[6]=j,a[7]=k,a[8]=l,a},e.scale=function(a,b,c){var d=c[0],e=c[1];return a[0]=d*b[0],a[1]=d*b[1],a[2]=d*b[2],a[3]=e*b[3],a[4]=e*b[4],a[5]=e*b[5],a[6]=b[6],a[7]=b[7],a[8]=b[8],a},e.fromTranslation=function(a,b){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=1,a[5]=0,a[6]=b[0],a[7]=b[1],a[8]=1,a},e.fromRotation=function(a,b){var c=Math.sin(b),d=Math.cos(b);return a[0]=d,a[1]=c,a[2]=0,a[3]=-c,a[4]=d,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},e.fromScaling=function(a,b){return a[0]=b[0],a[1]=0,a[2]=0,a[3]=0,a[4]=b[1],a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},e.fromMat2d=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=0,a[3]=b[2],a[4]=b[3],a[5]=0,a[6]=b[4],a[7]=b[5],a[8]=1,a},e.fromQuat=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=c+c,h=d+d,i=e+e,j=c*g,k=d*g,l=d*h,m=e*g,n=e*h,o=e*i,p=f*g,q=f*h,r=f*i;return a[0]=1-l-o,a[3]=k-r,a[6]=m+q,a[1]=k+r,a[4]=1-j-o,a[7]=n-p,a[2]=m-q,a[5]=n+p,a[8]=1-j-l,a},e.normalFromMat4=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=b[6],j=b[7],k=b[8],l=b[9],m=b[10],n=b[11],o=b[12],p=b[13],q=b[14],r=b[15],s=c*h-d*g,t=c*i-e*g,u=c*j-f*g,v=d*i-e*h,w=d*j-f*h,x=e*j-f*i,y=k*p-l*o,z=k*q-m*o,A=k*r-n*o,B=l*q-m*p,C=l*r-n*p,D=m*r-n*q,E=s*D-t*C+u*B+v*A-w*z+x*y;return E?(E=1/E,a[0]=(h*D-i*C+j*B)*E,a[1]=(i*A-g*D-j*z)*E,a[2]=(g*C-h*A+j*y)*E,a[3]=(e*C-d*D-f*B)*E,a[4]=(c*D-e*A+f*z)*E,a[5]=(d*A-c*C-f*y)*E,a[6]=(p*x-q*w+r*v)*E,a[7]=(q*u-o*x-r*t)*E,a[8]=(o*w-p*u+r*s)*E,a):null},e.str=function(a){return"mat3("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+")"},e.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2))},a.exports=e},function(a,b,c){var d=c(1),e={scalar:{},SIMD:{}};e.create=function(){var a=new d.ARRAY_TYPE(16);return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},e.clone=function(a){var b=new d.ARRAY_TYPE(16);return b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[4]=a[4],b[5]=a[5],b[6]=a[6],b[7]=a[7],b[8]=a[8],b[9]=a[9],b[10]=a[10],b[11]=a[11],b[12]=a[12],b[13]=a[13],b[14]=a[14],b[15]=a[15],b},e.copy=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[4]=b[4],a[5]=b[5],a[6]=b[6],a[7]=b[7],a[8]=b[8],a[9]=b[9],a[10]=b[10],a[11]=b[11],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15],a},e.identity=function(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},e.transpose=function(a,b){if(a===b){var c=b[1],d=b[2],e=b[3],f=b[6],g=b[7],h=b[11];a[1]=b[4],a[2]=b[8],a[3]=b[12],a[4]=c,a[6]=b[9],a[7]=b[13],a[8]=d,a[9]=f,a[11]=b[14],a[12]=e,a[13]=g,a[14]=h}else a[0]=b[0],a[1]=b[4],a[2]=b[8],a[3]=b[12],a[4]=b[1],a[5]=b[5],a[6]=b[9],a[7]=b[13],a[8]=b[2],a[9]=b[6],a[10]=b[10],a[11]=b[14],a[12]=b[3],a[13]=b[7],a[14]=b[11],a[15]=b[15];return a},e.invert=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=b[6],j=b[7],k=b[8],l=b[9],m=b[10],n=b[11],o=b[12],p=b[13],q=b[14],r=b[15],s=c*h-d*g,t=c*i-e*g,u=c*j-f*g,v=d*i-e*h,w=d*j-f*h,x=e*j-f*i,y=k*p-l*o,z=k*q-m*o,A=k*r-n*o,B=l*q-m*p,C=l*r-n*p,D=m*r-n*q,E=s*D-t*C+u*B+v*A-w*z+x*y;return E?(E=1/E,a[0]=(h*D-i*C+j*B)*E,a[1]=(e*C-d*D-f*B)*E,a[2]=(p*x-q*w+r*v)*E,a[3]=(m*w-l*x-n*v)*E,a[4]=(i*A-g*D-j*z)*E,a[5]=(c*D-e*A+f*z)*E,a[6]=(q*u-o*x-r*t)*E,a[7]=(k*x-m*u+n*t)*E,a[8]=(g*C-h*A+j*y)*E,a[9]=(d*A-c*C-f*y)*E,a[10]=(o*w-p*u+r*s)*E,a[11]=(l*u-k*w-n*s)*E,a[12]=(h*z-g*B-i*y)*E,a[13]=(c*B-d*z+e*y)*E,a[14]=(p*t-o*v-q*s)*E,a[15]=(k*v-l*t+m*s)*E,a):null},e.adjoint=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=b[6],j=b[7],k=b[8],l=b[9],m=b[10],n=b[11],o=b[12],p=b[13],q=b[14],r=b[15];return a[0]=h*(m*r-n*q)-l*(i*r-j*q)+p*(i*n-j*m),a[1]=-(d*(m*r-n*q)-l*(e*r-f*q)+p*(e*n-f*m)),a[2]=d*(i*r-j*q)-h*(e*r-f*q)+p*(e*j-f*i),a[3]=-(d*(i*n-j*m)-h*(e*n-f*m)+l*(e*j-f*i)),a[4]=-(g*(m*r-n*q)-k*(i*r-j*q)+o*(i*n-j*m)),a[5]=c*(m*r-n*q)-k*(e*r-f*q)+o*(e*n-f*m),a[6]=-(c*(i*r-j*q)-g*(e*r-f*q)+o*(e*j-f*i)),a[7]=c*(i*n-j*m)-g*(e*n-f*m)+k*(e*j-f*i),a[8]=g*(l*r-n*p)-k*(h*r-j*p)+o*(h*n-j*l),a[9]=-(c*(l*r-n*p)-k*(d*r-f*p)+o*(d*n-f*l)),a[10]=c*(h*r-j*p)-g*(d*r-f*p)+o*(d*j-f*h),a[11]=-(c*(h*n-j*l)-g*(d*n-f*l)+k*(d*j-f*h)),a[12]=-(g*(l*q-m*p)-k*(h*q-i*p)+o*(h*m-i*l)),a[13]=c*(l*q-m*p)-k*(d*q-e*p)+o*(d*m-e*l),a[14]=-(c*(h*q-i*p)-g*(d*q-e*p)+o*(d*i-e*h)),a[15]=c*(h*m-i*l)-g*(d*m-e*l)+k*(d*i-e*h),a},e.determinant=function(a){var b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],h=a[6],i=a[7],j=a[8],k=a[9],l=a[10],m=a[11],n=a[12],o=a[13],p=a[14],q=a[15],r=b*g-c*f,s=b*h-d*f,t=b*i-e*f,u=c*h-d*g,v=c*i-e*g,w=d*i-e*h,x=j*o-k*n,y=j*p-l*n,z=j*q-m*n,A=k*p-l*o,B=k*q-m*o,C=l*q-m*p;return r*C-s*B+t*A+u*z-v*y+w*x},e.SIMD.multiply=function(a,b,c){var d=SIMD.Float32x4.load(b,0),e=SIMD.Float32x4.load(b,4),f=SIMD.Float32x4.load(b,8),g=SIMD.Float32x4.load(b,12),h=SIMD.Float32x4.load(c,0),i=SIMD.Float32x4.load(c,4),j=SIMD.Float32x4.load(c,8),k=SIMD.Float32x4.load(c,12),l=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(h,0,0,0,0),d),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(h,1,1,1,1),e),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(h,2,2,2,2),f),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(h,3,3,3,3),g)))),m=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(i,0,0,0,0),d),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(i,1,1,1,1),e),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(i,2,2,2,2),f),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(i,3,3,3,3),g)))),n=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(j,0,0,0,0),d),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(j,1,1,1,1),e),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(j,2,2,2,2),f),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(j,3,3,3,3),g)))),o=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(k,0,0,0,0),d),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(k,1,1,1,1),e),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(k,2,2,2,2),f),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(k,3,3,3,3),g))));return SIMD.Float32x4.store(a,0,l),SIMD.Float32x4.store(a,4,m),SIMD.Float32x4.store(a,8,n),SIMD.Float32x4.store(a,12,o),a},e.scalar.multiply=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=b[6],k=b[7],l=b[8],m=b[9],n=b[10],o=b[11],p=b[12],q=b[13],r=b[14],s=b[15],t=c[0],u=c[1],v=c[2],w=c[3];return a[0]=t*d+u*h+v*l+w*p,a[1]=t*e+u*i+v*m+w*q,a[2]=t*f+u*j+v*n+w*r,a[3]=t*g+u*k+v*o+w*s,t=c[4],u=c[5],v=c[6],w=c[7],a[4]=t*d+u*h+v*l+w*p,a[5]=t*e+u*i+v*m+w*q,a[6]=t*f+u*j+v*n+w*r,a[7]=t*g+u*k+v*o+w*s,t=c[8],u=c[9],v=c[10],w=c[11],a[8]=t*d+u*h+v*l+w*p,a[9]=t*e+u*i+v*m+w*q,a[10]=t*f+u*j+v*n+w*r,a[11]=t*g+u*k+v*o+w*s,t=c[12],u=c[13],v=c[14],w=c[15],a[12]=t*d+u*h+v*l+w*p,a[13]=t*e+u*i+v*m+w*q,a[14]=t*f+u*j+v*n+w*r,a[15]=t*g+u*k+v*o+w*s,a},e.multiply=d.USE_SIMD?e.SIMD.multiply:e.scalar.multiply,e.mul=e.multiply,e.translate=function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p=c[0],q=c[1],r=c[2];return b===a?(a[12]=b[0]*p+b[4]*q+b[8]*r+b[12],a[13]=b[1]*p+b[5]*q+b[9]*r+b[13],a[14]=b[2]*p+b[6]*q+b[10]*r+b[14],a[15]=b[3]*p+b[7]*q+b[11]*r+b[15]):(d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=b[6],k=b[7],l=b[8],m=b[9],n=b[10],o=b[11],a[0]=d,a[1]=e,a[2]=f,a[3]=g,a[4]=h,a[5]=i,a[6]=j,a[7]=k,a[8]=l,a[9]=m,a[10]=n,a[11]=o,a[12]=d*p+h*q+l*r+b[12],a[13]=e*p+i*q+m*r+b[13],a[14]=f*p+j*q+n*r+b[14],a[15]=g*p+k*q+o*r+b[15]),a},e.scale=function(a,b,c){var d=c[0],e=c[1],f=c[2];return a[0]=b[0]*d,a[1]=b[1]*d,a[2]=b[2]*d,a[3]=b[3]*d,a[4]=b[4]*e,a[5]=b[5]*e,a[6]=b[6]*e,a[7]=b[7]*e,a[8]=b[8]*f,a[9]=b[9]*f,a[10]=b[10]*f,a[11]=b[11]*f,a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15],a},e.rotate=function(a,b,c,e){var f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D=e[0],E=e[1],F=e[2],G=Math.sqrt(D*D+E*E+F*F);return Math.abs(G)<d.EPSILON?null:(G=1/G,D*=G,E*=G,F*=G,f=Math.sin(c),g=Math.cos(c),h=1-g,i=b[0],j=b[1],k=b[2],l=b[3],m=b[4],n=b[5],o=b[6],p=b[7],q=b[8],r=b[9],s=b[10],t=b[11],u=D*D*h+g,v=E*D*h+F*f,w=F*D*h-E*f,x=D*E*h-F*f,y=E*E*h+g,z=F*E*h+D*f,A=D*F*h+E*f,B=E*F*h-D*f,C=F*F*h+g,a[0]=i*u+m*v+q*w,a[1]=j*u+n*v+r*w,a[2]=k*u+o*v+s*w,a[3]=l*u+p*v+t*w,a[4]=i*x+m*y+q*z,a[5]=j*x+n*y+r*z,a[6]=k*x+o*y+s*z,a[7]=l*x+p*y+t*z,a[8]=i*A+m*B+q*C,a[9]=j*A+n*B+r*C,a[10]=k*A+o*B+s*C,a[11]=l*A+p*B+t*C,b!==a&&(a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]),a)},e.rotateX=function(a,b,c){var d=Math.sin(c),e=Math.cos(c),f=b[4],g=b[5],h=b[6],i=b[7],j=b[8],k=b[9],l=b[10],m=b[11];return b!==a&&(a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]),a[4]=f*e+j*d,a[5]=g*e+k*d,a[6]=h*e+l*d,a[7]=i*e+m*d,a[8]=j*e-f*d,a[9]=k*e-g*d,a[10]=l*e-h*d,a[11]=m*e-i*d,a},e.rotateY=function(a,b,c){var d=Math.sin(c),e=Math.cos(c),f=b[0],g=b[1],h=b[2],i=b[3],j=b[8],k=b[9],l=b[10],m=b[11];return b!==a&&(a[4]=b[4],a[5]=b[5],a[6]=b[6],a[7]=b[7],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]),a[0]=f*e-j*d,a[1]=g*e-k*d,a[2]=h*e-l*d,a[3]=i*e-m*d,a[8]=f*d+j*e,a[9]=g*d+k*e,a[10]=h*d+l*e,a[11]=i*d+m*e,a},e.rotateZ=function(a,b,c){var d=Math.sin(c),e=Math.cos(c),f=b[0],g=b[1],h=b[2],i=b[3],j=b[4],k=b[5],l=b[6],m=b[7];return b!==a&&(a[8]=b[8],a[9]=b[9],a[10]=b[10],a[11]=b[11],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]),a[0]=f*e+j*d,a[1]=g*e+k*d,a[2]=h*e+l*d,a[3]=i*e+m*d,a[4]=j*e-f*d,a[5]=k*e-g*d,a[6]=l*e-h*d,a[7]=m*e-i*d,a},e.fromTranslation=function(a,b){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=b[0],a[13]=b[1],a[14]=b[2],a[15]=1,a},e.fromScaling=function(a,b){return a[0]=b[0],a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=b[1],a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=b[2],a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},e.fromRotation=function(a,b,c){var e,f,g,h=c[0],i=c[1],j=c[2],k=Math.sqrt(h*h+i*i+j*j);return Math.abs(k)<d.EPSILON?null:(k=1/k,h*=k,i*=k,j*=k,e=Math.sin(b),f=Math.cos(b),g=1-f,a[0]=h*h*g+f,a[1]=i*h*g+j*e,a[2]=j*h*g-i*e,a[3]=0,a[4]=h*i*g-j*e,a[5]=i*i*g+f,a[6]=j*i*g+h*e,a[7]=0,a[8]=h*j*g+i*e,a[9]=i*j*g-h*e,a[10]=j*j*g+f,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a)},e.fromXRotation=function(a,b){var c=Math.sin(b),d=Math.cos(b);return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=d,a[6]=c,a[7]=0,a[8]=0,a[9]=-c,a[10]=d,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},e.fromYRotation=function(a,b){var c=Math.sin(b),d=Math.cos(b);return a[0]=d,a[1]=0,a[2]=-c,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=c,a[9]=0,a[10]=d,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},e.fromZRotation=function(a,b){var c=Math.sin(b),d=Math.cos(b);return a[0]=d,a[1]=c,a[2]=0,a[3]=0,a[4]=-c,a[5]=d,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},e.fromRotationTranslation=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=d+d,i=e+e,j=f+f,k=d*h,l=d*i,m=d*j,n=e*i,o=e*j,p=f*j,q=g*h,r=g*i,s=g*j;return a[0]=1-(n+p),a[1]=l+s,a[2]=m-r,a[3]=0,a[4]=l-s,a[5]=1-(k+p),a[6]=o+q,a[7]=0,a[8]=m+r,a[9]=o-q,a[10]=1-(k+n),a[11]=0,a[12]=c[0],a[13]=c[1],a[14]=c[2],a[15]=1,a},e.fromRotationTranslationScale=function(a,b,c,d){var e=b[0],f=b[1],g=b[2],h=b[3],i=e+e,j=f+f,k=g+g,l=e*i,m=e*j,n=e*k,o=f*j,p=f*k,q=g*k,r=h*i,s=h*j,t=h*k,u=d[0],v=d[1],w=d[2];return a[0]=(1-(o+q))*u,a[1]=(m+t)*u,a[2]=(n-s)*u,a[3]=0,a[4]=(m-t)*v,a[5]=(1-(l+q))*v,a[6]=(p+r)*v,a[7]=0,a[8]=(n+s)*w,a[9]=(p-r)*w,a[10]=(1-(l+o))*w,a[11]=0,a[12]=c[0],a[13]=c[1],a[14]=c[2],a[15]=1,a},e.fromRotationTranslationScaleOrigin=function(a,b,c,d,e){var f=b[0],g=b[1],h=b[2],i=b[3],j=f+f,k=g+g,l=h+h,m=f*j,n=f*k,o=f*l,p=g*k,q=g*l,r=h*l,s=i*j,t=i*k,u=i*l,v=d[0],w=d[1],x=d[2],y=e[0],z=e[1],A=e[2];return a[0]=(1-(p+r))*v,a[1]=(n+u)*v,a[2]=(o-t)*v,a[3]=0,a[4]=(n-u)*w,a[5]=(1-(m+r))*w,a[6]=(q+s)*w,a[7]=0,a[8]=(o+t)*x,a[9]=(q-s)*x,a[10]=(1-(m+p))*x,a[11]=0,a[12]=c[0]+y-(a[0]*y+a[4]*z+a[8]*A),a[13]=c[1]+z-(a[1]*y+a[5]*z+a[9]*A),a[14]=c[2]+A-(a[2]*y+a[6]*z+a[10]*A),a[15]=1,a},e.fromQuat=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=c+c,h=d+d,i=e+e,j=c*g,k=d*g,l=d*h,m=e*g,n=e*h,o=e*i,p=f*g,q=f*h,r=f*i;return a[0]=1-l-o,a[1]=k+r,a[2]=m-q,a[3]=0,a[4]=k-r,a[5]=1-j-o,a[6]=n+p,a[7]=0,a[8]=m+q,a[9]=n-p,a[10]=1-j-l,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},e.frustum=function(a,b,c,d,e,f,g){var h=1/(c-b),i=1/(e-d),j=1/(f-g);return a[0]=2*f*h,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=2*f*i,a[6]=0,a[7]=0,a[8]=(c+b)*h,a[9]=(e+d)*i,a[10]=(g+f)*j,a[11]=-1,a[12]=0,a[13]=0,a[14]=g*f*2*j,a[15]=0,a},e.perspective=function(a,b,c,d,e){var f=1/Math.tan(b/2),g=1/(d-e);return a[0]=f/c,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=f,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=(e+d)*g,a[11]=-1,a[12]=0,a[13]=0,a[14]=2*e*d*g,a[15]=0,a},e.perspectiveFromFieldOfView=function(a,b,c,d){var e=Math.tan(b.upDegrees*Math.PI/180),f=Math.tan(b.downDegrees*Math.PI/180),g=Math.tan(b.leftDegrees*Math.PI/180),h=Math.tan(b.rightDegrees*Math.PI/180),i=2/(g+h),j=2/(e+f);return a[0]=i,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=j,a[6]=0,a[7]=0,a[8]=-((g-h)*i*.5),a[9]=(e-f)*j*.5,a[10]=d/(c-d),a[11]=-1,a[12]=0,a[13]=0,a[14]=d*c/(c-d),a[15]=0,a},e.ortho=function(a,b,c,d,e,f,g){var h=1/(b-c),i=1/(d-e),j=1/(f-g);return a[0]=-2*h,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=-2*i,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=2*j,a[11]=0,a[12]=(b+c)*h,a[13]=(e+d)*i,a[14]=(g+f)*j,a[15]=1,a},e.lookAt=function(a,b,c,f){var g,h,i,j,k,l,m,n,o,p,q=b[0],r=b[1],s=b[2],t=f[0],u=f[1],v=f[2],w=c[0],x=c[1],y=c[2];return Math.abs(q-w)<d.EPSILON&&Math.abs(r-x)<d.EPSILON&&Math.abs(s-y)<d.EPSILON?e.identity(a):(m=q-w,n=r-x,o=s-y,p=1/Math.sqrt(m*m+n*n+o*o),m*=p,n*=p,o*=p,g=u*o-v*n,h=v*m-t*o,i=t*n-u*m,p=Math.sqrt(g*g+h*h+i*i),p?(p=1/p,g*=p,h*=p,i*=p):(g=0,h=0,i=0),j=n*i-o*h,k=o*g-m*i,l=m*h-n*g,p=Math.sqrt(j*j+k*k+l*l),p?(p=1/p,j*=p,k*=p,l*=p):(j=0,k=0,l=0),a[0]=g,a[1]=j,a[2]=m,a[3]=0,a[4]=h,a[5]=k,a[6]=n,a[7]=0,a[8]=i,a[9]=l,a[10]=o,a[11]=0,a[12]=-(g*q+h*r+i*s),a[13]=-(j*q+k*r+l*s),a[14]=-(m*q+n*r+o*s),a[15]=1,a)},e.str=function(a){return"mat4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+", "+a[9]+", "+a[10]+", "+a[11]+", "+a[12]+", "+a[13]+", "+a[14]+", "+a[15]+")"},e.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2)+Math.pow(a[9],2)+Math.pow(a[10],2)+Math.pow(a[11],2)+Math.pow(a[12],2)+Math.pow(a[13],2)+Math.pow(a[14],2)+Math.pow(a[15],2))},a.exports=e},function(a,b,c){var d=c(1),e=c(4),f=c(7),g=c(8),h={};h.create=function(){var a=new d.ARRAY_TYPE(4);return a[0]=0,a[1]=0,a[2]=0,a[3]=1,a},h.rotationTo=function(){var a=f.create(),b=f.fromValues(1,0,0),c=f.fromValues(0,1,0);return function(d,e,g){var i=f.dot(e,g);return-.999999>i?(f.cross(a,b,e),f.length(a)<1e-6&&f.cross(a,c,e),f.normalize(a,a),h.setAxisAngle(d,a,Math.PI),d):i>.999999?(d[0]=0,d[1]=0,d[2]=0,d[3]=1,d):(f.cross(a,e,g),d[0]=a[0],d[1]=a[1],d[2]=a[2],d[3]=1+i,h.normalize(d,d))}}(),h.setAxes=function(){var a=e.create();return function(b,c,d,e){return a[0]=d[0],a[3]=d[1],a[6]=d[2],a[1]=e[0],a[4]=e[1],a[7]=e[2],a[2]=-c[0],a[5]=-c[1],a[8]=-c[2],h.normalize(b,h.fromMat3(b,a))}}(),h.clone=g.clone,h.fromValues=g.fromValues,h.copy=g.copy,h.set=g.set,h.identity=function(a){return a[0]=0,a[1]=0,a[2]=0,a[3]=1,a},h.setAxisAngle=function(a,b,c){c=.5*c;var d=Math.sin(c);return a[0]=d*b[0],a[1]=d*b[1],a[2]=d*b[2],a[3]=Math.cos(c),a},h.add=g.add,h.multiply=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=c[0],i=c[1],j=c[2],k=c[3];return a[0]=d*k+g*h+e*j-f*i,a[1]=e*k+g*i+f*h-d*j,a[2]=f*k+g*j+d*i-e*h,a[3]=g*k-d*h-e*i-f*j,a},h.mul=h.multiply,h.scale=g.scale,h.rotateX=function(a,b,c){c*=.5;var d=b[0],e=b[1],f=b[2],g=b[3],h=Math.sin(c),i=Math.cos(c);return a[0]=d*i+g*h,a[1]=e*i+f*h,a[2]=f*i-e*h,a[3]=g*i-d*h,a},h.rotateY=function(a,b,c){c*=.5;var d=b[0],e=b[1],f=b[2],g=b[3],h=Math.sin(c),i=Math.cos(c);return a[0]=d*i-f*h,a[1]=e*i+g*h,a[2]=f*i+d*h,a[3]=g*i-e*h,a},h.rotateZ=function(a,b,c){c*=.5;var d=b[0],e=b[1],f=b[2],g=b[3],h=Math.sin(c),i=Math.cos(c);return a[0]=d*i+e*h,a[1]=e*i-d*h,a[2]=f*i+g*h,a[3]=g*i-f*h,a},h.calculateW=function(a,b){var c=b[0],d=b[1],e=b[2];return a[0]=c,a[1]=d,a[2]=e,a[3]=Math.sqrt(Math.abs(1-c*c-d*d-e*e)),a},h.dot=g.dot,h.lerp=g.lerp,h.slerp=function(a,b,c,d){var e,f,g,h,i,j=b[0],k=b[1],l=b[2],m=b[3],n=c[0],o=c[1],p=c[2],q=c[3];return f=j*n+k*o+l*p+m*q,0>f&&(f=-f,n=-n,o=-o,p=-p,q=-q),1-f>1e-6?(e=Math.acos(f),g=Math.sin(e),h=Math.sin((1-d)*e)/g,i=Math.sin(d*e)/g):(h=1-d,i=d),a[0]=h*j+i*n,a[1]=h*k+i*o,a[2]=h*l+i*p,a[3]=h*m+i*q,a},h.sqlerp=function(){var a=h.create(),b=h.create();return function(c,d,e,f,g,i){return h.slerp(a,d,g,i),h.slerp(b,e,f,i),h.slerp(c,a,b,2*i*(1-i)),c}}(),h.invert=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=c*c+d*d+e*e+f*f,h=g?1/g:0;return a[0]=-c*h,a[1]=-d*h,a[2]=-e*h,a[3]=f*h,a},h.conjugate=function(a,b){return a[0]=-b[0],a[1]=-b[1],a[2]=-b[2],a[3]=b[3],a},h.length=g.length,h.len=h.length,h.squaredLength=g.squaredLength,h.sqrLen=h.squaredLength,h.normalize=g.normalize,h.fromMat3=function(a,b){var c,d=b[0]+b[4]+b[8];if(d>0)c=Math.sqrt(d+1),a[3]=.5*c,c=.5/c,a[0]=(b[5]-b[7])*c,a[1]=(b[6]-b[2])*c,a[2]=(b[1]-b[3])*c;else{var e=0;b[4]>b[0]&&(e=1),b[8]>b[3*e+e]&&(e=2);var f=(e+1)%3,g=(e+2)%3;c=Math.sqrt(b[3*e+e]-b[3*f+f]-b[3*g+g]+1),a[e]=.5*c,c=.5/c,a[3]=(b[3*f+g]-b[3*g+f])*c,a[f]=(b[3*f+e]+b[3*e+f])*c,a[g]=(b[3*g+e]+b[3*e+g])*c}return a},h.str=function(a){return"quat("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"},a.exports=h},function(a,b,c){var d=c(1),e={};e.create=function(){var a=new d.ARRAY_TYPE(3);return a[0]=0,a[1]=0,a[2]=0,a},e.clone=function(a){var b=new d.ARRAY_TYPE(3);return b[0]=a[0],b[1]=a[1],b[2]=a[2],b},e.fromValues=function(a,b,c){var e=new d.ARRAY_TYPE(3);return e[0]=a,e[1]=b,e[2]=c,e},e.copy=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a},e.set=function(a,b,c,d){return a[0]=b,a[1]=c,a[2]=d,a},e.add=function(a,b,c){return a[0]=b[0]+c[0],a[1]=b[1]+c[1],a[2]=b[2]+c[2],a},e.subtract=function(a,b,c){return a[0]=b[0]-c[0],a[1]=b[1]-c[1],a[2]=b[2]-c[2],a},e.sub=e.subtract,e.multiply=function(a,b,c){return a[0]=b[0]*c[0],a[1]=b[1]*c[1],a[2]=b[2]*c[2],a},e.mul=e.multiply,e.divide=function(a,b,c){return a[0]=b[0]/c[0],a[1]=b[1]/c[1],a[2]=b[2]/c[2],a},e.div=e.divide,e.min=function(a,b,c){return a[0]=Math.min(b[0],c[0]),a[1]=Math.min(b[1],c[1]),a[2]=Math.min(b[2],c[2]),a},e.max=function(a,b,c){return a[0]=Math.max(b[0],c[0]),a[1]=Math.max(b[1],c[1]),a[2]=Math.max(b[2],c[2]),a},e.scale=function(a,b,c){return a[0]=b[0]*c,a[1]=b[1]*c,a[2]=b[2]*c,a},e.scaleAndAdd=function(a,b,c,d){return a[0]=b[0]+c[0]*d,a[1]=b[1]+c[1]*d,a[2]=b[2]+c[2]*d,a},e.distance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1],e=b[2]-a[2];return Math.sqrt(c*c+d*d+e*e)},e.dist=e.distance,e.squaredDistance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1],e=b[2]-a[2];return c*c+d*d+e*e},e.sqrDist=e.squaredDistance,e.length=function(a){var b=a[0],c=a[1],d=a[2];return Math.sqrt(b*b+c*c+d*d)},e.len=e.length,e.squaredLength=function(a){var b=a[0],c=a[1],d=a[2];return b*b+c*c+d*d},e.sqrLen=e.squaredLength,e.negate=function(a,b){return a[0]=-b[0],a[1]=-b[1],a[2]=-b[2],a},e.inverse=function(a,b){return a[0]=1/b[0],a[1]=1/b[1],a[2]=1/b[2],a},e.normalize=function(a,b){var c=b[0],d=b[1],e=b[2],f=c*c+d*d+e*e;return f>0&&(f=1/Math.sqrt(f),a[0]=b[0]*f,a[1]=b[1]*f,a[2]=b[2]*f),a},e.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]},e.cross=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=c[0],h=c[1],i=c[2];return a[0]=e*i-f*h,a[1]=f*g-d*i,a[2]=d*h-e*g,a},e.lerp=function(a,b,c,d){var e=b[0],f=b[1],g=b[2];return a[0]=e+d*(c[0]-e),a[1]=f+d*(c[1]-f),a[2]=g+d*(c[2]-g),a},e.hermite=function(a,b,c,d,e,f){var g=f*f,h=g*(2*f-3)+1,i=g*(f-2)+f,j=g*(f-1),k=g*(3-2*f);return a[0]=b[0]*h+c[0]*i+d[0]*j+e[0]*k,a[1]=b[1]*h+c[1]*i+d[1]*j+e[1]*k,a[2]=b[2]*h+c[2]*i+d[2]*j+e[2]*k,a},e.bezier=function(a,b,c,d,e,f){var g=1-f,h=g*g,i=f*f,j=h*g,k=3*f*h,l=3*i*g,m=i*f;return a[0]=b[0]*j+c[0]*k+d[0]*l+e[0]*m,a[1]=b[1]*j+c[1]*k+d[1]*l+e[1]*m,a[2]=b[2]*j+c[2]*k+d[2]*l+e[2]*m,a},e.random=function(a,b){b=b||1;var c=2*d.RANDOM()*Math.PI,e=2*d.RANDOM()-1,f=Math.sqrt(1-e*e)*b;return a[0]=Math.cos(c)*f,a[1]=Math.sin(c)*f,a[2]=e*b,a},e.transformMat4=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=c[3]*d+c[7]*e+c[11]*f+c[15];return g=g||1,a[0]=(c[0]*d+c[4]*e+c[8]*f+c[12])/g,a[1]=(c[1]*d+c[5]*e+c[9]*f+c[13])/g,a[2]=(c[2]*d+c[6]*e+c[10]*f+c[14])/g,a},e.transformMat3=function(a,b,c){var d=b[0],e=b[1],f=b[2];return a[0]=d*c[0]+e*c[3]+f*c[6],a[1]=d*c[1]+e*c[4]+f*c[7],a[2]=d*c[2]+e*c[5]+f*c[8],a},e.transformQuat=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=c[0],h=c[1],i=c[2],j=c[3],k=j*d+h*f-i*e,l=j*e+i*d-g*f,m=j*f+g*e-h*d,n=-g*d-h*e-i*f;return a[0]=k*j+n*-g+l*-i-m*-h,a[1]=l*j+n*-h+m*-g-k*-i,a[2]=m*j+n*-i+k*-h-l*-g,a},e.rotateX=function(a,b,c,d){var e=[],f=[];return e[0]=b[0]-c[0],e[1]=b[1]-c[1],e[2]=b[2]-c[2],f[0]=e[0],f[1]=e[1]*Math.cos(d)-e[2]*Math.sin(d),f[2]=e[1]*Math.sin(d)+e[2]*Math.cos(d),a[0]=f[0]+c[0],a[1]=f[1]+c[1],a[2]=f[2]+c[2],a},e.rotateY=function(a,b,c,d){var e=[],f=[];return e[0]=b[0]-c[0],e[1]=b[1]-c[1],e[2]=b[2]-c[2],f[0]=e[2]*Math.sin(d)+e[0]*Math.cos(d),f[1]=e[1],f[2]=e[2]*Math.cos(d)-e[0]*Math.sin(d),a[0]=f[0]+c[0],a[1]=f[1]+c[1],a[2]=f[2]+c[2],a},e.rotateZ=function(a,b,c,d){var e=[],f=[];return e[0]=b[0]-c[0],e[1]=b[1]-c[1],e[2]=b[2]-c[2],f[0]=e[0]*Math.cos(d)-e[1]*Math.sin(d),f[1]=e[0]*Math.sin(d)+e[1]*Math.cos(d),f[2]=e[2],a[0]=f[0]+c[0],a[1]=f[1]+c[1],a[2]=f[2]+c[2],a},e.forEach=function(){var a=e.create();return function(b,c,d,e,f,g){var h,i;for(c||(c=3),d||(d=0),i=e?Math.min(e*c+d,b.length):b.length,h=d;i>h;h+=c)a[0]=b[h],a[1]=b[h+1],a[2]=b[h+2],f(a,a,g),b[h]=a[0],b[h+1]=a[1],b[h+2]=a[2];return b}}(),e.angle=function(a,b){var c=e.fromValues(a[0],a[1],a[2]),d=e.fromValues(b[0],b[1],b[2]);e.normalize(c,c),e.normalize(d,d);var f=e.dot(c,d);return f>1?0:Math.acos(f)},e.str=function(a){return"vec3("+a[0]+", "+a[1]+", "+a[2]+")"},a.exports=e},function(a,b,c){var d=c(1),e={};e.create=function(){var a=new d.ARRAY_TYPE(4);return a[0]=0,a[1]=0,a[2]=0,a[3]=0,a},e.clone=function(a){var b=new d.ARRAY_TYPE(4);return b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b},e.fromValues=function(a,b,c,e){var f=new d.ARRAY_TYPE(4);return f[0]=a,f[1]=b,f[2]=c,f[3]=e,f},e.copy=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a},e.set=function(a,b,c,d,e){return a[0]=b,a[1]=c,a[2]=d,a[3]=e,a},e.add=function(a,b,c){return a[0]=b[0]+c[0],a[1]=b[1]+c[1],a[2]=b[2]+c[2],a[3]=b[3]+c[3],a},e.subtract=function(a,b,c){return a[0]=b[0]-c[0],a[1]=b[1]-c[1],a[2]=b[2]-c[2],a[3]=b[3]-c[3],a},e.sub=e.subtract,e.multiply=function(a,b,c){return a[0]=b[0]*c[0],a[1]=b[1]*c[1],a[2]=b[2]*c[2],a[3]=b[3]*c[3],
a},e.mul=e.multiply,e.divide=function(a,b,c){return a[0]=b[0]/c[0],a[1]=b[1]/c[1],a[2]=b[2]/c[2],a[3]=b[3]/c[3],a},e.div=e.divide,e.min=function(a,b,c){return a[0]=Math.min(b[0],c[0]),a[1]=Math.min(b[1],c[1]),a[2]=Math.min(b[2],c[2]),a[3]=Math.min(b[3],c[3]),a},e.max=function(a,b,c){return a[0]=Math.max(b[0],c[0]),a[1]=Math.max(b[1],c[1]),a[2]=Math.max(b[2],c[2]),a[3]=Math.max(b[3],c[3]),a},e.scale=function(a,b,c){return a[0]=b[0]*c,a[1]=b[1]*c,a[2]=b[2]*c,a[3]=b[3]*c,a},e.scaleAndAdd=function(a,b,c,d){return a[0]=b[0]+c[0]*d,a[1]=b[1]+c[1]*d,a[2]=b[2]+c[2]*d,a[3]=b[3]+c[3]*d,a},e.distance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1],e=b[2]-a[2],f=b[3]-a[3];return Math.sqrt(c*c+d*d+e*e+f*f)},e.dist=e.distance,e.squaredDistance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1],e=b[2]-a[2],f=b[3]-a[3];return c*c+d*d+e*e+f*f},e.sqrDist=e.squaredDistance,e.length=function(a){var b=a[0],c=a[1],d=a[2],e=a[3];return Math.sqrt(b*b+c*c+d*d+e*e)},e.len=e.length,e.squaredLength=function(a){var b=a[0],c=a[1],d=a[2],e=a[3];return b*b+c*c+d*d+e*e},e.sqrLen=e.squaredLength,e.negate=function(a,b){return a[0]=-b[0],a[1]=-b[1],a[2]=-b[2],a[3]=-b[3],a},e.inverse=function(a,b){return a[0]=1/b[0],a[1]=1/b[1],a[2]=1/b[2],a[3]=1/b[3],a},e.normalize=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=c*c+d*d+e*e+f*f;return g>0&&(g=1/Math.sqrt(g),a[0]=c*g,a[1]=d*g,a[2]=e*g,a[3]=f*g),a},e.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3]},e.lerp=function(a,b,c,d){var e=b[0],f=b[1],g=b[2],h=b[3];return a[0]=e+d*(c[0]-e),a[1]=f+d*(c[1]-f),a[2]=g+d*(c[2]-g),a[3]=h+d*(c[3]-h),a},e.random=function(a,b){return b=b||1,a[0]=d.RANDOM(),a[1]=d.RANDOM(),a[2]=d.RANDOM(),a[3]=d.RANDOM(),e.normalize(a,a),e.scale(a,a,b),a},e.transformMat4=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3];return a[0]=c[0]*d+c[4]*e+c[8]*f+c[12]*g,a[1]=c[1]*d+c[5]*e+c[9]*f+c[13]*g,a[2]=c[2]*d+c[6]*e+c[10]*f+c[14]*g,a[3]=c[3]*d+c[7]*e+c[11]*f+c[15]*g,a},e.transformQuat=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=c[0],h=c[1],i=c[2],j=c[3],k=j*d+h*f-i*e,l=j*e+i*d-g*f,m=j*f+g*e-h*d,n=-g*d-h*e-i*f;return a[0]=k*j+n*-g+l*-i-m*-h,a[1]=l*j+n*-h+m*-g-k*-i,a[2]=m*j+n*-i+k*-h-l*-g,a[3]=b[3],a},e.forEach=function(){var a=e.create();return function(b,c,d,e,f,g){var h,i;for(c||(c=4),d||(d=0),i=e?Math.min(e*c+d,b.length):b.length,h=d;i>h;h+=c)a[0]=b[h],a[1]=b[h+1],a[2]=b[h+2],a[3]=b[h+3],f(a,a,g),b[h]=a[0],b[h+1]=a[1],b[h+2]=a[2],b[h+3]=a[3];return b}}(),e.str=function(a){return"vec4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"},a.exports=e},function(a,b,c){var d=c(1),e={};e.create=function(){var a=new d.ARRAY_TYPE(2);return a[0]=0,a[1]=0,a},e.clone=function(a){var b=new d.ARRAY_TYPE(2);return b[0]=a[0],b[1]=a[1],b},e.fromValues=function(a,b){var c=new d.ARRAY_TYPE(2);return c[0]=a,c[1]=b,c},e.copy=function(a,b){return a[0]=b[0],a[1]=b[1],a},e.set=function(a,b,c){return a[0]=b,a[1]=c,a},e.add=function(a,b,c){return a[0]=b[0]+c[0],a[1]=b[1]+c[1],a},e.subtract=function(a,b,c){return a[0]=b[0]-c[0],a[1]=b[1]-c[1],a},e.sub=e.subtract,e.multiply=function(a,b,c){return a[0]=b[0]*c[0],a[1]=b[1]*c[1],a},e.mul=e.multiply,e.divide=function(a,b,c){return a[0]=b[0]/c[0],a[1]=b[1]/c[1],a},e.div=e.divide,e.min=function(a,b,c){return a[0]=Math.min(b[0],c[0]),a[1]=Math.min(b[1],c[1]),a},e.max=function(a,b,c){return a[0]=Math.max(b[0],c[0]),a[1]=Math.max(b[1],c[1]),a},e.scale=function(a,b,c){return a[0]=b[0]*c,a[1]=b[1]*c,a},e.scaleAndAdd=function(a,b,c,d){return a[0]=b[0]+c[0]*d,a[1]=b[1]+c[1]*d,a},e.distance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1];return Math.sqrt(c*c+d*d)},e.dist=e.distance,e.squaredDistance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1];return c*c+d*d},e.sqrDist=e.squaredDistance,e.length=function(a){var b=a[0],c=a[1];return Math.sqrt(b*b+c*c)},e.len=e.length,e.squaredLength=function(a){var b=a[0],c=a[1];return b*b+c*c},e.sqrLen=e.squaredLength,e.negate=function(a,b){return a[0]=-b[0],a[1]=-b[1],a},e.inverse=function(a,b){return a[0]=1/b[0],a[1]=1/b[1],a},e.normalize=function(a,b){var c=b[0],d=b[1],e=c*c+d*d;return e>0&&(e=1/Math.sqrt(e),a[0]=b[0]*e,a[1]=b[1]*e),a},e.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]},e.cross=function(a,b,c){var d=b[0]*c[1]-b[1]*c[0];return a[0]=a[1]=0,a[2]=d,a},e.lerp=function(a,b,c,d){var e=b[0],f=b[1];return a[0]=e+d*(c[0]-e),a[1]=f+d*(c[1]-f),a},e.random=function(a,b){b=b||1;var c=2*d.RANDOM()*Math.PI;return a[0]=Math.cos(c)*b,a[1]=Math.sin(c)*b,a},e.transformMat2=function(a,b,c){var d=b[0],e=b[1];return a[0]=c[0]*d+c[2]*e,a[1]=c[1]*d+c[3]*e,a},e.transformMat2d=function(a,b,c){var d=b[0],e=b[1];return a[0]=c[0]*d+c[2]*e+c[4],a[1]=c[1]*d+c[3]*e+c[5],a},e.transformMat3=function(a,b,c){var d=b[0],e=b[1];return a[0]=c[0]*d+c[3]*e+c[6],a[1]=c[1]*d+c[4]*e+c[7],a},e.transformMat4=function(a,b,c){var d=b[0],e=b[1];return a[0]=c[0]*d+c[4]*e+c[12],a[1]=c[1]*d+c[5]*e+c[13],a},e.forEach=function(){var a=e.create();return function(b,c,d,e,f,g){var h,i;for(c||(c=2),d||(d=0),i=e?Math.min(e*c+d,b.length):b.length,h=d;i>h;h+=c)a[0]=b[h],a[1]=b[h+1],f(a,a,g),b[h]=a[0],b[h+1]=a[1];return b}}(),e.str=function(a){return"vec2("+a[0]+", "+a[1]+")"},a.exports=e}])}),function(a,b,c,d){"use strict";function e(a,b,c){return setTimeout(k(a,c),b)}function f(a,b,c){return Array.isArray(a)?(g(a,c[b],c),!0):!1}function g(a,b,c){var e;if(a)if(a.forEach)a.forEach(b,c);else if(a.length!==d)for(e=0;e<a.length;)b.call(c,a[e],e,a),e++;else for(e in a)a.hasOwnProperty(e)&&b.call(c,a[e],e,a)}function h(a,b,c){for(var e=Object.keys(b),f=0;f<e.length;)(!c||c&&a[e[f]]===d)&&(a[e[f]]=b[e[f]]),f++;return a}function i(a,b){return h(a,b,!0)}function j(a,b,c){var d,e=b.prototype;d=a.prototype=Object.create(e),d.constructor=a,d._super=e,c&&h(d,c)}function k(a,b){return function(){return a.apply(b,arguments)}}function l(a,b){return typeof a==ka?a.apply(b?b[0]||d:d,b):a}function m(a,b){return a===d?b:a}function n(a,b,c){g(r(b),function(b){a.addEventListener(b,c,!1)})}function o(a,b,c){g(r(b),function(b){a.removeEventListener(b,c,!1)})}function p(a,b){for(;a;){if(a==b)return!0;a=a.parentNode}return!1}function q(a,b){return a.indexOf(b)>-1}function r(a){return a.trim().split(/\s+/g)}function s(a,b,c){if(a.indexOf&&!c)return a.indexOf(b);for(var d=0;d<a.length;){if(c&&a[d][c]==b||!c&&a[d]===b)return d;d++}return-1}function t(a){return Array.prototype.slice.call(a,0)}function u(a,b,c){for(var d=[],e=[],f=0;f<a.length;){var g=b?a[f][b]:a[f];s(e,g)<0&&d.push(a[f]),e[f]=g,f++}return c&&(d=b?d.sort(function(a,c){return a[b]>c[b]}):d.sort()),d}function v(a,b){for(var c,e,f=b[0].toUpperCase()+b.slice(1),g=0;g<ia.length;){if(c=ia[g],e=c?c+f:b,e in a)return e;g++}return d}function w(){return oa++}function x(a){var b=a.ownerDocument;return b.defaultView||b.parentWindow}function y(a,b){var c=this;this.manager=a,this.callback=b,this.element=a.element,this.target=a.options.inputTarget,this.domHandler=function(b){l(a.options.enable,[a])&&c.handler(b)},this.init()}function z(a){var b,c=a.options.inputClass;return new(b=c?c:ra?N:sa?Q:qa?S:M)(a,A)}function A(a,b,c){var d=c.pointers.length,e=c.changedPointers.length,f=b&ya&&d-e===0,g=b&(Aa|Ba)&&d-e===0;c.isFirst=!!f,c.isFinal=!!g,f&&(a.session={}),c.eventType=b,B(a,c),a.emit("hammer.input",c),a.recognize(c),a.session.prevInput=c}function B(a,b){var c=a.session,d=b.pointers,e=d.length;c.firstInput||(c.firstInput=E(b)),e>1&&!c.firstMultiple?c.firstMultiple=E(b):1===e&&(c.firstMultiple=!1);var f=c.firstInput,g=c.firstMultiple,h=g?g.center:f.center,i=b.center=F(d);b.timeStamp=na(),b.deltaTime=b.timeStamp-f.timeStamp,b.angle=J(h,i),b.distance=I(h,i),C(c,b),b.offsetDirection=H(b.deltaX,b.deltaY),b.scale=g?L(g.pointers,d):1,b.rotation=g?K(g.pointers,d):0,D(c,b);var j=a.element;p(b.srcEvent.target,j)&&(j=b.srcEvent.target),b.target=j}function C(a,b){var c=b.center,d=a.offsetDelta||{},e=a.prevDelta||{},f=a.prevInput||{};(b.eventType===ya||f.eventType===Aa)&&(e=a.prevDelta={x:f.deltaX||0,y:f.deltaY||0},d=a.offsetDelta={x:c.x,y:c.y}),b.deltaX=e.x+(c.x-d.x),b.deltaY=e.y+(c.y-d.y)}function D(a,b){var c,e,f,g,h=a.lastInterval||b,i=b.timeStamp-h.timeStamp;if(b.eventType!=Ba&&(i>xa||h.velocity===d)){var j=h.deltaX-b.deltaX,k=h.deltaY-b.deltaY,l=G(i,j,k);e=l.x,f=l.y,c=ma(l.x)>ma(l.y)?l.x:l.y,g=H(j,k),a.lastInterval=b}else c=h.velocity,e=h.velocityX,f=h.velocityY,g=h.direction;b.velocity=c,b.velocityX=e,b.velocityY=f,b.direction=g}function E(a){for(var b=[],c=0;c<a.pointers.length;)b[c]={clientX:la(a.pointers[c].clientX),clientY:la(a.pointers[c].clientY)},c++;return{timeStamp:na(),pointers:b,center:F(b),deltaX:a.deltaX,deltaY:a.deltaY}}function F(a){var b=a.length;if(1===b)return{x:la(a[0].clientX),y:la(a[0].clientY)};for(var c=0,d=0,e=0;b>e;)c+=a[e].clientX,d+=a[e].clientY,e++;return{x:la(c/b),y:la(d/b)}}function G(a,b,c){return{x:b/a||0,y:c/a||0}}function H(a,b){return a===b?Ca:ma(a)>=ma(b)?a>0?Da:Ea:b>0?Fa:Ga}function I(a,b,c){c||(c=Ka);var d=b[c[0]]-a[c[0]],e=b[c[1]]-a[c[1]];return Math.sqrt(d*d+e*e)}function J(a,b,c){c||(c=Ka);var d=b[c[0]]-a[c[0]],e=b[c[1]]-a[c[1]];return 180*Math.atan2(e,d)/Math.PI}function K(a,b){return J(b[1],b[0],La)-J(a[1],a[0],La)}function L(a,b){return I(b[0],b[1],La)/I(a[0],a[1],La)}function M(){this.evEl=Na,this.evWin=Oa,this.allow=!0,this.pressed=!1,y.apply(this,arguments)}function N(){this.evEl=Ra,this.evWin=Sa,y.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}function O(){this.evTarget=Ua,this.evWin=Va,this.started=!1,y.apply(this,arguments)}function P(a,b){var c=t(a.touches),d=t(a.changedTouches);return b&(Aa|Ba)&&(c=u(c.concat(d),"identifier",!0)),[c,d]}function Q(){this.evTarget=Xa,this.targetIds={},y.apply(this,arguments)}function R(a,b){var c=t(a.touches),d=this.targetIds;if(b&(ya|za)&&1===c.length)return d[c[0].identifier]=!0,[c,c];var e,f,g=t(a.changedTouches),h=[],i=this.target;if(f=c.filter(function(a){return p(a.target,i)}),b===ya)for(e=0;e<f.length;)d[f[e].identifier]=!0,e++;for(e=0;e<g.length;)d[g[e].identifier]&&h.push(g[e]),b&(Aa|Ba)&&delete d[g[e].identifier],e++;return h.length?[u(f.concat(h),"identifier",!0),h]:void 0}function S(){y.apply(this,arguments);var a=k(this.handler,this);this.touch=new Q(this.manager,a),this.mouse=new M(this.manager,a)}function T(a,b){this.manager=a,this.set(b)}function U(a){if(q(a,bb))return bb;var b=q(a,cb),c=q(a,db);return b&&c?cb+" "+db:b||c?b?cb:db:q(a,ab)?ab:_a}function V(a){this.id=w(),this.manager=null,this.options=i(a||{},this.defaults),this.options.enable=m(this.options.enable,!0),this.state=eb,this.simultaneous={},this.requireFail=[]}function W(a){return a&jb?"cancel":a&hb?"end":a&gb?"move":a&fb?"start":""}function X(a){return a==Ga?"down":a==Fa?"up":a==Da?"left":a==Ea?"right":""}function Y(a,b){var c=b.manager;return c?c.get(a):a}function Z(){V.apply(this,arguments)}function $(){Z.apply(this,arguments),this.pX=null,this.pY=null}function _(){Z.apply(this,arguments)}function aa(){V.apply(this,arguments),this._timer=null,this._input=null}function ba(){Z.apply(this,arguments)}function ca(){Z.apply(this,arguments)}function da(){V.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function ea(a,b){return b=b||{},b.recognizers=m(b.recognizers,ea.defaults.preset),new fa(a,b)}function fa(a,b){b=b||{},this.options=i(b,ea.defaults),this.options.inputTarget=this.options.inputTarget||a,this.handlers={},this.session={},this.recognizers=[],this.element=a,this.input=z(this),this.touchAction=new T(this,this.options.touchAction),ga(this,!0),g(b.recognizers,function(a){var b=this.add(new a[0](a[1]));a[2]&&b.recognizeWith(a[2]),a[3]&&b.requireFailure(a[3])},this)}function ga(a,b){var c=a.element;g(a.options.cssProps,function(a,d){c.style[v(c.style,d)]=b?a:""})}function ha(a,c){var d=b.createEvent("Event");d.initEvent(a,!0,!0),d.gesture=c,c.target.dispatchEvent(d)}var ia=["","webkit","moz","MS","ms","o"],ja=b.createElement("div"),ka="function",la=Math.round,ma=Math.abs,na=Date.now,oa=1,pa=/mobile|tablet|ip(ad|hone|od)|android/i,qa="ontouchstart"in a,ra=v(a,"PointerEvent")!==d,sa=qa&&pa.test(navigator.userAgent),ta="touch",ua="pen",va="mouse",wa="kinect",xa=25,ya=1,za=2,Aa=4,Ba=8,Ca=1,Da=2,Ea=4,Fa=8,Ga=16,Ha=Da|Ea,Ia=Fa|Ga,Ja=Ha|Ia,Ka=["x","y"],La=["clientX","clientY"];y.prototype={handler:function(){},init:function(){this.evEl&&n(this.element,this.evEl,this.domHandler),this.evTarget&&n(this.target,this.evTarget,this.domHandler),this.evWin&&n(x(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&o(this.element,this.evEl,this.domHandler),this.evTarget&&o(this.target,this.evTarget,this.domHandler),this.evWin&&o(x(this.element),this.evWin,this.domHandler)}};var Ma={mousedown:ya,mousemove:za,mouseup:Aa},Na="mousedown",Oa="mousemove mouseup";j(M,y,{handler:function(a){var b=Ma[a.type];b&ya&&0===a.button&&(this.pressed=!0),b&za&&1!==a.which&&(b=Aa),this.pressed&&this.allow&&(b&Aa&&(this.pressed=!1),this.callback(this.manager,b,{pointers:[a],changedPointers:[a],pointerType:va,srcEvent:a}))}});var Pa={pointerdown:ya,pointermove:za,pointerup:Aa,pointercancel:Ba,pointerout:Ba},Qa={2:ta,3:ua,4:va,5:wa},Ra="pointerdown",Sa="pointermove pointerup pointercancel";a.MSPointerEvent&&(Ra="MSPointerDown",Sa="MSPointerMove MSPointerUp MSPointerCancel"),j(N,y,{handler:function(a){var b=this.store,c=!1,d=a.type.toLowerCase().replace("ms",""),e=Pa[d],f=Qa[a.pointerType]||a.pointerType,g=f==ta,h=s(b,a.pointerId,"pointerId");e&ya&&(0===a.button||g)?0>h&&(b.push(a),h=b.length-1):e&(Aa|Ba)&&(c=!0),0>h||(b[h]=a,this.callback(this.manager,e,{pointers:b,changedPointers:[a],pointerType:f,srcEvent:a}),c&&b.splice(h,1))}});var Ta={touchstart:ya,touchmove:za,touchend:Aa,touchcancel:Ba},Ua="touchstart",Va="touchstart touchmove touchend touchcancel";j(O,y,{handler:function(a){var b=Ta[a.type];if(b===ya&&(this.started=!0),this.started){var c=P.call(this,a,b);b&(Aa|Ba)&&c[0].length-c[1].length===0&&(this.started=!1),this.callback(this.manager,b,{pointers:c[0],changedPointers:c[1],pointerType:ta,srcEvent:a})}}});var Wa={touchstart:ya,touchmove:za,touchend:Aa,touchcancel:Ba},Xa="touchstart touchmove touchend touchcancel";j(Q,y,{handler:function(a){var b=Wa[a.type],c=R.call(this,a,b);c&&this.callback(this.manager,b,{pointers:c[0],changedPointers:c[1],pointerType:ta,srcEvent:a})}}),j(S,y,{handler:function(a,b,c){var d=c.pointerType==ta,e=c.pointerType==va;if(d)this.mouse.allow=!1;else if(e&&!this.mouse.allow)return;b&(Aa|Ba)&&(this.mouse.allow=!0),this.callback(a,b,c)},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var Ya=v(ja.style,"touchAction"),Za=Ya!==d,$a="compute",_a="auto",ab="manipulation",bb="none",cb="pan-x",db="pan-y";T.prototype={set:function(a){a==$a&&(a=this.compute()),Za&&(this.manager.element.style[Ya]=a),this.actions=a.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var a=[];return g(this.manager.recognizers,function(b){l(b.options.enable,[b])&&(a=a.concat(b.getTouchAction()))}),U(a.join(" "))},preventDefaults:function(a){if(!Za){var b=a.srcEvent,c=a.offsetDirection;if(this.manager.session.prevented)return void b.preventDefault();var d=this.actions,e=q(d,bb),f=q(d,db),g=q(d,cb);return e||f&&c&Ha||g&&c&Ia?this.preventSrc(b):void 0}},preventSrc:function(a){this.manager.session.prevented=!0,a.preventDefault()}};var eb=1,fb=2,gb=4,hb=8,ib=hb,jb=16,kb=32;V.prototype={defaults:{},set:function(a){return h(this.options,a),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(a){if(f(a,"recognizeWith",this))return this;var b=this.simultaneous;return a=Y(a,this),b[a.id]||(b[a.id]=a,a.recognizeWith(this)),this},dropRecognizeWith:function(a){return f(a,"dropRecognizeWith",this)?this:(a=Y(a,this),delete this.simultaneous[a.id],this)},requireFailure:function(a){if(f(a,"requireFailure",this))return this;var b=this.requireFail;return a=Y(a,this),-1===s(b,a)&&(b.push(a),a.requireFailure(this)),this},dropRequireFailure:function(a){if(f(a,"dropRequireFailure",this))return this;a=Y(a,this);var b=s(this.requireFail,a);return b>-1&&this.requireFail.splice(b,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(a){return!!this.simultaneous[a.id]},emit:function(a){function b(b){c.manager.emit(c.options.event+(b?W(d):""),a)}var c=this,d=this.state;hb>d&&b(!0),b(),d>=hb&&b(!0)},tryEmit:function(a){return this.canEmit()?this.emit(a):void(this.state=kb)},canEmit:function(){for(var a=0;a<this.requireFail.length;){if(!(this.requireFail[a].state&(kb|eb)))return!1;a++}return!0},recognize:function(a){var b=h({},a);return l(this.options.enable,[this,b])?(this.state&(ib|jb|kb)&&(this.state=eb),this.state=this.process(b),void(this.state&(fb|gb|hb|jb)&&this.tryEmit(b))):(this.reset(),void(this.state=kb))},process:function(a){},getTouchAction:function(){},reset:function(){}},j(Z,V,{defaults:{pointers:1},attrTest:function(a){var b=this.options.pointers;return 0===b||a.pointers.length===b},process:function(a){var b=this.state,c=a.eventType,d=b&(fb|gb),e=this.attrTest(a);return d&&(c&Ba||!e)?b|jb:d||e?c&Aa?b|hb:b&fb?b|gb:fb:kb}}),j($,Z,{defaults:{event:"pan",threshold:10,pointers:1,direction:Ja},getTouchAction:function(){var a=this.options.direction,b=[];return a&Ha&&b.push(db),a&Ia&&b.push(cb),b},directionTest:function(a){var b=this.options,c=!0,d=a.distance,e=a.direction,f=a.deltaX,g=a.deltaY;return e&b.direction||(b.direction&Ha?(e=0===f?Ca:0>f?Da:Ea,c=f!=this.pX,d=Math.abs(a.deltaX)):(e=0===g?Ca:0>g?Fa:Ga,c=g!=this.pY,d=Math.abs(a.deltaY))),a.direction=e,c&&d>b.threshold&&e&b.direction},attrTest:function(a){return Z.prototype.attrTest.call(this,a)&&(this.state&fb||!(this.state&fb)&&this.directionTest(a))},emit:function(a){this.pX=a.deltaX,this.pY=a.deltaY;var b=X(a.direction);b&&this.manager.emit(this.options.event+b,a),this._super.emit.call(this,a)}}),j(_,Z,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[bb]},attrTest:function(a){return this._super.attrTest.call(this,a)&&(Math.abs(a.scale-1)>this.options.threshold||this.state&fb)},emit:function(a){if(this._super.emit.call(this,a),1!==a.scale){var b=a.scale<1?"in":"out";this.manager.emit(this.options.event+b,a)}}}),j(aa,V,{defaults:{event:"press",pointers:1,time:500,threshold:5},getTouchAction:function(){return[_a]},process:function(a){var b=this.options,c=a.pointers.length===b.pointers,d=a.distance<b.threshold,f=a.deltaTime>b.time;if(this._input=a,!d||!c||a.eventType&(Aa|Ba)&&!f)this.reset();else if(a.eventType&ya)this.reset(),this._timer=e(function(){this.state=ib,this.tryEmit()},b.time,this);else if(a.eventType&Aa)return ib;return kb},reset:function(){clearTimeout(this._timer)},emit:function(a){this.state===ib&&(a&&a.eventType&Aa?this.manager.emit(this.options.event+"up",a):(this._input.timeStamp=na(),this.manager.emit(this.options.event,this._input)))}}),j(ba,Z,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[bb]},attrTest:function(a){return this._super.attrTest.call(this,a)&&(Math.abs(a.rotation)>this.options.threshold||this.state&fb)}}),j(ca,Z,{defaults:{event:"swipe",threshold:10,velocity:.65,direction:Ha|Ia,pointers:1},getTouchAction:function(){return $.prototype.getTouchAction.call(this)},attrTest:function(a){var b,c=this.options.direction;return c&(Ha|Ia)?b=a.velocity:c&Ha?b=a.velocityX:c&Ia&&(b=a.velocityY),this._super.attrTest.call(this,a)&&c&a.direction&&a.distance>this.options.threshold&&ma(b)>this.options.velocity&&a.eventType&Aa},emit:function(a){var b=X(a.direction);b&&this.manager.emit(this.options.event+b,a),this.manager.emit(this.options.event,a)}}),j(da,V,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:2,posThreshold:10},getTouchAction:function(){return[ab]},process:function(a){var b=this.options,c=a.pointers.length===b.pointers,d=a.distance<b.threshold,f=a.deltaTime<b.time;if(this.reset(),a.eventType&ya&&0===this.count)return this.failTimeout();if(d&&f&&c){if(a.eventType!=Aa)return this.failTimeout();var g=this.pTime?a.timeStamp-this.pTime<b.interval:!0,h=!this.pCenter||I(this.pCenter,a.center)<b.posThreshold;this.pTime=a.timeStamp,this.pCenter=a.center,h&&g?this.count+=1:this.count=1,this._input=a;var i=this.count%b.taps;if(0===i)return this.hasRequireFailures()?(this._timer=e(function(){this.state=ib,this.tryEmit()},b.interval,this),fb):ib}return kb},failTimeout:function(){return this._timer=e(function(){this.state=kb},this.options.interval,this),kb},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==ib&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),ea.VERSION="2.0.4",ea.defaults={domEvents:!1,touchAction:$a,enable:!0,inputTarget:null,inputClass:null,preset:[[ba,{enable:!1}],[_,{enable:!1},["rotate"]],[ca,{direction:Ha}],[$,{direction:Ha},["swipe"]],[da],[da,{event:"doubletap",taps:2},["tap"]],[aa]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var lb=1,mb=2;fa.prototype={set:function(a){return h(this.options,a),a.touchAction&&this.touchAction.update(),a.inputTarget&&(this.input.destroy(),this.input.target=a.inputTarget,this.input.init()),this},stop:function(a){this.session.stopped=a?mb:lb},recognize:function(a){var b=this.session;if(!b.stopped){this.touchAction.preventDefaults(a);var c,d=this.recognizers,e=b.curRecognizer;(!e||e&&e.state&ib)&&(e=b.curRecognizer=null);for(var f=0;f<d.length;)c=d[f],b.stopped===mb||e&&c!=e&&!c.canRecognizeWith(e)?c.reset():c.recognize(a),!e&&c.state&(fb|gb|hb)&&(e=b.curRecognizer=c),f++}},get:function(a){if(a instanceof V)return a;for(var b=this.recognizers,c=0;c<b.length;c++)if(b[c].options.event==a)return b[c];return null},add:function(a){if(f(a,"add",this))return this;var b=this.get(a.options.event);return b&&this.remove(b),this.recognizers.push(a),a.manager=this,this.touchAction.update(),a},remove:function(a){if(f(a,"remove",this))return this;var b=this.recognizers;return a=this.get(a),b.splice(s(b,a),1),this.touchAction.update(),this},on:function(a,b){var c=this.handlers;return g(r(a),function(a){c[a]=c[a]||[],c[a].push(b)}),this},off:function(a,b){var c=this.handlers;return g(r(a),function(a){b?c[a].splice(s(c[a],b),1):delete c[a]}),this},emit:function(a,b){this.options.domEvents&&ha(a,b);var c=this.handlers[a]&&this.handlers[a].slice();if(c&&c.length){b.type=a,b.preventDefault=function(){b.srcEvent.preventDefault()};for(var d=0;d<c.length;)c[d](b),d++}},destroy:function(){this.element&&ga(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},h(ea,{INPUT_START:ya,INPUT_MOVE:za,INPUT_END:Aa,INPUT_CANCEL:Ba,STATE_POSSIBLE:eb,STATE_BEGAN:fb,STATE_CHANGED:gb,STATE_ENDED:hb,STATE_RECOGNIZED:ib,STATE_CANCELLED:jb,STATE_FAILED:kb,DIRECTION_NONE:Ca,DIRECTION_LEFT:Da,DIRECTION_RIGHT:Ea,DIRECTION_UP:Fa,DIRECTION_DOWN:Ga,DIRECTION_HORIZONTAL:Ha,DIRECTION_VERTICAL:Ia,DIRECTION_ALL:Ja,Manager:fa,Input:y,TouchAction:T,TouchInput:Q,MouseInput:M,PointerEventInput:N,TouchMouseInput:S,SingleTouchInput:O,Recognizer:V,AttrRecognizer:Z,Tap:da,Pan:$,Swipe:ca,Pinch:_,Rotate:ba,Press:aa,on:n,off:o,each:g,merge:i,extend:h,inherit:j,bindFn:k,prefixed:v}),typeof define==ka&&define.amd?define(function(){return ea}):"undefined"!=typeof module&&module.exports?module.exports=ea:a[c]=ea}(window,document,"Hammer"),function(){var a,b,c;return function(d){function e(a,b){return u.call(a,b)}function f(a,b){var c,d,e,f,g,h,i,j,k,l,m,n=b&&b.split("/"),o=s.map,p=o&&o["*"]||{};if(a&&"."===a.charAt(0))if(b){for(n=n.slice(0,n.length-1),a=a.split("/"),g=a.length-1,s.nodeIdCompat&&w.test(a[g])&&(a[g]=a[g].replace(w,"")),a=n.concat(a),k=0;k<a.length;k+=1)if(m=a[k],"."===m)a.splice(k,1),k-=1;else if(".."===m){if(1===k&&(".."===a[2]||".."===a[0]))break;k>0&&(a.splice(k-1,2),k-=2)}a=a.join("/")}else 0===a.indexOf("./")&&(a=a.substring(2));if((n||p)&&o){for(c=a.split("/"),k=c.length;k>0;k-=1){if(d=c.slice(0,k).join("/"),n)for(l=n.length;l>0;l-=1)if(e=o[n.slice(0,l).join("/")],e&&(e=e[d])){f=e,h=k;break}if(f)break;!i&&p&&p[d]&&(i=p[d],j=k)}!f&&i&&(f=i,h=j),f&&(c.splice(0,h,f),a=c.join("/"))}return a}function g(a,b){return function(){return n.apply(d,v.call(arguments,0).concat([a,b]))}}function h(a){return function(b){return f(b,a)}}function i(a){return function(b){q[a]=b}}function j(a){if(e(r,a)){var b=r[a];delete r[a],t[a]=!0,m.apply(d,b)}if(!e(q,a)&&!e(t,a))throw new Error("No "+a);return q[a]}function k(a){var b,c=a?a.indexOf("!"):-1;return c>-1&&(b=a.substring(0,c),a=a.substring(c+1,a.length)),[b,a]}function l(a){return function(){return s&&s.config&&s.config[a]||{}}}var m,n,o,p,q={},r={},s={},t={},u=Object.prototype.hasOwnProperty,v=[].slice,w=/\.js$/;o=function(a,b){var c,d=k(a),e=d[0];return a=d[1],e&&(e=f(e,b),c=j(e)),e?a=c&&c.normalize?c.normalize(a,h(b)):f(a,b):(a=f(a,b),d=k(a),e=d[0],a=d[1],e&&(c=j(e))),{f:e?e+"!"+a:a,n:a,pr:e,p:c}},p={require:function(a){return g(a)},exports:function(a){var b=q[a];return"undefined"!=typeof b?b:q[a]={}},module:function(a){return{id:a,uri:"",exports:q[a],config:l(a)}}},m=function(a,b,c,f){var h,k,l,m,n,s,u=[],v=typeof c;if(f=f||a,"undefined"===v||"function"===v){for(b=!b.length&&c.length?["require","exports","module"]:b,n=0;n<b.length;n+=1)if(m=o(b[n],f),k=m.f,"require"===k)u[n]=p.require(a);else if("exports"===k)u[n]=p.exports(a),s=!0;else if("module"===k)h=u[n]=p.module(a);else if(e(q,k)||e(r,k)||e(t,k))u[n]=j(k);else{if(!m.p)throw new Error(a+" missing "+k);m.p.load(m.n,g(f,!0),i(k),{}),u[n]=q[k]}l=c?c.apply(q[a],u):void 0,a&&(h&&h.exports!==d&&h.exports!==q[a]?q[a]=h.exports:l===d&&s||(q[a]=l))}else a&&(q[a]=c)},a=b=n=function(a,b,c,e,f){if("string"==typeof a)return p[a]?p[a](b):j(o(a,b).f);if(!a.splice){if(s=a,s.deps&&n(s.deps,s.callback),!b)return;b.splice?(a=b,b=c,c=null):a=d}return b=b||function(){},"function"==typeof c&&(c=e,e=f),e?m(d,a,b,c):setTimeout(function(){m(d,a,b,c)},4),n},n.config=function(a){return n(a)},a._defined=q,c=function(a,b,c){b.splice||(c=b,b=[]),e(q,a)||e(r,a)||(r[a]=[a,b,c])},c.amd={jQuery:!0}}(),c("../tools/almond",function(){}),c("utils/GuiUtils",["require","exports","module"],function(a,b,c){"use strict";var d={};d.makeProxy=function(a,b,c){for(var d=a.prototype,e=b.prototype,f=Object.keys(d),g=0,h=f.length;h>g;++g){var i=f[g];e[i]||(e[i]=c?c(d[i]):d[i])}},d.rgbToHsv=function(a){var b=a[0],c=a[1],d=a[2],e=Math.max(b,c,d),f=Math.min(b,c,d);if(f===e)return[0,0,f];var g=b===f?c-d:d===f?b-c:d-b,h=b===f?3:d===f?1:5;return[(h-g/(e-f))/6,(e-f)/e,e]},d.hsvToRgb=function(a){var b=6*a[0],c=a[1],d=a[2],e=Math.floor(b),f=b-e,g=d*(1-c),h=d*(1-f*c),i=d*(1-(1-f)*c),j=e%6;return 0===j?[d,i,g]:1===j?[h,d,g]:2===j?[g,d,i]:3===j?[g,h,d]:4===j?[i,g,d]:[d,g,h]},d.getValidColor=function(a){for(var b=0,c=a.length;c>b;++b)a[b]=Math.max(0,Math.min(1,a[b]));return a},d.getStrColor=function(a){return 3===a.length?d.rgbToHex(a):"rgba("+Math.round(255*a[0])+","+Math.round(255*a[1])+","+Math.round(255*a[2])+","+a[3]+")"},d.getColorMult=function(a,b){var c=[a[0]*b,a[1]*b,a[2]*b];return 4===a.length&&c.push(a[3]),d.getValidColor(c)},d.getColorAdd=function(a,b){var c=[a[0]+b,a[1]+b,a[2]+b];return 4===a.length&&c.push(a[3]),d.getValidColor(c)},d.rgbToHex=function(a){for(var b="#",c=0;3>c;++c){var d=Math.round(255*a[c]).toString(16);b+=1===d.length?"0"+d:d}return b},d.hexToRgb=function(a){var b=0;"#"===a[0]&&(a=a.slice(1));var c=a;if(a.length>6)c=a.slice(0,6);else if(a.length<6)for(c="",b=0;3>b;++b)c+=a[b]?a[b]+a[b]:"00";var d=[0,0,0];for(b=0;3>b;++b){var e=parseInt(c[2*b]+c[2*b+1],16);d[b]=(e!==e?0:e)/255}return d},c.exports=d}),c("widgets/BaseWidget",["require","exports","module"],function(a,b,c){"use strict";var d=function(){};d.prototype={_getInitialValue:function(a,b){return"string"!=typeof b?a:a[b]},_getCheckCallback:function(a,b){return"string"!=typeof b?b:function(c){a[b]=c}},_setDomContainer:function(a){this.domContainer=a},setCallback:function(a){this.callback=a},setVisibility:function(a){this.domContainer&&(this.domContainer.hidden=!a)}},c.exports=d}),c("widgets/Button",["require","exports","module","utils/GuiUtils","widgets/BaseWidget"],function(a,b,c){"use strict";var d=a("utils/GuiUtils"),e=a("widgets/BaseWidget"),f=function(a,b,c){var d=c?b[c].bind(b):b;this.domButton=document.createElement("button"),this.domButton.className="gui-button",this.domButton.innerHTML=a||"",this.domButton.addEventListener("click",this._onClick.bind(this)),this.setCallback(d)};f.prototype={setEnable:function(a){this.domButton.disabled=void 0===a?!1:!a},_onClick:function(){this.callback&&this.callback()}},d.makeProxy(e,f),c.exports=f}),c("widgets/Checkbox",["require","exports","module","utils/GuiUtils","widgets/BaseWidget"],function(a,b,c){"use strict";var d=a("utils/GuiUtils"),e=a("widgets/BaseWidget"),f=function(a,b){var c=this._getInitialValue(a,b),d=this._getCheckCallback(a,b);this.domCheckbox=document.createElement("input"),this.domCheckbox.className="gui-input-checkbox",this.domCheckbox.type="checkbox",this.domLabelCheckbox=document.createElement("label"),this.setValue(void 0===c?!0:c),this.setCallback(d)};f.prototype={_onMouseDown:function(){this.setValue(!this.domCheckbox.checked)},setValue:function(a,b){this.domCheckbox.checked=a,!b&&this.callback&&this.callback(a)},getValue:function(){return this.domCheckbox.checked}},d.makeProxy(e,f),c.exports=f}),c("widgets/Color",["require","exports","module","utils/GuiUtils","widgets/BaseWidget"],function(a,b,c){"use strict";var d=a("utils/GuiUtils"),e=a("widgets/BaseWidget"),f=["-moz-","-o-","-webkit-","-ms-",""],g='url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAIAAABLbSncAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAChJREFUeNpiPHPmDAMMGBsbw9lMDDgA6RKM%2F%2F%2F%2Fh3POnj1LCzsAAgwAQtYIcFfEyzkAAAAASUVORK5CYII%3D")',h=function(a,b){var c=this._getInitialValue(a,b),e=this._getCheckCallback(a,b);c?this.color=d.getValidColor(c.slice()):this.color=[1,0,0],this.domColor=document.createElement("div"),this.domColor.className="gui-widget-color",this.domInputColor=document.createElement("input"),this.domPopup=document.createElement("div"),this.domHue=document.createElement("div"),this.domHue.className="gui-color-hue",this.domHueKnob=document.createElement("div"),this.domHueKnob.className="gui-knob-hue",this.domSaturation=document.createElement("div"),this.domSaturation.className="gui-color-saturation";var f=document.createElement("div");this.domSaturation.appendChild(f),this.domSaturationKnob=document.createElement("div"),this.domSaturationKnob.className="gui-knob-saturation",this.domHue.appendChild(this.domHueKnob),this.domPopup.appendChild(this.domSaturationKnob),this.domPopup.appendChild(this.domSaturation),this.domPopup.appendChild(this.domHue),this.domColor.appendChild(this.domInputColor),this.domColor.appendChild(this.domPopup),this._hueGradient(this.domHue),this._linearGradient(f,"top","rgba(0,0,0,0)","#000"),this.domColor.addEventListener("keydown",this._onInputDown.bind(this)),this.domSaturation.addEventListener("mousedown",this._onSaturationDown.bind(this)),this.domHue.addEventListener("mousedown",this._onHueDown.bind(this)),window.addEventListener("mouseup",this._onMouseUp.bind(this)),window.addEventListener("mouseout",this._onMouseUp.bind(this)),window.addEventListener("mousemove",this._onMouseMove.bind(this)),this.hasAlpha=4===this.color.length,this.alpha=1,this.hasAlpha&&(this.domPopup.style.width="142px",this.domAlpha=document.createElement("div"),this.domAlpha.className="gui-color-alpha",this.domAlphaKnob=document.createElement("div"),this.domAlphaKnob.className="gui-knob-alpha",this._alphaGradient(this.domAlpha,"top","rgba(0,0,0,1.0)","rgba(0,0,0,0.0)"),this.domAlpha.addEventListener("mousedown",this._onAlphaDown.bind(this)),this.domAlpha.appendChild(this.domAlphaKnob),this.domPopup.appendChild(this.domAlpha)),this.editHue=this.editSaturation=this.editAlpha=!1,this.widgetHeight=this.widgetWidth=100,this.setValue(this.color),this.setCallback(e)};h.prototype={_onInputDown:function(a){a.stopPropagation(),13===a.keyCode&&this.setValue(d.hexToRgb(a.target.value))},_onUpdateSaturation:function(a){
var b=this.domSaturation.getBoundingClientRect(),c=d.rgbToHsv(this.getValue());c[1]=Math.min(1,Math.max(0,(a.clientX-b.left)/b.width)),c[2]=Math.min(1,Math.max(0,1-(a.clientY-b.top)/b.width)),this.setValue(d.hsvToRgb(c),!1,!0),this._updateGui()},_onUpdateHue:function(a){var b=this.domHue.getBoundingClientRect(),c=d.rgbToHsv(this.getValue());c[0]=Math.min(1,Math.max(0,1-(a.clientY-b.top)/b.height)),this.setValue(d.hsvToRgb(c),!1,!0),this._updateGui()},_onUpdateAlpha:function(a){var b=this.domAlpha.getBoundingClientRect(),c=this.getValue();c[3]=this.alpha=Math.min(1,Math.max(0,1-(a.clientY-b.top)/b.height)),this.setValue(c,!1,!0),this._updateGui()},_updateGui:function(){var a=this.getValue(),b=d.rgbToHsv(a);this.domSaturationKnob.style.marginLeft=this.widgetWidth*b[1]-7+"px",this.domSaturationKnob.style.marginTop=this.widgetHeight*(1-b[2])-7+"px",b[1]=b[2]=1,this._linearGradient(this.domSaturation,"left","#fff",d.getStrColor(d.hsvToRgb(b))),this.domHueKnob.style.marginTop=(1-b[0])*this.widgetHeight+"px",this.hasAlpha&&void 0!==a[3]&&(this.domAlphaKnob.style.marginTop=(1-this.alpha)*this.widgetHeight+"px")},_onMouseMove:function(a){return this.editSaturation||this.editHue||this.editAlpha?this.editSaturation?this._onUpdateSaturation(a):this.editHue?this._onUpdateHue(a):this.editAlpha?this._onUpdateAlpha(a):void 0:void 0},_onSaturationDown:function(a){this.editSaturation=!0,this._onMouseMove(a)},_onHueDown:function(a){this.editHue=!0,this._onMouseMove(a)},_onAlphaDown:function(a){this.editAlpha=!0,this._onMouseMove(a)},_onMouseUp:function(){this.editHue=this.editSaturation=this.editAlpha=!1},_hueGradient:function(a){a.style.background="";for(var b=0,c=f.length;c>b;++b)a.style.cssText+="background: "+f[b]+"linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);"},_alphaGradient:function(a,b,c,d){a.style.background="";for(var e=0,h=f.length;h>e;++e)a.style.cssText+="background: "+f[e]+"linear-gradient("+b+", "+c+","+d+"),"+g+";"},_linearGradient:function(a,b,c,d){a.style.background="";for(var e=0,g=f.length;g>e;++e)a.style.cssText+="background: "+f[e]+"linear-gradient("+b+", "+c+" 0%, "+d+" 100%);"},setValue:function(a,b,c){for(var e=this.color,f=0,g=a.length;g>f;++f)e[f]=a[f];var h=d.rgbToHex(a);if(this.domInputColor.value=h,this.hasAlpha){a.length>=4?this.alpha=a[3]:a.push(this.alpha);var i="rgba("+parseInt(255*a[0],10)+","+parseInt(255*a[1],10)+","+parseInt(255*a[2],10)+","+this.alpha+")";this._alphaGradient(this.domInputColor,"0deg",i,i)}else this.domInputColor.style.background=h;var j=d.rgbToHsv(a);this.domSaturationKnob.style.borderColor=j[2]<.5||j[1]>.5?"#fff":"#000",this.domInputColor.style.color=this.alpha>.2&&(j[2]<.5||j[1]>.5)?"#fff":"#000",c||this._updateGui(),!b&&this.callback&&this.callback(a)},getValue:function(){return this.color}},d.makeProxy(e,h),c.exports=h}),c("widgets/Combobox",["require","exports","module","utils/GuiUtils","widgets/BaseWidget"],function(a,b,c){"use strict";var d=a("utils/GuiUtils"),e=a("widgets/BaseWidget"),f=function(a,b,c){var d=this._getInitialValue(a,b),e=this._getCheckCallback(a,b);c=c||{},d=d||c[0],this.domSelect=document.createElement("select"),this.domSelect.className="gui-select",this.addOptions(c),this.domSelect.addEventListener("change",this._onChange.bind(this)),this.setValue(d),this.setCallback(e)};f.prototype={_onChange:function(a){this.setValue(a.target.value)},addOptions:function(a){for(var b=Object.keys(a),c=0;c<b.length;++c){var d=document.createElement("option");d.innerHTML=a[b[c]],d.value=b[c],this.domSelect.appendChild(d)}},setValue:function(a,b){this.domSelect.value=a,!b&&this.callback&&this.callback(a)},getValue:function(){return this.domSelect.value}},d.makeProxy(e,f),c.exports=f}),c("widgets/Slider",["require","exports","module","utils/GuiUtils","widgets/BaseWidget"],function(a,b,c){"use strict";var d=a("utils/GuiUtils"),e=a("widgets/BaseWidget"),f=function(a,b,c,d,e){var f=this._getInitialValue(a,b),g=this._getCheckCallback(a,b);f=void 0!==f?f:100,c=void 0!==c?c:0,d=void 0!==d?d:200,e=void 0!==e?e:1,this.domSlider=document.createElement("div"),this.domSlider.className="gui-slider",this.domSliderFill=document.createElement("div"),this.domSlider.appendChild(this.domSliderFill),this.domInputText=document.createElement("input"),this.domInputText.className="gui-input-number",this.domInputText.type="number",this.min=this.domInputText.min=c,this.max=this.domInputText.max=d,this.step=this.domInputText.step=e,this.domInputText.addEventListener("keydown",this._onKeyDown.bind(this)),this.domInputText.addEventListener("change",this._onInputText.bind(this)),this.domInputText.addEventListener("blur",this._onInputText.bind(this)),this.domSlider.addEventListener("mousedown",this._onMouseDown.bind(this)),window.addEventListener("mouseup",this._onMouseUp.bind(this),!0),window.addEventListener("mousemove",this._onMouseMove.bind(this)),this.lastValue=f,this.isDown=!1,this.setValue(f),this.setCallback(g)};f.prototype={_onInputText:function(a){var b=parseFloat(a.target.value);b===b&&b!==this.lastValue&&this.setValue(b)},_onKeyDown:function(a){a.stopPropagation(),13===a.which&&this.domInputText.blur()},_onMouseMove:function(a){if(a.preventDefault(),this.isDown){var b=this.domSlider.getBoundingClientRect(),c=this.min+(this.max-this.min)*((a.clientX-b.left)/b.width);this.setValue(c)}},_onMouseDown:function(a){this.isDown=!0,this._onMouseMove(a)},_onMouseUp:function(){this.isDown=!1},_setDomContainer:function(a){this.domContainer=a},getValue:function(){return parseFloat(this.domInputText.value)},setValue:function(a,b){this.lastValue=a,a=Math.max(Math.min(a,this.max),this.min),a=Math.round(a/this.step)*this.step,this.domInputText.value=a;var c=this.min;this.max!==this.min&&(c=(a-this.min)/(this.max-this.min)),this.domSliderFill.style.width=100*c+"%",!b&&this.callback&&this.callback(a)},setMax:function(a){return this.domInputText.max=this.max=a,this},setMin:function(a){return this.min=a,this}},d.makeProxy(e,f),c.exports=f}),c("widgets/Title",["require","exports","module","utils/GuiUtils","widgets/BaseWidget"],function(a,b,c){"use strict";var d=a("utils/GuiUtils"),e=a("widgets/BaseWidget"),f=function(a){this.domText=document.createElement("div"),this.domText.innerHTML=a||"",this.domText.className="group-title"};f.prototype={setText:function(a){this.domText.innerHTML=a},setVisibility:function(a){this.domText.hidden=!a}},d.makeProxy(e,f),c.exports=f}),c("containers/BaseContainer",["require","exports","module","widgets/Button","widgets/Checkbox","widgets/Color","widgets/Combobox","widgets/Slider","widgets/Title"],function(a,b,c){"use strict";var d=a("widgets/Button"),e=a("widgets/Checkbox"),f=a("widgets/Color"),g=a("widgets/Combobox"),h=a("widgets/Slider"),i=a("widgets/Title"),j=function(){};j.prototype={_addLine:function(a){var b=document.createElement("li");return b.innerHTML=a||"",this.domUl.appendChild(b),b},_createLabel:function(a){var b=document.createElement("label");return b.className="gui-label-side",b.innerHTML=a||"",b},_setDomContainer:function(a){this.domContainer=a},addTitle:function(a){var b=new i(a);return this.domUl.appendChild(b.domText),b},addCheckbox:function(a,b,c){var d=new e(b,c),f=this._addLine();f.className+=" gui-pointerOnHover gui-glowOnHover";var g=this._createLabel(a);return g.style.overflow="visible",g.className+=" gui-pointerOnHover",f.appendChild(g),f.appendChild(d.domCheckbox),f.appendChild(d.domLabelCheckbox),f.addEventListener("mousedown",d._onMouseDown.bind(d)),d._setDomContainer(f),d},addCombobox:function(a,b,c,d){var e=new g(b,c,d),f=this._addLine();return a?f.appendChild(this._createLabel(a)):e.domSelect.style.width="100%",f.appendChild(e.domSelect),e._setDomContainer(f),e},addSlider:function(a,b,c,d,e,f){var g=new h(b,c,d,e,f),i=this._addLine();return a&&i.appendChild(this._createLabel(a)),i.appendChild(g.domInputText),i.appendChild(g.domSlider),g._setDomContainer(i),g},addColor:function(a,b,c){var d=new f(b,c),e=this._addLine();return a?e.appendChild(this._createLabel(a)):d.domColor.style.width="100%",e.appendChild(d.domColor),d._setDomContainer(e),d},addButton:function(a,b,c){var e=new d(a,b,c),f=this._addLine();return f.appendChild(e.domButton),e._setDomContainer(f),e},addDualButton:function(a,b,c,e,f,g){var h=new d(a,c,f),i=new d(b,e,g),j=this._addLine();j.appendChild(i.domButton),j.appendChild(h.domButton);var k=h.domButton.style,l=i.domButton.style;return k.width=l.width="49%",k.marginRight=l.marginLeft="1%",h._setDomContainer(j),i._setDomContainer(j),[h,i]},setVisibility:function(a){this.domContainer&&(this.domContainer.hidden=!a)}},c.exports=j}),c("containers/Folder",["require","exports","module","utils/GuiUtils","containers/BaseContainer"],function(a,b,c){"use strict";var d=a("utils/GuiUtils"),e=a("containers/BaseContainer"),f=function(a){this.domUl=document.createElement("ul"),this.domUl.setAttribute("opened",!0);var b=document.createElement("label");b.innerHTML=a||"",b.addEventListener("mousedown",this._onMouseDown.bind(this)),this.domUl.appendChild(b),this.isOpen=!0};f.prototype={_onMouseDown:function(){this.isOpen=!this.isOpen,this.domUl.setAttribute("opened",this.isOpen)},open:function(){this.isOpen=!0,this.domUl.setAttribute("opened",!0)},close:function(){this.isOpen=!1,this.domUl.setAttribute("opened",!1)},setVisibility:function(a){a?this.isOpen&&this.domUl.setAttribute("opened",!0):this.domUl.setAttribute("opened",!1),this.domUl.style.height=a?"auto":"0px"}},d.makeProxy(e,f),c.exports=f}),c("containers/Sidebar",["require","exports","module","containers/Folder"],function(a,b,c){"use strict";var d=a("containers/Folder"),e=function(a){this.domSidebar=document.createElement("div"),this.domSidebar.className="gui-sidebar",this.domResize=document.createElement("div"),this.domResize.className="gui-resize",this.isDragging=!1,this.mouseX=0,this.domResize.addEventListener("mousedown",this._onMouseDown.bind(this)),window.addEventListener("mousemove",this._onMouseMove.bind(this)),window.addEventListener("mouseup",this._onMouseUp.bind(this)),this.callbackResize=a,this.isOnTheRight=!1};e.prototype={_setTop:function(a){this.domSidebar.style.top=this.domResize.style.top=a+"px"},_onTheRight:function(){this.isOnTheRight=!0,this.domSidebar.style.right=0,this.domSidebar.style.borderRight=0,this.domSidebar.style.borderLeft="double",this.domSidebar.style.borderColor="rgba(255,255,255,0.3)",this.domResize.style.left="auto",this.domResize.style.right=this.domSidebar.offsetWidth+"px",this.domResize.style.marginRight="-3px"},_onMouseDown:function(a){this.isDragging=!0,this.mouseX=a.clientX},_updateViewportPosition:function(a){var b=this.domSidebar.hidden?0:this.domSidebar.offsetWidth;this.isOnTheRight?a.style.width=a.clientWidth-b+"px":(a.style.left=this.domSidebar.offsetLeft+b+"px",a.style.width=a.clientWidth-b+"px")},_onMouseMove:function(a){if(this.isDragging!==!1){var b=a.clientX,c=b-this.mouseX;this.isOnTheRight&&(c=-c);var d=Math.max(50,this.domSidebar.offsetWidth+c),e=d+"px";this.domSidebar.style.width=e,this.isOnTheRight?this.domResize.style.right=this.domSidebar.offsetWidth+"px":this.domResize.style.left=e,this.mouseX=b,this.callbackResize()}},_onMouseUp:function(){this.isDragging=!1},addMenu:function(a){var b=new d(a);return this.domSidebar.appendChild(b.domUl),b},setVisibility:function(a){this.domSidebar.hidden=!a,this.domResize.hidden=!a,this.callbackResize()}},c.exports=e}),c("widgets/MenuButton",["require","exports","module","utils/GuiUtils","widgets/BaseWidget"],function(a,b,c){"use strict";var d=a("utils/GuiUtils"),e=a("widgets/BaseWidget"),f=function(a,b,c){var d=a;d&&"function"!=typeof d?d=a[b].bind(a):c=b,this.domSpan=document.createElement("span"),this.domSpan.className="shortcut",this.domSpan.innerHTML=c||"",this.setCallback(d)};f.prototype={_setDomContainer:function(a){this.domContainer=a,a.addEventListener("click",this._onClick.bind(this))},_onClick:function(){this.callback&&this.callback()}},d.makeProxy(e,f),c.exports=f}),c("containers/Menu",["require","exports","module","utils/GuiUtils","containers/BaseContainer","widgets/MenuButton"],function(a,b,c){"use strict";var d=a("utils/GuiUtils"),e=a("containers/BaseContainer"),f=a("widgets/MenuButton"),g=function(){this.domUl=document.createElement("ul")};g.prototype={addButton:function(a,b,c,d){var e=new f(b,c,d),g=this._addLine(a);return g.appendChild(e.domSpan),e._setDomContainer(g),e},addSlider:function(a,b,c,d,f,g){var h=e.prototype.addSlider.call(this,a,b,c,d,f,g);return h.domInputText.style.width="18%",h.domSlider.style.width=a?"44%":"80%",h}},d.makeProxy(e,g),c.exports=g}),c("utils/EditStyle",["require","exports","module","utils/GuiUtils"],function(a,b,c){"use strict";var d=a("utils/GuiUtils"),e={};e.refRules={};var f,g=function(){if(f)return f;for(var a=document.styleSheets,b=0,c=a.length;c>b;++b){var d=a[b].href;if(d&&-1!==d.indexOf("yagui.css"))return f=a[b]}},h=function(a,b,c){var d=g();if(d){var f=d.cssRules||d.rules,h=e.refRules[a];if(!h){var i=0,j=f.length;for(i=0;j>i&&f[i].selectorText!==a;++i);if(i===j)return!1;h=e.refRules[a]=f[i]}h&&(h.style[b]=c)}};e.changeWidgetsColor=function(a){var b=d.getStrColor(a);h(".gui-button","background",b),h(".gui-select","background",b),h(".gui-slider > div","background",b),e._curWidgetColor=a},e.changeDisplayBoorder=function(a){var b=a?"1px solid #000":"0";h(".gui-button","border",b),h(".gui-select","border",b),h(".gui-slider","border",b),h(".gui-input-number","border",b),h(".gui-sidebar > ul > label","borderTop",b),h(".gui-sidebar > ul > label","borderBottom",b),h(".gui-sidebar","borderLeft",b),h(".gui-sidebar","borderRight",b),h(".gui-topbar","borderBottom",b),e._curShowBorder=a},e.changeBackgroundColor=function(a){h(".gui-sidebar","background",d.getStrColor(a));var b=d.getStrColor(d.getColorMult(a,.5));h(".gui-topbar","background",b),h(".gui-topbar ul > li > ul","background",b),e._curBackgroundColor=a},e.changeTextColor=function(a){var b=d.getStrColor(a);h("*","color",b),h(".gui-sidebar > ul > label","color",b),e._curTextColor=a},e.changeOverallColor=function(a){e.changeWidgetsColor(a);var b=d.getColorMult(a,.5);b.length=3,e.changeBackgroundColor(b);for(var c=d.getColorAdd(a,.5),f=0;3>f;++f)c[f]=Math.min(.8,c[f]);e.changeTextColor(c),e._curWidgetColor=a,e._curBackgroundColor=b,e._curTextColor=c},e._curTextColor=[.73,.73,.73,1],e._curWidgetColor=[.32,.37,.39,1],e._curBackgroundColor=[.24,.24,.24],e._curShowBorder=!1,e.changeOverallColor([.3,.34,.4,1]),c.exports=e}),c("containers/Topbar",["require","exports","module","containers/Menu","utils/EditStyle"],function(a,b,c){"use strict";var d=a("containers/Menu"),e=a("utils/EditStyle"),f=function(a){this.domTopbar=document.createElement("div"),this.domTopbar.className="gui-topbar",this.domUl=document.createElement("ul"),this.domTopbar.appendChild(this.domUl),this.callbackResize=a,this.uiExtra={}};f.prototype={_updateViewportPosition:function(a){var b=this.domTopbar.hidden?0:this.domTopbar.offsetHeight;a.style.top=b+"px",a.style.height=a.clientHeight-b+"px"},_onChangeColor:function(a,b){a(b),this.uiExtra.overallColor.setValue(e._curWidgetColor,!0),this.uiExtra.widgetColor.setValue(e._curWidgetColor,!0),this.uiExtra.backColor.setValue(e._curBackgroundColor,!0),this.uiExtra.textColor.setValue(e._curTextColor,!0)},addMenu:function(a){var b=new d,c=document.createElement("li");return c.innerHTML=a||"",this.domUl.appendChild(c),c.appendChild(b.domUl),b._setDomContainer(c),b},addExtra:function(){var a=this._onChangeColor,b=this.addMenu("Extra UI"),c=this.uiExtra;return b.addTitle("Overall"),c.overallColor=b.addColor("",e._curWidgetColor,a.bind(this,e.changeOverallColor)),b.addTitle("Advanced"),c.widgetColor=b.addColor("Widget",e._curWidgetColor,a.bind(this,e.changeWidgetsColor)),c.backColor=b.addColor("Back",e._curBackgroundColor,a.bind(this,e.changeBackgroundColor)),c.textColor=b.addColor("Text",e._curTextColor,a.bind(this,e.changeTextColor)),c.showBorder=b.addCheckbox("Border",e._curShowBorder,e.changeDisplayBoorder),b},setVisibility:function(a){this.domTopbar.hidden=!a,this.callbackResize()}},c.exports=f}),c("GuiMain",["require","exports","module","containers/Sidebar","containers/Topbar"],function(a,b,c){"use strict";var d=a("containers/Sidebar"),e=a("containers/Topbar"),f=function(a,b){this.domMain=document.createElement("div"),this.viewport=a,this.callbackResize=b,this.viewport&&(this.viewport.style.width=document.documentElement.clientWidth+"px",this.viewport.style.height=document.documentElement.clientHeight+"px"),this.cbResize_=this._onWindowResize.bind(this),document.body.appendChild(this.domMain),this.leftSidebar=void 0,this.rightSidebar=void 0,this.topbar=void 0,window.addEventListener("resize",this._onWindowResize.bind(this),!1)};f.prototype={_onWindowResize:function(){this.viewport&&(this.viewport.style.width=document.documentElement.clientWidth+"px",this.viewport.style.height=document.documentElement.clientHeight+"px",this.viewport.style.left="0px",this.viewport.style.top="0px",this.leftSidebar&&this.leftSidebar._updateViewportPosition(this.viewport),this.rightSidebar&&this.rightSidebar._updateViewportPosition(this.viewport),this.topbar&&this.topbar._updateViewportPosition(this.viewport)),this._updateSidebarsPosition(),this.callbackResize&&this.callbackResize()},_updateSidebarsPosition:function(){if(this.topbar){var a=this.topbar.domTopbar.offsetHeight;this.leftSidebar&&this.leftSidebar._setTop(a),this.rightSidebar&&this.rightSidebar._setTop(a)}},addLeftSidebar:function(){this.leftSidebar=new d(this.cbResize_);var a=this.leftSidebar.domSidebar;return this.domMain.appendChild(a),this.domMain.appendChild(this.leftSidebar.domResize),this._updateSidebarsPosition(),this.leftSidebar._updateViewportPosition(this.viewport),this.leftSidebar},addRightSidebar:function(){this.rightSidebar=new d(this.cbResize_);var a=this.rightSidebar.domSidebar;return this.domMain.appendChild(a),this.domMain.appendChild(this.rightSidebar.domResize),this.rightSidebar._onTheRight(),this._updateSidebarsPosition(),this.rightSidebar._updateViewportPosition(this.viewport),this.rightSidebar},addTopbar:function(){return this.topbar=new e(this.cbResize_),this.domMain.appendChild(this.topbar.domTopbar),this._updateSidebarsPosition(),this.topbar._updateViewportPosition(this.viewport),this.topbar},setVisibility:function(a){this.domMain.hidden=!a,this._onWindowResize()}},c.exports=f}),c("yagui",["require","exports","module","GuiMain"],function(a,b,c){"use strict";var d=a("GuiMain"),e={};e.GuiMain=d,window.yagui=e,c.exports=e}),b("yagui")}(),function(a){"use strict";function b(){this.crc=-1}function c(){}function d(a,b,c){if(0>b||0>c||b+c>a.size)throw new RangeError("offset:"+b+", length:"+c+", size:"+a.size);return a.slice?a.slice(b,b+c):a.webkitSlice?a.webkitSlice(b,b+c):a.mozSlice?a.mozSlice(b,b+c):a.msSlice?a.msSlice(b,b+c):void 0}function e(a,b){var c,d;return c=new ArrayBuffer(a),d=new Uint8Array(c),b&&d.set(b,0),{buffer:c,array:d,view:new DataView(c)}}function f(){}function g(a){function b(b,c){var f=new Blob([a],{type:P});d=new i(f),d.init(function(){e.size=d.size,b()},c)}function c(a,b,c,e){d.readUint8Array(a,b,c,e)}var d,e=this;e.size=0,e.init=b,e.readUint8Array=c}function h(b){function c(a){for(var c=b.length;"="==b.charAt(c-1);)c--;f=b.indexOf(",")+1,g.size=Math.floor(.75*(c-f)),a()}function d(c,d,g){var h,i=e(d),j=4*Math.floor(c/3),k=4*Math.ceil((c+d)/3),l=a.atob(b.substring(j+f,k+f)),m=c-3*Math.floor(j/4);for(h=m;m+d>h;h++)i.array[h-m]=l.charCodeAt(h);g(i.array)}var f,g=this;g.size=0,g.init=c,g.readUint8Array=d}function i(a){function b(b){e.size=a.size,b()}function c(b,c,e,f){var g=new FileReader;g.onload=function(a){e(new Uint8Array(a.target.result))},g.onerror=f;try{g.readAsArrayBuffer(d(a,b,c))}catch(h){f(h)}}var e=this;e.size=0,e.init=b,e.readUint8Array=c}function j(){}function k(a){function b(a){e=new Blob([],{type:P}),a()}function c(a,b){e=new Blob([e,E?a:a.buffer],{type:P}),b()}function d(b,c){var d=new FileReader;d.onload=function(a){b(a.target.result)},d.onerror=c,d.readAsText(e,a)}var e,f=this;f.init=b,f.writeUint8Array=c,f.getData=d}function l(b){function c(a){g+="data:"+(b||"")+";base64,",a()}function d(b,c){var d,e=h.length,f=h;for(h="",d=0;d<3*Math.floor((e+b.length)/3)-e;d++)f+=String.fromCharCode(b[d]);for(;d<b.length;d++)h+=String.fromCharCode(b[d]);f.length>2?g+=a.btoa(f):h=f,c()}function e(b){b(g+a.btoa(h))}var f=this,g="",h="";f.init=c,f.writeUint8Array=d,f.getData=e}function m(a){function b(b){e=new Blob([],{type:a}),b()}function c(b,c){e=new Blob([e,E?b:b.buffer],{type:a}),c()}function d(a){a(e)}var e,f=this;f.init=b,f.writeUint8Array=c,f.getData=d}function n(a,b,c,d,e,f,g,h,i,j){function k(){a.removeEventListener("message",l,!1),h(o,p)}function l(b){var c=b.data,e=c.data,h=c.error;if(h)return h.toString=function(){return"Error: "+this.message},void i(h);if(c.sn===r)switch("number"==typeof c.codecTime&&(a.codecTime+=c.codecTime),"number"==typeof c.crcTime&&(a.crcTime+=c.crcTime),c.type){case"append":e?(o+=e.length,d.writeUint8Array(e,function(){m()},j)):m();break;case"flush":p=c.crc,e?(o+=e.length,d.writeUint8Array(e,function(){k()},j)):k();break;case"progress":g&&g(n+c.loaded,f);break;case"importScripts":case"newTask":case"echo":break;default:console.warn("zip.js:launchWorkerProcess: unknown message: ",c)}}function m(){n=q*O,f>n?c.readUint8Array(e+n,Math.min(O,f-n),function(c){g&&g(n,f);var d=0===n?b:{sn:r};d.type="append",d.data=c,a.postMessage(d,[c.buffer]),q++},i):a.postMessage({sn:r,type:"flush"})}var n,o,p,q=0,r=b.sn;o=0,a.addEventListener("message",l,!1),m()}function o(a,c,d,e,f,g,h,i,j,k){function l(){var b;if(m=n*O,f>m)c.readUint8Array(e+m,Math.min(O,f-m),function(b){var c;try{c=a.append(b,function(a){h&&h(m+a,f)})}catch(e){return void j(e)}c?(o+=c.length,d.writeUint8Array(c,function(){n++,setTimeout(l,1)},k),q&&r.append(c)):(n++,setTimeout(l,1)),p&&r.append(b),h&&h(m,f)},j);else{try{b=a.flush()}catch(g){return void j(g)}b?(q&&r.append(b),o+=b.length,d.writeUint8Array(b,function(){i(o,r.get())},k)):i(o,r.get())}}var m,n=0,o=0,p="input"===g,q="output"===g,r=new b;l()}function p(b,c,d,e,f,g,h,i,j,k,l){var m=h?"output":"none";if(a.zip.useWebWorkers){var p={sn:c,codecClass:"Inflater",crcType:m};n(b,p,d,e,f,g,j,i,k,l)}else o(new a.zip.Inflater,d,e,f,g,m,j,i,k,l)}function q(b,c,d,e,f,g,h,i,j){var k="input";if(a.zip.useWebWorkers){var l={sn:c,options:{level:f},codecClass:"Deflater",crcType:k};n(b,l,d,e,0,d.size,h,g,i,j)}else o(new a.zip.Deflater,d,e,0,d.size,k,h,g,i,j)}function r(b,d,e,f,g,h,i,j,k,l,m){var p="input";if(a.zip.useWebWorkers&&i){var q={sn:d,codecClass:"NOOP",crcType:p};n(b,q,e,f,g,h,k,j,l,m)}else o(new c,e,f,g,h,p,k,j,l,m)}function s(a){var b,c,d="",e=["Ç","ü","é","â","ä","à","å","ç","ê","ë","è","ï","î","ì","Ä","Å","É","æ","Æ","ô","ö","ò","û","ù","ÿ","Ö","Ü","ø","£","Ø","×","ƒ","á","í","ó","ú","ñ","Ñ","ª","º","¿","®","¬","½","¼","¡","«","»","_","_","_","¦","¦","Á","Â","À","©","¦","¦","+","+","¢","¥","+","+","-","-","+","-","+","ã","Ã","+","+","-","-","¦","-","+","¤","ð","Ð","Ê","Ë","È","i","Í","Î","Ï","+","+","_","_","¦","Ì","_","Ó","ß","Ô","Ò","õ","Õ","µ","þ","Þ","Ú","Û","Ù","ý","Ý","¯","´","­","±","_","¾","¶","§","÷","¸","°","¨","·","¹","³","²","_"," "];for(b=0;b<a.length;b++)c=255&a.charCodeAt(b),d+=c>127?e[c-128]:String.fromCharCode(c);return d}function t(a){return decodeURIComponent(escape(a))}function u(a){var b,c="";for(b=0;b<a.length;b++)c+=String.fromCharCode(a[b]);return c}function v(a){var b=(4294901760&a)>>16,c=65535&a;try{return new Date(1980+((65024&b)>>9),((480&b)>>5)-1,31&b,(63488&c)>>11,(2016&c)>>5,2*(31&c),0)}catch(d){}}function w(a,b,c,d,e){return a.version=b.view.getUint16(c,!0),a.bitFlag=b.view.getUint16(c+2,!0),a.compressionMethod=b.view.getUint16(c+4,!0),a.lastModDateRaw=b.view.getUint32(c+6,!0),a.lastModDate=v(a.lastModDateRaw),1===(1&a.bitFlag)?void e(H):((d||8!=(8&a.bitFlag))&&(a.crc32=b.view.getUint32(c+10,!0),a.compressedSize=b.view.getUint32(c+14,!0),a.uncompressedSize=b.view.getUint32(c+18,!0)),4294967295===a.compressedSize||4294967295===a.uncompressedSize?void e(I):(a.filenameLength=b.view.getUint16(c+22,!0),void(a.extraFieldLength=b.view.getUint16(c+24,!0))))}function x(b,c,d){function f(){}function g(a){function c(c,f){b.readUint8Array(b.size-c,c,function(b){for(var c=b.length-e;c>=0;c--)if(80===b[c]&&75===b[c+1]&&5===b[c+2]&&6===b[c+3])return void a(new DataView(b.buffer,c,e));f()},function(){d(J)})}var e=22;if(b.size<e)return void d(F);var f=65536,g=e+f;c(e,function(){c(Math.min(g,b.size),function(){d(F)})})}var h=0;f.prototype.getData=function(a,c,f,g){function i(a){var b=e(4);return b.view.setUint32(0,a),m.crc32==b.view.getUint32(0)}function j(b,e){g&&!i(e)?d(G):a.getData(function(a){c(a)})}function k(a){d(a||M)}function l(a){d(a||L)}var m=this;b.readUint8Array(m.offset,30,function(c){var i,n=e(c.length,c);return 1347093252!=n.view.getUint32(0)?void d(F):(w(m,n,4,!1,d),i=m.offset+30+m.filenameLength+m.extraFieldLength,void a.init(function(){0===m.compressionMethod?r(m._worker,h++,b,a,i,m.compressedSize,g,j,f,k,l):p(m._worker,h++,b,a,i,m.compressedSize,g,j,f,k,l)},l))},k)};var i={getEntries:function(a){var c=this._worker;g(function(g){var h,i;return h=g.getUint32(16,!0),i=g.getUint16(8,!0),0>h||h>=b.size?void d(F):void b.readUint8Array(h,b.size-h,function(b){var g,h,j,k,l=0,m=[],n=e(b.length,b);for(g=0;i>g;g++){if(h=new f,h._worker=c,1347092738!=n.view.getUint32(l))return void d(F);w(h,n,l+6,!0,d),h.commentLength=n.view.getUint16(l+32,!0),h.directory=16==(16&n.view.getUint8(l+38)),h.offset=n.view.getUint32(l+42,!0),j=u(n.array.subarray(l+46,l+46+h.filenameLength)),h.filename=2048===(2048&h.bitFlag)?t(j):s(j),h.directory||"/"!=h.filename.charAt(h.filename.length-1)||(h.directory=!0),k=u(n.array.subarray(l+46+h.filenameLength+h.extraFieldLength,l+46+h.filenameLength+h.extraFieldLength+h.commentLength)),h.comment=2048===(2048&h.bitFlag)?t(k):s(k),m.push(h),l+=46+h.filenameLength+h.extraFieldLength+h.commentLength}a(m)},function(){d(J)})})},close:function(a){this._worker&&(this._worker.terminate(),this._worker=null),a&&a()},_worker:null};a.zip.useWebWorkers?C("inflater",function(a){i._worker=a,c(i)},function(a){d(a)}):c(i)}function y(a){return unescape(encodeURIComponent(a))}function z(a){var b,c=[];for(b=0;b<a.length;b++)c.push(a.charCodeAt(b));return c}function A(b,c,d,f){function g(a){d(a||K)}function h(a){d(a||M)}var i={},j=[],k=0,l=0,m={add:function(a,c,m,n,o){function p(c){var d;w=o.lastModDate||new Date,u=e(26),i[a]={headerArray:u.array,directory:o.directory,filename:v,offset:k,comment:z(y(o.comment||""))},u.view.setUint32(0,335546376),o.version&&u.view.setUint8(0,o.version),f||0===o.level||o.directory||u.view.setUint16(4,2048),u.view.setUint16(6,(w.getHours()<<6|w.getMinutes())<<5|w.getSeconds()/2,!0),u.view.setUint16(8,(w.getFullYear()-1980<<4|w.getMonth()+1)<<5|w.getDate(),!0),u.view.setUint16(22,v.length,!0),d=e(30+v.length),d.view.setUint32(0,1347093252),d.array.set(u.array,4),d.array.set(v,30),k+=d.array.length,b.writeUint8Array(d.array,c,g)}function s(a,d){var f=e(16);k+=a||0,f.view.setUint32(0,1347094280),"undefined"!=typeof d&&(u.view.setUint32(10,d,!0),f.view.setUint32(4,d,!0)),c&&(f.view.setUint32(8,a,!0),u.view.setUint32(14,a,!0),f.view.setUint32(12,c.size,!0),u.view.setUint32(18,c.size,!0)),b.writeUint8Array(f.array,function(){k+=16,m()},g)}function t(){return o=o||{},a=a.trim(),o.directory&&"/"!=a.charAt(a.length-1)&&(a+="/"),i.hasOwnProperty(a)?void d(N):(v=z(y(a)),j.push(a),void p(function(){c?f||0===o.level?r(x,l++,c,b,0,c.size,!0,s,n,h,g):q(x,l++,c,b,o.level,s,n,h,g):s()},g))}var u,v,w,x=this._worker;c?c.init(t,h):t()},close:function(a){this._worker&&(this._worker.terminate(),this._worker=null);var c,d,f,h=0,l=0;for(d=0;d<j.length;d++)f=i[j[d]],h+=46+f.filename.length+f.comment.length;for(c=e(h+22),d=0;d<j.length;d++)f=i[j[d]],c.view.setUint32(l,1347092738),c.view.setUint16(l+4,5120),c.array.set(f.headerArray,l+6),c.view.setUint16(l+32,f.comment.length,!0),f.directory&&c.view.setUint8(l+38,16),c.view.setUint32(l+42,f.offset,!0),c.array.set(f.filename,l+46),c.array.set(f.comment,l+46+f.filename.length),l+=46+f.filename.length+f.comment.length;c.view.setUint32(l,1347093766),c.view.setUint16(l+8,j.length,!0),c.view.setUint16(l+10,j.length,!0),c.view.setUint32(l+12,h,!0),c.view.setUint32(l+16,k,!0),b.writeUint8Array(c.array,function(){b.getData(a)},g)},_worker:null};a.zip.useWebWorkers?C("deflater",function(a){m._worker=a,c(m)},function(a){d(a)}):c(m)}function B(a){var b=document.createElement("a");return a.map(function(a){return b.href=a,b.href})}function C(b,c,d){function e(a){var b=a.data;return b.error?(h.terminate(),void d(b.error)):void("importScripts"===b.type&&(h.removeEventListener("message",e),h.removeEventListener("error",f),c(h)))}function f(a){h.terminate(),d(a)}if(null!==a.zip.workerScripts&&null!==a.zip.workerScriptsPath)return void d(new Error("Either zip.workerScripts or zip.workerScriptsPath may be set, not both."));var g;if(a.zip.workerScripts){if(g=a.zip.workerScripts[b],!Array.isArray(g))return void d(new Error("zip.workerScripts."+b+" is not an array!"));g=B(g)}else g=R[b].slice(0),g[0]=(a.zip.workerScriptsPath||"")+g[0];var h=new Worker(g[0]);h.codecTime=h.crcTime=0,h.postMessage({type:"importScripts",scripts:g.slice(1)}),h.addEventListener("message",e),h.addEventListener("error",f)}function D(a){console.error(a)}var E,F="File format is not recognized.",G="CRC failed.",H="File contains encrypted entry.",I="File is using Zip64 (4gb+ file size).",J="Error while reading zip file.",K="Error while writing zip file.",L="Error while writing file data.",M="Error while reading file data.",N="File already exists.",O=524288,P="text/plain";try{E=0===new Blob([new DataView(new ArrayBuffer(0))]).size}catch(Q){}b.prototype.append=function(a){for(var b=0|this.crc,c=this.table,d=0,e=0|a.length;e>d;d++)b=b>>>8^c[255&(b^a[d])];this.crc=b},b.prototype.get=function(){return~this.crc},b.prototype.table=function(){var a,b,c,d=[];for(a=0;256>a;a++){for(c=a,b=0;8>b;b++)1&c?c=c>>>1^3988292384:c>>>=1;d[a]=c}return d}(),c.prototype.append=function(a,b){return a},c.prototype.flush=function(){},g.prototype=new f,g.prototype.constructor=g,h.prototype=new f,h.prototype.constructor=h,i.prototype=new f,i.prototype.constructor=i,j.prototype.getData=function(a){a(this.data)},k.prototype=new j,k.prototype.constructor=k,l.prototype=new j,l.prototype.constructor=l,m.prototype=new j,m.prototype.constructor=m;var R={deflater:["z-worker.js","deflate.js"],inflater:["z-worker.js","inflate.js"]};a.zip={Reader:f,Writer:j,BlobReader:i,Data64URIReader:h,TextReader:g,BlobWriter:m,Data64URIWriter:l,TextWriter:k,createReader:function(a,b,c){c=c||D,a.init(function(){x(a,b,c)},c)},createWriter:function(a,b,c,d){c=c||D,d=!!d,a.init(function(){A(a,b,c,d)},c)},useWebWorkers:!0,workerScriptsPath:null,workerScripts:null}}(this);var requirejs,require,define;!function(a){function b(a,b){return r.call(a,b)}function c(a,b){var c,d,e,f,g,h,i,j,k,l,m,n=b&&b.split("/"),o=p.map,q=o&&o["*"]||{};if(a&&"."===a.charAt(0))if(b){for(n=n.slice(0,n.length-1),a=a.split("/"),g=a.length-1,p.nodeIdCompat&&t.test(a[g])&&(a[g]=a[g].replace(t,"")),a=n.concat(a),k=0;k<a.length;k+=1)if(m=a[k],"."===m)a.splice(k,1),k-=1;else if(".."===m){if(1===k&&(".."===a[2]||".."===a[0]))break;k>0&&(a.splice(k-1,2),k-=2)}a=a.join("/")}else 0===a.indexOf("./")&&(a=a.substring(2));if((n||q)&&o){for(c=a.split("/"),k=c.length;k>0;k-=1){if(d=c.slice(0,k).join("/"),n)for(l=n.length;l>0;l-=1)if(e=o[n.slice(0,l).join("/")],e&&(e=e[d])){f=e,h=k;break}if(f)break;!i&&q&&q[d]&&(i=q[d],j=k)}!f&&i&&(f=i,h=j),f&&(c.splice(0,h,f),a=c.join("/"))}return a}function d(b,c){return function(){return k.apply(a,s.call(arguments,0).concat([b,c]))}}function e(a){return function(b){return c(b,a)}}function f(a){return function(b){n[a]=b}}function g(c){if(b(o,c)){var d=o[c];delete o[c],q[c]=!0,j.apply(a,d)}if(!b(n,c)&&!b(q,c))throw new Error("No "+c);return n[c]}function h(a){var b,c=a?a.indexOf("!"):-1;return c>-1&&(b=a.substring(0,c),a=a.substring(c+1,a.length)),
[b,a]}function i(a){return function(){return p&&p.config&&p.config[a]||{}}}var j,k,l,m,n={},o={},p={},q={},r=Object.prototype.hasOwnProperty,s=[].slice,t=/\.js$/;l=function(a,b){var d,f=h(a),i=f[0];return a=f[1],i&&(i=c(i,b),d=g(i)),i?a=d&&d.normalize?d.normalize(a,e(b)):c(a,b):(a=c(a,b),f=h(a),i=f[0],a=f[1],i&&(d=g(i))),{f:i?i+"!"+a:a,n:a,pr:i,p:d}},m={require:function(a){return d(a)},exports:function(a){var b=n[a];return"undefined"!=typeof b?b:n[a]={}},module:function(a){return{id:a,uri:"",exports:n[a],config:i(a)}}},j=function(c,e,h,i){var j,k,p,r,s,t,u=[],v=typeof h;if(i=i||c,"undefined"===v||"function"===v){for(e=!e.length&&h.length?["require","exports","module"]:e,s=0;s<e.length;s+=1)if(r=l(e[s],i),k=r.f,"require"===k)u[s]=m.require(c);else if("exports"===k)u[s]=m.exports(c),t=!0;else if("module"===k)j=u[s]=m.module(c);else if(b(n,k)||b(o,k)||b(q,k))u[s]=g(k);else{if(!r.p)throw new Error(c+" missing "+k);r.p.load(r.n,d(i,!0),f(k),{}),u[s]=n[k]}p=h?h.apply(n[c],u):void 0,c&&(j&&j.exports!==a&&j.exports!==n[c]?n[c]=j.exports:p===a&&t||(n[c]=p))}else c&&(n[c]=h)},requirejs=require=k=function(b,c,d,e,f){if("string"==typeof b)return m[b]?m[b](c):g(l(b,c).f);if(!b.splice){if(p=b,p.deps&&k(p.deps,p.callback),!c)return;c.splice?(b=c,c=d,d=null):b=a}return c=c||function(){},"function"==typeof d&&(d=e,e=f),e?j(a,b,c,d):setTimeout(function(){j(a,b,c,d)},4),k},k.config=function(a){return k(a)},requirejs._defined=n,define=function(a,c,d){c.splice||(d=c,c=[]),b(n,a)||b(o,a)||(o[a]=[a,c,d])},define.amd={jQuery:!0}}(),define("../tools/almond",function(){}),define("misc/Polyfill",["require","exports","module"],function(a,b,c){"use strict";if(window.Map||(window.Map=function(){this.map={}},window.Map.prototype={set:function(a,b){this.map[a]=b},get:function(a){return this.map[a]}}),!Float32Array.prototype.slice){var d=function(a,b){return new this.constructor(this.subarray(a,b))};Int8Array.prototype.slice=d,Uint8Array.prototype.slice=d,Uint8ClampedArray.prototype.slice=d,Int16Array.prototype.slice=d,Uint16Array.prototype.slice=d,Int32Array.prototype.slice=d,Uint32Array.prototype.slice=d,Float32Array.prototype.slice=d,Float64Array.prototype.slice=d}String.prototype.endsWith||(String.prototype.endsWith=function(a){return this.slice(-a.length)===a}),String.prototype.startsWith||(String.prototype.startsWith=function(a){return this.slice(0,a.length)===a});for(var e=["moz","webkit"],f=0;f<e.length&&!window.requestAnimationFrame;++f)window.requestAnimationFrame=window[e[f]+"RequestAnimationFrame"];window.requestAnimationFrame||window.alert("browser is too old. Probably no webgl there anyway"),c.exports={}}),define("lib/glMatrix",["require","exports","module"],function(a,b,c){"use strict";var d={};d.vec2=window.vec2,d.vec3=window.vec3,d.vec4=window.vec4,d.mat2=window.mat2,d.mat3=window.mat3,d.mat4=window.mat4,d.quat=window.quat,c.exports=d}),define("lib/Hammer",["require","exports","module"],function(a,b,c){"use strict";c.exports=window.Hammer}),define("misc/Utils",["require","exports","module"],function(a,b,c){"use strict";var d={};d.SCALE=100,d.TAG_FLAG=1,d.SCULPT_FLAG=1,d.STATE_FLAG=1,d.cursors={},d.cursors.dropper="url(resources/dropper.png) 5 25, auto",d.makeProxy=function(a,b,c){for(var d=a.prototype,e=b.prototype,f=Object.keys(d),g=0,h=f.length;h>g;++g){var i=f[g];e[i]||(e[i]=c?c(d[i]):d[i])}},d.littleEndian=function(){var a=new ArrayBuffer(2);return new DataView(a).setInt16(0,256,!0),256===new Int16Array(a)[0]}(),d.replaceElement=function(a,b,c){for(var d=0,e=a.length;e>d;++d)if(a[d]===b)return void(a[d]=c)},d.removeElement=function(a,b){for(var c=0,d=a.length;d>c;++c)if(a[c]===b)return a[c]=a[d-1],void a.pop()},d.appendArray=function(a,b){var c=a.length,d=b.length;a.length+=d;for(var e=0;d>e;++e)a[c+e]=b[e]},d.isPowerOfTwo=function(a){return 0!==a&&0===(a&a-1)},d.nextHighestPowerOfTwo=function(a){--a;for(var b=1;32>b;b<<=1)a|=a>>b;return a+1};var e=function(a,b){return a-b};d.tidy=function(a){a.sort(e);var b=a.length,c=0,d=0;for(c=1;b>c;++c)a[d]!==a[c]&&(a[++d]=a[c]);c>1&&(a.length=d+1)},d.intersectionArrays=function(a,b){for(var c=0,d=0,e=[],f=a.length,g=b.length;f>c&&g>d;)a[c]<b[d]?c++:a[c]>b[d]?d++:(e.push(a[c]),++c,++d);return e},d.getBytes=function(a,b){return[a[b].charCodeAt(),a[b+1].charCodeAt(),a[b+2].charCodeAt(),a[b+3].charCodeAt()]},d.getUint32=function(a,b){var c=d.getBytes(a,b);return c[0]<<0|c[1]<<8|c[2]<<16|c[3]<<24},d.getFloat32=function(a,b){var c=d.getBytes(a,b),e=1-2*(c[3]>>7),f=(c[3]<<1&255|c[2]>>7)-127,g=(127&c[2])<<16|c[1]<<8|c[0];return 128===f?0!==g?NaN:e*(1/0):-127===f?e*g*Math.pow(2,-149):e*(1+g*Math.pow(2,-23))*Math.pow(2,f)},d.ab2str=function(a){for(var b="",c=new Uint8Array(a),d=65535,e=0,f=c.length;f>e;e+=d){var g=c.subarray(e,f-e>d?d+e:f);b+=String.fromCharCode.apply(null,g)}return b},d.getMemory=function(){var a=new ArrayBuffer(1e5);return function(b){return a.byteLength>=b?a:a=new ArrayBuffer(b)}}(),d.now=Date.now||function(){return(new Date).getTime()},d.throttle=function(a,b){var c,e=[],f=null,g=0,h=function(){g=d.now(),f=null,c=a.apply(a,e)};return function(){for(var i=d.now(),j=b-(i-g),k=e.length=arguments.length,l=0;k>l;++l)e[l]=arguments[l];return 0>=j||j>b?(window.clearTimeout(f),f=null,g=i,c=a.apply(a,e)):f||(f=window.setTimeout(h,j)),c}},d.normalizeArrayVec3=function(a,b){for(var c=b||a,d=0,e=a.length/3;e>d;++d){var f=3*d,g=a[f],h=a[f+1],i=a[f+2],j=g*g+h*h+i*i;0!==j?(j=1/Math.sqrt(j),c[f]=g*j,c[f+1]=h*j,c[f+2]=i*j):c[f]=1}return c},d.convertArrayVec3toSRGB=function(a,b){for(var c=b||a,d=0,e=a.length;e>d;++d){var f=a[d],g=Math.sqrt(f),h=Math.sqrt(g),i=Math.sqrt(h);c[d]=.662002687*g+.68412206*h-.323583601*i-.022541147*f}return c},d.convertArrayVec3toLinear=function(a,b){for(var c=b||a,d=0,e=a.length;e>d;++d){var f=a[d];c[d]=f*(f*(.305306011*f+.682171111)+.012522878)}return c},c.exports=d}),define("misc/getOptionsURL",["require","exports","module"],function(a,b,c){"use strict";var d,e=function(a,b){return void 0===a?b:"false"!==a&&"0"!==a},f=function(a,b,c,d){var e=parseFloat(a);return e||0===e?Math.max(b,Math.min(c,e)):d},g=function(a,b,c,d){var e=parseInt(a,10);return e||0===e?Math.max(b,Math.min(c,e)):d},h=function(a,b){if(!a)return b;var c=a.split(",");if(c.length<3)return b;var d=b.slice();return d[0]=parseInt(c[0]||0,10)/255,d[1]=parseInt(c[1]||0,10)/255,d[2]=parseInt(c[2]||0,10)/255,void 0!==c[3]&&(d[3]=parseFloat(c[3])),d},i=function(a){var b={};if(b["0".charCodeAt(0)]="MOVE",b["1".charCodeAt(0)]="BRUSH",b["2".charCodeAt(0)]="INFLATE",b["3".charCodeAt(0)]="TWIST",b["4".charCodeAt(0)]="SMOOTH",b["5".charCodeAt(0)]="FLATTEN",b["6".charCodeAt(0)]="PINCH",b["7".charCodeAt(0)]="CREASE",b["8".charCodeAt(0)]="DRAG",b["9".charCodeAt(0)]="PAINT",b["E".charCodeAt(0)]="TRANSFORM",!a)return b;for(var c=a.split(","),d=0,e=c.length;e>d;d++){var f=c[d].split(":",2);2===f.length&&(b[f[1].toUpperCase().charCodeAt(0)]=f[0].toUpperCase())}return b},j=function(){for(var a=window.location.search.substr(1).split("&"),b={},c=0,d=a.length;d>c;c++){var e=a[c].split("=",2);2===e.length&&(b[e[0].toLowerCase()]=e[1])}return b},k=function(){if(d)return d;d={};var a=j();return d.language=a.language,d.scalecenter=e(a.scalecenter,!0),d.wacom=e(a.wacom,!1),d.grid=e(a.grid,!0),d.outline=e(a.outline,!1),d.outlinecolor=h(a.outlinecolor,[.3,0,0,1]),d.mirrorline=e(a.mirrorline,!1),d.darkenunselected=e(a.darkenunselected,!0),d.projection=(a.projection||"PERSPECTIVE").toUpperCase(),d.cameramode=(a.cameramode||"ORBIT").toUpperCase(),d.pivot=e(a.pivot,!0),d.fov=f(a.fov,10,90,45),d.flatshading=e(a.flatshading,!1),d.wireframe=e(a.wireframe,!1),d.curvature=f(a.curvature,0,5,0),d.exposure=f(a.exposure,0,5,1),d.environment=g(a.environment,0,1/0,0),d.matcap=g(a.matcap,0,1/0,3),d.shader=(a.shader||"MATCAP").toUpperCase(),d.filmic=e(a.filmic,!1),d.shortcuts=i(a.shortcuts),d};k(),c.exports=k}),define("misc/Tablet",["require","exports","module","misc/getOptionsURL"],function(a,b,c){"use strict";var d,e=a("misc/getOptionsURL");e().wacom&&(d=document.createElement("object"),d.setAttribute("id","tablet-plugin"),d.setAttribute("type","application/x-wacomtabletplugin"),document.body.appendChild(d));var f={useOnRadius:!0,useOnIntensity:!1};f.pressure=function(){if(!d)return 1;var a=d.penAPI;return a&&a.pointerType?a.pressure:1},f.getPressureIntensity=function(){return f.useOnIntensity===!0?.25+.75*f.pressure():1},f.getPressureRadius=function(){return f.useOnRadius===!0?.25+.75*f.pressure():1},c.exports=f}),define("editing/tools/SculptBase",["require","exports","module","misc/Utils"],function(a,b,c){"use strict";var d=a("misc/Utils"),e=function(a){this._main=a,this._states=a?a.getStates():null,this._cbContinuous=this.updateContinuous.bind(this),this._lastMouseX=0,this._lastMouseY=0};e.prototype={setToolMesh:function(a){this._forceToolMesh=a},getMesh:function(){return this._forceToolMesh||this._main.getMesh()},start:function(a){var b=this._main,c=b.getPicking();if(!c.intersectionMouseMeshes())return!1;var d=b.setOrUnsetMesh(c.getMesh(),a);if(!d)return!1;c.initAlpha();var e=b.getSculpt().getSymmetry()?b.getPickingSymmetry():null;return e&&(e.intersectionMouseMesh(d),e.initAlpha()),this.pushState(),this._lastMouseX=b._mouseX,this._lastMouseY=b._mouseY,this.startSculpt(),!0},end:function(){this.getMesh()&&this.getMesh().checkLeavesUpdate()},pushState:function(){this._states.pushStateGeometry(this.getMesh())},startSculpt:function(){this._lockPosition!==!0&&this.sculptStroke()},preUpdate:function(a){var b=this._main,c=b.getPicking(),d="SCULPT_EDIT"===b._action;if(!d||a){d?c.intersectionMouseMesh():c.intersectionMouseMeshes();var e=c.getMesh();e&&b.getSculpt().getSymmetry()&&b.getPickingSymmetry().intersectionMouseMesh(e)}},update:function(a){return this._lockPosition===!0?this.updateSculptLock(a):void this.sculptStroke()},updateSculptLock:function(a){var b=this._main;a||this._states.getCurrentState().undo();var c=b.getPicking(),d=this._radius,e=b.getSculpt().getSymmetry()?b.getPickingSymmetry():null,f=b._mouseX-this._lastMouseX,g=b._mouseY-this._lastMouseY;this._radius=Math.sqrt(f*f+g*g);var h=f/this._radius,i=g/this._radius;this.makeStroke(this._lastMouseX+.001*h,this._lastMouseY+.001*i,c,e),this._radius=d,this.updateRender(),b.setCanvasCursor("default")},sculptStroke:function(){var a=this._main,b=a.getPicking(),c=a.getSculpt().getSymmetry()?a.getPickingSymmetry():null,d=a._mouseX-this._lastMouseX,e=a._mouseY-this._lastMouseY,f=Math.sqrt(d*d+e*e),g=.15*this._radius*a.getPixelRatio();if(!(g>=f)){var h=1/Math.floor(f/g);d*=h,e*=h;for(var i=this._lastMouseX+d,j=this._lastMouseY+e,k=h;1>=k&&this.makeStroke(i,j,b,c);k+=h)i+=d,j+=e;this.updateRender(),this._lastMouseX=a._mouseX,this._lastMouseY=a._mouseY}},updateRender:function(){this.updateMeshBuffers(),this._main.render()},makeStroke:function(a,b,c,d){var e=this.getMesh();c.intersectionMouseMesh(e,a,b);var f=c.getMesh();f&&(c.pickVerticesInSphere(c.getLocalRadius2()),c.computePickedNormal());var g=e.getDynamicTopology&&!this._lockPosition;g&&f&&this.stroke(c,!1);var h;return d&&(d.intersectionMouseMesh(e,a,b),h=d.getMesh(),h&&(d.setLocalRadius2(c.getLocalRadius2()),d.pickVerticesInSphere(d.getLocalRadius2()),d.computePickedNormal())),!g&&f&&this.stroke(c,!1),h&&this.stroke(d,!0),f||h},updateMeshBuffers:function(){var a=this.getMesh();a.getDynamicTopology?a.updateBuffers():a.updateGeometryBuffers()},updateContinuous:function(){if(this._lockPosition)return this.update(!0);var a=this._main,b=a.getPicking(),c=a.getSculpt().getSymmetry()?a.getPickingSymmetry():null;this.makeStroke(a._mouseX,a._mouseY,b,c),this.updateRender()},getFrontVertices:function(a,b){for(var c=a.length,e=new Uint32Array(d.getMemory(4*c),0,c),f=0,g=this.getMesh().getNormals(),h=b[0],i=b[1],j=b[2],k=0;c>k;++k){var l=a[k],m=3*l;g[m]*h+g[m+1]*i+g[m+2]*j<=0&&(e[f++]=l)}return new Uint32Array(e.subarray(0,f))},areaNormal:function(a){for(var b=this.getMesh(),c=b.getNormals(),d=b.getMaterials(),e=0,f=0,g=0,h=0,i=a.length;i>h;++h){var j=3*a[h],k=d[j+2];e+=c[j]*k,f+=c[j+1]*k,g+=c[j+2]*k}var l=Math.sqrt(e*e+f*f+g*g);return 0!==l?(l=1/l,[e*l,f*l,g*l]):void 0},areaCenter:function(a){for(var b=this.getMesh(),c=b.getVertices(),d=b.getMaterials(),e=a.length,f=0,g=0,h=0,i=0,j=0;e>j;++j){var k=3*a[j],l=d[k+2];i+=l,f+=c[k]*l,g+=c[k+1]*l,h+=c[k+2]*l}return[f/i,g/i,h/i]},updateProxy:function(a){var b=this.getMesh(),c=b.getVertices(),e=b.getVerticesProxy();if(c!==e)for(var f=b.getVerticesStateFlags(),g=d.STATE_FLAG,h=0,i=a.length;i>h;++h){var j=a[h];if(f[j]!==g){var k=3*j;e[k]=c[k],e[k+1]=c[k+1],e[k+2]=c[k+2]}}},laplacianSmooth:function(a,b,c){for(var d=this.getMesh(),e=d.getVerticesRingVertStartCount(),f=d.getVerticesRingVert(),g=f instanceof Array?f:null,h=d.getVerticesOnEdge(),i=c||d.getVertices(),j=a.length,k=0;j>k;++k){var l,m,n=3*k,o=a[k];g?(f=g[o],l=0,m=f.length):(l=e[2*o],m=l+e[2*o+1]);var p=0,q=0,r=0,s=0,t=0;if(1===h[o]){var u=0;for(s=l;m>s;++s)t=f[s],1===h[t]&&(t*=3,p+=i[t],q+=i[t+1],r+=i[t+2],++u);if(u>=2){b[n]=p/u,b[n+1]=q/u,b[n+2]=r/u;continue}p=q=r=0}for(s=l;m>s;++s)t=3*f[s],p+=i[t],q+=i[t+1],r+=i[t+2];s=m-l,b[n]=p/s,b[n+1]=q/s,b[n+2]=r/s}},dynamicTopology:function(a){var b=this.getMesh(),c=a.getPickedVertices();if(!b.getDynamicTopology)return c;0===c.length&&(c=b.getVerticesFromFaces([a.getPickedFace()]),this._states.pushVertices(c));var e=b.getDynamicTopology(),f=e.getSubdivisionFactor(),g=e.getDecimationFactor();if(0===f&&0===g)return c;var h=b.getFacesFromVertices(c),i=a.getLocalRadius2(),j=a.getIntersectionPoint(),k=i*(1.1-f)*.2,l=k/4.2025*g;this._states.pushFaces(h),f&&(h=e.subdivision(h,j,i,k,this._states)),g&&(h=e.decimation(h,j,i,l,this._states)),c=b.getVerticesFromFaces(h);for(var m=c.length,n=d.SCULPT_FLAG,o=b.getVerticesSculptFlags(),p=new Uint32Array(d.getMemory(4*m),0,m),q=0,r=0;m>r;++r){var s=c[r];o[s]===n&&(p[q++]=s)}return p=new Uint32Array(p.subarray(0,q)),b.updateTopology(h),b.updateGeometry(h,p),p},getUnmaskedVertices:function(){return this.filterMaskedVertices(0,1/0)},getMaskedVertices:function(){return this.filterMaskedVertices(-(1/0),1)},filterMaskedVertices:function(a,b){for(var c=void 0===a?-(1/0):a,e=void 0===b?1/0:b,f=this.getMesh(),g=f.getMaterials(),h=f.getNbVertices(),i=new Uint32Array(d.getMemory(4*h),0,h),j=0,k=0;h>k;++k){var l=g[3*k+2];l>c&&e>l&&(i[j++]=k)}return new Uint32Array(i.subarray(0,j))},postRender:function(){},addSculptToScene:function(){},getScreenRadius:function(){return(this._radius||1)*this._main.getPixelRatio()}},c.exports=e}),define("editing/tools/Flatten",["require","exports","module","misc/Utils","misc/Tablet","editing/tools/SculptBase"],function(a,b,c){"use strict";var d=a("misc/Utils"),e=a("misc/Tablet"),f=a("editing/tools/SculptBase"),g=function(a){f.call(this,a),this._radius=50,this._intensity=.75,this._negative=!0,this._culling=!1,this._idAlpha=0,this._lockPosition=!1};g.prototype={stroke:function(a){var b=a.getPickedVertices(),c=this._intensity*e.getPressureIntensity();this._states.pushVertices(b),b=this.dynamicTopology(a);var d=this.getFrontVertices(b,a.getEyeDirection());this._culling&&(b=d);var f=this.areaNormal(d);if(f){var g=this.areaCenter(d);a.updateAlpha(this._lockPosition),a.setIdAlpha(this._idAlpha),this.flatten(b,f,g,a.getIntersectionPoint(),a.getLocalRadius2(),c,a);var h=this.getMesh();h.updateGeometry(h.getFacesFromVertices(b),b)}},flatten:function(a,b,c,d,e,f,g){for(var h=this.getMesh(),i=h.getVertices(),j=h.getMaterials(),k=Math.sqrt(e),l=this._accumulate===!1&&this._lockPosition===!1?h.getVerticesProxy():i,m=d[0],n=d[1],o=d[2],p=c[0],q=c[1],r=c[2],s=b[0],t=b[1],u=b[2],v=this._negative?-1:1,w=0,x=a.length;x>w;++w){var y=3*a[w],z=i[y],A=i[y+1],B=i[y+2],C=(z-p)*s+(A-q)*t+(B-r)*u;if(!(C*v>0)){var D=l[y]-m,E=l[y+1]-n,F=l[y+2]-o,G=Math.sqrt(D*D+E*E+F*F)/k;if(!(G>=1)){var H=G*G;H=3*H*H-4*H*G+1,H*=C*f*j[y+2]*g.getAlpha(z,A,B),i[y]-=s*H,i[y+1]-=t*H,i[y+2]-=u*H}}}}},d.makeProxy(f,g),c.exports=g}),define("editing/tools/Brush",["require","exports","module","lib/glMatrix","misc/Utils","misc/Tablet","editing/tools/SculptBase","editing/tools/Flatten"],function(a,b,c){"use strict";var d=a("lib/glMatrix"),e=a("misc/Utils"),f=a("misc/Tablet"),g=a("editing/tools/SculptBase"),h=a("editing/tools/Flatten"),i=d.vec3,j=function(a){g.call(this,a),this._radius=50,this._intensity=.5,this._negative=!1,this._clay=!0,this._culling=!1,this._accumulate=!0,this._idAlpha=0,this._lockPosition=!1};j.prototype={stroke:function(a){var b=a.getPickedVertices(),c=this._intensity*f.getPressureIntensity();this._accumulate||this._lockPosition||this.updateProxy(b),this._states.pushVertices(b),this._lockPosition||(b=this.dynamicTopology(a));var d=this.getFrontVertices(b,a.getEyeDirection());this._culling&&(b=d);var e=a.getLocalRadius2();if(a.updateAlpha(this._lockPosition),a.setIdAlpha(this._idAlpha),this._clay){var g=this.areaNormal(d);if(!g)return;var j=this._lockPosition?a.getIntersectionPoint():this.areaCenter(d),k=.1*Math.sqrt(e);i.scaleAndAdd(j,j,g,this._negative?-k:k),h.prototype.flatten.call(this,b,g,j,a.getIntersectionPoint(),e,c,a)}else this.brush(b,a.getPickedNormal(),a.getIntersectionPoint(),e,c,a);var l=this.getMesh();l.updateGeometry(l.getFacesFromVertices(b),b)},brush:function(a,b,c,d,e,f){var g=this.getMesh(),h=g.getVertices(),i=g.getMaterials(),j=this._accumulate||this._lockPosition?h:g.getVerticesProxy(),k=Math.sqrt(d),l=e*k*.1;this._negative&&(l=-l);for(var m=c[0],n=c[1],o=c[2],p=b[0],q=b[1],r=b[2],s=0,t=a.length;t>s;++s){var u=3*a[s],v=j[u]-m,w=j[u+1]-n,x=j[u+2]-o,y=Math.sqrt(v*v+w*w+x*x)/k;if(!(y>=1)){var z=h[u],A=h[u+1],B=h[u+2],C=y*y;C=3*C*C-4*C*y+1,C*=i[u+2]*l*f.getAlpha(z,A,B),h[u]=z+p*C,h[u+1]=A+q*C,h[u+2]=B+r*C}}}},e.makeProxy(g,j),c.exports=j}),define("editing/tools/Smooth",["require","exports","module","misc/Utils","misc/Tablet","editing/tools/SculptBase"],function(a,b,c){"use strict";var d=a("misc/Utils"),e=a("misc/Tablet"),f=a("editing/tools/SculptBase"),g=function(a){f.call(this,a),this._radius=50,this._intensity=.75,this._culling=!1,this._tangent=!1,this._idAlpha=0,this._lockPosition=!1};g.prototype={stroke:function(a){var b=a.getPickedVertices(),c=this._intensity*e.getPressureIntensity();this._states.pushVertices(b),this._culling&&(b=this.getFrontVertices(b,a.getEyeDirection())),a.updateAlpha(this._lockPosition),a.setIdAlpha(this._idAlpha),this._tangent?this.smoothTangent(b,c,a):this.smooth(b,c,a);var d=this.getMesh();d.updateGeometry(d.getFacesFromVertices(b),b)},smooth:function(a,b,c){var d=this.getMesh(),e=d.getVertices(),f=d.getMaterials(),g=a.length,h=new Float32Array(3*g);this.laplacianSmooth(a,h);for(var i=0;g>i;++i){var j=3*a[i],k=e[j],l=e[j+1],m=e[j+2],n=3*i,o=b*f[j+2];c&&(o*=c.getAlpha(k,l,m));var p=1-o;e[j]=k*p+h[n]*o,e[j+1]=l*p+h[n+1]*o,e[j+2]=m*p+h[n+2]*o}},smoothTangent:function(a,b,c){var d=this.getMesh(),e=d.getVertices(),f=d.getMaterials(),g=d.getNormals(),h=a.length,i=new Float32Array(3*h);this.laplacianSmooth(a,i);for(var j=0;h>j;++j){var k=3*a[j],l=e[k],m=e[k+1],n=e[k+2],o=g[k],p=g[k+1],q=g[k+2],r=o*o+p*p+q*q;if(0!==r){r=1/Math.sqrt(r),o*=r,p*=r,q*=r;var s=3*j,t=i[s],u=i[s+1],v=i[s+2],w=o*(t-l)+p*(u-m)+q*(v-n),x=b*f[k+2];c&&(x*=c.getAlpha(l,m,n)),e[k]=l+(t-o*w-l)*x,e[k+1]=m+(u-p*w-m)*x,e[k+2]=n+(v-q*w-n)*x}}},smoothAlongNormals:function(a,b,c){var d=this.getMesh(),e=d.getVertices(),f=d.getMaterials(),g=d.getNormals(),h=a.length,i=new Float32Array(3*h);this.laplacianSmooth(a,i);for(var j=0;h>j;++j){var k=3*a[j],l=e[k],m=e[k+1],n=e[k+2],o=g[k],p=g[k+1],q=g[k+2],r=3*j,s=1/(o*o+p*p+q*q),t=o*(i[r]-l)+p*(i[r+1]-m)+q*(i[r+2]-n);t*=s*b*f[k+2],c&&(t*=c.getAlpha(l,m,n)),e[k]=l+o*t,e[k+1]=m+p*t,e[k+2]=n+q*t}}},d.makeProxy(f,g),c.exports=g}),define("editing/tools/Inflate",["require","exports","module","misc/Utils","misc/Tablet","editing/tools/SculptBase","editing/tools/Smooth"],function(a,b,c){"use strict";var d=a("misc/Utils"),e=a("misc/Tablet"),f=a("editing/tools/SculptBase"),g=a("editing/tools/Smooth"),h=function(a){f.call(this,a),this._radius=50,this._intensity=.3,this._negative=!1,this._culling=!1,this._idAlpha=0,this._lockPosition=!1};h.prototype={stroke:function(a){var b=a.getPickedVertices(),c=this._intensity*e.getPressureIntensity();this.updateProxy(b),this._states.pushVertices(b),b=this.dynamicTopology(a),this._culling&&(b=this.getFrontVertices(b,a.getEyeDirection())),a.updateAlpha(this._lockPosition),a.setIdAlpha(this._idAlpha),this.inflate(b,a.getIntersectionPoint(),a.getLocalRadius2(),c,a),g.prototype.smoothTangent.call(this,b,1,a);var d=this.getMesh();d.updateGeometry(d.getFacesFromVertices(b),b)},inflate:function(a,b,c,d,e){var f=this.getMesh(),g=f.getVertices(),h=f.getMaterials(),i=f.getVerticesProxy(),j=f.getNormals(),k=Math.sqrt(c),l=d*k*.1;this._negative&&(l=-l);for(var m=b[0],n=b[1],o=b[2],p=0,q=a.length;q>p;++p){var r=3*a[p],s=i[r]-m,t=i[r+1]-n,u=i[r+2]-o,v=Math.sqrt(s*s+t*t+u*u)/k;if(!(v>=1)){var w=v*v;w=3*w*w-4*w*v+1,w=l*w;var x=g[r],y=g[r+1],z=g[r+2],A=j[r],B=j[r+1],C=j[r+2];w/=Math.sqrt(A*A+B*B+C*C),w*=h[r+2]*e.getAlpha(x,y,z),g[r]=x+A*w,g[r+1]=y+B*w,g[r+2]=z+C*w}}}},d.makeProxy(f,h),c.exports=h}),define("math3d/Geometry",["require","exports","module","lib/glMatrix"],function(a,b,c){"use strict";var d=a("lib/glMatrix"),e=d.vec3,f={};f.normalizedMouse=function(a,b,c,d){return[2*a/c-1,1-2*b/d]},f.reflect=function(a,b){var c=e.dot(a,b);return a[0]-=2*c*b[0],a[1]-=2*c*b[1],a[2]-=2*c*b[2],a},f.mouseOnUnitSphere=function(a){var b=a[0],c=a[1],d=1-b*b-c*c,f=d>0?Math.sqrt(d):0,g=[b,c,f];return e.normalize(g,g)},f.intersectionRayTriangleEdges=function(){var a=1e-15,b=1+a,c=0-a,d=[0,0,0],f=[0,0,0],g=[0,0,0];return function(h,i,j,k,l,m){e.cross(d,i,k);var n=e.dot(j,d);if(n>-a&&a>n)return-1;var o=1/n;e.sub(f,h,l);var p=e.dot(f,d)*o;if(c>p||p>b)return-1;e.cross(g,f,j);var q=e.dot(i,g)*o;if(c>q||p+q>b)return-1;var r=e.dot(k,g)*o;return c>r?-1:(m&&e.scaleAndAdd(m,h,i,r),r)}}(),f.intersectionRayTriangle=function(){var a=[0,0,0],b=[0,0,0];return function(c,d,g,h,i,j){return e.sub(a,h,g),e.sub(b,i,g),f.intersectionRayTriangleEdges(c,d,a,b,g,j)}}(),f.distance2PointTriangleEdges=function(){var a=[0,0,0];return function(b,c,d,f,g,h,i,j){e.sub(a,f,b);var k,l=e.dot(a,c),m=e.dot(a,d),n=e.sqrLen(a),o=Math.abs(g*i-h*h),p=h*m-i*l,q=h*l-g*m,r=4;if(o>=p+q)if(0>p)0>q?(r=4,0>l?(q=0,-l>=g?(p=1,k=g+2*l+n):(p=-l/g,k=l*p+n)):(p=0,m>=0?(q=0,k=n):-m>=i?(q=1,k=i+2*m+n):(q=-m/i,k=m*q+n))):(r=3,p=0,m>=0?(q=0,k=n):-m>=i?(q=1,k=i+2*m+n):(q=-m/i,k=m*q+n));else if(0>q)r=5,q=0,l>=0?(p=0,k=n):-l>=g?(p=1,k=g+2*l+n):(p=-l/g,k=l*p+n);else{r=0;var s=1/o;p*=s,q*=s,k=p*(g*p+h*q+2*l)+q*(h*p+i*q+2*m)+n}else{var t,u,v,w;0>p?(r=2,t=h+l,u=i+m,u>t?(v=u-t,w=g-2*h+i,v>=w?(p=1,q=0,k=g+2*l+n):(p=v/w,q=1-p,k=p*(g*p+h*q+2*l)+q*(h*p+i*q+2*m)+n)):(p=0,0>=u?(q=1,k=i+2*m+n):m>=0?(q=0,k=n):(q=-m/i,k=m*q+n))):0>q?(r=6,t=h+m,u=g+l,u>t?(v=u-t,w=g-2*h+i,v>=w?(q=1,p=0,k=i+2*m+n):(q=v/w,p=1-q,k=p*(g*p+h*q+2*l)+q*(h*p+i*q+2*m)+n)):(q=0,0>=u?(p=1,k=g+2*l+n):l>=0?(p=0,k=n):(p=-l/g,k=l*p+n))):(r=1,v=i+m-h-l,0>=v?(p=0,q=1,k=i+2*m+n):(w=g-2*h+i,v>=w?(p=1,q=0,k=g+2*l+n):(p=v/w,q=1-p,k=p*(g*p+h*q+2*l)+q*(h*p+i*q+2*m)+n)))}return 0>k&&(k=0),j&&(j[0]=f[0]+p*c[0]+q*d[0],j[1]=f[1]+p*c[1]+q*d[1],j[2]=f[2]+p*c[2]+q*d[2],j[3]=r),k}}(),f.distance2PointTriangle=function(){var a=[0,0,0],b=[0,0,0];return function(c,d,g,h,i){e.sub(a,g,d),e.sub(b,h,d);var j=e.sqrLen(a),k=e.dot(a,b),l=e.sqrLen(b);return f.distance2PointTriangleEdges(c,a,b,d,j,k,l,i)}}(),f.pointInsideTriangle=function(){var a=[0,0,0],b=[0,0,0],c=[0,0,0],d=[0,0,0],f=[0,0,0];return function(g,h,i,j){e.sub(a,h,i),e.sub(b,h,j),e.sub(c,g,i),e.sub(d,g,j);var k=e.len(e.cross(f,a,b)),l=e.len(e.cross(f,a,c)),m=e.len(e.cross(f,b,d)),n=e.len(e.cross(f,c,d));return Math.abs(k-(l+m+n))<1e-20}}(),f.triangleInsideSphere=function(a,b,c,d,e){return f.distanceSqToSegment(a,c,d)<b?!0:f.distanceSqToSegment(a,d,e)<b?!0:f.distanceSqToSegment(a,c,e)<b?!0:!1},f.distanceSqToSegment=function(){var a=[0,0,0],b=[0,0,0];return function(c,d,f){e.sub(a,c,d),e.sub(b,f,d);var g=e.sqrLen(b),h=e.dot(a,b)/g;return 0>h?e.sqrLen(a):h>1?e.sqrLen(e.sub(a,c,f)):(a[0]=c[0]-d[0]-h*b[0],a[1]=c[1]-d[1]-h*b[1],a[2]=c[2]-d[2]-h*b[2],e.sqrLen(a))}}(),f.signedAngle2d=function(a,b){var c=a[0],d=a[1],e=b[0],f=b[1];return Math.atan2(c*f-d*e,c*e+d*f)},f.pointPlaneDistance=function(){var a=[0,0,0];return function(b,c,d){return e.dot(e.sub(a,b,c),d)}}(),f.mirrorPoint=function(){var a=[0,0,0];return function(b,c,d){return e.sub(b,b,e.scale(a,d,2*f.pointPlaneDistance(b,c,d)))}}(),f.vertexOnLine=function(){var a=[0,0,0];return function(b,c,d){e.sub(a,d,c);var f=[0,0,0],g=e.dot(a,e.sub(f,b,c));return e.scaleAndAdd(f,c,a,g/e.sqrLen(a))}}(),f.intersectLinePlane=function(a,b,c,d,f){var g=e.dot(e.sub(f,a,c),d),h=e.dot(e.sub(f,b,c),d);if(g===h)return b;var i=-g/(h-g);return e.scaleAndAdd(f,a,e.sub(f,b,a),i)},f.getPerpendicularVector=function(a){var b=[0,0,0];return 0===a[0]?b[0]=1:0===a[1]?b[1]=1:0===a[2]?b[2]=1:(b[0]=a[2],b[1]=a[2],b[2]=-a[0]-a[1],e.normalize(b,b)),b},c.exports=f}),define("editing/tools/Twist",["require","exports","module","lib/glMatrix","misc/Utils","math3d/Geometry","editing/tools/SculptBase"],function(a,b,c){"use strict";var d=a("lib/glMatrix"),e=a("misc/Utils"),f=a("math3d/Geometry"),g=a("editing/tools/SculptBase"),h=d.vec2,i=d.vec3,j=d.quat,k=function(a){g.call(this,a),this._radius=75,this._culling=!1,this._twistData={normal:[0,0,0],center:[0,0]},this._twistDataSym={normal:[0,0,0],center:[0,0]},this._idAlpha=0};k.prototype={startSculpt:function(){var a=this._main,b=a._mouseX,c=a._mouseY,d=a.getPicking();if(this.initTwistData(d,b,c,this._twistData),a.getSculpt().getSymmetry()){var e=a.getPickingSymmetry();e.intersectionMouseMesh(),e.setLocalRadius2(d.getLocalRadius2()),e.getMesh()&&this.initTwistData(e,b,c,this._twistDataSym)}},initTwistData:function(a,b,c,d){a.pickVerticesInSphere(a.getLocalRadius2()),i.negate(d.normal,a.getEyeDirection()),h.set(d.center,b,c)},sculptStroke:function(){var a=this._main,b=a._mouseX,c=a._mouseY,d=a._lastMouseX,e=a._lastMouseY,f=a.getPicking(),g=f.getLocalRadius2();if(f.pickVerticesInSphere(g),this.stroke(f,b,c,d,e,this._twistData),a.getSculpt().getSymmetry()){var h=a.getPickingSymmetry();h.getMesh()&&(h.pickVerticesInSphere(g),this.stroke(h,d,e,b,c,this._twistDataSym))}this.updateRender(),a.setCanvasCursor("default")},stroke:function(a,b,c,d,e,f){var g=a.getPickedVertices();this._states.pushVertices(g),g=this.dynamicTopology(a),this._culling&&(g=this.getFrontVertices(g,a.getEyeDirection())),a.updateAlpha(!1),a.setIdAlpha(this._idAlpha),this.twist(g,a.getIntersectionPoint(),a.getLocalRadius2(),b,c,d,e,f,a);var h=this.getMesh();h.updateGeometry(h.getFacesFromVertices(g),g)},twist:function(a,b,c,d,e,g,k,l,m){var n=this.getMesh(),o=l.center,p=[d-o[0],e-o[1]];if(!(h.len(p)<30)){h.normalize(p,p);var q=l.normal,r=[0,0,0,0],s=[g-o[0],k-o[1]];h.normalize(s,s);for(var t=f.signedAngle2d(p,s),u=n.getVertices(),v=n.getMaterials(),w=1/Math.sqrt(c),x=b[0],y=b[1],z=b[2],A=[0,0,0],B=0,C=a.length;C>B;++B){var D=3*a[B],E=u[D],F=u[D+1],G=u[D+2],H=E-x,I=F-y,J=G-z,K=Math.sqrt(H*H+I*I+J*J)*w,L=K*K;L=3*L*L-4*L*K+1,L*=t*v[D+2]*m.getAlpha(E,F,G),j.setAxisAngle(r,q,L),i.set(A,E,F,G),i.sub(A,A,b),i.transformQuat(A,A,r),i.add(A,A,b),u[D]=A[0],u[D+1]=A[1],u[D+2]=A[2]}}}},e.makeProxy(g,k),c.exports=k}),define("editing/tools/Pinch",["require","exports","module","misc/Utils","misc/Tablet","editing/tools/SculptBase"],function(a,b,c){"use strict";var d=a("misc/Utils"),e=a("misc/Tablet"),f=a("editing/tools/SculptBase"),g=function(a){f.call(this,a),this._radius=50,this._intensity=.75,this._negative=!1,this._culling=!1,this._idAlpha=0,this._lockPosition=!1};g.prototype={stroke:function(a){var b=a.getPickedVertices(),c=this._intensity*e.getPressureIntensity();this._states.pushVertices(b),b=this.dynamicTopology(a),this._culling&&(b=this.getFrontVertices(b,a.getEyeDirection())),a.updateAlpha(this._lockPosition),a.setIdAlpha(this._idAlpha),this.pinch(b,a.getIntersectionPoint(),a.getLocalRadius2(),c,a);var d=this.getMesh();d.updateGeometry(d.getFacesFromVertices(b),b)},pinch:function(a,b,c,d,e){var f=this.getMesh(),g=f.getVertices(),h=f.getMaterials(),i=Math.sqrt(c),j=b[0],k=b[1],l=b[2],m=.05*d;this._negative&&(m=-m);for(var n=0,o=a.length;o>n;++n){var p=3*a[n],q=g[p],r=g[p+1],s=g[p+2],t=j-q,u=k-r,v=l-s,w=Math.sqrt(t*t+u*u+v*v)/i,x=w*w;x=3*x*x-4*x*w+1,x*=m*h[p+2]*e.getAlpha(q,r,s),g[p]=q+t*x,g[p+1]=r+u*x,g[p+2]=s+v*x}}},d.makeProxy(f,g),c.exports=g}),define("editing/tools/Crease",["require","exports","module","misc/Utils","misc/Tablet","editing/tools/SculptBase"],function(a,b,c){"use strict";var d=a("misc/Utils"),e=a("misc/Tablet"),f=a("editing/tools/SculptBase"),g=function(a){f.call(this,a),this._radius=25,this._intensity=.75,this._negative=!0,this._culling=!1,this._idAlpha=0,this._lockPosition=!1};g.prototype={stroke:function(a){var b=a.getPickedVertices(),c=this._intensity*e.getPressureIntensity();this.updateProxy(b),this._states.pushVertices(b),b=this.dynamicTopology(a);var d=this.getFrontVertices(b,a.getEyeDirection());this._culling&&(b=d),a.updateAlpha(this._lockPosition),a.setIdAlpha(this._idAlpha),this.crease(b,a.getPickedNormal(),a.getIntersectionPoint(),a.getLocalRadius2(),c,a);var f=this.getMesh();f.updateGeometry(f.getFacesFromVertices(b),b)},crease:function(a,b,c,d,e,f){var g=this.getMesh(),h=g.getVertices(),i=g.getMaterials(),j=g.getVerticesProxy(),k=Math.sqrt(d),l=c[0],m=c[1],n=c[2],o=b[0],p=b[1],q=b[2],r=.07*e,s=r*k;this._negative&&(s=-s);for(var t=0,u=a.length;u>t;++t){var v=3*a[t],w=l-j[v],x=m-j[v+1],y=n-j[v+2],z=Math.sqrt(w*w+x*x+y*y)/k;if(!(z>=1)){var A=h[v],B=h[v+1],C=h[v+2],D=z*z;D=3*D*D-4*D*z+1,D*=i[v+2]*f.getAlpha(A,B,C);var E=Math.pow(D,5)*s;D*=r,h[v]=A+w*D+o*E,h[v+1]=B+x*D+p*E,h[v+2]=C+y*D+q*E}}}},d.makeProxy(f,g),c.exports=g}),define("editing/tools/Drag",["require","exports","module","lib/glMatrix","misc/Utils","math3d/Geometry","editing/tools/SculptBase","editing/tools/Smooth"],function(a,b,c){"use strict";var d=a("lib/glMatrix"),e=a("misc/Utils"),f=a("math3d/Geometry"),g=a("editing/tools/SculptBase"),h=a("editing/tools/Smooth"),i=d.vec3,j=d.mat4,k=function(a){g.call(this,a),this._radius=150,this._dragDir=[0,0,0],this._dragDirSym=[0,0,0],this._idAlpha=0};k.prototype={sculptStroke:function(){var a=this._main,b=this.getMesh(),c=a.getPicking(),d=a.getSculpt().getSymmetry()?a.getPickingSymmetry():null,e=a._mouseX-this._lastMouseX,g=a._mouseY-this._lastMouseY,h=Math.sqrt(e*e+g*g),j=.15*this._radius,k=1/Math.floor(h/j);e*=k,g*=k;var l=this._lastMouseX,m=this._lastMouseY;if(c.getMesh()){c._mesh=b,d&&(d._mesh=b,i.copy(d.getIntersectionPoint(),c.getIntersectionPoint()),f.mirrorPoint(d.getIntersectionPoint(),b.getSymmetryOrigin(),b.getSymmetryNormal()));for(var n=0;1>n&&this.makeStroke(l,m,c,d);n+=k)l+=e,m+=g;this.updateRender(),this._lastMouseX=a._mouseX,this._lastMouseY=a._mouseY}},makeStroke:function(a,b,c,d){var e=this.getMesh();return this.updateDragDir(c,a,b),c.pickVerticesInSphere(c.getLocalRadius2()),c.computePickedNormal(),e.getDynamicTopology&&this.stroke(c,!1),d&&(this.updateDragDir(d,a,b,!0),d.setLocalRadius2(c.getLocalRadius2()),d.pickVerticesInSphere(d.getLocalRadius2())),e.getDynamicTopology||this.stroke(c,!1),d&&this.stroke(d,!0),!0},stroke:function(a,b){var c=a.getPickedVertices();this._states.pushVertices(c),c=this.dynamicTopology(a),a.updateAlpha(this._lockPosition),a.setIdAlpha(this._idAlpha),this.drag(c,a.getIntersectionPoint(),a.getLocalRadius2(),b,a),h.prototype.smoothTangent.call(this,c,1,a);var d=this.getMesh();d.updateGeometry(d.getFacesFromVertices(c),c)},drag:function(a,b,c,d,e){for(var f=this.getMesh(),g=f.getVertices(),h=f.getMaterials(),i=Math.sqrt(c),j=b[0],k=b[1],l=b[2],m=d?this._dragDirSym:this._dragDir,n=m[0],o=m[1],p=m[2],q=0,r=a.length;r>q;++q){var s=3*a[q],t=g[s],u=g[s+1],v=g[s+2],w=t-j,x=u-k,y=v-l,z=Math.sqrt(w*w+x*x+y*y)/i,A=z*z;A=3*A*A-4*A*z+1,A*=h[s+2]*e.getAlpha(t,u,v),g[s]=t+n*A,g[s+1]=u+o*A,g[s+2]=v+p*A}},updateDragDir:function(a,b,c,d){var e=this.getMesh(),g=a.unproject(b,c,0),h=a.unproject(b,c,.1),k=j.create();j.invert(k,e.getMatrix()),i.transformMat4(g,g,k),i.transformMat4(h,h,k);var l=this._dragDir;if(d){l=this._dragDirSym;var m=e.getSymmetryOrigin(),n=e.getSymmetryNormal();
f.mirrorPoint(g,m,n),f.mirrorPoint(h,m,n)}var o=a.getIntersectionPoint();a.setIntersectionPoint(f.vertexOnLine(o,g,h)),i.sub(l,a.getIntersectionPoint(),o),a._mesh=e,a.updateLocalAndWorldRadius2();var p=a.getEyeDirection();i.sub(p,h,g),i.normalize(p,p)}},e.makeProxy(g,k),c.exports=k}),define("editing/tools/Paint",["require","exports","module","lib/glMatrix","misc/Utils","misc/Tablet","editing/tools/SculptBase"],function(a,b,c){"use strict";var d=a("lib/glMatrix"),e=a("misc/Utils"),f=a("misc/Tablet"),g=a("editing/tools/SculptBase"),h=d.vec3,i=function(a){g.call(this,a),this._radius=50,this._hardness=.75,this._intensity=.75,this._culling=!1,this._color=h.fromValues(1,.766,.336),this._material=h.fromValues(.3,.95,0),this._pickColor=!1,this._global=!1,this._pickCallback=null,this._idAlpha=0,this._lockPosition=!1};i.prototype={end:function(){this._pickColor=!1,g.prototype.end.call(this)},pushState:function(a){(!this._pickColor||a)&&this._states.pushStateColorAndMaterial(this.getMesh())},startSculpt:function(){return this._pickColor?this.pickColor(this._main.getPicking()):void g.prototype.startSculpt.call(this)},update:function(){return this._pickColor===!0?this.updatePickColor():void g.prototype.update.apply(this,arguments)},updateContinuous:function(){return this._pickColor===!0?this.updatePickColor():void g.prototype.updateContinuous.call(this)},updateMeshBuffers:function(){var a=this.getMesh();a.getDynamicTopology?a.updateBuffers():(a.updateColorBuffer(),a.updateMaterialBuffer())},updatePickColor:function(){var a=this._main.getPicking();a.intersectionMouseMesh()&&this.pickColor(a)},setPickCallback:function(a){this._pickCallback=a},pickColor:function(a){var b=this.getMesh(),c=this._color;a.polyLerp(b.getMaterials(),c);var d=c[0],e=c[1];a.polyLerp(b.getColors(),c),this._pickCallback(c,d,e)},stroke:function(a){var b=a.getPickedVertices(),c=this._intensity*f.getPressureIntensity();this._states.pushVertices(b),b=this.dynamicTopology(a),this._culling&&(b=this.getFrontVertices(b,a.getEyeDirection())),a.updateAlpha(this._lockPosition),a.setIdAlpha(this._idAlpha),this.paint(b,a.getIntersectionPoint(),a.getLocalRadius2(),c,this._hardness,a);var d=this.getMesh();d.updateDuplicateColorsAndMaterials(b),d.isUsingDrawArrays()&&d.updateDrawArrays(d.getFacesFromVertices(b))},paint:function(a,b,c,d,e,f){for(var g=this.getMesh(),h=g.getVertices(),i=g.getColors(),j=g.getMaterials(),k=this._color,l=this._material[0],m=this._material[1],n=Math.sqrt(c),o=k[0],p=k[1],q=k[2],r=b[0],s=b[1],t=b[2],u=2*(1-e),v=0,w=a.length;w>v;++v){var x=3*a[v],y=h[x],z=h[x+1],A=h[x+2],B=y-r,C=z-s,D=A-t,E=Math.sqrt(B*B+C*C+D*D)/n,F=Math.pow(1-E,u);F*=d*j[x+2]*f.getAlpha(y,z,A);var G=1-F;i[x]=i[x]*G+o*F,i[x+1]=i[x+1]*G+p*F,i[x+2]=i[x+2]*G+q*F,j[x]=j[x]*G+l*F,j[x+1]=j[x+1]*G+m*F}},paintAll:function(){var a=this.getMesh(),b=this.getUnmaskedVertices();if(0!==b.length){this.pushState(!0),this._states.pushVertices(b);for(var c=a.getColors(),d=a.getMaterials(),e=this._color,f=this._material[0],g=this._material[1],h=e[0],i=e[1],j=e[2],k=0,l=b.length;l>k;++k){var m=3*b[k],n=d[m+2],o=1-n;c[m]=c[m]*o+h*n,c[m+1]=c[m+1]*o+i*n,c[m+2]=c[m+2]*o+j*n,d[m]=d[m]*o+f*n,d[m+1]=d[m+1]*o+g*n}a.updateDuplicateColorsAndMaterials(),a.updateDrawArrays(),this.updateRender()}}},e.makeProxy(g,i),c.exports=i}),define("editing/tools/Move",["require","exports","module","lib/glMatrix","misc/Utils","math3d/Geometry","editing/tools/SculptBase"],function(a,b,c){"use strict";var d=a("lib/glMatrix"),e=a("misc/Utils"),f=a("math3d/Geometry"),g=a("editing/tools/SculptBase"),h=d.vec3,i=d.mat4,j=function(a){g.call(this,a),this._radius=150,this._intensity=1,this._topoCheck=!0,this._negative=!1,this._moveData={center:[0,0,0],dir:[0,0],vProxy:null},this._moveDataSym={center:[0,0,0],dir:[0,0],vProxy:null},this._idAlpha=0};j.prototype={startSculpt:function(){var a=this._main,b=a.getPicking();if(this.initMoveData(b,this._moveData),a.getSculpt().getSymmetry()){var c=a.getPickingSymmetry();c.intersectionMouseMesh(),c.setLocalRadius2(b.getLocalRadius2()),c.getMesh()&&this.initMoveData(c,this._moveDataSym)}},initMoveData:function(a,b){this._topoCheck?a.pickVerticesInSphereTopological(a.getLocalRadius2()):a.pickVerticesInSphere(a.getLocalRadius2()),h.copy(b.center,a.getIntersectionPoint());var c=a.getPickedVertices();this._states.pushVertices(c);for(var d=a.getMesh().getVertices(),e=c.length,f=b.vProxy=new Float32Array(3*e),g=0;e>g;++g){var i=3*c[g],j=3*g;f[j]=d[i],f[j+1]=d[i+1],f[j+2]=d[i+2]}},copyVerticesProxy:function(a,b){for(var c=a.getPickedVertices(),d=this.getMesh().getVertices(),e=b.vProxy,f=0,g=c.length;g>f;++f){var h=3*c[f],i=3*f;d[h]=e[i],d[h+1]=e[i+1],d[h+2]=e[i+2]}},sculptStroke:function(){var a=this._main,b=a.getPicking(),c=a.getPickingSymmetry(),d=a.getSculpt().getSymmetry()&&c.getMesh();b.updateAlpha(this._lockPosition),b.setIdAlpha(this._idAlpha),d&&(c.updateAlpha(!1),c.setIdAlpha(this._idAlpha)),this.copyVerticesProxy(b,this._moveData),d&&this.copyVerticesProxy(c,this._moveDataSym);var e=a._mouseX,f=a._mouseY;this.updateMoveDir(b,e,f),this.move(b.getPickedVertices(),b.getIntersectionPoint(),b.getLocalRadius2(),this._moveData,b),d&&(this.updateMoveDir(c,e,f,!0),this.move(c.getPickedVertices(),c.getIntersectionPoint(),c.getLocalRadius2(),this._moveDataSym,c));var g=this.getMesh();g.updateGeometry(g.getFacesFromVertices(b.getPickedVertices()),b.getPickedVertices()),d&&g.updateGeometry(g.getFacesFromVertices(c.getPickedVertices()),c.getPickedVertices()),this.updateRender(),a.setCanvasCursor("default")},move:function(a,b,c,d,e){for(var f=this.getMesh(),g=f.getVertices(),h=f.getMaterials(),i=Math.sqrt(c),j=d.vProxy,k=b[0],l=b[1],m=b[2],n=d.dir,o=n[0],p=n[1],q=n[2],r=0,s=a.length;s>r;++r){var t=3*a[r],u=3*r,v=j[u],w=j[u+1],x=j[u+2],y=v-k,z=w-l,A=x-m,B=Math.sqrt(y*y+z*z+A*A)/i,C=B*B;C=3*C*C-4*C*B+1,C*=h[t+2]*e.getAlpha(v,w,x),g[t]+=o*C,g[t+1]+=p*C,g[t+2]+=q*C}},updateMoveDir:function(a,b,c,d){var e=this.getMesh(),g=a.unproject(b,c,0),j=a.unproject(b,c,.1),k=i.create();i.invert(k,e.getMatrix()),h.transformMat4(g,g,k),h.transformMat4(j,j,k);var l=d?this._moveDataSym:this._moveData;if(d){var m=e.getSymmetryOrigin(),n=e.getSymmetryNormal();f.mirrorPoint(g,m,n),f.mirrorPoint(j,m,n)}if(this._negative){var o=h.dist(f.vertexOnLine(l.center,g,j),l.center);h.normalize(l.dir,a.computePickedNormal()),h.scale(l.dir,l.dir,b<this._lastMouseX?-o:o)}else h.sub(l.dir,f.vertexOnLine(l.center,g,j),l.center);h.scale(l.dir,l.dir,this._intensity);var p=a.getEyeDirection();h.sub(p,j,g),h.normalize(p,p)}},e.makeProxy(g,j),c.exports=j}),define("mesh/meshData/DrawArraysData",["require","exports","module"],function(a,b,c){"use strict";var d=function(a){this._mesh=a,this._verticesXYZ=null,this._normalsXYZ=null,this._colorsRGB=null,this._materialsPBR=null,this._texCoordsST=null};d.prototype={getVerticesDrawArrays:function(){return this._verticesXYZ||this.updateDrawArrays(),this._verticesXYZ},getNormalsDrawArrays:function(){return this._normalsXYZ},getColorsDrawArrays:function(){return this._colorsRGB},getMaterialsDrawArrays:function(){return this._materialsPBR},getTexCoordsDrawArrays:function(){return this._texCoordsST},setAlreadyDrawArrays:function(){var a=this._mesh;this._verticesXYZ=a.getVertices(),this._normalsXYZ=a.getNormals(),this._colorsRGB=a.getColors(),this._materialsPBR=a.getMaterials()},reAllocateArrays:function(a){var b=this._mesh,c=10,d=this._verticesXYZ.length/9,e=b.getNbTriangles(),f=e+a*c;(f>d||d>4*f)&&(this._verticesXYZ=b.resizeArray(this._verticesXYZ,9*f),this._normalsXYZ=b.resizeArray(this._normalsXYZ,9*f),this._colorsRGB=b.resizeArray(this._colorsRGB,9*f),this._materialsPBR=b.resizeArray(this._materialsPBR,9*f))},updateDrawArrays:function(a){var b=this._mesh;if(b.isUsingDrawArrays()){var c=b.getVertices(),d=b.getNormals(),e=b.getColors(),f=b.getMaterials(),g=b.getFaces(),h=b.getNbTriangles(),i=b.hasOnlyTriangles()?null:b.getFacesToTriangles(),j=void 0===a,k=this._verticesXYZ,l=this._normalsXYZ,m=this._colorsRGB,n=this._materialsPBR;(!k||k.length<9*h)&&(k=this._verticesXYZ=new Float32Array(9*h),l=this._normalsXYZ=new Float32Array(9*h),m=this._colorsRGB=new Float32Array(9*h),n=this._materialsPBR=new Float32Array(9*h));for(var o=j?b.getNbFaces():a.length,p=0;o>p;++p){var q=j?p:a[p],r=i?i[q]:q,s=9*r;q*=4;var t=3*g[q],u=3*g[q+1],v=3*g[q+2],w=3*g[q+3];k[s]=c[t],k[s+1]=c[t+1],k[s+2]=c[t+2],k[s+3]=c[u],k[s+4]=c[u+1],k[s+5]=c[u+2],k[s+6]=c[v],k[s+7]=c[v+1],k[s+8]=c[v+2],m[s]=e[t],m[s+1]=e[t+1],m[s+2]=e[t+2],m[s+3]=e[u],m[s+4]=e[u+1],m[s+5]=e[u+2],m[s+6]=e[v],m[s+7]=e[v+1],m[s+8]=e[v+2],n[s]=f[t],n[s+1]=f[t+1],n[s+2]=f[t+2],n[s+3]=f[u],n[s+4]=f[u+1],n[s+5]=f[u+2],n[s+6]=f[v],n[s+7]=f[v+1],n[s+8]=f[v+2],l[s]=d[t],l[s+1]=d[t+1],l[s+2]=d[t+2],l[s+3]=d[u],l[s+4]=d[u+1],l[s+5]=d[u+2],l[s+6]=d[v],l[s+7]=d[v+1],l[s+8]=d[v+2],0>w||(s+=9,k[s]=c[t],k[s+1]=c[t+1],k[s+2]=c[t+2],k[s+3]=c[v],k[s+4]=c[v+1],k[s+5]=c[v+2],k[s+6]=c[w],k[s+7]=c[w+1],k[s+8]=c[w+2],m[s]=e[t],m[s+1]=e[t+1],m[s+2]=e[t+2],m[s+3]=e[v],m[s+4]=e[v+1],m[s+5]=e[v+2],m[s+6]=e[w],m[s+7]=e[w+1],m[s+8]=e[w+2],n[s]=f[t],n[s+1]=f[t+1],n[s+2]=f[t+2],n[s+3]=f[v],n[s+4]=f[v+1],n[s+5]=f[v+2],n[s+6]=f[w],n[s+7]=f[w+1],n[s+8]=f[w+2],l[s]=d[t],l[s+1]=d[t+1],l[s+2]=d[t+2],l[s+3]=d[v],l[s+4]=d[v+1],l[s+5]=d[v+2],l[s+6]=d[w],l[s+7]=d[w+1],l[s+8]=d[w+2])}b.isUsingTexCoords()&&this.updateDrawArraysTexCoord(a)}},updateDrawArraysTexCoord:function(a){var b=this._mesh,c=b.getNbTriangles(),d=b.getFacesToTriangles(),e=void 0===a,f=this._texCoordsST;f&&f.length===6*c||(f=this._texCoordsST=new Float32Array(6*c));for(var g=b.getTexCoords(),h=b.getFacesTexCoord(),i=e?b.getNbFaces():a.length,j=0;i>j;++j){var k=e?j:a[j],l=d[k],m=6*l;k*=4;var n=2*h[k],o=2*h[k+1],p=2*h[k+2],q=2*h[k+3];f[m]=g[n],f[m+1]=g[n+1],f[m+2]=g[o],f[m+3]=g[o+1],f[m+4]=g[p],f[m+5]=g[p+1],0>q||(m+=6,f[m]=g[n],f[m+1]=g[n+1],f[m+2]=g[p],f[m+3]=g[p+1],f[m+4]=g[q],f[m+5]=g[q+1])}}},c.exports=d}),define("mesh/meshData/EdgeData",["require","exports","module"],function(a,b,c){"use strict";var d=function(a){this._mesh=a,this._edges=null};d.prototype={getEdges:function(){return this._edges},getNbEdges:function(){return this._edges.length},initEdges:function(){for(var a=this._mesh,b=a.getFaces(),c=a.getFaceEdges(),d=0,e=new Uint32Array(a.getNbVertices()),f=a.getVerticesRingFaceStartCount(),g=a.getVerticesRingFace(),h=0,i=a.getNbVertices();i>h;++h)for(var j=f[2*h],k=j+f[2*h+1],l=d,m=j;k>m;++m){var n=4*g[m],o=b[n],p=b[n+1],q=b[n+2],r=b[n+3],s=0,t=0;0>r?(h>o&&(s=e[o],t=n+(h===p?0:2),l>=s?(c[t]=d,e[o]=++d):c[t]=s-1),h>p&&(s=e[p],t=n+(h===o?0:1),l>=s?(c[t]=d,e[p]=++d):c[t]=s-1),h>q&&(s=e[q],t=n+(h===o?2:1),l>=s?(c[t]=d,e[q]=++d):c[t]=s-1),c[n+3]=-1):(h>o&&h!==q&&(s=e[o],t=n+(h===p?0:3),l>=s?(c[t]=d,e[o]=++d):c[t]=s-1),h>p&&h!==r&&(s=e[p],t=n+(h===o?0:1),l>=s?(c[t]=d,e[p]=++d):c[t]=s-1),h>q&&h!==o&&(s=e[q],t=n+(h===p?1:2),l>=s?(c[t]=d,e[q]=++d):c[t]=s-1),h>r&&h!==p&&(s=e[r],t=n+(h===o?3:2),l>=s?(c[t]=d,e[r]=++d):c[t]=s-1))}for(var u=this._edges=new Uint8Array(d),v=0,w=c.length;w>v;++v)u[c[v]]++}},c.exports=d}),define("mesh/meshData/FaceData",["require","exports","module","misc/Utils"],function(a,b,c){"use strict";var d=a("misc/Utils"),e=function(a){this._mesh=a,this._facesABCD=null,this._faceEdges=null,this._faceNormalsXYZ=null,this._faceBoxes=null,this._faceCentersXYZ=null,this._facesToTriangles=null,this._UVtrianglesABC=null,this._trianglesABC=null,this._facesTagFlags=null};e.prototype={setFaces:function(a){this._facesABCD=a},getFaces:function(){return this._facesABCD},hasOnlyTriangles:function(){return this._mesh.getNbTriangles()===this._mesh.getNbFaces()},hasOnlyQuads:function(){return this._mesh.getNbTriangles()===2*this._mesh.getNbFaces()},getNbQuads:function(){return this._mesh.getNbTriangles()-this._mesh.getNbFaces()},getFaceNormals:function(){return this._faceNormalsXYZ},getFaceBoxes:function(){return this._faceBoxes},getFaceCenters:function(){return this._faceCentersXYZ},getFacesTagFlags:function(){return this._facesTagFlags},getFaceEdges:function(){return this._faceEdges},getFacesToTriangles:function(){return this._facesToTriangles},getNbFaces:function(){return this._facesABCD?this._facesABCD.length/4:0},getTrianglesTexCoord:function(){return this._UVtrianglesABC},getTriangles:function(){return this._trianglesABC},getNbTriangles:function(){return this._trianglesABC.length/3},allocateArrays:function(){var a=this._mesh.getNbFaces();this._faceEdges=new Int32Array(4*a),this._facesToTriangles=new Uint32Array(a),this._faceBoxes=new Float32Array(6*a),this._faceNormalsXYZ=new Float32Array(3*a),this._faceCentersXYZ=new Float32Array(3*a),this._facesTagFlags=new Int32Array(a)},reAllocateArrays:function(a){var b=this._mesh,c=this._facesABCD.length/4,d=b.getNbTriangles(),e=d+a;(e>c||c>4*e)&&(this._facesABCD=b.resizeArray(this._facesABCD,4*e),this._trianglesABC=b.resizeArray(this._trianglesABC,3*e),this._faceBoxes=b.resizeArray(this._faceBoxes,6*e),this._faceNormalsXYZ=b.resizeArray(this._faceNormalsXYZ,3*e),this._faceCentersXYZ=b.resizeArray(this._faceCentersXYZ,3*e),this._facesTagFlags=b.resizeArray(this._facesTagFlags,e))},updateFacesAabbAndNormal:function(a){for(var b=this._mesh,c=this.getFaceNormals(),d=this.getFaceBoxes(),e=this.getFaceCenters(),f=b.getVertices(),g=this.getFaces(),h=void 0===a,i=h?b.getNbFaces():a.length,j=0;i>j;++j){var k=h?j:a[j],l=3*k,m=4*k,n=6*k,o=3*g[m],p=3*g[m+1],q=3*g[m+2],r=3*g[m+3],s=f[o],t=f[o+1],u=f[o+2],v=f[p],w=f[p+1],x=f[p+2],y=f[q],z=f[q+1],A=f[q+2],B=v-s,C=w-t,D=x-u,E=y-s,F=z-t,G=A-u,H=C*G-D*F,I=D*E-B*G,J=B*F-C*E,K=v>s?y>s?s:y:y>v?v:y,L=s>v?s>y?s:y:v>y?v:y,M=w>t?z>t?t:z:z>w?w:z,N=t>w?t>z?t:z:w>z?w:z,O=x>u?A>u?u:A:A>x?x:A,P=u>x?u>A?u:A:x>A?x:A;if(r>=0){var Q=f[r],R=f[r+1],S=f[r+2];K>Q&&(K=Q),Q>L&&(L=Q),M>R&&(M=R),R>N&&(N=R),O>S&&(O=S),S>P&&(P=S),B=y-Q,C=z-R,D=A-S,H+=C*G-D*F,I+=D*E-B*G,J+=B*F-C*E}c[l]=H,c[l+1]=I,c[l+2]=J,d[n]=K,d[n+1]=M,d[n+2]=O,d[n+3]=L,d[n+4]=N,d[n+5]=P,e[l]=.5*(K+L),e[l+1]=.5*(M+N),e[l+2]=.5*(O+P)}},expandsFaces:function(a,b){var c=this._mesh,e=++d.TAG_FLAG,f=a.length,g=c.getVerticesRingFaceStartCount(),h=c.getVerticesRingFace(),i=h instanceof Array?h:null,j=this.getFacesTagFlags(),k=this.getFaces(),l=f,m=new Uint32Array(d.getMemory(4*c.getNbFaces()),0,c.getNbFaces());m.set(a);var n=0;for(n=0;f>n;++n)j[m[n]]=e;for(var o=0;b;){for(--b,n=o;f>n;++n)for(var p=4*m[n],q=0;4>q;++q){var r=k[p+q];if(0>r)break;var s,t;i?(h=i[r],s=0,t=h.length):(s=g[2*r],t=s+g[2*r+1]);for(var u=s;t>u;++u){var v=h[u];j[v]!==e&&(j[v]=e,m[l++]=v)}}o=f,f=l}return new Uint32Array(m.subarray(0,l))},getFacesFromVertices:function(a){for(var b=this._mesh,c=++d.TAG_FLAG,e=a.length,f=b.getVerticesRingFaceStartCount(),g=b.getVerticesRingFace(),h=g instanceof Array?g:null,i=this.getFacesTagFlags(),j=0,k=new Uint32Array(d.getMemory(4*b.getNbFaces()),0,b.getNbFaces()),l=0;e>l;++l){var m,n,o=a[l];h?(g=h[o],m=0,n=g.length):(m=f[2*o],n=m+f[2*o+1]);for(var p=m;n>p;++p){var q=g[p];i[q]!==c&&(i[q]=c,k[j++]=q)}}return new Uint32Array(k.subarray(0,j))},initRenderTriangles:function(){var a=this._mesh;a.hasUV()&&(this._UVtrianglesABC=this.computeTrianglesFromFaces(a.getFacesTexCoord())),this._trianglesABC=this.computeTrianglesFromFaces(a.getFaces())},computeTrianglesFromFaces:function(a){for(var b=this._mesh.getNbFaces(),c=this.getFacesToTriangles(),e=new Uint32Array(d.getMemory(4*b*6),0,6*b),f=0,g=0;b>g;++g){c[g]=f;var h=4*g,i=a[h],j=a[h+1],k=a[h+2],l=a[h+3],m=3*f;e[m]=i,e[m+1]=j,e[m+2]=k,++f,l>=0&&(m=3*f,e[m]=i,e[m+1]=k,e[m+2]=l,++f)}return new Uint32Array(e.subarray(0,3*f))}},c.exports=e}),define("mesh/meshData/TexCoordsData",["require","exports","module","misc/Utils"],function(a,b,c){"use strict";var d=a("misc/Utils"),e=function(a){this._mesh=a,this._texCoordsST=null,this._duplicateStartCount=null,this._UVfacesABCD=null,this._UVverticesXYZ=null,this._UVcolorsRGB=null,this._UVmaterialsPBR=null,this._UVnormalsXYZ=null};e.prototype={hasUV:function(){return null!==this._texCoordsST},setTexCoords:function(a){this._texCoordsST=a},setVerticesDuplicateStartCount:function(a){this._duplicateStartCount=a},setFacesTexCoord:function(a){this._UVfacesABCD=a},getVerticesTexCoord:function(){return this._UVverticesXYZ},getColorsTexCoord:function(){return this._UVcolorsRGB},getMaterialsTexCoord:function(){return this._UVmaterialsPBR},getNormalsTexCoord:function(){return this._UVnormalsXYZ},getTexCoords:function(){return this._texCoordsST},getVerticesDuplicateStartCount:function(){return this._duplicateStartCount},getFacesTexCoord:function(){return this._UVfacesABCD},getNbTexCoords:function(){return this._texCoordsST?this._texCoordsST.length/2:0},allocateArrays:function(){if(this.hasUV()){var a=this._mesh,b=this._texCoordsST.length/2,c=a.getNbVertices(),d=this._UVverticesXYZ=new Float32Array(3*b);d.set(a.getVertices()),a.setVertices(d.subarray(0,3*c));var e=this._UVnormalsXYZ=new Float32Array(3*b);e.set(a.getNormals()),a.setNormals(e.subarray(0,3*c));var f=this._UVcolorsRGB=new Float32Array(3*b);f.set(a.getColors()),a.setColors(f.subarray(0,3*c));var g=this._UVmaterialsPBR=new Float32Array(3*b);g.set(a.getMaterials()),a.setMaterials(g.subarray(0,3*c))}},updateDuplicateGeometry:function(a){var b=this._mesh;if(b.isUsingTexCoords()&&this.hasUV())for(var c=this.getVerticesTexCoord(),d=this.getColorsTexCoord(),e=this.getMaterialsTexCoord(),f=this.getNormalsTexCoord(),g=this.getVerticesDuplicateStartCount(),h=void 0===a,i=h?b.getNbVertices():a.length,j=0;i>j;++j){var k=h?j:a[j],l=g[2*k];if(0!==l)for(var m=l+g[2*k+1],n=3*k,o=c[n],p=c[n+1],q=c[n+2],r=f[n],s=f[n+1],t=f[n+2],u=d[n],v=d[n+1],w=d[n+2],x=e[n],y=e[n+1],z=e[n+2],A=l;m>A;++A){var B=3*A;c[B]=o,c[B+1]=p,c[B+2]=q,f[B]=r,f[B+1]=s,f[B+2]=t,d[B]=u,d[B+1]=v,d[B+2]=w,e[B]=x,e[B+1]=y,e[B+2]=z}}},updateDuplicateColorsAndMaterials:function(a){var b=this._mesh;if(b.isUsingTexCoords()&&this.hasUV())for(var c=this.getColorsTexCoord(),d=this.getMaterialsTexCoord(),e=this.getVerticesDuplicateStartCount(),f=void 0===a,g=f?b.getNbVertices():a.length,h=0;g>h;++h){var i=f?h:a[h],j=e[2*i];if(0!==j)for(var k=j+e[2*i+1],l=3*i,m=c[l],n=c[l+1],o=c[l+2],p=d[l],q=d[l+1],r=d[l+2],s=j;k>s;++s){var t=3*s;c[t]=m,c[t+1]=n,c[t+2]=o,d[t]=p,d[t+1]=q,d[t+2]=r}}},initTexCoordsDataFromOBJData:function(a,b){var c=this._mesh,e=c.getFaces(),f=c.getNbVertices(),g=0,h=0,i=0,j=0,k=new Int32Array(f),l=new Float32Array(d.getMemory(4*f*2),0,2*f),m=[],n=0,o=0,p=e.length;for(g=0;p>g;++g)if(i=e[g],!(0>i)){var q=b[g];if(j=k[i],j!==q+1)if(0!==j)if(j>0)k[i]=--n,m.push([q]),++o;else{var r=m[-j-1],s=r.length;for(h=0;s>h&&r[h]!==q;++h);h===s&&(++o,r.push(q))}else k[i]=q+1,l[2*i]=a[2*q],l[2*i+1]=a[2*q+1]}var t=new Float32Array(2*(f+o));t.set(l);var u=this._duplicateStartCount=new Uint32Array(2*f);for(n=0,g=0;f>g;++g)if(j=k[g],!(j>=0)){var v=m[-j-1],w=v.length,x=f+n;for(u[2*g]=x,u[2*g+1]=w,n+=w,h=0;w>h;++h){var y=2*v[h],z=2*(x+h);t[z]=a[y],t[z+1]=a[y+1]}}var A=new Int32Array(e);for(p=e.length,g=0;p>g;++g)if(i=A[g],!(0>i||(j=k[i],j>0))){var B=b[g],C=m[-j-1],D=C.length;for(h=0;D>h;++h)if(B===C[h]){A[g]=u[2*i]+h;break}}this.setTexCoords(t),this.setFacesTexCoord(A)}},c.exports=e}),define("mesh/meshData/TransformData",["require","exports","module","lib/glMatrix","misc/Utils"],function(a,b,c){"use strict";var d=a("lib/glMatrix"),e=a("misc/Utils"),f=d.vec3,g=d.mat3,h=d.mat4,i=function(a){this._mesh=a,this._center=f.create(),this._matrix=h.create(),this._editMatrix=h.create(),this._symmetryNormal=[1,0,0],this._cacheMV=h.create(),this._cacheMVP=h.create(),this._cacheN=g.create(),this._cacheEN=g.create(),this._cacheDepth=0,this._worldBound=[1/0,1/0,1/0,-(1/0),-(1/0),-(1/0)]};i.prototype={getCenter:function(){return this._center},getMV:function(){return this._cacheMV},getMVP:function(){return this._cacheMVP},getN:function(){return this._cacheN},getEN:function(){return this._cacheEN},getDepth:function(){return this._cacheDepth},getMatrix:function(){return this._matrix},getEditMatrix:function(){return this._editMatrix},getScale2:function(){var a=this._matrix;return a[0]*a[0]+a[4]*a[4]+a[8]*a[8]},getScale:function(){return Math.sqrt(this.getScale2())},getSymmetryOrigin:function(){return this._center},getSymmetryNormal:function(){return this._symmetryNormal},updateCenter:function(){var a=this._mesh.getLocalBound();f.set(this._center,.5*(a[0]+a[3]),.5*(a[1]+a[4]),.5*(a[2]+a[5]))},updateMatrices:function(a){g.normalFromMat4(this._cacheEN,this._editMatrix),h.mul(this._cacheMV,a.getView(),this._matrix),g.normalFromMat4(this._cacheN,this._cacheMV),h.mul(this._cacheMVP,a.getProjection(),this._cacheMV);var b=this._center,c=this._cacheMVP;this._cacheDepth=c[2]*b[0]+c[6]*b[1]+c[10]*b[2]+c[14]},normalizeSize:function(){var a=this._mesh.getLocalBound(),b=f.dist([a[0],a[1],a[2]],[a[3],a[4],a[5]]),c=e.SCALE/b;h.scale(this._matrix,this._matrix,[c,c,c])},translate:function(a){h.translate(this._matrix,this._matrix,a)},moveTo:function(){var a=[0,0,0];return function(b){h.translate(this._matrix,this._matrix,f.sub(a,b,this._center))}}(),getWorldBound:function(){var a=this._worldBound,b=this._mesh.getLocalBound(),c=this._mesh.getMatrix();a[0]=a[3]=c[12],a[1]=a[4]=c[13],a[2]=a[5]=c[14];for(var d=0;3>d;++d)for(var e=4*d,f=b[d],g=b[d+3],h=0;3>h;++h){var i=c[e+h],j=i*g,k=i*f;k>j?(a[h]+=j,a[h+3]+=k):(a[h]+=k,a[h+3]+=j)}return a}},c.exports=i}),define("mesh/meshData/VertexData",["require","exports","module","misc/Utils"],function(a,b,c){"use strict";var d=a("misc/Utils"),e=function(a){this._mesh=a,this._verticesXYZ=null,this._colorsRGB=null,this._materialsPBR=null,this._normalsXYZ=null,this._vertOnEdge=null,this._vrfStartCount=null,this._vertRingFace=null,this._vrvStartCount=null,this._vertRingVert=null,this._vertTagFlags=null,this._vertSculptFlags=null,this._vertStateFlags=null,this._vertProxy=null};e.prototype={setVertices:function(a){this._verticesXYZ=a},setNormals:function(a){this._normalsXYZ=a},setColors:function(a){this._colorsRGB=a},setMaterials:function(a){this._materialsPBR=a},getVertices:function(){return this._verticesXYZ},getColors:function(){return this._colorsRGB},getNormals:function(){return this._normalsXYZ},getMaterials:function(){return this._materialsPBR},getVerticesTagFlags:function(){return this._vertTagFlags},getVerticesSculptFlags:function(){return this._vertSculptFlags},getVerticesStateFlags:function(){return this._vertStateFlags},getVerticesRingVertStartCount:function(){return this._vrvStartCount},getVerticesRingVert:function(){return this._vertRingVert},getVerticesRingFaceStartCount:function(){return this._vrfStartCount},getVerticesRingFace:function(){return this._vertRingFace},getVerticesOnEdge:function(){return this._vertOnEdge},getVerticesProxy:function(){return this._vertProxy},getNbVertices:function(){return this._verticesXYZ.length/3},allocateArrays:function(){var a=this._mesh.getNbVertices();this._normalsXYZ=new Float32Array(3*a),this._colorsRGB=this._colorsRGB?this._colorsRGB:new Float32Array(3*a),this._materialsPBR=this._materialsPBR?this._materialsPBR:new Float32Array(3*a),this._vertOnEdge=new Uint8Array(a),this._vrvStartCount=new Uint32Array(2*a),this._vrfStartCount=new Uint32Array(2*a),this._vertTagFlags=new Int32Array(a),this._vertSculptFlags=new Int32Array(a),this._vertStateFlags=new Int32Array(a),this._vertProxy=new Float32Array(3*a)},reAllocateArrays:function(a){var b=this._mesh,c=this._verticesXYZ.length/3,d=b.getNbVertices(),e=d+a;(e>c||c>4*e)&&(this._verticesXYZ=b.resizeArray(this._verticesXYZ,3*e),this._normalsXYZ=b.resizeArray(this._normalsXYZ,3*e),this._colorsRGB=b.resizeArray(this._colorsRGB,3*e),this._materialsPBR=b.resizeArray(this._materialsPBR,3*e),this._vertOnEdge=b.resizeArray(this._vertOnEdge,e),this._vertTagFlags=b.resizeArray(this._vertTagFlags,e),this._vertSculptFlags=b.resizeArray(this._vertSculptFlags,e),this._vertStateFlags=b.resizeArray(this._vertStateFlags,e))},initColorsAndMaterials:function(){var a=this._mesh.getNbVertices(),b=0,c=3*a;if(!this._colorsRGB||this._colorsRGB.length!==c){var d=this._colorsRGB=new Float32Array(c);for(b=0;c>b;++b)d[b]=1}if(!this._materialsPBR||this._materialsPBR.length!==c){var e=this._materialsPBR=new Float32Array(c);for(b=0;c>b;++b){var f=3*b;e[f]=.18,e[f+1]=.08,e[f+2]=1}}},initFaceRings:function(){var a=this._mesh,b=a.getFaces(),c=a.getNbVertices(),e=a.getNbFaces(),f=0,g=0,h=new Uint32Array(a.getNbVertices());for(f=0;e>f;++f){g=4*f,h[b[g]]++,h[b[g+1]]++,h[b[g+2]]++;var i=b[g+3];i>=0&&h[i]++}var j=this.getVerticesRingFaceStartCount(),k=0;for(f=0;c>f;++f){var l=h[f];j[2*f]=k,j[2*f+1]=l,k+=l}var m=new Uint32Array(d.getMemory(4*e*6),0,6*e);for(k=0,f=0;e>f;++f){g=4*f;var n=b[g],o=b[g+1],p=b[g+2],q=b[g+3];m[j[2*n]+--h[n]]=f,m[j[2*o]+--h[o]]=f,m[j[2*p]+--h[p]]=f,q>=0&&(m[j[2*q]+--h[q]]=f,++k)}this._vertRingFace=new Uint32Array(m.subarray(0,3*e+k))},updateVerticesNormal:function(a){for(var b=this._mesh,c=this.getVerticesRingFaceStartCount(),d=this.getVerticesRingFace(),e=d instanceof Array?d:null,f=this.getNormals(),g=b.getFaceNormals(),h=void 0===a,i=h?b.getNbVertices():a.length,j=0;i>j;++j){var k,l,m=h?j:a[j];e?(d=e[m],k=0,l=d.length):(k=c[2*m],l=k+c[2*m+1]);for(var n=0,o=0,p=0,q=k;l>q;++q){var r=3*d[q];n+=g[r],o+=g[r+1],p+=g[r+2]}var s=1/(l-k);m*=3,f[m]=n*s,f[m+1]=o*s,f[m+2]=p*s}},initVertexRings:function(){for(var a=this._mesh,b=this.getVerticesRingVertStartCount(),c=this._vertRingVert=new Uint32Array(2*a.getNbEdges()),e=this.getVerticesRingFaceStartCount(),f=this.getVerticesRingFace(),g=this.getVerticesTagFlags(),h=this.getVerticesOnEdge(),i=a.getFaces(),j=0,k=0,l=a.getNbVertices();l>k;++k){for(var m=++d.TAG_FLAG,n=e[2*k],o=n+e[2*k+1],p=0,q=n;o>q;++q){var r=4*f[q],s=i[r],t=i[r+1],u=i[r+2],v=i[r+3];s===k?s=v>=0?v:u:t===k||v===k?t=u:u===k&&v>=0&&(s=v),g[s]!==m&&(c[j+p++]=s,g[s]=m),g[t]!==m&&(c[j+p++]=t,g[t]=m)}b[2*k]=j,b[2*k+1]=p,j+=p,o-n!==p&&(h[k]=1)}},expandsVertices:function(a,b){var c=++d.TAG_FLAG,e=a.length,f=this.getVerticesRingVertStartCount(),g=this.getVerticesRingVert(),h=g instanceof Array?g:null,i=this.getVerticesTagFlags(),j=e,k=this._mesh.getNbVertices(),l=new Uint32Array(d.getMemory(4*k),0,k);l.set(a);var m=0;for(m=0;e>m;++m)i[l[m]]=c;for(var n=0;b;){for(--b,m=n;e>m;++m){var o,p,q=l[m];h?(g=h[q],o=0,p=g.length):(o=f[2*q],p=o+f[2*q+1]);for(var r=o;p>r;++r){var s=g[r];i[s]!==c&&(i[s]=c,l[j++]=s)}}n=e,e=j}return new Uint32Array(l.subarray(0,j))},getVerticesFromFaces:function(a){for(var b=this._mesh,c=++d.TAG_FLAG,e=a.length,f=this.getVerticesTagFlags(),g=b.getFaces(),h=0,i=new Uint32Array(d.getMemory(4*a.length*4),0,4*a.length),j=0;e>j;++j){var k=4*a[j],l=g[k],m=g[k+1],n=g[k+2],o=g[k+3];f[l]!==c&&(f[l]=c,i[h++]=l),f[m]!==c&&(f[m]=c,i[h++]=m),f[n]!==c&&(f[n]=c,i[h++]=n),o>=0&&f[o]!==c&&(f[o]=c,i[h++]=o)}return new Uint32Array(i.subarray(0,h))}},c.exports=e}),define("mesh/meshData/WireframeData",["require","exports","module"],function(a,b,c){"use strict";var d=function(a){this._mesh=a,this._drawArraysWireframe=null,this._drawElementsWireframe=null};d.prototype={getWireframe:function(){var a,b=this._mesh,c=b.getNbEdges(),d=this._mesh.isUsingDrawArrays();if(d){if(this._drawArraysWireframe&&this._drawArraysWireframe.length===2*c)return this._drawArraysWireframe;a=this._drawArraysWireframe=new Uint32Array(2*c)}else{if(this._drawElementsWireframe&&this._drawElementsWireframe.length===2*c)return this._drawElementsWireframe;a=this._drawElementsWireframe=new Uint32Array(2*c)}for(var e=b.getFaces(),f=b.getFaceEdges(),g=b.getNbFaces(),h=b.getFacesToTriangles(),i=0,j=new Int32Array(c),k=0;g>k;++k){var l,m,n,o=4*k,p=e[o+3];if(d){var q=3*h[k];l=q,m=q+1,n=q+2,p>=0&&(p=q+5)}else l=e[o],m=e[o+1],n=e[o+2];var r=f[o],s=f[o+1],t=f[o+2],u=f[o+3];0===j[r]&&(j[r]=1,a[2*i]=l,a[2*i+1]=m,i++),0===j[s]&&(j[s]=1,a[2*i]=m,a[2*i+1]=n,i++),0===j[t]&&(j[t]=1,a[2*i]=n,a[2*i+1]=0>p?l:p,i++),p>=0&&0===j[u]&&(j[u]=1,a[2*i]=p,a[2*i+1]=l,i++)}return d?this._drawArraysWireframe:this._drawElementsWireframe}},c.exports=d}),define("mesh/meshData/MeshData",["require","exports","module","misc/Utils","mesh/meshData/DrawArraysData","mesh/meshData/EdgeData","mesh/meshData/FaceData","mesh/meshData/TexCoordsData","mesh/meshData/TransformData","mesh/meshData/VertexData","mesh/meshData/WireframeData"],function(a,b,c){"use strict";var d=a("misc/Utils"),e=a("mesh/meshData/DrawArraysData"),f=a("mesh/meshData/EdgeData"),g=a("mesh/meshData/FaceData"),h=a("mesh/meshData/TexCoordsData"),i=a("mesh/meshData/TransformData"),j=a("mesh/meshData/VertexData"),k=a("mesh/meshData/WireframeData"),l=function(a){this._mesh=a,this._drawArraysData=new e(a),this._edgeData=new f(a),this._faceData=new g(a),this._texCoordsData=new h(a),this._vertexData=new j(a),this._wireframeData=new k(a),this._transformData=new i(a)};l.prototype={getDrawArraysData:function(){return this._drawArraysData},getEdgeData:function(){return this._edgeData},getFaceData:function(){return this._faceData},getTexCoordsData:function(){return this._texCoordsData},getTransformData:function(){return this._transformData},getVertexData:function(){return this._vertexData},getWireframeData:function(){return this._wireframeData},setDrawArraysData:function(a){this._drawArraysData=a},setEdgeData:function(a){this._edgeData=a},setFaceData:function(a){this._faceData=a},setTexCoordsData:function(a){this._texCoordsData=a},setTransformData:function(a){this._transformData=a},setVertexData:function(a){this._vertexData=a},setWireframeData:function(a){this._wireframeData=a}},d.makeProxy(e,l,function(a){return function(){return a.apply(this.getDrawArraysData(),arguments)}}),d.makeProxy(f,l,function(a){return function(){return a.apply(this.getEdgeData(),arguments)}}),d.makeProxy(g,l,function(a){return function(){return a.apply(this.getFaceData(),arguments)}}),d.makeProxy(h,l,function(a){return function(){return a.apply(this.getTexCoordsData(),arguments)}}),d.makeProxy(i,l,function(a){return function(){return a.apply(this.getTransformData(),arguments)}}),d.makeProxy(j,l,function(a){return function(){return a.apply(this.getVertexData(),arguments)}}),d.makeProxy(k,l,function(a){return function(){return a.apply(this.getWireframeData(),arguments)}}),c.exports=l}),define("math3d/OctreeCell",["require","exports","module"],function(a,b,c){"use strict";var d=function(a){this._parent=a?a:null,this._depth=a?a._depth+1:0,this._children=[],this._aabbLoose=[1/0,1/0,1/0,-(1/0),-(1/0),-(1/0)],this._aabbSplit=[1/0,1/0,1/0,-(1/0),-(1/0),-(1/0)],this._iFaces=[]};d.MAX_DEPTH=8,d.MAX_FACES=100,function(){for(var a=d.MAX_DEPTH*d.MAX_DEPTH+d.MAX_DEPTH,b=d.STACK=new Array(a),c=0;a>c;++c)b[c]=null}(),d.prototype={build:function(a,b){var c=this._aabbLoose,e=this._aabbSplit,f=0;for(f=0;6>f;++f)c[f]=e[f];this._iFaces=b;var g=d.STACK;g[0]=this;for(var h=1,i=[];h>0;){var j=g[--h],k=j._iFaces.length;if(k>d.MAX_FACES&&j._depth<d.MAX_DEPTH){j.constructChildren(a);var l=j._children;for(f=0;8>f;++f)g[h+f]=l[f];h+=8}else k>0&&i.push(j)}var m=i.length;for(f=0;m>f;++f)i[f].constructLeaf(a)},constructLeaf:function(a){for(var b=this._iFaces,c=b.length,d=1/0,e=1/0,f=1/0,g=-(1/0),h=-(1/0),i=-(1/0),j=a.getFaceBoxes(),k=a.getFacePosInLeaf(),l=a.getFaceLeaf(),m=0;c>m;++m){var n=b[m];l[n]=this,k[n]=m,n*=6;var o=j[n],p=j[n+1],q=j[n+2],r=j[n+3],s=j[n+4],t=j[n+5];d>o&&(d=o),r>g&&(g=r),e>p&&(e=p),s>h&&(h=s),f>q&&(f=q),t>i&&(i=t)}this.expandsAabbLoose(d,e,f,g,h,i)},constructChildren:function(a){for(var b=this._aabbSplit,c=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=.5*(g-c),k=.5*(h-e),l=.5*(i-f),m=.5*(g+c),n=.5*(h+e),o=.5*(i+f),p=new d(this),q=new d(this),r=new d(this),s=new d(this),t=new d(this),u=new d(this),v=new d(this),w=new d(this),x=p._iFaces,y=q._iFaces,z=r._iFaces,A=s._iFaces,B=t._iFaces,C=u._iFaces,D=v._iFaces,E=w._iFaces,F=a.getFaceCenters(),G=this._iFaces,H=G.length,I=0;H>I;++I){var J=G[I],K=3*J,L=F[K],M=F[K+1],N=F[K+2];L>m?M>n?N>o?D.push(J):C.push(J):N>o?z.push(J):y.push(J):M>n?N>o?E.push(J):B.push(J):N>o?A.push(J):x.push(J)}p.setAabbSplit(c,e,f,m,n,o),q.setAabbSplit(c+j,e,f,m+j,n,o),r.setAabbSplit(m,n-k,o,g,h-k,i),s.setAabbSplit(c,e,f+l,m,n,o+l),t.setAabbSplit(c,e+k,f,m,n+k,o),u.setAabbSplit(m,n,o-l,g,h,i-l),v.setAabbSplit(m,n,o,g,h,i),w.setAabbSplit(m-j,n,o,g-j,h,i),this._children.length=0,this._children.push(p,q,r,s,t,u,v,w),G.length=0;
},setAabbSplit:function(a,b,c,d,e,f){var g=this._aabbSplit;g[0]=a,g[1]=b,g[2]=c,g[3]=d,g[4]=e,g[5]=f},collectIntersectRay:function(a,b,c){var e=a[0],f=a[1],g=a[2],h=1/b[0],i=1/b[1],j=1/b[2],k=0,l=d.STACK;l[0]=this;for(var m=1;m>0;){var n=l[--m],o=n._aabbLoose,p=(o[0]-e)*h,q=(o[3]-e)*h,r=(o[1]-f)*i,s=(o[4]-f)*i,t=(o[2]-g)*j,u=(o[5]-g)*j,v=Math.max(Math.min(p,q),Math.min(r,s),Math.min(t,u)),w=Math.min(Math.max(p,q),Math.max(r,s),Math.max(t,u));if(!(0>w||v>w)){var x=n._children;if(8===x.length){for(var y=0;8>y;++y)l[m+y]=x[y];m+=8}else{var z=n._iFaces;c.set(z,k),k+=z.length}}}return new Uint32Array(c.subarray(0,k))},collectIntersectSphere:function(a,b,c,e){var f=a[0],g=a[1],h=a[2],i=0,j=d.STACK;j[0]=this;for(var k=1;k>0;){var l=j[--k],m=l._aabbLoose,n=0,o=0,p=0;if(n=m[0]>f?m[0]-f:m[3]<f?m[3]-f:0,o=m[1]>g?m[1]-g:m[4]<g?m[4]-g:0,p=m[2]>h?m[2]-h:m[5]<h?m[5]-h:0,!(n*n+o*o+p*p>b)){var q=l._children;if(8===q.length){for(var r=0;8>r;++r)j[k+r]=q[r];k+=8}else{c.push(l);var s=l._iFaces;e.set(s,i),i+=s.length}}}return new Uint32Array(e.subarray(0,i))},addFace:function(a,b,c,e,f,g,h,i,j,k){var l=d.STACK;l[0]=this;for(var m=1;m>0;){var n=l[--m],o=n._aabbSplit;if(!(i<=o[0]||j<=o[1]||k<=o[2]||i>o[3]||j>o[4]||k>o[5])){var p=n._aabbLoose;b<p[0]&&(p[0]=b),c<p[1]&&(p[1]=c),e<p[2]&&(p[2]=e),f>p[3]&&(p[3]=f),g>p[4]&&(p[4]=g),h>p[5]&&(p[5]=h);var q=n._children;if(8!==q.length)return n._iFaces.push(a),n;for(var r=0;8>r;++r)l[m+r]=q[r];m+=8}}},checkEmptiness:function(){var a=d.STACK;a[0]=this;for(var b=1;b>0;){var c=a[--b],e=c._parent;if(e){var f=e._children;if(0!==f.length){for(var g=!0,h=0;8>h;++h){var i=f[h];if(i._iFaces.length>0||8===i._children.length){g=!1;break}}g===!0&&(f.length=0,c[b++]=e)}}}},expandsAabbLoose:function(a,b,c,d,e,f){for(var g=this;g;){var h=g._aabbLoose,i=!1;a<h[0]&&(h[0]=a,i=!0),b<h[1]&&(h[1]=b,i=!0),c<h[2]&&(h[2]=c,i=!0),d>h[3]&&(h[3]=d,i=!0),e>h[4]&&(h[4]=e,i=!0),f>h[5]&&(h[5]=f,i=!0),g=i?g._parent:null}}},c.exports=d}),define("math3d/Octree",["require","exports","module","misc/Utils","math3d/OctreeCell"],function(a,b,c){"use strict";var d=a("misc/Utils"),e=a("math3d/OctreeCell"),f=function(a){this._mesh=a,this._root=null,this._facePosInLeaf=null,this._faceLeaf=[],this._leavesUpdate=[]};f.prototype={getFacePosInLeaf:function(){return this._facePosInLeaf},getFaceLeaf:function(){return this._faceLeaf},getLeavesUpdate:function(){return this._leavesUpdate},getLocalBound:function(){return this._root._aabbSplit},allocateArrays:function(){var a=this._mesh.getNbFaces();this._facePosInLeaf=new Uint32Array(a);var b=this._faceLeaf;b.length=a;for(var c=0;a>c;++c)b[c]=null},reAllocateArrays:function(a){var b=this._mesh,c=this._facePosInLeaf.length,d=b.getNbTriangles(),e=d+a;(e>c||c>4*e)&&(this._facePosInLeaf=b.resizeArray(this._facePosInLeaf,e))},intersectRay:function(a,b,c){var e=new Uint32Array(d.getMemory(4*c),0,c);return this._root.collectIntersectRay(a,b,e)},intersectSphere:function(a,b,c,e){var f=new Uint32Array(d.getMemory(4*e),0,e);return this._root.collectIntersectSphere(a,b,c,f)},updateOctree:function(a){a?this.updateOctreeAdd(this.updateOctreeRemove(a)):this.computeOctree(.3)},computeAabb:function(){for(var a=this._mesh,b=a.getNbVertices(),c=a.getVertices(),d=1/0,e=1/0,f=1/0,g=-(1/0),h=-(1/0),i=-(1/0),j=0;b>j;++j){var k=3*j,l=c[k],m=c[k+1],n=c[k+2];d>l&&(d=l),l>g&&(g=l),e>m&&(e=m),m>h&&(h=m),f>n&&(f=n),n>i&&(i=n)}return[d,e,f,g,h,i]},computeOctree:function(a){var b=this._mesh,c=this.computeAabb(),d=c[0],f=c[1],g=c[2],h=c[3],i=c[4],j=c[5],k=h-d,l=i-f,m=j-g;if(a){var n=k*a,o=l*a,p=m*a;d-=n,h+=n,f-=o,i+=o,g-=p,j+=p}var q=.2*Math.sqrt(k*k+l*l+m*m);d===h&&(d-=q,h+=q),f===i&&(f-=q,i+=q),g===j&&(g-=q,j+=q);var r=b.getNbFaces(),s=[];s.length=r;for(var t=0;r>t;++t)s[t]=t;this._root=new e,this._root.setAabbSplit(d,f,g,h,i,j),this._root.build(b,s)},updateOctreeRemove:function(a){for(var b=this._mesh,c=b.getFaceCenters(),e=b.getFaceBoxes(),f=this._facePosInLeaf,g=this._faceLeaf,h=a.length,i=0,j=new Uint32Array(d.getMemory(4*h),0,h),k=0;h>k;++k){var l=a[k],m=6*l,n=3*l,o=g[l],p=o._aabbSplit,q=c[n],r=c[n+1],s=c[n+2];if(q<=p[0]||r<=p[1]||s<=p[2]||q>p[3]||r>p[4]||s>p[5]){j[i++]=a[k];var t=o._iFaces;if(t.length>0){var u=t[t.length-1],v=f[l];t[v]=u,f[u]=v,t.pop()}}else o.expandsAabbLoose(e[m],e[m+1],e[m+2],e[m+3],e[m+4],e[m+5])}return new Uint32Array(j.subarray(0,i))},updateOctreeAdd:function(a){for(var b=this._mesh,c=b.getFaceCenters(),d=b.getFaceBoxes(),e=this._facePosInLeaf,f=this._faceLeaf,g=a.length,h=this._root,i=h._aabbLoose,j=i[0],k=i[1],l=i[2],m=i[3],n=i[4],o=i[5],p=0;g>p;++p){var q=a[p],r=6*q,s=d[r],t=d[r+1],u=d[r+2],v=d[r+3],w=d[r+4],x=d[r+5];if(s>m||j>v||t>n||k>w||u>o||l>x){this.computeOctree(.3),this._leavesUpdate.length=0;break}var y=3*q,z=f[q],A=h.addFace(q,s,t,u,v,w,x,c[y],c[y+1],c[y+2]);if(A)e[q]=A._iFaces.length-1,f[q]=A;else{var B=z._iFaces;e[q]=B.length,B.push(a[p])}}},checkLeavesUpdate:function(){d.tidy(this._leavesUpdate);for(var a=this._leavesUpdate,b=a.length,c=[],f=e.MAX_FACES,g=e.MAX_DEPTH,h=0;b>h;++h){var i=a[h];if(!i)break;i._iFaces.length?i._iFaces.length>f&&i._depth<g&&i.build(this._mesh,i._iFaces):i.checkEmptiness(c)}this._leavesUpdate.length=0}},c.exports=f}),define("render/Attribute",["require","exports","module"],function(a,b,c){"use strict";var d=function(a,b,c,d,e){this._gl=a,this._location=a.getAttribLocation(b,c),this._size=d,this._type=e};d.prototype={bindToBuffer:function(a){var b=this._gl;a.bind(),b.enableVertexAttribArray(this._location),b.vertexAttribPointer(this._location,this._size,this._type,!1,0,0)}},c.exports=d}),define("text",["module"],function(a){"use strict";var b,c,d,e,f,g=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],h=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,i=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,j="undefined"!=typeof location&&location.href,k=j&&location.protocol&&location.protocol.replace(/\:/,""),l=j&&location.hostname,m=j&&(location.port||void 0),n={},o=a.config&&a.config()||{};return b={version:"2.0.14",strip:function(a){if(a){a=a.replace(h,"");var b=a.match(i);b&&(a=b[1])}else a="";return a},jsEscape:function(a){return a.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:o.createXhr||function(){var a,b,c;if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;if("undefined"!=typeof ActiveXObject)for(b=0;3>b;b+=1){c=g[b];try{a=new ActiveXObject(c)}catch(d){}if(a){g=[c];break}}return a},parseName:function(a){var b,c,d,e=!1,f=a.lastIndexOf("."),g=0===a.indexOf("./")||0===a.indexOf("../");return-1!==f&&(!g||f>1)?(b=a.substring(0,f),c=a.substring(f+1)):b=a,d=c||b,f=d.indexOf("!"),-1!==f&&(e="strip"===d.substring(f+1),d=d.substring(0,f),c?c=d:b=d),{moduleName:b,ext:c,strip:e}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(a,c,d,e){var f,g,h,i=b.xdRegExp.exec(a);return i?(f=i[2],g=i[3],g=g.split(":"),h=g[1],g=g[0],!(f&&f!==c||g&&g.toLowerCase()!==d.toLowerCase()||(h||g)&&h!==e)):!0},finishLoad:function(a,c,d,e){d=c?b.strip(d):d,o.isBuild&&(n[a]=d),e(d)},load:function(a,c,d,e){if(e&&e.isBuild&&!e.inlineText)return void d();o.isBuild=e&&e.isBuild;var f=b.parseName(a),g=f.moduleName+(f.ext?"."+f.ext:""),h=c.toUrl(g),i=o.useXhr||b.useXhr;return 0===h.indexOf("empty:")?void d():void(!j||i(h,k,l,m)?b.get(h,function(c){b.finishLoad(a,f.strip,c,d)},function(a){d.error&&d.error(a)}):c([g],function(a){b.finishLoad(f.moduleName+"."+f.ext,f.strip,a,d)}))},write:function(a,c,d,e){if(n.hasOwnProperty(c)){var f=b.jsEscape(n[c]);d.asModule(a+"!"+c,"define(function () { return '"+f+"';});\n")}},writeFile:function(a,c,d,e,f){var g=b.parseName(c),h=g.ext?"."+g.ext:"",i=g.moduleName+h,j=d.toUrl(g.moduleName+h)+".js";b.load(i,d,function(c){var d=function(a){return e(j,a)};d.asModule=function(a,b){return e.asModule(a,j,b)},b.write(a,i,d,f)},f)}},"node"===o.env||!o.env&&"undefined"!=typeof process&&process.versions&&process.versions.node&&!process.versions["node-webkit"]&&!process.versions["atom-shell"]?(c=require.nodeRequire("fs"),b.get=function(a,b,d){try{var e=c.readFileSync(a,"utf8");"\ufeff"===e[0]&&(e=e.substring(1)),b(e)}catch(f){d&&d(f)}}):"xhr"===o.env||!o.env&&b.createXhr()?b.get=function(a,c,d,e){var f,g=b.createXhr();if(g.open("GET",a,!0),e)for(f in e)e.hasOwnProperty(f)&&g.setRequestHeader(f.toLowerCase(),e[f]);o.onXhr&&o.onXhr(g,a),g.onreadystatechange=function(b){var e,f;4===g.readyState&&(e=g.status||0,e>399&&600>e?(f=new Error(a+" HTTP status: "+e),f.xhr=g,d&&d(f)):c(g.responseText),o.onXhrComplete&&o.onXhrComplete(g,a))},g.send(null)}:"rhino"===o.env||!o.env&&"undefined"!=typeof Packages&&"undefined"!=typeof java?b.get=function(a,b){var c,d,e="utf-8",f=new java.io.File(a),g=java.lang.System.getProperty("line.separator"),h=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(f),e)),i="";try{for(c=new java.lang.StringBuffer,d=h.readLine(),d&&d.length()&&65279===d.charAt(0)&&(d=d.substring(1)),null!==d&&c.append(d);null!==(d=h.readLine());)c.append(g),c.append(d);i=String(c.toString())}finally{h.close()}b(i)}:("xpconnect"===o.env||!o.env&&"undefined"!=typeof Components&&Components.classes&&Components.interfaces)&&(d=Components.classes,e=Components.interfaces,Components.utils["import"]("resource://gre/modules/FileUtils.jsm"),f="@mozilla.org/windows-registry-key;1"in d,b.get=function(a,b){var c,g,h,i={};f&&(a=a.replace(/\//g,"\\")),h=new FileUtils.File(a);try{c=d["@mozilla.org/network/file-input-stream;1"].createInstance(e.nsIFileInputStream),c.init(h,1,0,!1),g=d["@mozilla.org/intl/converter-input-stream;1"].createInstance(e.nsIConverterInputStream),g.init(c,"utf-8",c.available(),e.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER),g.readString(c.available(),i),g.close(),c.close(),b(i.value)}catch(j){throw new Error((h&&h.path||"")+": "+j)}}),b}),define("text!render/shaders/glsl/colorSpace.glsl",[],function(){return"// reference\n// https://www.khronos.org/registry/gles/extensions/EXT/EXT_sRGB.txt\n\n// approximation\n// http://chilliant.blogspot.fr/2012/08/srgb-approximations-for-hlsl.html\nfloat lineartoSRGB(const in float c) {\n    float S1 = sqrt(c);\n    float S2 = sqrt(S1);\n    float S3 = sqrt(S2);\n    return 0.662002687 * S1 + 0.684122060 * S2 - 0.323583601 * S3 - 0.0225411470 * c;\n}\nvec3 lineartoSRGB(const in vec3 c) {\n    vec3 S1 = sqrt(c);\n    vec3 S2 = sqrt(S1);\n    vec3 S3 = sqrt(S2);\n    return 0.662002687 * S1 + 0.684122060 * S2 - 0.323583601 * S3 - 0.0225411470 * c;\n}\nvec4 lineartoSRGB(const in vec4 c) {\n    vec3 S1 = sqrt(c.rgb);\n    vec3 S2 = sqrt(S1);\n    vec3 S3 = sqrt(S2);\n    return vec4(0.662002687 * S1 + 0.684122060 * S2 - 0.323583601 * S3 - 0.0225411470 * c.rgb, c.a);\n}\n\nfloat sRGBToLinear(const in float c) {\n    return c * (c * (c * 0.305306011 + 0.682171111) + 0.012522878);\n}\nvec3 sRGBToLinear(const in vec3 c) {\n    return c * (c * (c * 0.305306011 + 0.682171111) + 0.012522878);\n}\nvec4 sRGBToLinear(const in vec4 c) {\n    return vec4(c.rgb * (c.rgb * (c.rgb * 0.305306011 + 0.682171111) + 0.012522878), c.a);\n}\n\n#define RANGE 1.0\n// http://graphicrants.blogspot.fr/2009/04/rgbm-color-encoding.html\nvec4 encodeRGBM(const in vec3 col) {\n    vec4 rgbm;\n    vec3 color = col / RANGE;\n    rgbm.a = clamp( max( max( color.r, color.g ), max( color.b, 1e-6 ) ), 0.0, 1.0 );\n    rgbm.a = ceil( rgbm.a * 255.0 ) / 255.0;\n    rgbm.rgb = color / rgbm.a;\n    return rgbm;\n}\n\nvec3 decodeRGBM(const in vec4 col) {\n  return RANGE * col.rgb * col.a;\n}"}),define("text!render/shaders/glsl/curvature.glsl",[],function(){return"// http://madebyevan.com/shaders/curvature/\n#extension GL_OES_standard_derivatives : enable\nvec3 computeCurvature( const in vec3 vertex, const in vec3 normal, const in vec3 color, const in float str, const in float fov) {\n  if(str < 1e-3)\n    return color;\n  #ifndef GL_OES_standard_derivatives\n    return color * pow(length(normal), str * 100.0);\n  #endif\n  vec3 n = normalize(normal);\n  // Compute curvature\n  vec3 dx = dFdx(n);\n  vec3 dy = dFdy(n);\n  vec3 xneg = n - dx;\n  vec3 xpos = n + dx;\n  vec3 yneg = n - dy;\n  vec3 ypos = n + dy;\n  // fov < 0.0 means ortho\n  float depth = fov > 0.0 ? length(vertex) * fov : -fov;\n  float cur = (cross(xneg, xpos).y - cross(yneg, ypos).x) * str * 80.0 / depth;\n  return mix(mix(color, color * 0.3, clamp(-cur * 15.0, 0.0, 1.0)), color * 2.0, clamp(cur * 25.0, 0.0, 1.0));\n}\n"}),define("render/shaders/ShaderBase",["require","exports","module","lib/glMatrix","misc/getOptionsURL","misc/Utils","render/Attribute","text!render/shaders/glsl/colorSpace.glsl","text!render/shaders/glsl/curvature.glsl"],function(a,b,c){"use strict";var d=a("lib/glMatrix"),e=a("misc/getOptionsURL"),f=a("misc/Utils"),g=a("render/Attribute"),h=a("text!render/shaders/glsl/colorSpace.glsl"),i=a("text!render/shaders/glsl/curvature.glsl"),j=d.vec3,k={};k.vertexName="VertexName",k.fragmentName="FragmentName",k.activeAttributes={vertex:!0,normal:!0,material:!0,color:!0},k.showSymmetryLine=e().mirrorline,k.darkenUnselected=e().darkenunselected,k.uniformNames={},k.uniformNames.commonUniforms=["uMV","uMVP","uN","uEM","uEN","uFlat","uPlaneO","uPlaneN","uSym","uCurvature","uAlpha","uFov","uDarken"],k.strings={},k.strings.colorSpaceGLSL=h,k.strings.vertUniforms=["uniform mat4 uMV;","uniform mat4 uMVP;","uniform mat3 uN;","uniform mat4 uEM;","uniform mat3 uEN;","uniform float uAlpha;"].join("\n"),k.strings.fragColorUniforms=["uniform vec3 uPlaneN;","uniform vec3 uPlaneO;","uniform int uSym;","uniform int uDarken;","uniform float uCurvature;","uniform float uFov;","varying float vMasking;","uniform int uFlat;"].join("\n"),k.strings.fragColorFunction=[i,h,"#extension GL_OES_standard_derivatives : enable","vec3 getNormal() {","  #ifndef GL_OES_standard_derivatives","    return normalize(gl_FrontFacing ? vNormal : -vNormal);","  #else","    return uFlat == 0 ? normalize(gl_FrontFacing ? vNormal : -vNormal) : -normalize(cross(dFdy(vVertex), dFdx(vVertex)));","  #endif","}","vec4 encodeFragColor(const in vec3 frag, const in float alpha) {","  vec3 col = computeCurvature(vVertex, vNormal, frag, uCurvature, uFov);","  if(uDarken == 1) col *= 0.3;","  col *= (0.3 + 0.7 * vMasking);","  if(uSym == 1 && abs(dot(uPlaneN, vVertex - uPlaneO)) < 0.15)","      col = min(col * 1.5, 1.0);","  return alpha != 1.0 ? vec4(col * alpha, alpha) : encodeRGBM(col);","}"].join("\n");var l=function(a){var b=a.match(/^\s*(#extension).*/gm);if(!b)return a;for(var c={},d="",e=0,f=b.length;f>e;++e){var g=b[e].substr(b[e].indexOf("#extension"));a=a.replace(b[e],""),c[g]||(c[g]=!0,d+=g+"\n")}return a=d+a};k.getOrCreate=function(a){if(this.program)return this;var b="\n#define SHADER_NAME "+this.vertexName+"\n",c="\n#define SHADER_NAME "+this.fragmentName+"\n",d=a.createShader(a.VERTEX_SHADER);a.shaderSource(d,l(this.vertex+b)),a.compileShader(d);var e=a.createShader(a.FRAGMENT_SHADER);a.shaderSource(e,l(this.fragment+c)),a.compileShader(e);var f=this.program=a.createProgram();a.attachShader(f,d),a.attachShader(f,e),a.linkProgram(f),a.useProgram(f);var g=a.getShaderInfoLog(d),h=a.getShaderInfoLog(e),i=a.getProgramInfoLog(f);return g&&console.warn(this.vertexName+" (vertex)\n"+g),h&&console.warn(this.fragmentName+" (fragment)\n"+h),i&&console.warn(this.fragmentName+" (program)\n"+i),this.initAttributes(a),this.initUniforms(a),this},k.initUniforms=function(a){for(var b=this.program,c=this.uniformNames,d=this.uniforms,e=0,f=c.length;f>e;++e){var g=c[e];d[g]=a.getUniformLocation(b,g)}},k.updateUniforms=function(){var a=[0,0,0];return function(b,c){var d=b.getGL(),e=b.getMesh(),f=c.getSelectedMeshes(),g=k.darkenUnselected&&0!==f.length&&-1===f.indexOf(e),h=k.showSymmetryLine&&e===c.getMesh()&&c.getSculpt().getSymmetry(),i=this.uniforms;d.uniformMatrix4fv(i.uEM,!1,e.getEditMatrix()),d.uniformMatrix3fv(i.uEN,!1,e.getEN()),d.uniformMatrix4fv(i.uMV,!1,e.getMV()),d.uniformMatrix4fv(i.uMVP,!1,e.getMVP()),d.uniformMatrix3fv(i.uN,!1,e.getN()),d.uniform1i(i.uDarken,g?1:0),d.uniform1i(i.uFlat,e.getFlatShading()),d.uniform3fv(i.uPlaneO,j.transformMat4(a,e.getSymmetryOrigin(),e.getMV())),d.uniform3fv(i.uPlaneN,j.normalize(a,j.transformMat3(a,e.getSymmetryNormal(),e.getN()))),d.uniform1i(i.uSym,h?1:0),d.uniform1f(i.uAlpha,e.getOpacity()),d.uniform1f(i.uCurvature,e.getCurvature());var l=c.getCamera();d.uniform1f(i.uFov,l.isOrthographic()?25*-Math.abs(l._trans[2]):l.getFov())}}(),k.draw=function(a,b){var c=a.getGL();c.useProgram(this.program),this.bindAttributes(a),this.updateUniforms(a,b),this.drawBuffer(a)},k.drawBuffer=function(a){var b=a.getGL();a.isUsingDrawArrays()?b.drawArrays(a.getMode(),0,a.getCount()):(a.getIndexBuffer().bind(),b.drawElements(a.getMode(),a.getCount(),b.UNSIGNED_INT,0)),b.bindBuffer(b.ARRAY_BUFFER,null),b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,null)},k.setTextureParameters=function(a,b){a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),f.isPowerOfTwo(b.width)&&f.isPowerOfTwo(b.height)?(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR_MIPMAP_LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.REPEAT),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.REPEAT),a.generateMipmap(a.TEXTURE_2D)):(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE))},k.onLoadTexture0=function(a,b,c){this.texture0=a.createTexture(),a.bindTexture(a.TEXTURE_2D,this.texture0),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,b),k.setTextureParameters(a,b),a.bindTexture(a.TEXTURE_2D,null),c&&c.render()},k.getOrCreateTexture0=function(a,b,c){if(void 0!==this.texture0)return this.texture0;this.texture0=null;var d=new Image;return d.src=b,d.onload=this.onLoadTexture0.bind(this,a,d,c),!1},k.initAttributes=function(a){var b=this.program,c=this.attributes;c.aVertex=new g(a,b,"aVertex",3,a.FLOAT),c.aNormal=new g(a,b,"aNormal",3,a.FLOAT),c.aColor=new g(a,b,"aColor",3,a.FLOAT),c.aMaterial=new g(a,b,"aMaterial",3,a.FLOAT)},k.bindAttributes=function(a){var b=this.attributes,c=this.activeAttributes;c.vertex&&b.aVertex.bindToBuffer(a.getVertexBuffer()),c.normal&&b.aNormal.bindToBuffer(a.getNormalBuffer()),c.color&&b.aColor.bindToBuffer(a.getColorBuffer()),c.material&&b.aMaterial.bindToBuffer(a.getMaterialBuffer())},k.getCopy=function(){for(var a=Object.keys(k),b={},c=0,d=a.length;d>c;++c)b[a[c]]=this[a[c]];return b.program=null,b},c.exports=k}),define("render/shaders/ShaderBackground",["require","exports","module","render/shaders/ShaderBase","render/Attribute"],function(a,b,c){"use strict";var d=a("render/shaders/ShaderBase"),e=a("render/Attribute"),f=d.getCopy();f.vertexName=f.fragmentName="Background",f.uniforms={},f.attributes={},f.uniformNames=["uTexture0"],f.vertex=["attribute vec2 aVertex;","attribute vec2 aTexCoord;","varying vec2 vTexCoord;","void main() {","  vTexCoord = aTexCoord;","  gl_Position = vec4(aVertex, 1.0, 1.0);","}"].join("\n"),f.fragment=["precision mediump float;","uniform sampler2D uTexture0;","varying vec2 vTexCoord;",d.strings.colorSpaceGLSL,"void main() {","  gl_FragColor = encodeRGBM(sRGBToLinear(texture2D(uTexture0, vTexCoord)).rgb);","}"].join("\n"),f.draw=function(a){var b=a.getGL();b.useProgram(this.program),this.bindAttributes(a),this.updateUniforms(a),b.drawArrays(b.TRIANGLE_STRIP,0,4)},f.initAttributes=function(a){var b=f.program,c=f.attributes;c.aVertex=new e(a,b,"aVertex",2,a.FLOAT),c.aTexCoord=new e(a,b,"aTexCoord",2,a.FLOAT)},f.bindAttributes=function(a){var b=f.attributes;b.aVertex.bindToBuffer(a.getVertexBuffer()),b.aTexCoord.bindToBuffer(a.getTexCoordBuffer())},f.updateUniforms=function(a){var b=a.getGL();b.activeTexture(b.TEXTURE0),b.bindTexture(b.TEXTURE_2D,a.getTexture()),b.uniform1i(this.uniforms.uTexture0,0)},c.exports=f}),define("render/shaders/ShaderContour",["require","exports","module","misc/getOptionsURL","render/shaders/ShaderBase","render/Attribute"],function(a,b,c){"use strict";var d=a("misc/getOptionsURL"),e=a("render/shaders/ShaderBase"),f=a("render/Attribute"),g=e.getCopy();g.vertexName=g.fragmentName="SobelContour",g.color=d().outlinecolor,g.uniforms={},g.attributes={},g.uniformNames=["uTexture0","uColor"],g.vertex=["attribute vec2 aVertex;","varying vec2 vTexCoord;","void main() {","  vTexCoord = aVertex * 0.5 + 0.5;","  gl_Position = vec4(aVertex, 0.0, 1.0);","}"].join("\n"),g.fragment=["#extension GL_OES_standard_derivatives : enable","precision mediump float;","uniform sampler2D uTexture0;","uniform vec4 uColor;","varying vec2 vTexCoord;","void main() {","  float fac0 = 2.0;","  float fac1 = 1.0;","  float ox = dFdx(vTexCoord).x;","  float oy = dFdy(vTexCoord).y;","  vec4 texel0 = texture2D(uTexture0, vTexCoord + vec2(ox, oy));","  vec4 texel1 = texture2D(uTexture0, vTexCoord + vec2(ox, 0.0));","  vec4 texel2 = texture2D(uTexture0, vTexCoord + vec2(ox, -oy));","  vec4 texel3 = texture2D(uTexture0, vTexCoord + vec2(0.0, -oy));","  vec4 texel4 = texture2D(uTexture0, vTexCoord + vec2(-ox, -oy));","  vec4 texel5 = texture2D(uTexture0, vTexCoord + vec2(-ox, 0.0));","  vec4 texel6 = texture2D(uTexture0, vTexCoord + vec2(-ox, oy));","  vec4 texel7 = texture2D(uTexture0, vTexCoord + vec2(0.0, oy));","  vec4 rowx = -fac0*texel5 + fac0*texel1 + -fac1*texel6 + fac1*texel0 + -fac1*texel4 + fac1*texel2;","  vec4 rowy = -fac0*texel3 + fac0*texel7 + -fac1*texel4 + fac1*texel6 + -fac1*texel2 + fac1*texel0;","  float mag = dot(rowy, rowy) + dot(rowx, rowx);","  if (mag < 1.5) discard;","  gl_FragColor = vec4(uColor.rgb * uColor.a, uColor.a);","}"].join("\n"),g.draw=function(a){var b=a.getGL();b.useProgram(this.program),g.attributes.aVertex.bindToBuffer(a.getVertexBuffer()),b.activeTexture(b.TEXTURE0),b.bindTexture(b.TEXTURE_2D,a.getTexture()),b.uniform1i(this.uniforms.uTexture0,0),b.uniform4fv(this.uniforms.uColor,g.color),b.drawArrays(b.TRIANGLES,0,3)},g.initAttributes=function(a){g.attributes.aVertex=new f(a,g.program,"aVertex",2,a.FLOAT)},c.exports=g}),define("render/shaders/ShaderSelection",["require","exports","module","render/shaders/ShaderBase"],function(a,b,c){"use strict";var d=a("render/shaders/ShaderBase"),e=d.getCopy();e.vertexName=e.fragmentName="ShowSelection",e.uniforms={},e.attributes={},e.activeAttributes={vertex:!0},e.uniformNames=["uMVP","uColor"],e.vertex=["attribute vec3 aVertex;","uniform mat4 uMVP;","void main() {","  gl_Position = uMVP * vec4(aVertex, 1.0);","}"].join("\n"),e.fragment=["precision mediump float;","uniform vec3 uColor;","void main() {","  gl_FragColor = vec4(uColor, 1.0);","}"].join("\n"),e.draw=function(a,b,c){var d=a.getGL();d.useProgram(this.program),d.uniform3fv(this.uniforms.uColor,a.getColor()),b&&(d.uniformMatrix4fv(this.uniforms.uMVP,!1,a.getCircleMVP()),e.attributes.aVertex.bindToBuffer(a.getCircleBuffer()),d.drawArrays(d.LINE_LOOP,0,a.getCircleBuffer()._size/3)),d.uniformMatrix4fv(this.uniforms.uMVP,!1,a.getDotMVP()),e.attributes.aVertex.bindToBuffer(a.getDotBuffer()),d.drawArrays(d.TRIANGLE_FAN,0,a.getDotBuffer()._size/3),c&&(d.uniformMatrix4fv(this.uniforms.uMVP,!1,a.getDotSymmetryMVP()),d.drawArrays(d.TRIANGLE_FAN,0,a.getDotBuffer()._size/3))},c.exports=e}),define("render/shaders/ShaderFlat",["require","exports","module","render/shaders/ShaderBase"],function(a,b,c){"use strict";var d=a("render/shaders/ShaderBase"),e=d.getCopy();e.vertexName=e.fragmentName="FlatColor",e.uniforms={},e.attributes={},e.activeAttributes={vertex:!0,material:!0},e.uniformNames=["uColor"],Array.prototype.push.apply(e.uniformNames,d.uniformNames.commonUniforms),e.vertex=["precision mediump float;","attribute vec3 aVertex;","attribute vec3 aMaterial;",d.strings.vertUniforms,"varying vec3 vVertex;","void main() {","  vec4 vertex4 = vec4(aVertex, 1.0);","  gl_Position = uMVP * mix(vertex4, uEM * vertex4, aMaterial.z);","}"].join("\n"),e.fragment=["precision mediump float;","uniform vec3 uColor;","void main() {","  gl_FragColor = vec4(uColor, 1.0);","}"].join("\n"),e.updateUniforms=function(a,b){a.getGL().uniform3fv(this.uniforms.uColor,a.getFlatColor()),d.updateUniforms.call(this,a,b)},c.exports=e}),define("text!render/shaders/glsl/fxaa.glsl",[],function(){return"// https://github.com/mattdesl/glsl-fxaa\n#define FXAA_REDUCE_MIN (1.0/ 128.0)\n#define FXAA_REDUCE_MUL (1.0 / 8.0)\n#define FXAA_SPAN_MAX 8.0\n\nvec3 fxaa(const in sampler2D tex, const in vec2 uvNW, const in vec2 uvNE, const in vec2 uvSW, const in vec2 uvSE, const in vec2 uvM, const in vec2 invRes) {\n    const vec3 luma = vec3(0.299, 0.587, 0.114);\n    float lumaNW = dot(texture2D(tex, uvNW).xyz, luma);\n    float lumaNE = dot(texture2D(tex, uvNE).xyz, luma);\n    float lumaSW = dot(texture2D(tex, uvSW).xyz, luma);\n    float lumaSE = dot(texture2D(tex, uvSE).xyz, luma);\n    float lumaM  = dot(texture2D(tex, uvM).xyz,  luma);\n    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\n    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\n\n    vec2 dir = vec2(-((lumaNW + lumaNE) - (lumaSW + lumaSE)), ((lumaNW + lumaSW) - (lumaNE + lumaSE)));\n    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) * (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);\n    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);\n    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX), max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX), dir * rcpDirMin)) * invRes;\n    \n    vec3 rgbA = 0.5 * ( texture2D(tex, uvM + dir * (1.0 / 3.0 - 0.5)).xyz + texture2D(tex, uvM + dir * (2.0 / 3.0 - 0.5)).xyz);\n    vec3 rgbB = rgbA * 0.5 + 0.25 * ( texture2D(tex, uvM - dir * 0.5).xyz + texture2D(tex, uvM + dir * 0.5).xyz);\n    \n    float lumaB = dot(rgbB, luma);\n    if((lumaB < lumaMin) || (lumaB > lumaMax))\n      return rgbA;\n    return rgbB;\n}"}),define("render/shaders/ShaderFxaa",["require","exports","module","render/shaders/ShaderBase","render/Attribute","misc/getOptionsURL","text!render/shaders/glsl/fxaa.glsl"],function(a,b,c){"use strict";var d=a("render/shaders/ShaderBase"),e=a("render/Attribute"),f=a("misc/getOptionsURL"),g=a("text!render/shaders/glsl/fxaa.glsl"),h=d.getCopy();h.vertexName=h.fragmentName="Fxaa",h.FILMIC=f().filmic,h.uniforms={},h.attributes={},h.uniformNames=["uTexture0","uInvSize"],h.vertex=["precision mediump float;","attribute vec2 aVertex;","uniform vec2 uInvSize;","varying vec2 vUVNW;","varying vec2 vUVNE;","varying vec2 vUVSW;","varying vec2 vUVSE;","varying vec2 vUVM;","void main() {","  vUVM = aVertex * 0.5 + 0.5;","  vUVNW = vUVM + vec2(-1.0, -1.0) * uInvSize;","  vUVNE = vUVM + vec2(1.0, -1.0) * uInvSize;","  vUVSW = vUVM + vec2(-1.0, 1.0) * uInvSize;","  vUVSE = vUVM + vec2(1.0, 1.0) * uInvSize;","  gl_Position = vec4(aVertex, 0.5, 1.0);","}"].join("\n"),h.fragment=["precision mediump float;","uniform sampler2D uTexture0;","uniform vec2 uInvSize;","varying vec2 vUVNW;","varying vec2 vUVNE;","varying vec2 vUVSW;","varying vec2 vUVSE;","varying vec2 vUVM;",g,d.strings.colorSpaceGLSL,"void main() {","  gl_FragColor = vec4(fxaa(uTexture0, vUVNW, vUVNE, vUVSW, vUVSE, vUVM, uInvSize), 1.0);","}"].join("\n"),h.draw=function(a,b){var c=a.getGL();c.useProgram(this.program),h.attributes.aVertex.bindToBuffer(a.getVertexBuffer()),c.activeTexture(c.TEXTURE0),c.bindTexture(c.TEXTURE_2D,b._rttMerge.getTexture()),c.uniform1i(this.uniforms.uTexture0,0),c.uniform2fv(this.uniforms.uInvSize,a.getInverseSize()),c.drawArrays(c.TRIANGLES,0,3)},h.initAttributes=function(a){h.attributes.aVertex=new e(a,h.program,"aVertex",2,a.FLOAT)},c.exports=h}),define("gui/tr/english",["require","exports","module"],function(a,b,c){"use strict";var d={backgroundTitle:"Background",backgroundReset:"Reset",backgroundImport:"Import (jpg, png...)",backgroundFill:"Fill",cameraTitle:"Camera",cameraReset:"View",cameraCenter:"Reset (bar)",cameraFront:"Front (F)",cameraLeft:"Left (L)",cameraTop:"Top (T)",cameraMode:"Mode",cameraOrbit:"Orbit (Turntable)",cameraSpherical:"Spherical (Trackball)",cameraPlane:"Plane (Trackball)",cameraProjection:"Projection",cameraPerspective:"Perspective",cameraOrthographic:"Orthographic",cameraFov:"Fov",cameraPivot:"Picking pivot",fileTitle:"Files (import/export)",fileImportTitle:"Import",fileAdd:"Add (obj, sgl, ply, stl)",fileAutoMatrix:"Scale and center",fileVertexSRGB:"sRGB vertex color",fileExportMeshTitle:"Export Mesh",fileExportSceneTitle:"Export Scene",fileExportSGL:"Save .sgl (SculptGL)",fileExportOBJ:"Save .obj",fileExportPLY:"Save .ply",fileExportSTL:"Save .stl",sceneTitle:"Scene",sceneReset:"Clear scene",sceneAddSphere:"Add sphere",sceneAddCube:"Add cube",sceneAddCylinder:"Add cylinder",sceneAddTorus:"Add torus",sceneSelection:"Selection",sceneMerge:"Merge selection",meshTitle:"Mesh",meshNbVertices:"Vertex : ",meshNbFaces:"Faces : ",topologyTitle:"Topology",multiresTitle:"Multiresolution",multiresSubdivide:"Subdivide",multiresReverse:"Reverse",multiresResolution:"Resolution",multiresNoLower:"There is no lower resolution level.",multiresNoHigher:"There is no higher resolution level.",multiresDelHigher:"Delete higher",multiresDelLower:"Delete lower",multiresSelectLowest:"Select the lowest resolution before reversing.",multiresSelectHighest:"Select the highest resolution before subdividing.",multiresWarnBigMesh:function(a){return"The next subdivision level will reach "+a+' faces.\nIf you know what you are doing, click again on "subdivide".'},multiresNotReversible:"Sorry it is not possile to reverse this mesh.\nThe mesh is not a product of a (loop-catmull) subdivision surface on a manifold mesh.",remeshTitle:"Voxel Remeshing",remeshRemesh:"Remesh",remeshResolution:"Resolution",remeshBlock:"Block",dynamicTitle:"Dynamic Topology",dynamicActivated:"Activated (no quads)",dynamicSubdivision:"Subdivision",dynamicDecimation:"Decimation",dynamicLinear:"Linear subdivision",sculptTitle:"Sculpting & Painting",sculptBrush:"Brush",sculptInflate:"Inflate",sculptTwist:"Twist",sculptSmooth:"Smooth (-Shift)",sculptFlatten:"Flatten",sculptPinch:"Pinch",sculptCrease:"Crease",sculptDrag:"Drag",sculptPaint:"Paint",sculptMasking:"Masking (-Ctrl)",sculptMove:"Move",sculptLocalScale:"Local scale",sculptTransform:"Transform (E)",sculptCommon:"Common",sculptTool:"Tool",sculptSymmetry:"Symmetry",sculptContinuous:"Continuous",sculptRadius:"Radius (-X)",sculptIntensity:"Intensity (-C)",sculptHardness:"Hardness",sculptCulling:"Thin surface (front vertex only)",sculptAlphaTitle:"Alpha",sculptLockPositon:"Lock position",sculptAlphaTex:"Texture",sculptImportAlpha:"Import alpha tex (jpg, png...)",sculptNegative:"Negative (N or -Alt)",sculptColor:"Albedo",sculptRoughness:"Roughness",sculptMetallic:"Metallic",sculptClay:"Clay",sculptAccumulate:"Accumulate (no limit per stroke)",sculptColorGlobal:"Global",sculptPickColor:"Material / Color picker (-S)",sculptTangentialSmoothing:"Relax only",sculptTopologicalCheck:"Topological check",sculptMoveAlongNormal:"Move along normal (N or -Alt)",sculptMaskingClear:"Clear (-Ctrl + Drag)",sculptMaskingInvert:"Invert (-Ctrl + Click)",sculptMaskingBlur:"Blur",sculptMaskingSharpen:"Sharpen",sculptPBRTitle:"PBR materials",sculptPaintAll:"Paint all",sculptExtractTitle:"Extract",sculptExtractThickness:"Thickness",sculptExtractAction:"Extract !",stateTitle:"History",stateUndo:"Undo",stateRedo:"Redo",stateMaxStack:"Max Stack",wacomTitle:"Wacom tablet",wacomRadius:"Pressure radius",wacomIntensity:"Pressure intensity",renderingTitle:"Rendering",renderingGrid:"Show grid",renderingSymmetryLine:"Show mirror line",renderingMatcap:"Matcap",renderingCurvature:"Curvature",renderingPBR:"PBR",renderingTransparency:"Transparency",renderingNormal:"Normal shader",renderingUV:"UV shader",renderingShader:"Shader",renderingMaterial:"Material",renderingImportUV:"Import (jpg, png...)",renderingImportMatcap:"Import (jpg, png...)",renderingExtra:"Extra",renderingFlat:"Flat shading",renderingWireframe:"Wireframe (W)",renderingExposure:"Exposure",renderingEnvironment:"Environment",renderingIsolate:"Isolate/Show (I)",renderingFilmic:"Filmic tonemapping",
contour:"Contour",contourShow:"Show contour",contourColor:"Color",darkenUnselected:"Darken unselected",resolution:"Resolution",matcapPearl:"Pearl",matcapClay:"Clay",matcapSkin:"Skin",matcapGreen:"Green",matcapWhite:"White",sketchfabTitle:"Go to Sketchfab !",sketchfabUpload:"Upload",sketchfabUploadMessage:'Please enter your sketchfab API Key.\nYou can also leave "guest" to upload anonymously.\n(a new window will pop up when the uploading and processing is finished)',sketchfabUploadError:function(a){return"Sketchfab upload error :\n"+a},sketchfabUploadSuccess:"Upload success !\nHere is your link :",sketchfabAbort:"Abort the last upload ?",sketchfabUploadProcessing:"Processing...\nYour model will be available at :",about:"About & Help",alphaNone:"None",alphaSquare:"Square",alphaSkin:"Skin",envFootPrint:"Foot Print",envGlazedPatio:"Glazed Patio",envNicolausChurch:"St Nicolaus church",envTerrace:"Terrace",envBryantPark:"BryantPark"};c.exports=d}),define("gui/tr/chinese",["require","exports","module"],function(a,b,c){"use strict";var d={backgroundTitle:"背景",backgroundReset:"重設",backgroundImport:"匯入 (jpg, png...)",backgroundFill:"填色",cameraTitle:"鏡頭",cameraReset:"檢視",cameraCenter:"重設 (空白鍵)",cameraFront:"前視角 (F)",cameraLeft:"左視角 (L)",cameraTop:"俯視角 (T)",cameraMode:"模式",cameraOrbit:"軌道 (轉盤)",cameraSpherical:"球面 (軌跡球)",cameraPlane:"平面 (軌跡球)",cameraProjection:"投影",cameraPerspective:"透視角",cameraOrthographic:"等視角",cameraFov:"視野範圍",cameraPivot:"選擇軸心",fileTitle:"檔案 (匯入/匯出)",fileImportTitle:"匯入",fileAdd:"加入 (obj, sgl, ply, stl)",fileAutoMatrix:null,fileVertexSRGB:null,fileExportMeshTitle:"匯出網面",fileExportSceneTitle:"匯出場景",fileExportSGL:"儲存 .sgl (SculptGL)",fileExportOBJ:"儲存 .obj",fileExportPLY:"儲存 .ply",fileExportSTL:"儲存 .stl",sceneTitle:"場景",sceneReset:"清除場景",sceneAddSphere:"加入球體",sceneAddCube:null,sceneAddCylinder:null,sceneAddTorus:null,sceneSelection:null,sceneMerge:null,meshTitle:"網面",meshNbVertices:"頂點 : ",meshNbFaces:"面 : ",topologyTitle:"網面結構",multiresTitle:"多重解析度",multiresSubdivide:"細分",multiresReverse:"反轉",multiresResolution:"解析度",multiresNoLower:"沒有更低等級的解析度。",multiresNoHigher:"沒有更高等級的解析度。",multiresDelHigher:"刪除較高等級",multiresDelLower:"刪除較低等級",multiresSelectLowest:"反轉前請先選擇最低的解析度。",multiresSelectHighest:"細分前請先選擇最高的解析度。",multiresWarnBigMesh:function(a){return"下一個細分等級會達到 "+a+" 個面。\n若你清楚你自己正在做什麼，再點擊「細分」一次。"},multiresNotReversible:"抱歉，無法反轉此網面。\n此網面不是由流形網面經過細分曲面 (loop-catmull) 而來。",remeshTitle:"立體像素網面重構",remeshRemesh:"網面重構",remeshResolution:"解析度",remeshBlock:null,dynamicTitle:"動態網面結構",dynamicActivated:"已啟用 (無四邊形)",dynamicSubdivision:"細分",dynamicDecimation:"削減面數",dynamicLinear:"線性細分",sculptTitle:"雕刻和塗繪",sculptBrush:"筆刷",sculptInflate:"膨脹",sculptTwist:"扭轉",sculptSmooth:"平滑 (-Shift)",sculptFlatten:"抹平",sculptPinch:"夾捏",sculptCrease:"皺褶",sculptDrag:"拖拉",sculptPaint:"塗繪",sculptMasking:null,sculptMove:null,sculptLocalScale:null,sculptTransform:"縮放 移動 旋轉 (E)",sculptCommon:null,sculptTool:"工具",sculptSymmetry:"對稱",sculptContinuous:"連續",sculptRadius:"半徑 (-X)",sculptIntensity:"強度 (-C)",sculptHardness:null,sculptCulling:"薄曲面 (僅前面頂點)",sculptAlphaTitle:null,sculptLockPositon:null,sculptAlphaTex:null,sculptImportAlpha:null,sculptNegative:"反向 (N or -Alt)",sculptColor:"反照率",sculptRoughness:"粗糙度",sculptMetallic:"金屬",sculptClay:"黏土",sculptAccumulate:"累積 (每道筆劃無限制)",sculptColorGlobal:"全域",sculptPickColor:"選擇材質 (-S)",sculptTangentialSmoothing:"僅放鬆",sculptTopologicalCheck:null,sculptMoveAlongNormal:null,sculptMaskingClear:null,sculptMaskingInvert:null,sculptMaskingBlur:null,sculptMaskingSharpen:null,sculptPBRTitle:null,sculptPaintAll:null,sculptExtractTitle:null,sculptExtractThickness:null,sculptExtractAction:null,stateTitle:"記錄",stateUndo:"復原",stateRedo:"取消復原",stateMaxStack:"最大堆疊",wacomTitle:"Wacom 繪圖板",wacomRadius:"感壓半徑",wacomIntensity:"感壓強度",renderingTitle:"繪算",renderingGrid:"顯示格線",renderingSymmetryLine:null,renderingMatcap:null,renderingCurvature:null,renderingPBR:"物理式繪算(PBR)",renderingTransparency:"透明",renderingNormal:"法線著色器",renderingUV:"UV 著色器",renderingShader:"著色器",renderingMaterial:"材質",renderingImportUV:"匯入 (jpg, png...)",renderingImportMatcap:"匯入 (jpg, png...)",renderingExtra:"額外項目",renderingFlat:"平整面 (較慢)",renderingWireframe:"線框 (較慢) (W)",renderingExposure:null,renderingEnvironment:null,renderingIsolate:null,renderingFilmic:null,contour:null,contourShow:null,contourColor:null,darkenUnselected:null,resolution:null,matcapPearl:"珍珠",matcapClay:"黏土",matcapSkin:"膚色",matcapGreen:"綠色",matcapWhite:"白色",sketchfabTitle:"前往 Sketchfab !",sketchfabUpload:"上傳",sketchfabUploadMessage:'請輸入你的 sketchfab API 密鑰。\n你也可以留下 "guest" 進行匿名上傳。\n(當上傳中和完成時會跳出新視窗)',sketchfabUploadError:function(a){return"Sketchfab 上傳錯誤 :\n"+a},sketchfabUploadSuccess:"上傳成功 !\n這是你的連結 :",sketchfabAbort:"中止最近一次的上傳 ?",sketchfabUploadProcessing:null,about:null,alphaNone:null,alphaSquare:null,alphaSkin:null,envFootPrint:null,envGlazedPatio:null,envNicolausChurch:null,envTerrace:null,envBryantPark:null};c.exports=d}),define("gui/tr/japanese",["require","exports","module"],function(a,b,c){"use strict";var d={backgroundTitle:"バックグラウンド",backgroundReset:"リセット",backgroundImport:"インポート  (jpg, png...)",backgroundFill:null,cameraTitle:"カメラ",cameraReset:"View",cameraCenter:null,cameraFront:null,cameraLeft:null,cameraTop:null,cameraMode:"モード",cameraOrbit:null,cameraSpherical:"球体 (Trackball)",cameraPlane:"平面 (Trackball)",cameraProjection:"タイプ",cameraPerspective:"透視投影",cameraOrthographic:"平行投影",cameraFov:"視野",cameraPivot:"ピボット選択",fileTitle:"ファイル (インポート/エクスポート)",fileImportTitle:null,fileAdd:"Add (obj, sgl, ply, stl)",fileAutoMatrix:null,fileVertexSRGB:null,fileExportMeshTitle:null,fileExportSceneTitle:null,fileExportSGL:null,fileExportOBJ:null,fileExportPLY:null,fileExportSTL:null,sceneTitle:null,sceneReset:null,sceneAddSphere:null,sceneAddCube:null,sceneAddCylinder:null,sceneAddTorus:null,sceneSelection:null,sceneMerge:null,meshTitle:"メッシュ",meshNbVertices:null,meshNbFaces:null,topologyTitle:null,multiresTitle:null,multiresSubdivide:null,multiresReverse:null,multiresResolution:null,multiresNoLower:null,multiresNoHigher:null,multiresDelHigher:null,multiresDelLower:null,multiresSelectLowest:null,multiresSelectHighest:null,multiresWarnBigMesh:null,multiresNotReversible:null,remeshTitle:null,remeshRemesh:null,remeshResolution:null,remeshBlock:null,dynamicTitle:null,dynamicActivated:null,dynamicSubdivision:null,dynamicDecimation:null,dynamicLinear:null,sculptTitle:null,sculptBrush:"ブラシ",sculptInflate:"膨張",sculptTwist:"回転",sculptSmooth:"スムーズ化 (-Shift)",sculptFlatten:"フラット化",sculptPinch:"つまむ",sculptCrease:"しわ",sculptDrag:"ドラッグ",sculptPaint:"ペイント",sculptMasking:null,sculptMove:null,sculptLocalScale:null,sculptTransform:null,sculptCommon:null,sculptTool:"ツール",sculptSymmetry:"対称加工",sculptContinuous:"連続加工",sculptRadius:"半径 (-X)",sculptIntensity:"明るさ (-C)",sculptHardness:null,sculptCulling:null,sculptAlphaTitle:null,sculptLockPositon:null,sculptAlphaTex:null,sculptImportAlpha:null,sculptNegative:"ネガティブ (N or -Alt)",sculptColor:null,sculptRoughness:null,sculptMetallic:null,sculptClay:"クレイ",sculptAccumulate:null,sculptColorGlobal:null,sculptPickColor:null,sculptTangentialSmoothing:null,sculptTopologicalCheck:null,sculptMoveAlongNormal:null,sculptMaskingClear:null,sculptMaskingInvert:null,sculptMaskingBlur:null,sculptMaskingSharpen:null,sculptPBRTitle:null,sculptPaintAll:null,sculptExtractTitle:null,sculptExtractThickness:null,sculptExtractAction:null,stateTitle:"履歴",stateUndo:"アンドゥ",stateRedo:"リドゥ",stateMaxStack:null,wacomTitle:"ワコムタブレット",wacomRadius:"圧力半径？",wacomIntensity:"圧力の強さ？",renderingTitle:null,renderingGrid:null,renderingSymmetryLine:null,renderingMatcap:null,renderingCurvature:null,renderingPBR:null,renderingTransparency:"透過",renderingNormal:"ノーマル",renderingUV:null,renderingShader:"シェーダー",renderingMaterial:null,renderingImportUV:null,renderingImportMatcap:null,renderingExtra:null,renderingFlat:"フラットシェーディング",renderingWireframe:"ワイヤーフレーム (W)",renderingExposure:null,renderingEnvironment:null,renderingIsolate:null,renderingFilmic:null,contour:null,contourShow:null,contourColor:null,darkenUnselected:null,resolution:null,matcapPearl:null,matcapClay:"クレイ",matcapSkin:"スキン",matcapGreen:null,matcapWhite:null,sketchfabTitle:"Sketchfabへ移動",sketchfabUpload:"アップロード",sketchfabUploadMessage:null,sketchfabUploadError:null,sketchfabUploadSuccess:null,sketchfabAbort:null,sketchfabUploadProcessing:null,about:null,alphaNone:null,alphaSquare:null,alphaSkin:null,envFootPrint:null,envGlazedPatio:null,envNicolausChurch:null,envTerrace:null,envBryantPark:null};c.exports=d}),define("gui/tr/korean",["require","exports","module"],function(a,b,c){"use strict";var d={backgroundTitle:"배경",backgroundReset:"초기화",backgroundImport:"배경 (jpg, png...)",backgroundFill:"채우기",cameraTitle:"카메라",cameraReset:"뷰",cameraCenter:"초기화 (bar)",cameraFront:"앞쪽 (F)",cameraLeft:"왼쪽 (L)",cameraTop:"위쪽 (T)",cameraMode:"모드",cameraOrbit:"궤도 (Turntable)",cameraSpherical:"구 (Trackball)",cameraPlane:"평면 (Trackball)",cameraProjection:"투사",cameraPerspective:"원근법",cameraOrthographic:"정사영법",cameraFov:"시야각",cameraPivot:"피봇 고르기",fileTitle:"파일 (가져오기/내보내기)",fileImportTitle:"가져오기",fileAdd:"파일 (obj, sgl, ply, stl)",fileAutoMatrix:null,fileVertexSRGB:null,fileExportMeshTitle:"메쉬 내보내기",fileExportSceneTitle:"장면 내보내기",fileExportSGL:"sgl로 저장하기",fileExportOBJ:"obj로 저장하기",fileExportPLY:"ply로 저장하기",fileExportSTL:"stl로 저장하기",sceneTitle:"장면",sceneReset:"장면 초기화",sceneAddSphere:"구 추가하기 ",sceneAddCube:null,sceneAddCylinder:null,sceneAddTorus:null,sceneSelection:null,sceneMerge:null,meshTitle:"메쉬",meshNbVertices:"점들 : ",meshNbFaces:"면들 : ",topologyTitle:"토폴로지",multiresTitle:"다중 해상도",multiresSubdivide:"세분화",multiresReverse:"리버스",multiresResolution:"해상도",multiresNoLower:"더 낮은 해상도가 존재하지 않습니다.",multiresNoHigher:"더 높은 해상도가 존재하지 않습니다.",multiresDelHigher:"더 높은 것을 삭제",multiresDelLower:"더 낮은 것을 삭제",multiresSelectLowest:"리버싱 하기 전에 더 낮은 해상도를 고르세요.",multiresSelectHighest:"세분화 하기 전에 더 높은 해상도를 고르세요",multiresWarnBigMesh:function(a){return"다음 세분화 레벨은 "+a+' 면만큼 도달할 것입니다.\n만약 당신이 무엇을 하는지 안다면 "세분화"를 다시 클릭하세요.'},multiresNotReversible:"이 메쉬는 리버싱할 수 없습니다.\n이 메쉬는 여러가지 메쉬의 표면의 세분화를 product한 것이 아닙니다.(loop-catmull)",remeshTitle:null,remeshRemesh:null,remeshResolution:null,remeshBlock:null,dynamicTitle:null,dynamicActivated:null,dynamicSubdivision:null,dynamicDecimation:null,dynamicLinear:null,sculptTitle:null,sculptBrush:"브러쉬",sculptInflate:null,sculptTwist:null,sculptSmooth:null,sculptFlatten:null,sculptPinch:null,sculptCrease:null,sculptDrag:null,sculptPaint:null,sculptMasking:null,sculptMove:null,sculptLocalScale:null,sculptTransform:null,sculptCommon:null,sculptTool:null,sculptSymmetry:null,sculptContinuous:null,sculptRadius:null,sculptIntensity:null,sculptHardness:null,sculptCulling:null,sculptAlphaTitle:null,sculptLockPositon:null,sculptAlphaTex:null,sculptImportAlpha:null,sculptNegative:null,sculptColor:null,sculptRoughness:null,sculptMetallic:null,sculptClay:null,sculptAccumulate:null,sculptColorGlobal:null,sculptPickColor:null,sculptTangentialSmoothing:null,sculptTopologicalCheck:null,sculptMoveAlongNormal:null,sculptMaskingClear:null,sculptMaskingInvert:null,sculptMaskingBlur:null,sculptMaskingSharpen:null,sculptPBRTitle:null,sculptPaintAll:null,sculptExtractTitle:null,sculptExtractThickness:null,sculptExtractAction:null,stateTitle:"역사",stateUndo:"되돌리기",stateRedo:"다시하기",stateMaxStack:"최대 스택",wacomTitle:"와콤 테블릿",wacomRadius:"압력 반지름",wacomIntensity:"압력 강도",renderingTitle:"렌더링",renderingGrid:"그리드 보이기",renderingSymmetryLine:"대칭선 보이기",renderingMatcap:null,renderingCurvature:null,renderingPBR:null,renderingTransparency:"투명도",renderingNormal:"노말 쉐이더",renderingUV:"UV 쉐이더",renderingShader:"쉐이더",renderingMaterial:"질",renderingImportUV:"가져오기 (jpg, png...)",renderingImportMatcap:"가져오기 (jpg, png...)",renderingExtra:"추가",renderingFlat:"편평한 (느리게)",renderingWireframe:"와이어프레임 (느리게) (W)",renderingExposure:null,renderingEnvironment:null,renderingIsolate:null,renderingFilmic:null,contour:null,contourShow:null,contourColor:null,darkenUnselected:null,resolution:null,matcapPearl:null,matcapClay:null,matcapSkin:null,matcapGreen:null,matcapWhite:null,sketchfabTitle:"Sketchfab으로 가기 !",sketchfabUpload:"올리기",sketchfabUploadMessage:null,sketchfabUploadError:null,sketchfabUploadSuccess:null,sketchfabAbort:null,sketchfabUploadProcessing:null,about:null,alphaNone:null,alphaSquare:null,alphaSkin:null,envFootPrint:null,envGlazedPatio:null,envNicolausChurch:null,envTerrace:null,envBryantPark:null};c.exports=d}),define("gui/tr/russian",["require","exports","module"],function(a,b,c){"use strict";var d={backgroundTitle:"Фон",backgroundReset:"Сброс",backgroundImport:"Импорт (jpg, png...)",backgroundFill:"Заполнить",cameraTitle:"Камера",cameraReset:"Вид",cameraCenter:"Сброс (bar)",cameraFront:"Спереди (F)",cameraLeft:"Слева (L)",cameraTop:"Сверху (T)",cameraMode:null,cameraOrbit:"Орбита (Вращение)",cameraSpherical:null,cameraPlane:"Плоскость (трекбол)",cameraProjection:"Проекция",cameraPerspective:"Перспективная",cameraOrthographic:"Ортогональная",cameraFov:"Угол обзора",cameraPivot:"Выбор вращения",fileTitle:"Файл",fileImportTitle:"Импорт",fileAdd:"Добавить(obj,sgl,ply,stl)",fileAutoMatrix:"Масштаб-вид",fileVertexSRGB:null,fileExportMeshTitle:"Эксорт модели",fileExportSceneTitle:"Экспорт сцены",fileExportSGL:"Сохранить .sgl",fileExportOBJ:"Сохранить .obj",fileExportPLY:"Сохранить .ply",fileExportSTL:"Сохранить .stl",sceneTitle:"Сцена",sceneReset:"Очистить сцену",sceneAddSphere:"Добавить сферу",sceneAddCube:"Добавить куб",sceneAddCylinder:null,sceneAddTorus:null,sceneSelection:"Выбрать",sceneMerge:"Объединить",meshTitle:"Сетка",meshNbVertices:"Вершины : ",meshNbFaces:"Грани : ",topologyTitle:"Топология",multiresTitle:"Детализация",multiresSubdivide:"Увеличить",multiresReverse:"Реверс",multiresResolution:"Разрешение",multiresNoLower:"Ниже уровня не существует.",multiresNoHigher:"Выше уровня не существует.",multiresDelHigher:"Удалить высокое",multiresDelLower:"Удалить низкое",multiresSelectLowest:"Выберете низкий перед реверсом.",multiresSelectHighest:"Выберете бысокий перед увеличением.",multiresWarnBigMesh:function(a){return"Следующий уровень "+a+' faces.\nЕсли вы уверены, снова нажмите на "разрешение".'},multiresNotReversible:"К сожалению это не возможно, чтобы изменить эту сетку.\nСетка не продуктивна.",remeshTitle:"Перестроить воксели",remeshRemesh:"Перестроить",remeshResolution:"Разрешение",remeshBlock:"Блоки-кубики",dynamicTitle:"Динамическая топология",dynamicActivated:"Активировать (без кубиков)",dynamicSubdivision:"Увеличить",dynamicDecimation:"Прореживание",dynamicLinear:"Линейное увеличение",sculptTitle:"Лепить и красить",sculptBrush:"3D Кисть",sculptInflate:"3D Надуть",sculptTwist:"3D Закручивание",sculptSmooth:"3D Сгладить (-Shift)",sculptFlatten:"3D Расплющить",sculptPinch:"3D Сдавить",sculptCrease:"3D Складка",sculptDrag:"3D Тянучка",sculptMove:"3D Перемещать",sculptLocalScale:"3D масштабирование",sculptPaint:"2D Кисть",sculptMasking:"2D Маска (-Ctrl)",sculptTransform:null,sculptCommon:null,sculptTool:"Инструмент",sculptSymmetry:"Симетрия",sculptContinuous:"Спрей",sculptRadius:"Размер (-X)",sculptIntensity:"Сила (-C)",sculptHardness:"Жесткость",sculptCulling:"Тонкая поверхность(передние вершины)",sculptAlphaTitle:"Альфа",sculptLockPositon:"Фиксация",sculptAlphaTex:"Текстура",sculptImportAlpha:"Импорт альфа текстуры (jpg, png...)",sculptNegative:"Негатив (N или -Alt)",sculptColor:"Палитра",sculptRoughness:"Шероховатость",sculptMetallic:"Металлический",sculptClay:"Без учета содержимого",sculptAccumulate:"Наращивать без ограничений",sculptColorGlobal:"Глобальный",sculptPickColor:"Пипетка материал (-S)",sculptTangentialSmoothing:null,sculptTopologicalCheck:null,sculptMoveAlongNormal:null,sculptMaskingClear:"Очистить (-Ctrl + Drag)",sculptMaskingInvert:"Инверсия (-Ctrl + Click)",sculptMaskingBlur:"Сгладить",sculptMaskingSharpen:"Резко",sculptPBRTitle:"PBR материал",sculptPaintAll:"Краска",sculptExtractTitle:"Извлечь",sculptExtractThickness:"Толщина",sculptExtractAction:"Извлечь !",stateTitle:"История",stateUndo:"Назад",stateRedo:"Вперед",stateMaxStack:"Количество шагов",wacomTitle:"Планшет Wacom",wacomRadius:"Нажим-размер",wacomIntensity:"Нажим-жесткость",renderingTitle:"Визуализация",renderingGrid:"Показать сетку",renderingSymmetryLine:"Линия симетрии",renderingMatcap:null,renderingCurvature:"Рельефность",renderingPBR:"PBR",renderingTransparency:"Прозрачность",renderingNormal:"Normal Map",renderingUV:"UV",renderingShader:"Шейдеры",renderingMaterial:"Материал",renderingImportUV:"Импорт (jpg, png...)",renderingImportMatcap:"Импорт (jpg, png...)",renderingExtra:"Дополнительно",renderingFlat:"Плоское-рельефное",renderingWireframe:"Каркас (W)",renderingExposure:"Экспозиция",renderingEnvironment:"Отражение",renderingIsolate:"Изолировать / Показать (I)",renderingFilmic:null,contour:"Контур",contourShow:"Показать контур",contourColor:"Цвет",darkenUnselected:null,resolution:null,matcapPearl:"Жемчуг",matcapClay:"Глина",matcapSkin:"Кожа",matcapGreen:"Зеленый",matcapWhite:"Белый",sketchfabTitle:"В Sketchfab.com ",sketchfabUpload:"Загрузить",sketchfabUploadMessage:"Ведите ключ sketchfab API Key.\nВы также можете оставить «Гость», чтобы загрузить anonymously.\n(Откроется новое окно, когда загрузка и обработка закончена)",sketchfabUploadError:function(a){return"Sketchfab ошибка загрузки :\n"+a},sketchfabUploadSuccess:"Загрузка выполнена !\nHere is your link :",sketchfabAbort:"Прервать загрузку ?",sketchfabUploadProcessing:"Загружается...\nВаша модель доступна :",about:null,alphaNone:"Нет",alphaSquare:"Квадрат",alphaSkin:"Кожа",envFootPrint:"Китайский театр Граумана",envGlazedPatio:"Застекленный дворик",envNicolausChurch:"Церковь Святого Николая",envTerrace:"Терраса",envBryantPark:"Бра́йант-парк"};c.exports=d}),define("gui/GuiTR",["require","exports","module","misc/getOptionsURL","gui/tr/english","gui/tr/chinese","gui/tr/japanese","gui/tr/korean","gui/tr/russian"],function(a,b,c){"use strict";var d=a("misc/getOptionsURL"),e=a("gui/tr/english"),f=a("gui/tr/chinese"),g=a("gui/tr/japanese"),h=a("gui/tr/korean"),i=a("gui/tr/russian"),j=function(a){var b=j.languages[j.select][a]||j.languages.english[a];return"string"==typeof b?b:"function"==typeof b?b.apply(this,Array.prototype.slice.call(arguments,1)):(console.error("No TR found for : "+a),a)};j.languages={english:e,"日本語":g,"中文":f,"한국어":h,"русский":i},j.select="english";var k=window.navigator.language||window.navigator.userLanguage;switch(k&&(k=k.substr(0,2)),"ja"===k?j.select="日本語":"zh"===k?j.select="中文":"ko"===k?j.select="한국어":"ru"===k&&(j.select="русский"),d().language){case"english":j.select="english";break;case"chinese":j.select="中文";break;case"korean":j.select="한국어";break;case"japanese":j.select="日本語";break;case"russian":j.select="русский"}c.exports=j}),define("render/shaders/ShaderMatcap",["require","exports","module","gui/GuiTR","render/shaders/ShaderBase"],function(a,b,c){"use strict";var d=a("gui/GuiTR"),e=a("render/shaders/ShaderBase"),f=e.getCopy();f.vertexName=f.fragmentName="Matcap",f.textures={},f.createTexture=function(a,b,c){var d=a.createTexture();a.bindTexture(a.TEXTURE_2D,d),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,b),f.setTextureParameters(a,b),a.bindTexture(a.TEXTURE_2D,null),f.textures[c]=d};var g="resources/matcaps/";f.matcaps=[{path:g+"matcapFV.jpg",name:"matcap FV"},{path:g+"redClay.jpg",name:"Red clay"},{path:g+"skinHazardousarts.jpg",name:"Skin hazardousarts"},{path:g+"skinHazardousarts2.jpg",name:"Skin Hazardousarts2"},{path:g+"pearl.jpg",name:d("matcapPearl")},{path:g+"clay.jpg",name:d("matcapClay")},{path:g+"skin.jpg",name:d("matcapSkin")},{path:g+"green.jpg",name:d("matcapGreen")},{path:g+"white.jpg",name:d("matcapWhite")}],f.uniforms={},f.attributes={},f.uniformNames=["uTexture0","uAlbedo"],Array.prototype.push.apply(f.uniformNames,e.uniformNames.commonUniforms),f.vertex=["precision mediump float;","attribute vec3 aVertex;","attribute vec3 aNormal;","attribute vec3 aColor;","attribute vec3 aMaterial;",e.strings.vertUniforms,"varying vec3 vVertex;","varying vec3 vNormal;","varying vec3 vColor;","varying float vMasking;","varying vec3 vVertexPres;","uniform vec3 uAlbedo;","void main() {","  vColor = uAlbedo.x >= 0.0 ? uAlbedo : aColor;","  vMasking = aMaterial.z;","  vNormal = mix(aNormal, uEN * aNormal, vMasking);","  vNormal = normalize(uN * vNormal);","  vec4 vertex4 = vec4(aVertex, 1.0);","  vertex4 = mix(vertex4, uEM *vertex4, vMasking);","  vVertex = vec3(uMV * vertex4);","  vVertexPres = vVertex / max(1.0, abs(uMV[3][2]));","  gl_Position = uMVP * vertex4;","}"].join("\n"),f.fragment=["precision mediump float;","uniform sampler2D uTexture0;","varying vec3 vVertex;","varying vec3 vVertexPres;","varying vec3 vNormal;","varying vec3 vColor;","uniform float uAlpha;",e.strings.fragColorUniforms,e.strings.fragColorFunction,"void main() {","  vec3 normal = getNormal();","  vec3 nm_z = normalize(vVertexPres);","  vec3 nm_x = vec3(-nm_z.z, 0.0, nm_z.x);","  vec3 nm_y = cross(nm_x, nm_z);","  vec2 texCoord = 0.5 + 0.5 * vec2(dot(normal, nm_x), dot(normal, nm_y));","  vec3 color = sRGBToLinear(texture2D(uTexture0, texCoord).rgb) * sRGBToLinear(vColor);","  gl_FragColor = encodeFragColor(color, uAlpha);","}"].join("\n"),f.updateUniforms=function(a,b){var c=a.getGL(),d=this.uniforms;c.activeTexture(c.TEXTURE0),a.setTexture0(f.textures[a.getMatcap()]||f.textures[0]),c.bindTexture(c.TEXTURE_2D,a.getTexture0()),c.uniform1i(d.uTexture0,0),c.uniform3fv(d.uAlbedo,a.getAlbedo()),e.updateUniforms.call(this,a,b)},c.exports=f}),define("render/shaders/ShaderMerge",["require","exports","module","render/shaders/ShaderBase","render/Attribute","misc/getOptionsURL"],function(a,b,c){"use strict";var d=a("render/shaders/ShaderBase"),e=a("render/Attribute"),f=a("misc/getOptionsURL"),g=d.getCopy();g.vertexName=g.fragmentName="Merge",g.FILMIC=f().filmic,g.uniforms={},g.attributes={},g.uniformNames=["uTexture0","uTexture1","uFilmic"],g.vertex=["precision mediump float;","attribute vec2 aVertex;","varying vec2 vTexCoord;","void main() {","  vTexCoord = aVertex * 0.5 + 0.5;","  gl_Position = vec4(aVertex, 0.5, 1.0);","}"].join("\n"),g.fragment=["precision mediump float;","uniform sampler2D uTexture0;","uniform sampler2D uTexture1;","uniform int uFilmic;","varying vec2 vTexCoord;",d.strings.colorSpaceGLSL,"void main() {","  vec4 transparent = texture2D(uTexture1, vTexCoord);","  vec3 color = decodeRGBM(texture2D(uTexture0, vTexCoord))*(1.0-transparent.a) + transparent.rgb;","  if(uFilmic == 1){","    vec3 x = max(vec3(0.0), color - vec3(0.004));","    gl_FragColor = vec4((x*(6.2*x+0.5))/(x*(6.2*x+1.7)+0.06), 1.0);","  }else{","    gl_FragColor = vec4(lineartoSRGB(color), 1.0);","  }","}"].join("\n"),g.draw=function(a,b){var c=a.getGL();c.useProgram(this.program),g.attributes.aVertex.bindToBuffer(a.getVertexBuffer()),c.activeTexture(c.TEXTURE0),c.bindTexture(c.TEXTURE_2D,b._rttOpaque.getTexture()),c.uniform1i(this.uniforms.uTexture0,0),c.activeTexture(c.TEXTURE1),c.bindTexture(c.TEXTURE_2D,b._rttTransparent.getTexture()),c.uniform1i(this.uniforms.uTexture1,1),c.uniform1i(this.uniforms.uFilmic,g.FILMIC),c.drawArrays(c.TRIANGLES,0,3)},g.initAttributes=function(a){g.attributes.aVertex=new e(a,g.program,"aVertex",2,a.FLOAT)},c.exports=g}),define("render/shaders/ShaderNormal",["require","exports","module","render/shaders/ShaderBase"],function(a,b,c){"use strict";var d=a("render/shaders/ShaderBase"),e=d.getCopy();e.vertexName=e.fragmentName="ShowNormal",e.uniforms={},e.attributes={},e.activeAttributes={vertex:!0,normal:!0,material:!0},e.uniformNames=[],Array.prototype.push.apply(e.uniformNames,d.uniformNames.commonUniforms),e.vertex=["precision mediump float;","attribute vec3 aVertex;","attribute vec3 aNormal;","attribute vec3 aMaterial;",d.strings.vertUniforms,"varying vec3 vVertex;","varying vec3 vNormal;","varying float vMasking;","void main() {","  vMasking = aMaterial.z;","  vNormal = mix(aNormal, uEN * aNormal, vMasking);","  vNormal = normalize(uN * vNormal);","  vec4 vertex4 = vec4(aVertex, 1.0);","  vertex4 = mix(vertex4, uEM *vertex4, vMasking);","  vVertex = vec3(uMV * vertex4);","  gl_Position = uMVP * vertex4;","}"].join("\n"),e.fragment=["precision mediump float;","varying vec3 vVertex;","varying vec3 vNormal;","uniform float uAlpha;",d.strings.fragColorUniforms,d.strings.fragColorFunction,"void main() {","  gl_FragColor = encodeFragColor(sRGBToLinear(getNormal() * 0.5 + 0.5), uAlpha);","}"].join("\n"),c.exports=e}),define("text!render/shaders/glsl/pbr.glsl",[],function(){return"#define PI 3.1415926535897932384626433832795\n#define PI_2 (2.0*3.1415926535897932384626433832795)\n#define INV_PI 1.0/PI\n#define INV_LOG2 1.4426950408889634073599246810019\n\nuniform sampler2D uTexture0;\nuniform float uExposure;\nuniform mat3 uIblTransform;\n\nvec2 environmentSize = vec2(1024, 512);\nvec2 environmentLodRange = vec2(10, 5);\n\nconst mat3 LUVInverse = mat3( 6.0013, -2.700, -1.7995, -1.332, 3.1029, -5.7720, 0.3007, -1.088, 5.6268 );\nvec3 LUVToRGB( const in vec4 vLogLuv ) {\n  float Le = vLogLuv.z * 255.0 + vLogLuv.w;\n  vec3 Xp_Y_XYZp;\n  Xp_Y_XYZp.y = exp2((Le - 127.0) / 2.0);\n  Xp_Y_XYZp.z = Xp_Y_XYZp.y / vLogLuv.y;\n  Xp_Y_XYZp.x = vLogLuv.x * Xp_Y_XYZp.z;\n  return max(LUVInverse * Xp_Y_XYZp, 0.0);\n}\n\nvec2 computeUVForMipmap( const in float level, const in vec2 uv, const in float size, const in float maxLOD ) {\n  float widthForLevel = exp2( maxLOD - level);\n  vec2 uvSpaceLocal =  vec2(1.0) + uv * vec2(widthForLevel - 2.0, widthForLevel * 0.5 - 2.0);\n  uvSpaceLocal.y += size - widthForLevel;\n  return uvSpaceLocal / size;\n}\n\nvec2 normalToPanoramaUVY( const in vec3 dir ) {\n  float n = length(dir.xz);\n  vec2 pos = vec2( (n>0.0000001) ? max(-1.0,dir.x / n) : 0.0, dir.y);\n  if ( pos.x > 0.0 ) pos.x = min( 0.999999, pos.x );\n  pos = acos(pos)*INV_PI;\n  pos.x = (dir.z > 0.0) ? pos.x*0.5 : 1.0-(pos.x*0.5);\n  pos.x = mod(pos.x-0.25+1.0, 1.0 );\n  pos.y = 1.0-pos.y;\n  return pos;\n}\n\nvec3 texturePanoramaLod(const in sampler2D texture, const in vec2 size , const in vec3 direction, const in float lodInput, const in float maxLOD ) {\n  float lod = min( maxLOD, lodInput );\n  vec2 uvBase = normalToPanoramaUVY( direction );\n  vec3 texel0 = LUVToRGB(texture2D( texture, computeUVForMipmap(floor(lod), uvBase, size.x, maxLOD )));\n  vec3 texel1 = LUVToRGB(texture2D( texture, computeUVForMipmap(ceil(lod), uvBase, size.x, maxLOD )));\n  return mix(texel0, texel1, fract( lod ) );\n}\n\nvec3 integrateBRDFApprox(const in vec3 specular, float roughness, float NoV) {\n  const vec4 c0 = vec4(-1, -0.0275, -0.572, 0.022);\n  const vec4 c1 = vec4(1, 0.0425, 1.04, -0.04);\n  vec4 r = roughness * c0 + c1;\n  float a004 = min(r.x * r.x, exp2(-9.28 * NoV)) * r.x + r.y;\n  vec2 AB = vec2(-1.04, 1.04) * a004 + r.zw;\n  return specular * AB.x + AB.y;\n}\n\nvec3 getSpecularDominantDir( const in vec3 N, const in vec3 R, const in float realRoughness ) {\n    float smoothness = 1.0 - realRoughness;\n    return mix( N, R, smoothness * ( sqrt( smoothness ) + realRoughness ) );\n}\n\nvec3 approximateSpecularIBL( const in vec3 specularColor, float rLinear, const in vec3 N, const in vec3 V ) {\n  float NoV = clamp( dot( N, V ), 0.0, 1.0 );\n  vec3 R = normalize( (2.0 * NoV ) * N - V);\n  R = getSpecularDominantDir(N, R, rLinear);\n  vec3 prefilteredColor = texturePanoramaLod( uTexture0, environmentSize, uIblTransform * R, rLinear * environmentLodRange[1], environmentLodRange[0] );\n  return prefilteredColor * integrateBRDFApprox(specularColor, rLinear, NoV);\n}\n\n// expect shCoefs uniform\n// https://github.com/cedricpinson/envtools/blob/master/Cubemap.cpp#L523\nvec3 sphericalHarmonics( const in vec3 N ) {\n  float x = N.x;\n  float y = N.y;\n  float z = N.z;\n  vec3 result = uSPH[0] + uSPH[1] * y + uSPH[2] * z + uSPH[3] * x + uSPH[4] * y * x + uSPH[5] * y * z + uSPH[6] * (3.0 * z * z - 1.0) + uSPH[7] * (z * x) + uSPH[8] * (x*x - y*y);\n  return max(result, vec3(0.0));\n}\n\nvec3 computeIBL_UE4( const in vec3 N, const in vec3 V, const in vec3 albedo, const in float roughness, const in vec3 specular) {\n  vec3 color = vec3(0.0);\n  if ( albedo != color )\n    color += albedo * sphericalHarmonics( uIblTransform * N );\n  color += approximateSpecularIBL(specular, roughness, N, V);\n  return color;\n}\n"}),define("render/shaders/ShaderPBR",["require","exports","module","lib/glMatrix","misc/getOptionsURL","render/shaders/ShaderBase","text!render/shaders/glsl/pbr.glsl","gui/GuiTR"],function(a,b,c){"use strict";var d=a("lib/glMatrix"),e=a("misc/getOptionsURL"),f=a("render/shaders/ShaderBase"),g=a("text!render/shaders/glsl/pbr.glsl"),h=a("gui/GuiTR"),i=d.mat3,j=f.getCopy();j.vertexName=j.fragmentName="ShadingPBR",j.textures={};var k="resources/environments/";j.environments=[{path:k+"footPrint.bin",sph:[.96097,.856821,1.11124,-.313999,-.358144,-.625599,.0870941,.1109,.171528,-.100569,-.0498991,-.0302566,.02047,.0151743,.0182682,-.00652953,-.0188746,-.0525354,.00192821,-.0279455,-.110808,-.0180287,-.0227345,-.0422744,.0139192,-.0187345,-.0812033],name:h("envFootPrint")},{path:k+"glazedPatio.bin",sph:[.475424,.460106,.407626,-.0626622,-.0978501,-.148369,-.029662,-.022522,-.0109794,-.0893952,-.116715,-.139033,.0450059,.0514445,.0619667,.00471057,.00393219,.00522881,-.0508041,-.0540791,-.0530655,-.0278953,-.0258599,-.0191718,-.0137735,-.0186312,-.0286948],name:h("envGlazedPatio")},{path:k+"nicolausChurch.bin",sph:[1.67609,1.52776,1.05807,-.261794,-.293249,-.225056,.0371792,.0263728,-.0174064,.142577,.121132,.0724402,.00827981,.00263222,.00184229,.0208164,.0128967,.0139606,.0795516,.0909961,.0897778,.058084,.0541786,.0401144,-.0664757,-.0587091,-.0386655],name:h("envNicolausChurch")},{path:k+"terrace.bin",sph:[.688602,.636799,.515733,-.192892,-.219448,-.242244,.126328,.124547,.0928089,.308754,.307826,.214901,-.0713295,-.0740211,-.0583892,-.0283229,-.0290954,-.0224256,-.030012,-.0302393,-.0280645,.0766113,.0653549,.0388244,.104034,.0751443,.0221583],name:h("envTerrace")},{path:k+"bryantPark.bin",sph:[.583073,.794556,.966801,-.218899,-.334516,-.690954,-.0581536,-.0912214,-.13112,.0180201,.0683966,.157536,-.0427475,-.073612,-.112892,.0490024,.06527,.0841072,-.0243839,-.0429701,-.0792229,-.0441213,-.0562622,-.0728875,-.0267015,-.0586719,-.11978],name:h("envBryantPark")}];var l=e();j.idEnv=Math.min(l.environment,j.environments.length-1),j.exposure=Math.min(l.exposure,5),j.uniforms={},j.attributes={},j.uniformNames=["uIblTransform","uTexture0","uAlbedo","uRoughness","uMetallic","uExposure","uSPH"],Array.prototype.push.apply(j.uniformNames,f.uniformNames.commonUniforms),j.vertex=["precision mediump float;","attribute vec3 aVertex;","attribute vec3 aNormal;","attribute vec3 aColor;","attribute vec3 aMaterial;",f.strings.vertUniforms,"uniform float uRoughness;","uniform float uMetallic;","uniform vec3 uAlbedo;","varying vec3 vVertex;","varying vec3 vNormal;","varying vec3 vAlbedo;","varying float vRoughness;","varying float vMetallic;","varying float vMasking;","void main() {","  vAlbedo = uAlbedo.x >= 0.0 ? uAlbedo : aColor;","  vRoughness = uRoughness >= 0.0 ? uRoughness : aMaterial.x;","  vMetallic = uMetallic >= 0.0 ? uMetallic : aMaterial.y;","  vMasking = aMaterial.z;","  vNormal = mix(aNormal, uEN * aNormal, vMasking);","  vNormal = normalize(uN * vNormal);","  vec4 vertex4 = vec4(aVertex, 1.0);","  vertex4 = mix(vertex4, uEM * vertex4, vMasking);","  vVertex = vec3(uMV * vertex4);","  gl_Position = uMVP * vertex4;","}"].join("\n"),j.fragment=["precision mediump float;","varying vec3 vVertex;","varying vec3 vNormal;","varying vec3 vAlbedo;","varying float vRoughness;","varying float vMetallic;","uniform float uAlpha;","uniform vec3 uSPH[9];",f.strings.fragColorUniforms,f.strings.fragColorFunction,g,"","void main(void) {","  vec3 normal = getNormal();","  float roughness = max( 0.0001, vRoughness );","  vec3 linColor = sRGBToLinear(vAlbedo);","  vec3 albedo = linColor * (1.0 - vMetallic);","  vec3 specular = mix( vec3(0.04), linColor, vMetallic);","","  vec3 color = uExposure * computeIBL_UE4( normal, -normalize(vVertex), albedo, roughness, specular );","  gl_FragColor = encodeFragColor(color, uAlpha);","}"].join("\n"),
j.onLoadEnvironment=function(a,b,c,d){(200===a.status||a.response&&a.response.byteLength)&&(d.texture=b.createTexture(),b.bindTexture(b.TEXTURE_2D,d.texture),b.texImage2D(b.TEXTURE_2D,0,b.RGBA,1024,1024,0,b.RGBA,b.UNSIGNED_BYTE,new Uint8Array(a.response)),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,b.LINEAR),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,b.LINEAR),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,b.REPEAT),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.CLAMP_TO_EDGE),b.bindTexture(b.TEXTURE_2D,null),c&&c.render())},j.getOrCreateEnvironment=function(a,b,c){if(void 0!==c.texture)return c.texture;c.texture=null;var d=new XMLHttpRequest;return d.open("GET",c.path,!0),d.responseType="arraybuffer",d.onload=j.onLoadEnvironment.bind(this,d,a,b,c),d.send(null),null},j.getOrCreateSPH=function(a){if(a.sphCoef)return a.sphCoef;for(var b=1/(2*Math.sqrt(Math.PI)),c=-(.5*Math.sqrt(3/Math.PI)),d=-c,e=c,f=.5*Math.sqrt(15/Math.PI),g=-f,h=.25*Math.sqrt(5/Math.PI),i=g,j=.25*Math.sqrt(15/Math.PI),k=[b,b,b,c,c,c,d,d,d,e,e,e,f,f,f,g,g,g,h,h,h,i,i,i,j,j,j],l=a.sphCoef=new Float32Array(27),m=a.sph,n=0;27>n;++n)l[n]=m[n]*k[n];return l};var m=i.create();j.updateUniforms=function(a,b){var c=a.getGL(),d=this.uniforms;i.fromMat4(m,b.getCamera().getView()),c.uniformMatrix3fv(d.uIblTransform,!1,i.transpose(m,m)),c.uniform3fv(d.uAlbedo,a.getAlbedo()),c.uniform1f(d.uRoughness,a.getRoughness()),c.uniform1f(d.uMetallic,a.getMetallic()),c.uniform1f(d.uExposure,j.exposure);var e=j.environments[j.idEnv];c.uniform3fv(d.uSPH,j.getOrCreateSPH(e)),c.activeTexture(c.TEXTURE0),c.bindTexture(c.TEXTURE_2D,j.getOrCreateEnvironment(c,b,e)),c.uniform1i(d.uTexture0,0),f.updateUniforms.call(this,a,b)},c.exports=j}),define("render/shaders/ShaderUV",["require","exports","module","render/shaders/ShaderBase","render/Attribute"],function(a,b,c){"use strict";var d=a("render/shaders/ShaderBase"),e=a("render/Attribute"),f=d.getCopy();f.vertexName=f.fragmentName="ShowUV",f.texPath="resources/uv.jpg",f.uniforms={},f.attributes={},f.uniformNames=["uTexture0","uAlbedo"],Array.prototype.push.apply(f.uniformNames,d.uniformNames.commonUniforms),f.vertex=["precision mediump float;","attribute vec3 aVertex;","attribute vec3 aNormal;","attribute vec3 aColor;","attribute vec2 aTexCoord;","attribute vec3 aMaterial;",d.strings.vertUniforms,"varying vec3 vVertex;","varying vec3 vNormal;","varying vec3 vColor;","varying vec2 vTexCoord;","varying float vMasking;","uniform vec3 uAlbedo;","void main() {","  vColor = uAlbedo.x >= 0.0 ? uAlbedo : aColor;","  vTexCoord = aTexCoord;","  vMasking = aMaterial.z;","  vNormal = mix(aNormal, uEN * aNormal, vMasking);","  vNormal = normalize(uN * vNormal);","  vec4 vertex4 = vec4(aVertex, 1.0);","  vertex4 = mix(vertex4, uEM *vertex4, vMasking);","  vVertex = vec3(uMV * vertex4);","  gl_Position = uMVP * vertex4;","}"].join("\n"),f.fragment=["precision mediump float;","uniform sampler2D uTexture0;","varying vec3 vVertex;","varying vec3 vNormal;","varying vec3 vColor;","varying vec2 vTexCoord;","uniform float uAlpha;",d.strings.fragColorUniforms,d.strings.fragColorFunction,"void main() {","  vec3 color = sRGBToLinear(texture2D(uTexture0, vTexCoord).rgb) * sRGBToLinear(vColor);","  gl_FragColor = encodeFragColor(color, uAlpha);","}"].join("\n"),f.draw=d.draw,f.drawBuffer=d.drawBuffer,f.getOrCreate=d.getOrCreate,f.initUniforms=d.initUniforms,f.initAttributes=function(a){d.initAttributes.call(this,a),f.attributes.aTexCoord=new e(a,f.program,"aTexCoord",2,a.FLOAT)},f.bindAttributes=function(a){d.bindAttributes.call(this,a),f.attributes.aTexCoord.bindToBuffer(a.getTexCoordBuffer())},f.updateUniforms=function(a,b){var c=a.getGL(),e=this.uniforms;c.activeTexture(c.TEXTURE0),c.bindTexture(c.TEXTURE_2D,d.getOrCreateTexture0.call(this,c,f.texPath,b)||null),c.uniform1i(e.uTexture0,0),c.uniform3fv(e.uAlbedo,a.getAlbedo()),d.updateUniforms.call(this,a,b)},c.exports=f}),define("render/shaders/ShaderWireframe",["require","exports","module","render/shaders/ShaderBase"],function(a,b,c){"use strict";var d=a("render/shaders/ShaderBase"),e=d.getCopy();e.vertexName=e.fragmentName="Wireframe",e.uniforms={},e.attributes={},e.activeAttributes={vertex:!0,material:!0},e.uniformNames=["uMVP","uEM"],e.vertex=["attribute vec3 aVertex;","attribute vec3 aMaterial;","uniform mat4 uMVP;","uniform mat4 uEM;","void main() {","  vec4 vertex4 = vec4(aVertex, 1.0);","  vec4 pos = uMVP * mix(vertex4, uEM * vertex4, aMaterial.z);","  pos[3] += 0.0001;","  gl_Position = pos;","}"].join("\n"),e.fragment=["precision mediump float;","void main() {","  gl_FragColor = vec4(0.0, 0.0, 0.0, 0.4);","}"].join("\n"),e.getOrCreate=d.getOrCreate,e.draw=function(a){var b=a.getGL();b.useProgram(this.program),this.bindAttributes(a),this.updateUniforms(a),a.getWireframeBuffer().bind(),b.drawElements(b.LINES,2*a.getMesh().getRenderNbEdges(),b.UNSIGNED_INT,0)},e.updateUniforms=function(a){a.getGL().uniformMatrix4fv(this.uniforms.uMVP,!1,a.getMesh().getMVP()),a.getGL().uniformMatrix4fv(this.uniforms.uEM,!1,a.getMesh().getEditMatrix())},c.exports=e}),define("render/ShaderLib",["require","exports","module","render/shaders/ShaderBackground","render/shaders/ShaderContour","render/shaders/ShaderSelection","render/shaders/ShaderFlat","render/shaders/ShaderFxaa","render/shaders/ShaderMatcap","render/shaders/ShaderMerge","render/shaders/ShaderNormal","render/shaders/ShaderPBR","render/shaders/ShaderUV","render/shaders/ShaderWireframe"],function(a,b,c){"use strict";var d=a("render/shaders/ShaderBackground"),e=a("render/shaders/ShaderContour"),f=a("render/shaders/ShaderSelection"),g=a("render/shaders/ShaderFlat"),h=a("render/shaders/ShaderFxaa"),i=a("render/shaders/ShaderMatcap"),j=a("render/shaders/ShaderMerge"),k=a("render/shaders/ShaderNormal"),l=a("render/shaders/ShaderPBR"),m=a("render/shaders/ShaderUV"),n=a("render/shaders/ShaderWireframe"),o={};o.PBR=l,o.MATCAP=i,o.NORMAL=k,o.UV=m,o.WIREFRAME=n,o.FLAT=g,o.SELECTION=f,o.BACKGROUND=d,o.MERGE=j,o.FXAA=h,o.CONTOUR=e,c.exports=o}),define("render/Buffer",["require","exports","module"],function(a,b,c){"use strict";var d=function(a,b,c){this._gl=a,this._buffer=a.createBuffer(),this._type=b,this._hint=c,this._size=0};d.prototype={bind:function(){this._gl.bindBuffer(this._type,this._buffer)},release:function(){this._gl.deleteBuffer(this._buffer)},update:function(a){this._gl.bindBuffer(this._type,this._buffer),a.length>this._size?(this._gl.bufferData(this._type,a,this._hint),this._size=a.length):this._gl.bufferSubData(this._type,0,a)}},c.exports=d}),define("mesh/Render",["require","exports","module","misc/getOptionsURL","render/ShaderLib","render/Buffer","render/shaders/ShaderMatcap"],function(a,b,c){"use strict";var d=a("misc/getOptionsURL"),e=a("render/ShaderLib"),f=a("render/Buffer"),g=a("render/shaders/ShaderMatcap"),h=function(a,b){this._mesh=b,this._gl=a;var c=d();this._shaderName=c.shader,this._flatShading=c.flatshading,this._showWireframe=c.wireframe,this._matcap=Math.min(c.matcap,g.matcaps.length-1),this._curvature=Math.min(c.curvature,5),this._texture0=null,this._useDrawArrays=!1,this._vertexBuffer=new f(a,a.ARRAY_BUFFER,a.DYNAMIC_DRAW),this._normalBuffer=new f(a,a.ARRAY_BUFFER,a.DYNAMIC_DRAW),this._colorBuffer=new f(a,a.ARRAY_BUFFER,a.DYNAMIC_DRAW),this._materialBuffer=new f(a,a.ARRAY_BUFFER,a.DYNAMIC_DRAW),this._texCoordBuffer=new f(a,a.ARRAY_BUFFER,a.STATIC_DRAW),this._indexBuffer=new f(a,a.ELEMENT_ARRAY_BUFFER,a.STATIC_DRAW),this._wireframeBuffer=new f(a,a.ELEMENT_ARRAY_BUFFER,a.STATIC_DRAW),this._albedo=new Float32Array([-1,-1,-1]),this._roughness=-.18,this._metallic=-.78,this._alpha=1,this._flatColor=new Float32Array([1,0,0]),this._mode=a.TRIANGLES};h.ONLY_DRAW_ARRAYS=!1,h.prototype={getCount:function(){var a=this._gl;return this._mode===a.TRIANGLES?3*this._mesh.getNbTriangles():this._mode===a.LINES?this._mesh.getNbVertices():0},getGL:function(){return this._gl},getMesh:function(){return this._mesh},getVertexBuffer:function(){return this._vertexBuffer},getNormalBuffer:function(){return this._normalBuffer},getColorBuffer:function(){return this._colorBuffer},getMaterialBuffer:function(){return this._materialBuffer},getTexCoordBuffer:function(){return this._texCoordBuffer},getIndexBuffer:function(){return this._indexBuffer},getWireframeBuffer:function(){return this._wireframeBuffer},getFlatColor:function(){return this._flatColor},setFlatColor:function(a){this._flatColor.set(a)},getMode:function(){return this._mode},setMode:function(a){this._mode=a},getAlbedo:function(){return this._albedo},setAlbedo:function(a){this._albedo.set(a)},getRoughness:function(){return this._roughness},setRoughness:function(a){this._roughness=a},getMetallic:function(){return this._metallic},setMetallic:function(a){this._metallic=a},getOpacity:function(){return this._alpha},setOpacity:function(a){this._alpha=a},getTexture0:function(){return this._texture0},setTexture0:function(a){this._texture0=a},getMatcap:function(){return this._matcap},setMatcap:function(a){this._matcap=a},getCurvature:function(){return this._curvature},setCurvature:function(a){this._curvature=a},getFlatShading:function(){return this._flatShading},setFlatShading:function(a){this._flatShading=a},getShowWireframe:function(){return this._showWireframe},setShowWireframe:function(a){this._showWireframe=h.ONLY_DRAW_ARRAYS?!1:a,this.updateWireframeBuffer()},isUsingDrawArrays:function(){return this._useDrawArrays||h.ONLY_DRAW_ARRAYS},setUseDrawArrays:function(a){this._useDrawArrays=a},isUsingTexCoords:function(){return"UV"===this._shaderName},isTransparent:function(){return this._alpha<.99},getShaderName:function(){return this._shaderName},setShaderName:function(a){var b=this._mesh.hasUV();("UV"!==a||b)&&(this._shaderName=a,b&&(this._mesh.updateDuplicateGeometry(),this._mesh.updateDuplicateColorsAndMaterials(),this._mesh.updateDrawArrays()),this.updateBuffers())},initRender:function(){"MATCAP"!==this._shaderName||this._texture0||this.setMatcap(this._matcap),this.setShaderName(this._shaderName),this.setShowWireframe(this.getShowWireframe())},render:function(a){e[this._shaderName].getOrCreate(this.getGL()).draw(this,a)},renderWireframe:function(a){e.WIREFRAME.getOrCreate(this.getGL()).draw(this,a)},renderFlatColor:function(a){e.FLAT.getOrCreate(this.getGL()).draw(this,a)},updateVertexBuffer:function(){this.getVertexBuffer().update(this._mesh.getRenderVertices())},updateNormalBuffer:function(){this.getNormalBuffer().update(this._mesh.getRenderNormals())},updateColorBuffer:function(){this.getColorBuffer().update(this._mesh.getRenderColors())},updateMaterialBuffer:function(){this.getMaterialBuffer().update(this._mesh.getRenderMaterials())},updateTexCoordBuffer:function(){this.isUsingTexCoords()&&this.getTexCoordBuffer().update(this._mesh.getRenderTexCoords())},updateIndexBuffer:function(){this.isUsingDrawArrays()||this.getIndexBuffer().update(this._mesh.getRenderTriangles())},updateWireframeBuffer:function(){this.getShowWireframe()&&this.getWireframeBuffer().update(this._mesh.getWireframe())},updateGeometryBuffers:function(){this.updateVertexBuffer(),this.updateNormalBuffer()},updateBuffers:function(){this.updateGeometryBuffers(),this.updateColorBuffer(),this.updateMaterialBuffer(),this.updateTexCoordBuffer(),this.updateIndexBuffer(),this.updateWireframeBuffer()},release:function(){this.getTexture0()&&this.getGL().deleteTexture(this.getTexture0()),this.getVertexBuffer().release(),this.getNormalBuffer().release(),this.getColorBuffer().release(),this.getMaterialBuffer().release(),this.getIndexBuffer().release(),this.getWireframeBuffer().release()},copyRenderConfig:function(a){this.setFlatShading(a.getFlatShading()),this.setShowWireframe(a.getShowWireframe()),this.setShaderName(a.getShaderName()),this.setMatcap(a.getMatcap()),this.setTexture0(a.getTexture0()),this.setCurvature(a.getCurvature()),this.setOpacity(a.getOpacity())}},c.exports=h}),define("mesh/Mesh",["require","exports","module","misc/Utils","mesh/meshData/MeshData","math3d/Octree","mesh/Render"],function(a,b,c){"use strict";var d=a("misc/Utils"),e=a("mesh/meshData/MeshData"),f=a("math3d/Octree"),g=a("mesh/Render"),h=function(a){this._meshData=new e(this),this._octree=new f(this),this._render=a?new g(a,this):null,this._id=h.ID++};h.ID=0,h.sortFunction=function(a,b){var c=a.isTransparent(),d=b.isTransparent();return c&&!d?1:!c&&d?-1:(b.getDepth()-a.getDepth())*(c&&d?1:-1)},h.prototype={getID:function(){return this._id},setID:function(a){this._id=a},getMeshData:function(){return this._meshData},getOctree:function(){return this._octree},getRender:function(){return this._render},setMeshData:function(a){this._meshData=a},setOctree:function(a){this._octree=a},setRender:function(a){this._render=a},getRenderVertices:function(){return this.isUsingDrawArrays()?this.getVerticesDrawArrays():this.isUsingTexCoords()?this.getVerticesTexCoord():this.getVertices()},getRenderNormals:function(){return this.isUsingDrawArrays()?this.getNormalsDrawArrays():this.isUsingTexCoords()?this.getNormalsTexCoord():this.getNormals()},getRenderColors:function(){return this.isUsingDrawArrays()?this.getColorsDrawArrays():this.isUsingTexCoords()?this.getColorsTexCoord():this.getColors()},getRenderMaterials:function(){return this.isUsingDrawArrays()?this.getMaterialsDrawArrays():this.isUsingTexCoords()?this.getMaterialsTexCoord():this.getMaterials()},getRenderTexCoords:function(){return this.isUsingDrawArrays()?this.getTexCoordsDrawArrays():this.getTexCoords()},getRenderTriangles:function(){return this.isUsingTexCoords()?this.getTrianglesTexCoord():this.getTriangles()},getRenderNbEdges:function(){return this.getNbEdges()},init:function(){this.initColorsAndMaterials(),this.allocateArrays(),this.initTopology(),this.updateGeometry(),this._render&&this.updateDuplicateColorsAndMaterials(),this.updateCenter()},initTopology:function(){this.initFaceRings(),this.initEdges(),this.initVertexRings(),this.initRenderTriangles()},updateGeometry:function(a,b){this.updateFacesAabbAndNormal(a),this.updateVerticesNormal(b),this.updateOctree(a),this._render&&(this.updateDuplicateGeometry(b),this.updateDrawArrays(a))},allocateArrays:function(){this.getFaceData().allocateArrays(),this.getVertexData().allocateArrays(),this.getTexCoordsData().allocateArrays(),this.getOctree().allocateArrays()}},d.makeProxy(e,h,function(a){return function(){return a.apply(this.getMeshData(),arguments)}}),d.makeProxy(g,h,function(a){return function(){return a.apply(this.getRender(),arguments)}}),d.makeProxy(f,h,function(a){return function(){return a.apply(this.getOctree(),arguments)}}),c.exports=h}),define("editing/tools/Masking",["require","exports","module","lib/glMatrix","misc/Utils","editing/tools/SculptBase","editing/tools/Paint","editing/tools/Smooth","mesh/Mesh"],function(a,b,c){"use strict";var d=a("lib/glMatrix"),e=a("misc/Utils"),f=a("editing/tools/SculptBase"),g=a("editing/tools/Paint"),h=a("editing/tools/Smooth"),i=a("mesh/Mesh"),j=d.vec3,k=d.mat3,l=function(a){f.call(this,a),this._radius=50,this._hardness=.25,this._intensity=1,this._negative=!0,this._culling=!1,this._idAlpha=0,this._lockPosition=!1,this._thickness=1};l.prototype={pushState:function(){this._states.pushStateColorAndMaterial(this.getMesh())},updateMeshBuffers:function(){var a=this.getMesh();a.getDynamicTopology?a.updateBuffers():a.updateMaterialBuffer()},stroke:function(a){g.prototype.stroke.call(this,a)},paint:function(a,b,c,d,e,f){for(var g=this.getMesh(),h=g.getVertices(),i=g.getMaterials(),j=Math.sqrt(c),k=b[0],l=b[1],m=b[2],n=2*(1-e),o=this._negative?-d:d,p=0,q=a.length;q>p;++p){var r=3*a[p],s=h[r],t=h[r+1],u=h[r+2],v=s-k,w=t-l,x=u-m,y=Math.sqrt(v*v+w*w+x*x)/j,z=Math.pow(1-y,n);z*=o*f.getAlpha(s,t,u),i[r+2]=Math.min(Math.max(i[r+2]+z,0),1)}},updateAndRenderMask:function(){var a=this.getMesh();a.updateDuplicateColorsAndMaterials(),a.updateDrawArrays(),this.updateRender()},blur:function(){var a=this.getMesh(),b=this.getMaskedVertices();if(0!==b.length){b=a.expandsVertices(b,1),this.pushState(),this._states.pushVertices(b);var c=a.getMaterials(),d=b.length,e=new Float32Array(3*d);this.laplacianSmooth(b,e,c);for(var f=0;d>f;++f)c[3*b[f]+2]=e[3*f+2];this.updateAndRenderMask()}},sharpen:function(){var a=this.getMesh(),b=this.getMaskedVertices();if(0!==b.length){this.pushState(),this._states.pushVertices(b);for(var c=a.getMaterials(),d=b.length,e=0;d>e;++e){var f=3*b[e]+2,g=c[f];c[f]=g>.5?Math.min(g+.1,1):Math.max(g-1,0)}this.updateAndRenderMask()}},clear:function(){var a=this.getMesh(),b=this.getMaskedVertices();if(0!==b.length){this.pushState(),this._states.pushVertices(b);for(var c=a.getMaterials(),d=0,e=b.length;e>d;++d)c[3*b[d]+2]=1;this.updateAndRenderMask()}},invert:function(a,b){var c=b;c||(c=this.getMesh()),a||this._states.pushStateCustom(this.invert.bind(this,!0,c));for(var d=c.getMaterials(),e=0,f=c.getNbVertices();f>e;++e)d[3*e+2]=1-d[3*e+2];this.updateAndRenderMask()},remapAndMirrorIndices:function(a,b,c){var d=this.getMesh().getNbVertices(),f=new Uint32Array(e.getMemory(4*d),0,d),g=0,h=0,i=c.length;for(g=0;i>g;++g)f[c[g]]=g;var j=2*b;for(g=0;j>g;++g){h=4*g;var k=b>g?0:i;a[h]=f[a[h]]+k,a[h+1]=f[a[h+1]]+k,a[h+2]=f[a[h+2]]+k;var l=a[h+3];l>=0&&(a[h+3]=f[l]+k)}var m=a.length/4;for(g=j;m>g;++g)h=4*g,a[h]=f[a[h]],a[h+1]=f[a[h+1]],a[h+2]=f[a[h+2]]+i,a[h+3]=f[a[h+3]]+i},invertFaces:function(a){for(var b=0,c=a.length;c>b;++b){var d=4*b,e=a[d];a[d]=a[d+2],a[d+2]=e}},extractFaces:function(a,b,c){for(var d=this.getMesh(),f=d.getFaces(),g=d.getMaterials(),h=d.getVerticesOnEdge(),i=0===this._thickness,j=a.length,k=new Int32Array(e.getMemory(4*j*4*3),0,4*j*3),l=i?j:2*j,m=0;j>m;++m){var n=4*m,o=4*a[m],p=k[n]=f[o],q=k[n+1]=f[o+1],r=k[n+2]=f[o+2],s=k[n+3]=f[o+3];if(!i){var t=s>=0,u=g[3*p+2]>=c||h[p]>=1,v=g[3*q+2]>=c||h[q]>=1,w=g[3*r+2]>=c||h[r]>=1,x=t?g[3*s+2]>=c||h[s]>=1:!1;n+=4*j,k[n]=r,k[n+1]=q,k[n+2]=p,k[n+3]=s,v&&(u&&(n=4*l++,k[n]=k[n+3]=q,k[n+1]=k[n+2]=p),w&&(n=4*l++,k[n]=k[n+3]=r,k[n+1]=k[n+2]=q)),t?x&&(u&&(n=4*l++,k[n]=k[n+3]=p,k[n+1]=k[n+2]=s),w&&(n=4*l++,k[n]=k[n+3]=s,k[n+1]=k[n+2]=r)):u&&w&&(n=4*l++,k[n]=k[n+3]=p,k[n+1]=k[n+2]=r)}}var y=new Int32Array(k.subarray(0,4*l));return this.remapAndMirrorIndices(y,j,b),this._thickness>0&&this.invertFaces(y),y},extractVertices:function(a){var b=this.getMesh(),c=b.getVertices(),d=b.getNormals(),e=b.getMatrix(),f=k.normalFromMat4(k.create(),e),g=a.length,h=new Float32Array(2*g*3),i=[0,0,0],l=[0,0,0],m=3*g,n=this._thickness,o=.01;0>n&&(o=-o);for(var p=0;g>p;++p){var q=3*p,r=3*a[p];i[0]=c[r],i[1]=c[r+1],i[2]=c[r+2],l[0]=d[r],l[1]=d[r+1],l[2]=d[r+2],j.transformMat3(l,l,f),j.normalize(l,l),j.transformMat4(i,i,e),j.scaleAndAdd(i,i,l,o),h[q]=i[0],h[q+1]=i[1],h[q+2]=i[2],j.scaleAndAdd(i,i,l,n),q+=m,h[q]=i[0],h[q+1]=i[1],h[q+2]=i[2]}return h},smoothBorder:function(a,b){for(var c=2*b.length,d=new Uint32Array(a.getNbFaces()-c),e=0,f=d.length;f>e;++e)d[e]=c+e;var g=a.expandsVertices(a.getVerticesFromFaces(d),1),i=new h;i.setToolMesh(a),i.smooth(g,1),i.smooth(g,1),i.smooth(g,1)},extract:function(){var a=this.getMesh(),b=.5,c=this.filterMaskedVertices(-(1/0),b);if(0!==c.length){var d=a.getFacesFromVertices(c);c=a.getVerticesFromFaces(d);var e=this.extractFaces(d,c,b),f=this.extractVertices(c),g=new i(a.getGL());g.setVertices(f),g.setFaces(e),g.initColorsAndMaterials(),g.allocateArrays(),g.initTopology(),0!==this._thickness&&this.smoothBorder(g,d),g.updateGeometry(),g.updateDuplicateColorsAndMaterials(),g.copyRenderConfig(a),g.initRender();var h=this._main;h.addNewMesh(g),h.setMesh(a)}}},e.makeProxy(f,l),c.exports=l}),define("editing/tools/LocalScale",["require","exports","module","misc/Utils","editing/tools/SculptBase"],function(a,b,c){"use strict";var d=a("misc/Utils"),e=a("editing/tools/SculptBase"),f=function(a){e.call(this,a),this._radius=50,this._culling=!1,this._idAlpha=0};f.prototype={startSculpt:function(){var a=this._main;if(a.getSculpt().getSymmetry()){var b=a.getPickingSymmetry();b.intersectionMouseMesh(),b.setLocalRadius2(a.getPicking().getLocalRadius2())}},sculptStroke:function(){var a=this._main,b=a._mouseX-a._lastMouseX,c=a.getPicking(),d=c.getLocalRadius2();if(c.pickVerticesInSphere(d),this.stroke(c,b),a.getSculpt().getSymmetry()){var e=a.getPickingSymmetry();e.getMesh()&&(e.pickVerticesInSphere(d),this.stroke(e,b))}this.updateRender()},stroke:function(a,b){var c=a.getPickedVertices();this._states.pushVertices(c),c=this.dynamicTopology(a),this._culling&&(c=this.getFrontVertices(c,a.getEyeDirection())),a.updateAlpha(!1),a.setIdAlpha(this._idAlpha),this.scale(c,a.getIntersectionPoint(),a.getLocalRadius2(),b,a);var d=this.getMesh();d.updateGeometry(d.getFacesFromVertices(c),c)},scale:function(a,b,c,d,e){for(var f=this.getMesh(),g=f.getVertices(),h=f.getMaterials(),i=.01*d,j=Math.sqrt(c),k=b[0],l=b[1],m=b[2],n=0,o=a.length;o>n;++n){var p=3*a[n],q=g[p],r=g[p+1],s=g[p+2],t=q-k,u=r-l,v=s-m,w=Math.sqrt(t*t+u*u+v*v)/j,x=w*w;x=3*x*x-4*x*w+1,x*=i*h[p+2]*e.getAlpha(q,r,s),g[p]=q+t*x,g[p+1]=r+u*x,g[p+2]=s+v*x}}},d.makeProxy(e,f),c.exports=f}),define("editing/HoleFilling",["require","exports","module","mesh/Mesh"],function(a,b,c){"use strict";var d=a("mesh/Mesh"),e=function(a,b){this.previous=null,this.next=null,this.v1=a,this.v2=b},f=function(a){if(!(a.length<=2)){var b=a.length,c=a[0].v1,d=a[0].v2,e=a[0],f=e;a[0]=a[--b];for(var g=0;b>g;){var h=a[g];if(h.v1===d){if(h.previous=f,f.next=f=h,d=a[g].v2,a[g]=a[--b],d===c)break;g=0}else g++}if(a.length=b,d===c)return e.previous=f,f.next=e,e}},g=function(a){for(var b=a.getEdges(),c=a.getFaces(),d=a.getFaceEdges(),g=[],h=0,i=a.getNbFaces();i>h;++h){var j=4*h,k=d[j+3];1===b[d[j]]&&g.push(new e(c[j],c[j+1])),1===b[d[j+1]]&&g.push(new e(c[j+1],c[j+2])),1===b[d[j+2]]&&g.push(new e(c[j+2],c[0>k?j:j+3])),k>=0&&1===b[k]&&g.push(new e(c[j+3],c[j]))}for(var l=[];;){var m=f(g);if(!m)break;l.push(m)}return l},h=function(a,b,c,d,e,f){var g=a.getVertices(),h=a.getColors(),i=a.getMaterials(),j=a.getNbVertices()+d.length/3,k=b,l=0,m=0,n=0,o=0,p=0,q=0,r=0,s=0,t=0,u=0;do{var v=k.next,w=k.v1,x=k.v2,y=v.v2;c.push(w,x,j,-1),w*=3,x*=3,y*=3,u++,l+=g[w],m+=g[w+1],n+=g[w+2],o+=h[w],p+=h[w+1],q+=h[w+2],r+=i[w],s+=i[w+1],t+=i[w+2];var z=g[x],A=g[x+1],B=g[x+2],C=g[w]-z,D=g[w+1]-A,E=g[w+2]-B,F=g[y]-z,G=g[y+1]-A,H=g[y+2]-B,I=C*C+D*D+E*E,J=F*F+G*G+H*H;k.angle=Math.acos((C*F+D*G+E*H)/Math.sqrt(I*J)),k=v}while(k!==b);d.push(l/u,m/u,n/u),e.push(o/u,p/u,q/u),f.push(r/u,s/u,t/u)},i={};i.createMesh=function(a,b,c,e,f){var g=new d;return g.setID(a.getID()),g.setVertices(b),e&&g.setColors(e),f&&g.setMaterials(f),g.setFaces(c),g.setTransformData(a.getTransformData()),g.setRender(a.getRender()),g.init(),g},i.closeHoles=function(a){var b=g(a);if(0===b.length)return a;for(var c=[],d=[],e=[],f=[],j=0,k=b.length;k>j;++j)h(a,b[j],c,d,e,f);var l=3*a.getNbVertices(),m=l+d.length,n=new Float32Array(m);n.set(a.getVertices());var o=new Float32Array(m);o.set(a.getColors());var p=new Float32Array(m);p.set(a.getMaterials()),m>l&&(n.set(d,l),o.set(e,l),p.set(f,l));var q=new Int32Array(4*a.getNbFaces()+c.length);return q.set(a.getFaces()),c.length>0&&q.set(c,4*a.getNbFaces()),i.createMesh(a,n,q,o,p)},i.createClosedMesh=function(a){var b=i.closeHoles(a);return b===a&&(b=i.createMesh(a,a.getVertices().slice(),a.getFaces().slice(),a.getColors().slice(),a.getMaterials().slice())),b},c.exports=i}),define("editing/SurfaceNets",["require","exports","module"],function(a,b,c){"use strict";var d={};d.BLOCK=!1;var e=function(){for(var a=new Int32Array(24),b=0,c=0;8>c;++c)for(var d=1;4>=d;d<<=1){var e=c^d;e>=c&&(a[b++]=c,a[b++]=e)}return a},f=function(a){for(var b=new Int32Array(256),c=0;256>c;++c){for(var d=0,e=0;24>e;e+=2){var f=!!(c&1<<a[e]),g=!!(c&1<<a[e+1]);d|=f!==g?1<<(e>>1):0}b[c]=d}return b},g=e(),h=f(g),i=function(a,b,c,d,e,f,g,h){for(var i=0,j=0,k=0,l=0,m=0,n=0,o=0,p=0,q=0,r=c[0],s=c[0]*c[1],t=0;2>t;++t)for(var u=0;2>u;++u)for(var v=0;2>v;++v){var w=d+v+u*r+t*s,x=3*w,y=a[w];b[q]=y,p|=0>y?1<<q:0,q++,y!==1/0&&(y=Math.min(1/Math.abs(y),1e15),o+=y,i+=e[x]*y,j+=e[x+1]*y,k+=e[x+2]*y,l+=f[x]*y,m+=f[x+1]*y,n+=f[x+2]*y)}return o>0&&0!==p&&255!==p&&(o=1/o,g.push(i*o,j*o,k*o),h.push(l*o,m*o,n*o)),p},j=[0,0,0],k=function(a,b,c,e,f,g,h){j[0]=j[1]=j[2]=0;for(var i=0,k=0;12>k;++k)if(a&1<<k&&(++i,!d.BLOCK)){var l=b[k<<1],m=b[(k<<1)+1],n=c[l],o=n-c[m];if(!(Math.abs(o)<1e-7)){o=n/o;for(var p=0,q=1;3>p;++p,q<<=1){var r=l&q;r!==(m&q)?j[p]+=r?1-o:o:j[p]+=r?1:0}}}for(var s=1/i,t=0;3>t;++t)j[t]=f[t]*(e[t]+s*j[t])+g[t];h.push(j[0],j[1],j[2])},l=function(a,b,c,d,e,f,g){for(var h=0;3>h;++h)if(a&1<<h){var i=(h+1)%3,j=(h+2)%3;if(0!==f[i]&&0!==f[j]){var k=d[i],l=d[j];1&b?g.push(c[e],c[e-k],c[e-k-l],c[e-l]):g.push(c[e],c[e-l],c[e-k-l],c[e-k])}}};d.computeSurface=function(a,b){var c=a.dims,d=a.colors,e=a.materials,f=a.distanceField;b||(b=[[0,0,0],c]);for(var j=[0,0,0],m=[0,0,0],n=0;3>n;++n)j[n]=(b[1][n]-b[0][n])/c[n],m[n]=b[0][n];var o=[],p=[],q=[],r=[],s=0,t=new Int32Array(3),u=new Int32Array([1,c[0]+1,(c[0]+1)*(c[1]+1)]),v=new Float32Array(8),w=1,x=new Int32Array(2*u[2]);for(t[2]=0;t[2]<c[2]-1;++t[2],s+=c[0],w^=1,u[2]=-u[2]){var y=1+(c[0]+1)*(1+w*(c[1]+1));for(t[1]=0;t[1]<c[1]-1;++t[1],++s,y+=2)for(t[0]=0;t[0]<c[0]-1;++t[0],++s,++y){var z=i(f,v,c,s,d,e,p,q);if(0!==z&&255!==z){var A=h[z];x[y]=o.length/3,k(A,g,v,t,j,m,o),l(A,z,x,u,y,t,r)}}}return{colors:new Float32Array(p),materials:new Float32Array(q),vertices:new Float32Array(o),faces:new Int32Array(r)}},c.exports=d}),define("editing/Remesh",["require","exports","module","lib/glMatrix","editing/HoleFilling","editing/SurfaceNets","math3d/Geometry","mesh/Mesh","misc/Utils"],function(a,b,c){"use strict";var d=a("lib/glMatrix"),e=a("editing/HoleFilling"),f=a("editing/SurfaceNets"),g=a("math3d/Geometry"),h=a("mesh/Mesh"),i=a("misc/Utils"),j=d.vec3,k={};k.RESOLUTION=150,k.BLOCK=!1;var l=function(a,b){var c=a.dims,d=c[0],e=c[1],f=d*e,g=a.crossedEdges,h=a.distanceField,i=h.length,j=new Uint8Array(i),k=new Int32Array(i);k[0]=0;for(var l=1,m=[-1,1,-d,d,-f,f],n=[0,0,1,1,2,2],o=m.length,p=0,q=0;l>0;){var r=k[--l],s=h[r];if(b>s)for(p=0;o>p;++p){var t=m[p];q=r+t,q>=i||0>q||1!==j[q]&&h[q]!==1/0&&0===g[3*(t>=0?r:q)+n[p]]&&(j[q]=1,k[l++]=q)}else for(p=0;o>p;++p)q=r+m[p],q>=i||0>q||1!==j[q]&&(j[q]=1,k[l++]=q)}for(var u=0;i>u;++u)0===j[u]&&(h[u]=-h[u])},m=function(a,b,c,d){for(var e=1/d,f=c[0][0],h=c[1][0],i=c[2][0],j=b.dims[0],k=b.dims[1],l=b.distanceField,m=b.crossedEdges,n=b.colors,o=b.materials,p=a.getTriangles(),q=a.getVertices(),r=a.getColors(),s=a.getMaterials(),t=a.getNbTriangles(),u=[0,0,0],v=[0,0,0],w=[0,0,0],x=[0,0,0],y=[0,0,0],z=[0,0,0],A=[0,0,0,0],B=j*k,C=[[1,0,0],[0,1,0],[0,0,1]],D=1/3,E=0;t>E;++E)for(var F=3*E,G=3*p[F],H=3*p[F+1],I=3*p[F+2],J=u[0]=q[G],K=u[1]=q[G+1],L=u[2]=q[G+2],M=v[0]=q[H],N=v[1]=q[H+1],O=v[2]=q[H+2],P=w[0]=q[I],Q=w[1]=q[I+1],R=w[2]=q[I+2],S=(r[G]+r[H]+r[I])*D,T=(r[G+1]+r[H+1]+r[I+1])*D,U=(r[G+2]+r[H+2]+r[I+2])*D,V=(s[G]+s[H]+s[I])*D,W=(s[G+1]+s[H+1]+s[I+1])*D,X=(s[G+2]+s[H+2]+s[I+2])*D,Y=M>J?P>J?J:P:P>M?M:P,Z=J>M?J>P?J:P:M>P?M:P,$=N>K?Q>K?K:Q:Q>N?N:Q,_=K>N?K>Q?K:Q:N>Q?N:Q,aa=O>L?R>L?L:R:R>O?O:R,ba=L>O?L>R?L:R:O>R?O:R,ca=x[0]=M-J,da=x[1]=N-K,ea=x[2]=O-L,fa=y[0]=P-J,ga=y[1]=Q-K,ha=y[2]=R-L,ia=ca*ca+da*da+ea*ea,ja=ca*fa+da*ga+ea*ha,ka=fa*fa+ga*ga+ha*ha,la=Math.floor((Y-f)*e),ma=Math.floor(($-h)*e),na=Math.floor((aa-i)*e),oa=Math.ceil((Z-f)*e),pa=Math.ceil((_-h)*e),qa=Math.ceil((ba-i)*e),ra=na;qa>=ra;++ra)for(var sa=ma;pa>=sa;++sa)for(var ta=la;oa>=ta;++ta){var ua=f+ta*d,va=h+sa*d,wa=i+ra*d,xa=ta+sa*j+ra*B;z[0]=ua,z[1]=va,z[2]=wa;var ya=g.distance2PointTriangleEdges(z,x,y,u,ia,ja,ka,A);if(ya=Math.sqrt(ya),ya<l[xa]){l[xa]=ya;var za=3*xa;n[za]=S,n[za+1]=T,n[za+2]=U,o[za]=V,o[za+1]=W,o[za+2]=X}if(!(ya>d))for(var Aa=0;3>Aa;++Aa){var Ba=A[Aa]-z[Aa];if(!(0>Ba||Ba>d)){var Ca=3*xa+Aa;if(1!==m[Ca]){var Da=g.intersectionRayTriangleEdges(z,C[Aa],x,y,u);0>Da||Da>d||(m[Ca]=1)}}}}},n=function(a,b){for(var c=1+Math.ceil((a[0][1]-a[0][0])/b),d=1+Math.ceil((a[1][1]-a[1][0])/b),e=1+Math.ceil((a[2][1]-a[2][0])/b),f=c*d*e,g=i.getMemory(31*f),h=new Float32Array(g,0,f),j=new Float32Array(g,4*f,3*f),k=new Float32Array(g,16*f,3*f),l=new Uint8Array(g,28*f,3*f),m=0;f>m;++m)h[m]=1/0;for(var n=0,o=3*f;o>n;++n)l[n]=0;for(var p=0,q=3*f;q>p;++p)j[p]=k[p]=-1;var r={};return r.dims=[c,d,e],r.crossedEdges=l,r.distanceField=h,r.colors=j,r.materials=k,r},o=function(a,b,c,d,e){var f=new h(a.getGL());return f.setID(a.getID()),f.setVertices(b),d&&f.setColors(d),e&&f.setMaterials(e),f.setFaces(c),f.init(),f.setRender(a.getRender()),a.getRender()._mesh=f,f.initRender(),f},p=function(a){for(var b=[1/0,1/0,1/0,-(1/0),-(1/0),-(1/0)],c=[0,0,0],d=0,f=a.length;f>d;++d){var g=a[d];g.isUsingTexCoords()&&g.setShaderName("MATCAP");var h=g.getMatrix();g=a[d]=e.createClosedMesh(g);for(var i=g.getVertices(),k=0,l=g.getNbVertices();l>k;++k){var m=3*k;c[0]=i[m],c[1]=i[m+1],c[2]=i[m+2],j.transformMat4(c,c,h);var n=i[m]=c[0],o=i[m+1]=c[1],p=i[m+2]=c[2];n<b[0]&&(b[0]=n),o<b[1]&&(b[1]=o),p<b[2]&&(b[2]=p),n>b[3]&&(b[3]=n),o>b[4]&&(b[4]=o),p>b[5]&&(b[5]=p)}}return b};k.remesh=function(a,b){console.time("remesh total"),console.time("1. initMeshes"),a=a.slice();var c=p(a);console.timeEnd("1. initMeshes"),console.time("2. voxelization");for(var d=Math.max(c[3]-c[0],c[4]-c[1],c[5]-c[2])/k.RESOLUTION,e=2.5*d,g=1.5*d,h=[[c[0]-e,c[3]+g],[c[1]-e,c[4]+g],[c[2]-e,c[5]+g]],i=n(h,d),j=0,q=a.length;q>j;++j)m(a[j],i,h,d);console.timeEnd("2. voxelization"),console.time("3. flood"),l(i,d),console.timeEnd("3. flood"),console.time("4. surfaceNet");var r=[h[0][0],h[1][0],h[2][0]],s=[h[0][1]+g,h[1][1]+g,h[2][1]+g];f.BLOCK=k.BLOCK;var t=f.computeSurface(i,[r,s]);console.timeEnd("4. surfaceNet"),console.time("5. createMesh");var u=o(b,t.vertices,t.faces,t.colors,t.materials);return console.time("5. createMesh"),console.timeEnd("remesh total"),console.log("\n"),u},k.mergeArrays=function(a,b){var c=0,d=0,e=0,f=0,g=a.length,h=0,i=0;for(h=0;g>h;++h)c+=a[h].getNbVertices(),d+=a[h].getNbFaces(),e+=a[h].getNbQuads(),f+=a[h].getNbTriangles();var k=b.vertices=void 0!==b.vertices?new Float32Array(3*c):null,l=b.colors=void 0!==b.colors?new Float32Array(3*c):null,m=b.materials=void 0!==b.materials?new Int32Array(4*d):null,n=b.faces=void 0!==b.faces?new Int32Array(4*d):null,o=[0,0,0],p=0,q=0,r=0;for(h=0;g>h;++h){for(var s=a[h],t=s.getVertices(),u=s.getColors(),v=s.getMaterials(),w=s.getFaces(),x=s.getNbVertices(),y=s.getNbFaces(),z=s.getMatrix(),A=0;x>A;++A)i=3*A,o[0]=t[i],o[1]=t[i+1],o[2]=t[i+2],j.transformMat4(o,o,z),k[p+i]=o[0],k[p+i+1]=o[1],k[p+i+2]=o[2],l&&(l[p+i]=u[i],l[p+i+1]=u[i+1],l[p+i+2]=u[i+2]),m&&(m[p+i]=v[i],m[p+i+1]=v[i+1],m[p+i+2]=v[i+2]);for(p+=3*x,A=0;y>A;++A)i=4*A,n[q+i]=w[i]+r,n[q+i+1]=w[i+1]+r,n[q+i+2]=w[i+2]+r,n[q+i+3]=w[i+3]>=0?w[i+3]+r:-1;r+=x,q=4*y}},k.mergeMeshes=function(a,b){var c={vertices:null,colors:null,materials:null,faces:null};return k.mergeArrays(a,c),o(b,c.vertices,c.faces,c.colors,c.materials)},c.exports=k}),define("drawables/Primitives",["require","exports","module","lib/glMatrix","mesh/Mesh","editing/Remesh"],function(a,b,c){"use strict";var d=a("lib/glMatrix"),e=a("mesh/Mesh"),f=a("editing/Remesh"),g=d.mat4,h={},i=function(a,b,c,d,e,f,g,h,i){a=void 0!==a?a:-.5,b=void 0!==b?b:0,c=void 0!==c?c:-.5,d=void 0!==d?d:1,e=void 0!==e?e:0,f=void 0!==f?f:0,g=void 0!==g?g:0,h=void 0!==h?h:0,i=void 0!==i?i:1;var j=new Float32Array(4);j[0]=0,j[1]=1,j[2]=2,j[3]=3;var k=new Float32Array(12);return k[0]=a,k[1]=b,k[2]=c,k[3]=a+d,k[4]=b+e,k[5]=c+f,k[6]=a+d+g,k[7]=b+e+h,k[8]=c+f+i,k[9]=a+g,k[10]=b+h,k[11]=c+i,{faces:j,vertices:k}},j=function(a){a=a||1;var b=new Float32Array(24);b[1]=b[2]=b[4]=b[6]=b[7]=b[9]=b[10]=b[11]=b[14]=b[18]=b[21]=b[23]=.5*-a,b[0]=b[3]=b[5]=b[8]=b[12]=b[13]=b[15]=b[16]=b[17]=b[19]=b[20]=b[22]=.5*a;var c=new Float32Array(28);c[0]=c[6]=c[8]=c[10]=c[11]=c[13]=c[16]=c[23]=c[25]=.5,c[1]=c[3]=1,c[2]=c[4]=c[9]=c[12]=c[14]=c[15]=c[18]=.25,c[5]=c[7]=c[21]=c[24]=c[26]=c[27]=.75,c[17]=c[19]=c[20]=c[22]=0;var d=new Int32Array(24),e=new Int32Array(24);return d[0]=d[8]=d[21]=e[0]=0,d[1]=d[11]=d[12]=e[1]=1,d[2]=d[15]=d[16]=e[2]=e[15]=e[16]=2,d[3]=d[19]=d[22]=e[3]=e[19]=e[22]=3,d[4]=d[9]=d[20]=e[4]=e[9]=4,d[7]=d[10]=d[13]=e[5]=e[18]=e[23]=5,
d[6]=d[14]=d[17]=e[6]=e[14]=e[17]=6,d[5]=d[18]=d[23]=e[7]=e[10]=7,e[8]=8,e[11]=9,e[12]=10,e[13]=11,e[20]=12,e[21]=13,{vertices:b,uv:c,faces:d,facesUV:e}},k=function(a,b,c,d,e,f,g){a=void 0!==a?a:.5,b=void 0!==b?b:.5,c=c||2,d=d||64,e=e||64,f=void 0!==f?f:!0,g=void 0!==g?g:!0,f=f,g=g;var h=f&&0===a,i=g&&0===b,j=.5*c,k=(e+1)*d,l=e*d;f&&(k+=1,l+=d),g&&(k+=1,l+=d),(h||i)&&(k-=d,l-=d);var m=new Float32Array(3*k),n=new Int32Array(4*l),o=0,p=0,q=0,r=0,s=h?1:0,t=i?e-1:e;for(q=s;t>=q;q++){var u=q/e,v=u*(b-a)+a;for(r=0;d>r;r++){var w=2*Math.PI*r/d;p=3*o++,m[p]=v*Math.sin(w),m[p+1]=-u*c+j,m[p+2]=v*Math.cos(w)}}for(o=0,r=0;d>r;r++){var x=r===d-1?0:r+1;for(q=s;t>q;q++)p=4*o++,n[p]=d*q+r,n[p+1]=d*(q+1)+r,n[p+2]=d*(q+1)+x,n[p+3]=d*q+x}var y;if(f)for(y=(g?m.length-6:m.length-3)/3,m[3*y+1]=j,r=0;d>r;r++)p=4*o++,n[p]=r,n[p+1]=r===d-1?0:r+1,n[p+2]=y,n[p+3]=-1;if(g){y=(m.length-3)/3,m[3*y+1]=-j,h&&--q;var z=d*q;for(r=0;d>r;r++)p=4*o++,n[p]=r===d-1?z:z+r+1,n[p+1]=z+r,n[p+2]=y,n[p+3]=-1}return{vertices:m,faces:n}},l=function(a,b,c,d,e){a=a||.5,b=b||.1,d=d||32,e=e||128,c=c||2*Math.PI;var f=2*Math.PI-c<.01,g=d*e,h=g;f||(g+=2,h+=d);var i=f?e:e-1,j=new Float32Array(3*g),k=new Int32Array(4*h),l=0,m=0,n=0,o=0;for(n=0;e>n;++n)for(o=0;d>o;++o){var p=n/i*c,q=o/d*Math.PI*2;m=3*l++,j[m]=(a+b*Math.cos(q))*Math.cos(p),j[m+1]=b*Math.sin(q),j[m+2]=(a+b*Math.cos(q))*Math.sin(p)}for(l=0,n=0;i>n;++n){var r=n===e-1?0:n+1;for(o=0;d>o;++o){m=4*l++,k[m]=d*n+o;var s=o===d-1?0:o+1;k[m+1]=d*n+s,k[m+2]=d*r+s,k[m+3]=d*r+o}}if(!f){var t=(j.length-6)/3;for(j[3*t]=a,o=0;d>o;o++)m=4*l++,k[m]=t,k[m+1]=o===d-1?0:o+1,k[m+2]=o,k[m+3]=-1;++t,j[3*t]=a*Math.cos(c),j[3*t+2]=a*Math.sin(c);var u=d*n;for(o=0;d>o;o++)m=4*l++,k[m]=t,k[m+1]=u+o,k[m+2]=o===d-1?u:u+o+1,k[m+3]=-1}return{vertices:j,faces:k}},m=function(a,b,c,d,e,f,g,h,i,j,k){a=void 0!==a?a:-.5,b=void 0!==b?b:0,c=void 0!==c?c:-.5,d=void 0!==d?d:1,e=void 0!==e?e:0,f=void 0!==f?f:0,g=void 0!==g?g:0,h=void 0!==h?h:0,i=void 0!==i?i:1,j=void 0!==j?j:20,k=void 0!==k?k:j,j+=2,k+=2;var l=new Float32Array(2*(j+k)*3),m=0,n=0,o=d/(j-1),p=e/(j-1),q=f/(j-1),r=a+d+g,s=b+e+h,t=c+f+i;for(m=0;j>m;++m)n=6*m,l[n]=a+o*m,l[n+1]=b+p*m,l[n+2]=c+q*m,l[n+3]=r-o*(j-m-1),l[n+4]=s-p*(j-m-1),l[n+5]=t-q*(j-m-1);for(o=g/(k-1),p=h/(k-1),q=i/(k-1),m=0;k>m;++m)n=6*(j+m),l[n]=a+o*m,l[n+1]=b+p*m,l[n+2]=c+q*m,l[n+3]=r-o*(k-m-1),l[n+4]=s-p*(k-m-1),l[n+5]=t-q*(k-m-1);return{vertices:l}},n=function(a,b){var c=new e(a);return c.setVertices(b.vertices),b.faces&&c.setFaces(b.faces),b.uv&&b.facesUV&&c.initTexCoordsDataFromOBJData(b.uv,b.facesUV),c.init(),a&&c.initRender(),c},o=Array.prototype.slice;h.createGrid=function(a){var b=n(a,m.apply(this,o.call(arguments,1)));return a&&(b.setMode(a.LINES),b.setUseDrawArrays(!0),b.setAlreadyDrawArrays()),b},h.createCube=function(a){return n(a,j.apply(this,o.call(arguments,1)))},h.createCylinder=function(a){return n(a,k.apply(this,o.call(arguments,1)))},h.createTorus=function(a){return n(a,l.apply(this,o.call(arguments,1)))},h.createPlane=function(a){return n(a,i.apply(this,o.call(arguments,1)))},h.createArrow=function(a,b,c,d,e,h,i){b=b||.5,c=c||2,h=h||4,i=i||1,d=d||5,e=e||.2;var j=n(a,k(b,b,c,h,i)),l=n(a,k(0,b*d,c*e,h,i));g.translate(l.getMatrix(),l.getMatrix(),[0,.5*c,0]);var m={vertices:null,faces:null};return f.mergeArrays([j,l],m),n(a,m)},h.createLine2D=function(a,b,c,d,e){var f=n(a,{vertices:new Float32Array([b||0,c||0,0,d||0,e||0,0])});return a&&(f.setMode(a.LINES),f.setUseDrawArrays(!0),f.setAlreadyDrawArrays()),f},c.exports=h}),define("editing/Gizmo",["require","exports","module","lib/glMatrix","drawables/Primitives"],function(a,b,c){"use strict";var d=a("lib/glMatrix"),e=a("drawables/Primitives"),f=d.vec2,g=d.vec3,h=d.mat4,i=d.quat,j=g.fromValues(.7,.2,.2),k=g.fromValues(.2,.7,.2),l=g.fromValues(.2,.2,.7),m=g.fromValues(.4,.4,.4),n=g.fromValues(.8,.4,.2),o=.08,p=2.5,q=6,r=.25,s=.02,t=5*s,u=1.5,v=1.3*u,w=.35,x=1.2*w,y=function(a,b){return{_finalMatrix:h.create(),_baseMatrix:h.create(),_color:g.create(),_colorSelect:g.fromValues(1,1,0),_drawGeo:null,_pickGeo:null,_isSelected:!1,_type:void 0!==a?a:-1,_nbAxis:void 0!==b?b:-1,_lastInter:[0,0,0],updateMatrix:function(){h.copy(this._drawGeo.getMatrix(),this._finalMatrix),h.copy(this._pickGeo.getMatrix(),this._finalMatrix)},updateFinalMatrix:function(a){h.mul(this._finalMatrix,a,this._baseMatrix)}}},z=function(a){this._main=a,this._gl=a._gl,this._activatedType=z.TRANS_XYZ|z.ROT_XYZ|z.PLANE_XYZ|z.SCALE_XYZW|z.ROT_W,this._transX=y(z.TRANS_X,0),this._transY=y(z.TRANS_Y,1),this._transZ=y(z.TRANS_Z,2),this._planeX=y(z.PLANE_X,0),this._planeY=y(z.PLANE_Y,1),this._planeZ=y(z.PLANE_Z,2),this._scaleX=y(z.SCALE_X,0),this._scaleY=y(z.SCALE_Y,1),this._scaleZ=y(z.SCALE_Z,2),this._scaleW=y(z.SCALE_W),this._rotX=y(z.ROT_X,0),this._rotY=y(z.ROT_Y,1),this._rotZ=y(z.ROT_Z,2),this._rotW=y(z.ROT_W),this._lineHelper=e.createLine2D(this._gl),this._lineHelper.setShaderName("FLAT"),this._lastDistToEye=0,this._isEditing=!1,this._selected=null,this._pickables=[],this._editLineOrigin=[0,0,0],this._editLineDirection=[0,0,0],this._editOffset=[0,0,0],this._editLocal=h.create(),this._editTrans=h.create(),this._editScaleRot=h.create(),this._editLocalInv=h.create(),this._editTransInv=h.create(),this._editScaleRotInv=h.create(),this._initTranslate(),this._initRotate(),this._initScale(),this._initPickables()},A=z.TRANS_X=1,B=z.TRANS_Y=2,C=z.TRANS_Z=4,D=z.ROT_X=8,E=z.ROT_Y=16,F=z.ROT_Z=32,G=z.ROT_W=64,H=z.PLANE_X=128,I=z.PLANE_Y=256,J=z.PLANE_Z=512,K=z.SCALE_X=1024,L=z.SCALE_Y=2048,M=z.SCALE_Z=4096,N=z.SCALE_W=8192,O=z.TRANS_XYZ=A|B|C,P=z.ROT_XYZ=D|E|F,Q=z.PLANE_XYZ=H|I|J,R=z.SCALE_XYZW=K|L|M|N;z.prototype={setActivatedType:function(a){this._activatedType=a,this._initPickables()},_initPickables:function(){var a=this._pickables;a.length=0;var b=this._activatedType;b&A&&a.push(this._transX._pickGeo),b&B&&a.push(this._transY._pickGeo),b&C&&a.push(this._transZ._pickGeo),b&H&&a.push(this._planeX._pickGeo),b&I&&a.push(this._planeY._pickGeo),b&J&&a.push(this._planeZ._pickGeo),b&D&&a.push(this._rotX._pickGeo),b&E&&a.push(this._rotY._pickGeo),b&F&&a.push(this._rotZ._pickGeo),b&K&&a.push(this._scaleX._pickGeo),b&L&&a.push(this._scaleY._pickGeo),b&M&&a.push(this._scaleZ._pickGeo),b&N&&a.push(this._scaleW._pickGeo)},_createArrow:function(a,b,c){var d=a._baseMatrix;h.rotate(d,d,.5*Math.PI,b),h.translate(d,d,[0,.5*p,0]),g.copy(a._color,c),a._pickGeo=e.createArrow(this._gl,t,p,.4*q),a._pickGeo._gizmo=a,a._drawGeo=e.createArrow(this._gl,s,p,q,r),a._drawGeo.setShaderName("FLAT")},_createPlane:function(a,b,c,d,f,h,i,j){g.copy(a._color,b),a._pickGeo=e.createPlane(this._gl,0,0,0,c,d,f,h,i,j),a._pickGeo._gizmo=a,a._drawGeo=e.createPlane(this._gl,0,0,0,c,d,f,h,i,j),a._drawGeo.setShaderName("FLAT")},_initTranslate:function(){var a=[0,0,0];this._createArrow(this._transX,g.set(a,0,0,-1),j),this._createArrow(this._transY,g.set(a,0,1,0),k),this._createArrow(this._transZ,g.set(a,1,0,0),l);var b=.2*p;this._createPlane(this._planeX,j,0,b,0,0,0,b),this._createPlane(this._planeY,k,b,0,0,0,0,b),this._createPlane(this._planeZ,l,b,0,0,0,b,0)},_createCircle:function(a,b,c,d,f){d=d||u,f=f||1,g.copy(a._color,c),a._pickGeo=e.createTorus(this._gl,d,t*f,b,6,64),a._pickGeo._gizmo=a,a._drawGeo=e.createTorus(this._gl,d,s*f,b,6,64),a._drawGeo.setShaderName("FLAT")},_initRotate:function(){this._createCircle(this._rotX,Math.PI,j),this._createCircle(this._rotY,Math.PI,k),this._createCircle(this._rotZ,Math.PI,l),this._createCircle(this._rotW,2*Math.PI,m)},_createCube:function(a,b,c){var d=a._baseMatrix;h.rotate(d,d,.5*Math.PI,b),h.translate(d,d,[0,u,0]),g.copy(a._color,c),a._pickGeo=e.createCube(this._gl,x),a._pickGeo._gizmo=a,a._drawGeo=e.createCube(this._gl,w),a._drawGeo.setShaderName("FLAT")},_initScale:function(){var a=[0,0,0];this._createCube(this._scaleX,g.set(a,0,0,-1),j),this._createCube(this._scaleY,g.set(a,0,1,0),k),this._createCube(this._scaleZ,g.set(a,1,0,0),l),this._createCircle(this._scaleW,2*Math.PI,n,v,2)},_updateArcRotation:function(){var a=i.create();return function(b){a[0]=b[2],a[1]=0,a[2]=-b[0],a[3]=1+b[1],i.normalize(a,a),h.fromQuat(this._rotW._baseMatrix,a),h.fromQuat(this._scaleW._baseMatrix,a),i.rotateZ(a,i.identity(a),.5*Math.PI),i.rotateY(a,a,Math.atan2(-b[1],-b[2])),h.fromQuat(this._rotX._baseMatrix,a),i.rotateY(a,i.identity(a),Math.atan2(-b[0],-b[2])),h.fromQuat(this._rotY._baseMatrix,a),i.rotateX(a,i.identity(a),.5*Math.PI),i.rotateY(a,a,Math.atan2(-b[0],b[1])),h.fromQuat(this._rotZ._baseMatrix,a)}}(),_computeCenterGizmo:function(a){var b=this._main.getMesh();return a=a||[0,0,0],b&&(g.copy(a,b.getCenter()),g.transformMat4(a,a,b.getEditMatrix()),g.transformMat4(a,a,b.getMatrix())),a},_updateMatrices:function(){var a=this._main.getCamera(),b=this._computeCenterGizmo(),c=a.computePosition();this._lastDistToEye=this._isEditing?this._lastDistToEye:g.dist(c,b);var d=this._lastDistToEye*o/a.getConstantScreen(),e=h.create();h.translate(e,e,b),h.scale(e,e,[d,d,d]),this._updateArcRotation(g.normalize(c,g.sub(c,b,c))),this._transX.updateFinalMatrix(e),this._transY.updateFinalMatrix(e),this._transZ.updateFinalMatrix(e),this._planeX.updateFinalMatrix(e),this._planeY.updateFinalMatrix(e),this._planeZ.updateFinalMatrix(e),this._rotX.updateFinalMatrix(e),this._rotY.updateFinalMatrix(e),this._rotZ.updateFinalMatrix(e),this._rotW.updateFinalMatrix(e),this._scaleX.updateFinalMatrix(e),this._scaleY.updateFinalMatrix(e),this._scaleZ.updateFinalMatrix(e),this._scaleW.updateFinalMatrix(e)},_drawGizmo:function(a){a.updateMatrix();var b=a._drawGeo;b.setFlatColor(a._isSelected?a._colorSelect:a._color),b.updateMatrices(this._main.getCamera()),b.render(this._main)},_updateLineHelper:function(a,b,c,d){var e=this._lineHelper.getVertices(),f=this._main,g=f.getCanvasWidth(),h=f.getCanvasHeight();e[0]=a/g*2-1,e[1]=(h-b)/h*2-1,e[3]=c/g*2-1,e[4]=(h-d)/h*2-1,this._lineHelper.updateVertexBuffer()},_saveEditMatrices:function(){h.copy(this._editLocal,this._main.getMesh().getMatrix());var a=this._computeCenterGizmo();h.translate(this._editTrans,h.identity(this._editTrans),a),h.copy(this._editScaleRot,this._editLocal),this._editScaleRot[12]=this._editScaleRot[13]=this._editScaleRot[14]=0,h.invert(this._editLocalInv,this._editLocal),h.invert(this._editTransInv,this._editTrans),h.invert(this._editScaleRotInv,this._editScaleRot)},_startRotateEdit:function(){var a=this._main,b=a.getCamera(),c=[0,0,0];this._computeCenterGizmo(c),g.copy(c,b.project(c));var d=this._editLineDirection,e=0===this._selected._nbAxis?-1:1,h=this._selected._lastInter;g.set(d,-e*h[2],-e*h[1],e*h[0]),g.transformMat4(d,d,this._selected._finalMatrix),g.copy(d,b.project(d)),f.normalize(d,f.sub(d,d,c)),f.set(this._editLineOrigin,a._mouseX,a._mouseY)},_startTranslateEdit:function(){var a=this._main,b=a.getCamera(),c=this._editLineOrigin,d=this._editLineDirection;this._computeCenterGizmo(c);var e=this._selected._nbAxis;-1!==e&&(g.set(d,0,0,0)[e]=1),g.add(d,c,d),g.copy(c,b.project(c)),g.copy(d,b.project(d)),f.normalize(d,f.sub(d,d,c));var h=this._editOffset;h[0]=a._mouseX-c[0],h[1]=a._mouseY-c[1]},_startPlaneEdit:function(){var a=this._main,b=a.getCamera(),c=this._editLineOrigin;this._computeCenterGizmo(c),g.copy(c,b.project(c));var d=this._editOffset;d[0]=a._mouseX-c[0],d[1]=a._mouseY-c[1],f.set(this._editLineOrigin,a._mouseX,a._mouseY)},_startScaleEdit:function(){this._startTranslateEdit()},_updateRotateEdit:function(){var a=this._main,b=a.getMesh(),c=this._editLineOrigin,d=this._editLineDirection,e=[a._mouseX,a._mouseY,0];f.sub(e,e,c);var g=f.dot(e,d);this._updateLineHelper(c[0],c[1],c[0]+d[0]*g,c[1]+d[1]*g);var i=7*g/Math.min(a.getCanvasWidth(),a.getCanvasHeight());i%=2*Math.PI;var j=this._selected._nbAxis,k=b.getEditMatrix();h.identity(k),0===j?h.rotateX(k,k,-i):1===j?h.rotateY(k,k,-i):2===j&&h.rotateZ(k,k,-i),this._scaleRotateEditMatrix(k),a.render()},_updateTranslateEdit:function(){var a=this._main,b=a.getCamera(),c=a.getMesh(),d=this._editLineOrigin,e=this._editLineDirection,i=[a._mouseX,a._mouseY,0];f.sub(i,i,d),f.sub(i,i,this._editOffset),f.scaleAndAdd(i,d,e,f.dot(i,e)),this._updateLineHelper(d[0],d[1],i[0],i[1]);var j=b.unproject(i[0],i[1],0),k=b.unproject(i[0],i[1],.1);g.transformMat4(j,j,this._editTransInv),g.transformMat4(k,k,this._editTransInv),g.normalize(i,g.sub(i,k,j));var l=[0,0,0];l[this._selected._nbAxis]=1;var m=-g.dot(i,l),n=g.dot(j,i),o=Math.abs(1-m*m),p=-g.dot(j,l);l[this._selected._nbAxis]=(m*n-p)/o,g.transformMat4(l,l,this._editScaleRotInv);var q=c.getEditMatrix();h.identity(q),h.translate(q,q,l),a.render()},_updatePlaneEdit:function(){var a=this._main,b=a.getCamera(),c=a.getMesh(),d=[a._mouseX,a._mouseY,0];f.sub(d,d,this._editOffset),this._updateLineHelper(this._editLineOrigin[0],this._editLineOrigin[1],a._mouseX,a._mouseY);var e=b.unproject(d[0],d[1],0),i=b.unproject(d[0],d[1],.1);g.transformMat4(e,e,this._editTransInv),g.transformMat4(i,i,this._editTransInv);var j=[0,0,0];j[this._selected._nbAxis]=1;var k=g.dot(e,j),l=g.dot(i,j);if(k===l)return!1;var m=-k/(l-k);j[0]=e[0]+(i[0]-e[0])*m,j[1]=e[1]+(i[1]-e[1])*m,j[2]=e[2]+(i[2]-e[2])*m,g.transformMat4(j,j,this._editScaleRotInv);var n=c.getEditMatrix();h.identity(n),h.translate(n,n,j),a.render()},_updateScaleEdit:function(){var a=this._main,b=a.getMesh(),c=this._editLineOrigin,d=this._editLineDirection,e=this._selected._nbAxis,i=[a._mouseX,a._mouseY,0];-1!==e&&(f.sub(i,i,c),f.scaleAndAdd(i,c,d,f.dot(i,d))),this._updateLineHelper(c[0],c[1],i[0],i[1]);var j=g.len(this._editOffset),k=[1,1,1],l=Math.max(-.99,(g.dist(c,i)-j)/j);-1===e?(k[0]+=l,k[1]+=l,k[2]+=l):k[e]+=l;var m=b.getEditMatrix();h.identity(m),h.scale(m,m,k),this._scaleRotateEditMatrix(m),a.render()},_scaleRotateEditMatrix:function(a){h.mul(a,this._editTrans,a),h.mul(a,a,this._editTransInv),h.mul(a,this._editLocalInv,a),h.mul(a,a,this._editLocal)},addGizmoToScene:function(a){return a.push(this._transX._drawGeo),a.push(this._transY._drawGeo),a.push(this._transZ._drawGeo),a.push(this._planeX._drawGeo),a.push(this._planeY._drawGeo),a.push(this._planeZ._drawGeo),a.push(this._rotX._drawGeo),a.push(this._rotY._drawGeo),a.push(this._rotZ._drawGeo),a.push(this._rotW._drawGeo),a.push(this._scaleX._drawGeo),a.push(this._scaleY._drawGeo),a.push(this._scaleZ._drawGeo),a.push(this._scaleW._drawGeo),a},render:function(){this._updateMatrices();var a=this._isEditing&&this._selected?this._selected._type:this._activatedType;a&G&&this._drawGizmo(this._rotW),a&A&&this._drawGizmo(this._transX),a&B&&this._drawGizmo(this._transY),a&C&&this._drawGizmo(this._transZ),a&H&&this._drawGizmo(this._planeX),a&I&&this._drawGizmo(this._planeY),a&J&&this._drawGizmo(this._planeZ),a&D&&this._drawGizmo(this._rotX),a&E&&this._drawGizmo(this._rotY),a&F&&this._drawGizmo(this._rotZ),a&K&&this._drawGizmo(this._scaleX),a&L&&this._drawGizmo(this._scaleY),a&M&&this._drawGizmo(this._scaleZ),a&N&&this._drawGizmo(this._scaleW),this._isEditing&&this._lineHelper.render(this._main)},onMouseOver:function(){if(this._isEditing){var a=this._selected._type;return a&P?this._updateRotateEdit():a&O?this._updateTranslateEdit():a&Q?this._updatePlaneEdit():a&R&&this._updateScaleEdit(),!0}var b=this._main,c=b.getPicking(),d=b._mouseX,e=b._mouseY,f=this._pickables;c.intersectionMouseMeshes(f,d,e),this._selected&&(this._selected._isSelected=!1);var h=c.getMesh();return h?(this._selected=h._gizmo,this._selected._isSelected=!0,g.copy(this._selected._lastInter,c.getIntersectionPoint()),!0):(this._selected=null,!1)},onMouseDown:function(){var a=this._selected;if(!a)return!1;this._isEditing=!0;var b=a._type;return this._saveEditMatrices(),b&P?this._startRotateEdit():b&O?this._startTranslateEdit():b&Q?this._startPlaneEdit():b&R&&this._startScaleEdit(),!0},onMouseUp:function(){this._isEditing=!1}},c.exports=z}),define("editing/tools/Transform",["require","exports","module","lib/glMatrix","misc/Utils","editing/Gizmo","editing/tools/SculptBase"],function(a,b,c){"use strict";var d=a("lib/glMatrix"),e=a("misc/Utils"),f=a("editing/Gizmo"),g=a("editing/tools/SculptBase"),h=d.vec3,i=d.mat4,j=function(a){g.call(this,a),this._gizmo=new f(a)};j.prototype={isIdentity:function(a){return 1!==a[0]||1!==a[5]||1!==a[10]||1!==a[15]?!1:0!==a[1]||0!==a[2]||0!==a[3]||0!==a[4]?!1:0!==a[6]||0!==a[7]||0!==a[8]||0!==a[9]?!1:0!==a[11]||0!==a[12]||0!==a[13]||0!==a[14]?!1:!0},preUpdate:function(){var a=this._main.getPicking(),b=a.getMesh();this._gizmo.onMouseOver(),a._mesh=b,this._main.setCanvasCursor("default")},start:function(a){var b=this._main,c=this.getMesh(),d=b.getPicking();return c&&this._gizmo.onMouseDown()?(this.pushState(),d._mesh=c,!0):d.intersectionMouseMeshes(b.getMeshes(),b._mouseX,b._mouseY)&&b.setOrUnsetMesh(d.getMesh(),a)?(this._lastMouseX=b._mouseX,this._lastMouseY=b._mouseY,!1):!1},end:function(){this._gizmo.onMouseUp();var a=this.getMesh();if(a&&!this.isIdentity(a.getEditMatrix())){var b=this.getUnmaskedVertices();this._states.pushVertices(b),this.applyEditMatrix(b),0!==b.length&&this.updateMeshBuffers()}},applyEditMatrix:function(a){for(var b=this.getMesh(),c=b.getEditMatrix(),d=b.getMaterials(),e=b.getVertices(),f=[0,0,0],g=0,j=a.length;j>g;++g){var k=3*a[g],l=d[k+2],m=f[0]=e[k],n=f[1]=e[k+1],o=f[2]=e[k+2];h.transformMat4(f,f,c);var p=1-l;e[k]=m*p+f[0]*l,e[k+1]=n*p+f[1]*l,e[k+2]=o*p+f[2]*l}h.transformMat4(b.getCenter(),b.getCenter(),c),i.identity(c),a.length===b.getNbVertices()?b.updateGeometry():b.updateGeometry(b.getFacesFromVertices(a),a)},update:function(){},postRender:function(){this.getMesh()&&this._gizmo.render()},addSculptToScene:function(a){this.getMesh()&&this._gizmo.addGizmoToScene(a)}},e.makeProxy(g,j),c.exports=j}),define("editing/tools/Tools",["require","exports","module","editing/tools/Brush","editing/tools/Inflate","editing/tools/Twist","editing/tools/Smooth","editing/tools/Flatten","editing/tools/Pinch","editing/tools/Crease","editing/tools/Drag","editing/tools/Paint","editing/tools/Move","editing/tools/Masking","editing/tools/LocalScale","editing/tools/Transform"],function(a,b,c){"use strict";var d=a("editing/tools/Brush"),e=a("editing/tools/Inflate"),f=a("editing/tools/Twist"),g=a("editing/tools/Smooth"),h=a("editing/tools/Flatten"),i=a("editing/tools/Pinch"),j=a("editing/tools/Crease"),k=a("editing/tools/Drag"),l=a("editing/tools/Paint"),m=a("editing/tools/Move"),n=a("editing/tools/Masking"),o=a("editing/tools/LocalScale"),p=a("editing/tools/Transform"),q={};q.BRUSH=d,q.INFLATE=e,q.TWIST=f,q.SMOOTH=g,q.FLATTEN=h,q.PINCH=i,q.CREASE=j,q.DRAG=k,q.PAINT=l,q.MOVE=m,q.MASKING=n,q.LOCALSCALE=o,q.TRANSFORM=p,q.BRUSH.uiName="sculptBrush",q.INFLATE.uiName="sculptInflate",q.TWIST.uiName="sculptTwist",q.SMOOTH.uiName="sculptSmooth",q.FLATTEN.uiName="sculptFlatten",q.PINCH.uiName="sculptPinch",q.CREASE.uiName="sculptCrease",q.DRAG.uiName="sculptDrag",q.PAINT.uiName="sculptPaint",q.MOVE.uiName="sculptMove",q.MASKING.uiName="sculptMasking",q.LOCALSCALE.uiName="sculptLocalScale",q.TRANSFORM.uiName="sculptTransform",q.keys=Object.keys(q),c.exports=q}),define("editing/Sculpt",["require","exports","module","editing/tools/Tools"],function(a,b,c){"use strict";var d=a("editing/tools/Tools"),e=function(a){this._main=a,this._tool="BRUSH",this._tools=[],this._symmetry=!0,this._continuous=!1,this._sculptTimer=-1,this.init()};e.prototype={getToolName:function(){return this._tool},getCurrentTool:function(){return this._tools[this._tool]},getSymmetry:function(){return this._symmetry},getTool:function(a){return this._tools[a]},init:function(){for(var a=this._main,b=this._tools,c=d.keys,e=0,f=c.length;f>e;++e){var g=c[e];b[g]=new d[g](a)}},canBeContinuous:function(){switch(this._tool){case"TWIST":case"MOVE":case"DRAG":case"LOCALSCALE":case"TRANSFORM":return!1;default:return!0}},isUsingContinuous:function(){return this._continuous&&this.canBeContinuous()},start:function(a){var b=this.getCurrentTool(),c=b.start(a);return this._main.getPicking().getMesh()&&this.isUsingContinuous()&&(this._sculptTimer=window.setInterval(b._cbContinuous,16.6)),c},end:function(){this.getCurrentTool().end(),-1!==this._sculptTimer&&(clearInterval(this._sculptTimer),this._sculptTimer=-1)},preUpdate:function(){this.getCurrentTool().preUpdate(this.canBeContinuous())},update:function(){this.isUsingContinuous()||this.getCurrentTool().update()},postRender:function(){this.getCurrentTool().postRender()},addSculptToScene:function(a){return this.getCurrentTool().addSculptToScene(a)}},c.exports=e}),define("editing/Subdivision",["require","exports","module","misc/Utils"],function(a,b,c){"use strict";var d=a("misc/Utils"),e={};e.LINEAR=!1;var f=function(a,b,c,d){this._vArOut=b,this._cArOut=c,this._mArOut=d,this._vAr=a.getVertices(),this._cAr=a.getColors(),this._mAr=a.getMaterials(),this._eAr=a.getEdges(),this._nbVertices=a.getNbVertices(),this._tagEdges=new Int32Array(a.getNbEdges())};f.prototype={computeTriangleEdgeVertex:function(a,b,c,d){var f=this._vAr,g=this._cAr,h=this._mAr,i=this._eAr,j=this._vArOut,k=this._cArOut,l=this._mArOut,m=this._tagEdges,n=3*a,o=3*b,p=3*c,q=m[d]-1,r=-1===q?this._nbVertices++:q,s=3*r,t=i[d];if(1===t||t>=3||e.LINEAR){if(-1!==q)return r;m[d]=r+1,j[s]=.5*(f[n]+f[o]),j[s+1]=.5*(f[n+1]+f[o+1]),j[s+2]=.5*(f[n+2]+f[o+2]),k[s]=.5*(g[n]+g[o]),k[s+1]=.5*(g[n+1]+g[o+1]),k[s+2]=.5*(g[n+2]+g[o+2]),l[s]=.5*(h[n]+h[o]),l[s+1]=.5*(h[n+1]+h[o+1]),l[s+2]=.5*(h[n+2]+h[o+2])}else-1===q?(m[d]=r+1,j[s]=.125*f[p]+.375*(f[n]+f[o]),j[s+1]=.125*f[p+1]+.375*(f[n+1]+f[o+1]),j[s+2]=.125*f[p+2]+.375*(f[n+2]+f[o+2]),k[s]=.125*g[p]+.375*(g[n]+g[o]),k[s+1]=.125*g[p+1]+.375*(g[n+1]+g[o+1]),k[s+2]=.125*g[p+2]+.375*(g[n+2]+g[o+2]),l[s]=.125*h[p]+.375*(h[n]+h[o]),l[s+1]=.125*h[p+1]+.375*(h[n+1]+h[o+1]),l[s+2]=.125*h[p+2]+.375*(h[n+2]+h[o+2])):(j[s]+=.125*f[p],j[s+1]+=.125*f[p+1],j[s+2]+=.125*f[p+2],k[s]+=.125*g[p],k[s+1]+=.125*g[p+1],k[s+2]+=.125*g[p+2],l[s]+=.125*h[p],l[s+1]+=.125*h[p+1],l[s+2]+=.125*h[p+2]);return r},computeQuadEdgeVertex:function(a,b,c,d,f){var g=this._vAr,h=this._cAr,i=this._mAr,j=this._eAr,k=this._vArOut,l=this._cArOut,m=this._mArOut,n=this._tagEdges,o=3*a,p=3*b,q=3*c,r=3*d,s=n[f]-1,t=-1===s?this._nbVertices++:s,u=3*t,v=j[f];if(1===v||v>=3||e.LINEAR){if(-1!==s)return t;n[f]=t+1,k[u]=.5*(g[o]+g[p]),k[u+1]=.5*(g[o+1]+g[p+1]),k[u+2]=.5*(g[o+2]+g[p+2]),l[u]=.5*(h[o]+h[p]),l[u+1]=.5*(h[o+1]+h[p+1]),l[u+2]=.5*(h[o+2]+h[p+2]),m[u]=.5*(i[o]+i[p]),m[u+1]=.5*(i[o+1]+i[p+1]),m[u+2]=.5*(i[o+2]+i[p+2])}else-1===s?(n[f]=t+1,k[u]=.0625*(g[q]+g[r])+.375*(g[o]+g[p]),k[u+1]=.0625*(g[q+1]+g[r+1])+.375*(g[o+1]+g[p+1]),k[u+2]=.0625*(g[q+2]+g[r+2])+.375*(g[o+2]+g[p+2]),l[u]=.0625*(h[q]+h[r])+.375*(h[o]+h[p]),l[u+1]=.0625*(h[q+1]+h[r+1])+.375*(h[o+1]+h[p+1]),l[u+2]=.0625*(h[q+2]+h[r+2])+.375*(h[o+2]+h[p+2]),m[u]=.0625*(i[q]+i[r])+.375*(i[o]+i[p]),m[u+1]=.0625*(i[q+1]+i[r+1])+.375*(i[o+1]+i[p+1]),m[u+2]=.0625*(i[q+2]+i[r+2])+.375*(i[o+2]+i[p+2])):(k[u]+=.0625*(g[q]+g[r]),k[u+1]+=.0625*(g[q+1]+g[r+1]),k[u+2]+=.0625*(g[q+2]+g[r+2]),l[u]+=.0625*(h[q]+h[r]),l[u+1]+=.0625*(h[q+1]+h[r+1]),l[u+2]+=.0625*(h[q+2]+h[r+2]),m[u]+=.0625*(i[q]+i[r]),m[u+1]+=.0625*(i[q+1]+i[r+1]),m[u+2]+=.0625*(i[q+2]+i[r+2]));return t},computeFaceVertex:function(a,b,c,d){var e=3*a,f=3*b,g=3*c,h=3*d,i=this._vAr,j=this._cAr,k=this._mAr,l=this._vArOut,m=this._cArOut,n=this._mArOut,o=this._nbVertices++,p=3*o;return l[p]=.25*(i[e]+i[f]+i[g]+i[h]),l[p+1]=.25*(i[e+1]+i[f+1]+i[g+1]+i[h+1]),l[p+2]=.25*(i[e+2]+i[f+2]+i[g+2]+i[h+2]),m[p]=.25*(j[e]+j[f]+j[g]+j[h]),m[p+1]=.25*(j[e+1]+j[f+1]+j[g+1]+j[h+1]),m[p+2]=.25*(j[e+2]+j[f+2]+j[g+2]+j[h+2]),n[p]=.25*(k[e]+k[f]+k[g]+k[h]),n[p+1]=.25*(k[e+1]+k[f+1]+k[g+1]+k[h+1]),n[p+2]=.25*(k[e+2]+k[f+2]+k[g+2]+k[h+2]),o}};var g=function(a,b,c,d){c.set(a.getColors()),d.set(a.getMaterials());for(var f=a.getVertices(),g=a.getFaces(),h=a.getEdges(),i=a.getFaceEdges(),j=a.getVerticesOnEdge(),k=a.getVerticesRingVertStartCount(),l=a.getVerticesRingVert(),m=a.getVerticesRingFaceStartCount(),n=a.getVerticesRingFace(),o=a.hasOnlyTriangles(),p=a.getNbVertices(),q=0;p>q;++q){var r=3*q,s=0,t=0,u=0,v=0,w=0,x=0,y=0;if(j[q]||e.LINEAR){var z=m[2*q],A=z+m[2*q+1];for(x=z;A>x;++x){var B=4*n[x],C=g[B],D=g[B+1],E=g[B+2],F=g[B+3];y=-1,C===q?1===h[i[B]]?y=D:1===h[i[0>F?B+2:B+3]]&&(y=0>F?E:F):D===q?1===h[i[B]]?y=C:1===h[i[B+1]]&&(y=E):E===q?1===h[i[B+1]]?y=D:1===h[i[B+2]]&&(y=0>F?C:F):F===q&&(1===h[i[B+2]]?y=E:1===h[i[B+3]]&&(y=C)),0>y||(y*=3,s+=f[y],t+=f[y+1],u+=f[y+2],v++)}2>v?(b[r]=f[r],b[r+1]=f[r+1],b[r+2]=f[r+2]):(v=.25/v,w=.75,b[r]=f[r]*w+s*v,b[r+1]=f[r+1]*w+t*v,b[r+2]=f[r+2]*w+u*v)}else{var G=k[2*q],H=k[2*q+1],I=G+H;for(x=G;I>x;++x)y=3*l[x],s+=f[y],t+=f[y+1],u+=f[y+2];if(o)6===H?(v=.0625,w=.625):3===H?(v=.1875,w=.4375):(v=.375/H,w=.625),b[r]=f[r]*w+s*v,b[r+1]=f[r+1]*w+t*v,b[r+2]=f[r+2]*w+u*v;else{var J=0,K=0,L=0,M=0,N=m[2*q],O=N+m[2*q+1],P=0;for(x=N;O>x;++x){y=4*n[x];var Q=g[y+3];if(!(0>Q)){P++;var R=g[y],S=g[y+1],T=g[y+2],U=0;U=R===q?3*T:S===q?3*Q:T===q?3*R:3*S,J+=f[U],K+=f[U+1],L+=f[U+2]}}P!==O-N?0!==P?(w=1/(1+.5*H+.25*P),v=.5*w,M=.25*w,b[r]=f[r]*w+s*v+J*M,b[r+1]=f[r+1]*w+t*v+K*M,b[r+2]=f[r+2]*w+u*v+L*M):(6===H?(v=.0625,w=.625):3===H?(v=.1875,w=.4375):(v=.375/H,w=.625),b[r]=f[r]*w+s*v,b[r+1]=f[r+1]*w+t*v,b[r+2]=f[r+2]*w+u*v):(4===H?(w=.5625,v=.09375,M=.015625):(v=1.5/(H*H),M=.25/(H*H),w=1-(v+M)*H),b[r]=f[r]*w+s*v+J*M,b[r+1]=f[r+1]*w+t*v+K*M,b[r+2]=f[r+2]*w+u*v+L*M)}}}},h=function(a,b,c,d,e){for(var g=a.getFaces(),h=a.getFaceEdges(),i=new f(a,b,c,d),j=0,k=a.getNbFaces();k>j;++j){var l,m,n,o,p,q=4*j,r=g[q],s=g[q+1],t=g[q+2],u=g[q+3];u>=0?(l=i.computeQuadEdgeVertex(r,s,t,u,h[q]),m=i.computeQuadEdgeVertex(s,t,u,r,h[q+1]),n=i.computeQuadEdgeVertex(t,u,r,s,h[q+2]),o=i.computeQuadEdgeVertex(u,r,s,t,h[q+3]),p=i.computeFaceVertex(r,s,t,u)):(l=i.computeTriangleEdgeVertex(r,s,t,h[q]),m=i.computeTriangleEdgeVertex(s,t,r,h[q+1]),n=i.computeTriangleEdgeVertex(t,r,s,h[q+2])),e&&(q*=4,u>=0?(e[q+1]=e[q+4]=l,e[q+6]=e[q+9]=m,e[q+11]=e[q+14]=n,e[q+3]=e[q+12]=o,e[q+2]=e[q+7]=e[q+8]=e[q+13]=p,e[q]=r,e[q+5]=s,e[q+10]=t,e[q+15]=u):(e[q]=e[q+5]=e[q+8]=l,e[q+1]=e[q+10]=e[q+12]=m,e[q+2]=e[q+6]=e[q+14]=n,e[q+3]=e[q+7]=e[q+11]=e[q+15]=-1,e[q+4]=r,e[q+9]=s,e[q+13]=t))}return i._tagEdges},i=function(a,b,c){var e=b.getNbVertices(),f=new Uint32Array(2*e);f.set(a.getVerticesDuplicateStartCount());var g=a.getFaces(),h=a.getFacesTexCoord(),i=3*b.getNbFaces(),k=a.getTexCoords(),l=new Float32Array(d.getMemory(4*i*2),0,2*i),m=0,n=a.getNbVertices(),o=e-n;for(m=0;n>m;++m){var p=f[2*m];p>0&&(f[2*m]=p+o)}l.set(k),l.set(k.subarray(2*n),2*(n+o));var q=a.getNbTexCoords(),r=o+q,s=a.getFaceEdges(),t=new Uint32Array(c.length),u=new Uint32Array(c.length);for(n=g.length,m=0;n>m;++m){var v=s[m];if(-1!==v){var w=(m+1)%4===0?m-3:m+1,x=h[m],y=h[w];0>y&&(y=h[m-2]);var z=c[v]-1,A=u[v],B=x>y?x:y,C=y>x?x:y;0!==A?(A!==B||t[v]!==C)&&(l[2*r]=.5*(k[2*x]+k[2*y]),l[2*r+1]=.5*(k[2*x+1]+k[2*y+1]),f[2*z]=r++,f[2*z+1]=1):(l[2*z]=.5*(k[2*x]+k[2*y]),l[2*z+1]=.5*(k[2*x+1]+k[2*y+1]),t[v]=C,u[v]=B)}}var D=new Float32Array(2*r);D.set(l.subarray(0,2*r)),b.setTexCoords(D),b.setVerticesDuplicateStartCount(f),j(a,b,c)},j=function(a,b,c){for(var d=a.getFacesTexCoord(),e=b.getFaces(),f=new Int32Array(e.length),g=a.getFaceEdges(),h=a.getNbVertices(),i=b.getNbVertices()-h,j=b.getVerticesDuplicateStartCount(),k=b.getTexCoords(),l=0,m=a.getNbFaces();m>l;++l){var n=4*l,o=d[n],p=d[n+1],q=d[n+2],r=d[n+3];o>=h&&(o+=i),p>=h&&(p+=i),q>=h&&(q+=i),r>=h&&(r+=i);var s=g[n],t=c[s]-1;0>t?t=j[2*(-t-1)]:j[2*t]>0&&(c[s]=-t),s=g[n+1];var u=c[s]-1;0>u?u=j[2*(-u-1)]:j[2*u]>0&&(c[s]=-u),s=g[n+2];var v=c[s]-1;if(0>v?v=j[2*(-v-1)]:j[2*v]>0&&(c[s]=-v),n*=4,r>=0){s=g[4*l+3];var w=c[s]-1;0>w?w=j[2*(-w-1)]:j[2*w]>0&&(c[s]=-w),f[n+1]=f[n+4]=t,f[n+6]=f[n+9]=u,f[n+11]=f[n+14]=v,f[n+3]=f[n+12]=w,f[n+2]=f[n+7]=f[n+8]=f[n+13]=e[n+2],f[n]=o,f[n+5]=p,f[n+10]=q,f[n+15]=r;var x=2*e[n+2];k[x]=.25*(k[2*o]+k[2*p]+k[2*q]+k[2*r]),k[x+1]=.25*(k[2*o+1]+k[2*p+1]+k[2*q+1]+k[2*r+1])}else f[n]=f[n+5]=f[n+8]=t,f[n+1]=f[n+10]=f[n+12]=u,f[n+2]=f[n+6]=f[n+14]=v,f[n+3]=f[n+7]=f[n+11]=f[n+15]=-1,f[n+4]=o,f[n+9]=p,f[n+13]=q}b.setFacesTexCoord(f)};e.fullSubdivision=function(a,b){var c=a.getNbVertices()+a.getNbEdges()+a.getNbQuads();b.setVertices(new Float32Array(3*c)),b.setColors(new Float32Array(3*c)),b.setMaterials(new Float32Array(3*c)),b.setFaces(new Int32Array(4*a.getNbFaces()*4)),g(a,b.getVertices(),b.getColors(),b.getMaterials());var d=h(a,b.getVertices(),b.getColors(),b.getMaterials(),b.getFaces());a.hasUV()&&i(a,b,d),b.allocateArrays()},e.partialSubdivision=function(a,b,c,d){g(a,b,c,d),h(a,b,c,d)},c.exports=e}),define("files/ImportOBJ",["require","exports","module","mesh/Mesh"],function(a,b,c){"use strict";var d=a("mesh/Mesh"),e={};e.importOBJ=function(a,b){for(var c=[],f=[],g=[],h=[],i=[],j=[],k=[],l=[],m=[],n=0,o=0,p=0,q=0,r=a.split("\n"),s=[],t=1/255,u=r.length,v=0;u>v;++v){var w=r[v].trim();if(w.startsWith("o "))c.length>0&&(e.initMeshOBJ(c[c.length-1],f,l,g,i,k,m,h,j),n=p,o=q),c.push(new d(b));else if(w.startsWith("v "))s=w.split(/\s+/),f.push(parseFloat(s[1]),parseFloat(s[2]),parseFloat(s[3])),s[4]&&g.push(parseFloat(s[4]),parseFloat(s[5]),parseFloat(s[6])),++p;else if(w.startsWith("#MRGB ")){s=w.split(/\s+/);for(var x=s[1],y=2,z=x.length;z>y;y+=8){var A=parseInt(x.substr(y,6),16);h.push((A>>16)*t,(A>>8&255)*t,(255&A)*t)}}else if(w.startsWith("#MAT ")){s=w.split(/\s+/);for(var B=s[1],C=0,D=B.length;D>C;C+=6){var E=parseInt(B.substr(C,6),16);j.push((E>>16)*t,(E>>8&255)*t,(255&E)*t)}}else if(w.startsWith("vt "))s=w.split(/\s+/),k.push(parseFloat(s[1]),parseFloat(s[2])),++q;else if(w.startsWith("f ")){s=w.split(/\s+/);var F=s.length-1;if(3>F)continue;for(var G=Math.ceil(F/2)-1,H=0;G>H;++H){var I=H+1,J=H+2,K=F-I,L=F-H;K===J&&(K=L,L=-1);var M,N=s[I].split("/"),O=s[J].split("/"),P=s[K].split("/"),Q=L>=0;Q&&(M=s[L].split("/"));var R=parseInt(N[0],10),S=parseInt(O[0],10),T=parseInt(P[0],10),U=Q?parseInt(M[0],10):void 0;if((!Q||U!==R&&U!==S&&U!==T)&&R!==S&&R!==T&&S!==T&&(R=(0>R?R+p:R-1)-n,S=(0>S?S+p:S-1)-n,T=(0>T?T+p:T-1)-n,Q&&(U=(0>U?U+p:U-1)-n),l.push(R,S,T,Q?U:-1),N[1])){var V=parseInt(N[1],10),W=parseInt(O[1],10),X=parseInt(P[1],10),Y=Q?parseInt(M[1],10):void 0;V=(0>V?V+q:V-1)-o,W=(0>W?W+q:W-1)-o,X=(0>X?X+q:X-1)-o,Q&&(Y=(0>Y?Y+q:Y-1)-o),m.push(V,W,X,Q?Y:-1)}}}}return 0===c.length&&(c[0]=new d(b)),e.initMeshOBJ(c[c.length-1],f,l,g,i,k,m,h,j),c},e.initMeshOBJ=function(a,b,c,d,e,f,g,h,i){a.setVertices(new Float32Array(b)),a.setFaces(new Int32Array(c)),h.length===b.length?a.setColors(new Float32Array(h)):d.length===b.length&&a.setColors(new Float32Array(d)),i.length===b.length?a.setMaterials(new Float32Array(i)):e.length===b.length&&a.setMaterials(new Float32Array(e)),f.length>0&&g.length===c.length&&a.initTexCoordsDataFromOBJData(f,g),b.length=c.length=0,h.length=d.length=0,i.length=e.length=0,f.length=g.length=0},c.exports=e}),define("files/ExportSGL",["require","exports","module","render/shaders/ShaderBase"],function(a,b,c){"use strict";var d=a("render/shaders/ShaderBase"),e=function(a){for(var b=Object.keys(a),c={},d=0,e=b.length;e>d;++d)c[a[b[d]]]=b[d];return c},f={},g={};f.MODE_TO_INT={ORBIT:0,SPHERICAL:1,PLANE:2},g.INT_TO_MODE=e(f.MODE_TO_INT),f.PROJECTION_TO_INT={PERSPECTIVE:0,ORTHOGRAPHIC:1},g.INT_TO_PROJECTION=e(f.PROJECTION_TO_INT),f.SHADER_TO_INT={PBR:0,NORMAL:2,UV:4,MATCAP:5},g.INT_TO_SHADER=e(f.SHADER_TO_INT);var h={};h.intToString=g,h.stringToInt=f,h.exportSGLAsArrayBuffer=function(a,b){return h.exportSGL(a,b,!0)},h.exportSGL=function(a,b,c){var e,g=a.length,h=31,i=4*(9+g*h),j=0;for(j=0;g>j;++j)e=a[j],i+=4*e.getNbVertices()*3,e.getColors()&&(i+=4*e.getNbVertices()*3),e.getMaterials()&&(i+=4*e.getNbVertices()*3),i+=4*e.getNbFaces()*4,e.hasUV()&&(i+=4*e.getNbTexCoords()*2,i+=4*e.getNbFaces()*4);var k=new ArrayBuffer(i),l=new Float32Array(k),m=new Uint32Array(k),n=new Int32Array(k),o=0;m[o++]=2,m[o++]=b._showGrid,m[o++]=d.showSymmetryLine,m[o++]=b._showContour;var p=b.getCamera();for(m[o++]=f.PROJECTION_TO_INT[p.getProjectionType()],m[o++]=f.MODE_TO_INT[p.getMode()],l[o++]=p.getFov(),m[o++]=p.getUsePivot(),m[o++]=g,j=0;g>j;++j){e=a[j],m[o++]=f.SHADER_TO_INT[e.getShaderName()],m[o++]=e.getMatcap(),m[o++]=e.getShowWireframe(),m[o++]=e.getFlatShading(),l[o++]=e.getOpacity(),l.set(e.getCenter(),o),o+=3,l.set(e.getMatrix(),o),
o+=16,l[o++]=e.getScale();var q=e.getNbVertices();m[o++]=q,l.set(e.getVertices(),o),o+=3*q;var r=e.getColors()?q:0;m[o++]=r,r>0&&l.set(e.getColors().subarray(0,3*q),o),o+=3*r;var s=e.getMaterials()?q:0;m[o++]=s,s>0&&l.set(e.getMaterials().subarray(0,3*q),o),o+=3*s;var t=e.getNbFaces();m[o++]=t,n.set(e.getFaces().subarray(0,4*t),o),o+=4*t;var u=e.hasUV(),v=e.getNbTexCoords();m[o++]=u?v:0,u&&(l.set(e.getTexCoords().subarray(0,2*v),o),o+=2*v),m[o++]=u?t:0,u&&(n.set(e.getFacesTexCoord().subarray(0,4*t),o),o+=4*t)}if(c)return k;var w=new DataView(k,0,4*o);return new Blob([w])},c.exports=h}),define("files/ImportSGL",["require","exports","module","mesh/Mesh","files/ExportSGL","render/shaders/ShaderBase"],function(a,b,c){"use strict";var d=a("mesh/Mesh"),e=a("files/ExportSGL"),f=a("render/shaders/ShaderBase"),g=e.intToString,h={};h.importSGL=function(a,b,c){var e=new Float32Array(a),h=new Uint32Array(a),i=new Int32Array(a),j=0,k=h[j++];if(k>2)return[];if(k>=2){c._showGrid=h[j++],f.showSymmetryLine=h[j++],c._showContour=h[j++];var l=c.getCamera();l.setProjectionType(g.INT_TO_PROJECTION[h[j++]]),l.setMode(g.INT_TO_MODE[h[j++]]),l.setFov(e[j++]),l.setUsePivot(h[j++])}for(var m=h[j++],n=new Array(m),o=0;m>o;++o){var p=n[o]=new d(b);if(k>=2){var q=p.getRender();q._shaderName=g.INT_TO_SHADER[h[j++]],q.setMatcap(h[j++]),q._showWireframe=h[j++],q._flatShading=h[j++],q.setOpacity(e[j++])}p.getCenter().set(e.subarray(j,j+3)),j+=3,p.getMatrix().set(e.subarray(j,j+16)),j+=16,j++;var r=h[j++];p.setVertices(e.subarray(j,j+3*r)),j+=3*r,r=h[j++],r>0&&p.setColors(e.subarray(j,j+3*r)),j+=3*r,r=h[j++],r>0&&p.setMaterials(e.subarray(j,j+3*r)),j+=3*r,r=h[j++],p.setFaces(i.subarray(j,j+4*r)),j+=4*r,r=h[j++];var s=null;r&&(s=e.subarray(j,j+2*r)),j+=2*r,r=h[j++];var t=null;r&&(t=i.subarray(j,j+4*r)),j+=4*r,s&&t&&p.initTexCoordsDataFromOBJData(s,t)}return n},c.exports=h}),define("files/ImportPLY",["require","exports","module","mesh/Mesh","misc/Utils"],function(a,b,c){"use strict";var d=a("mesh/Mesh"),e=a("misc/Utils"),f={},g=function(a){switch(a){case"uchar":case"char":case"int8":case"uint8":return 1;case"ushort":case"short":case"int16":case"uint16":return 2;case"uint":case"int":case"float":case"int32":case"uint32":case"float32":return 4;case"double":case"float64":return 8;default:return 0}},h=function(a,b){var c=b?1/255:1;switch(a){case"char":case"uchar":case"short":case"ushort":case"int":case"uint":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":return function(a){return parseInt(a,10)*c};case"float":case"double":case"float32":case"float64":return parseFloat;default:return function(a){return a}}},i=function(a,b,c){var d=c?1/255:1,e=b.offsetOctet;switch(b.type){case"int8":case"char":return function(b){return a.getInt8(b+e)*d};case"uint8":case"uchar":return function(b){return a.getUint8(b+e)*d};case"int16":case"short":return function(b){return a.getInt16(b+e,!0)*d};case"uint16":case"ushort":return function(b){return a.getUint16(b+e,!0)*d};case"int32":case"int":return function(b){return a.getInt32(b+e,!0)*d};case"uint32":case"uint":return function(b){return a.getUint32(b+e,!0)*d};case"float32":case"float":return function(b){return a.getFloat32(b+e,!0)};case"float64":case"double":return function(b){return a.getFloat64(b+e,!0)}}},j=function(a){for(var b,c=e.ab2str(a),d=c.split("\n"),f={isBinary:!1,start:0,elements:[],lines:d,buffer:a,vertices:null,faces:null,colors:null,offsetLine:0,offsetOctet:0},g=0;;){var h=d[g++];if(f.offsetOctet+=h.length+1,f.offsetLine=g,h=h.trim(),h.startsWith("format binary"))f.isBinary=!0;else if(h.startsWith("element"))b=h.split(/\s+/),f.elements.push({name:b[1],count:parseInt(b[2],10),properties:[]});else if(h.startsWith("property")){b=h.split(/\s+/);var i="list"===b[1];f.elements[f.elements.length-1].properties.push({type:b[i?2:1],type2:i?b[3]:void 0,name:b[i?4:2]})}else if(h.startsWith("end_header"))break}return f},k=function(a,b){var c=a.properties,d=a.objProperties={};a.offsetOctet=0;for(var e=0,f=c.length;f>e;++e){var h=c[e],i=d[h.name]={};i.type=h.type,b.isBinary?(i.offsetOctet=a.offsetOctet,a.offsetOctet+=g(h.type)):i.id=e}},l=function(a,b,c,d){var e,f,g,i=a.count,j=b.lines,k=a.objProperties,l=b.offsetLine,m=h(k.x.type,!0),n=h(k.y.type,!0),o=h(k.z.type,!0);k.red&&(e=h(k.red.type,!0)),k.green&&(f=h(k.green.type,!0)),k.blue&&(g=h(k.blue.type,!0));for(var p=0;i>p;++p){var q=3*p,r=j[l+p].trim().split(/\s+/);c[q]=m(r[k.x.id]),c[q+1]=n(r[k.y.id]),c[q+2]=o(r[k.z.id]),e&&(d[q]=e(r[k.red.id])),f&&(d[q+1]=f(r[k.green.id])),g&&(d[q+2]=g(r[k.blue.id]))}b.offsetLine+=i},m=function(a,b,c,d){var e,f,g,h=a.count,j=a.objProperties,k=a.offsetOctet,l=k*h,m=new DataView(b.buffer,b.offsetOctet,l),n=i(m,j.x,!0),o=i(m,j.y,!0),p=i(m,j.z,!0);j.red&&(e=i(m,j.red,!0)),j.green&&(f=i(m,j.green,!0)),j.blue&&(g=i(m,j.blue,!0));for(var q=0;h>q;++q){var r=3*q,s=q*k;c[r]=n(s),c[r+1]=o(s),c[r+2]=p(s),e&&(d[r]=e(s)),f&&(d[r+1]=f(s)),g&&(d[r+2]=g(s))}b.offsetOctet+=l},n=function(a,b){k(a,b);var c,d=b.vertices=new Float32Array(3*a.count),e=a.objProperties;(e.red||e.green||e.blue)&&(c=b.colors=new Float32Array(3*a.count)),b.isBinary?m(a,b,d,c):l(a,b,d,c)},o=function(a,b,c){for(var d=a.count,e=b.lines,f=b.offsetLine,g=a.properties[0],i=h(g.type),j=h(g.type2),k=0,l=0;d>l;++l){var m=e[f+l].trim().split(/\s+/),n=i(m[0]);(3===n||4===n)&&(c[k]=j(m[1]),c[k+1]=j(m[2]),c[k+2]=j(m[3]),c[k+3]=4===n?j(m[4]):-1,k+=4)}b.offsetLine+=d},p=function(a,b,c){for(var d=a.count,e=a.properties[0],f=new DataView(b.buffer,b.offsetOctet),h=i(f,{type:e.type,offsetOctet:0}),j=i(f,{type:e.type2,offsetOctet:0}),k=0,l=g(e.type),m=g(e.type2),n=0,o=0;d>o;++o){var p=h(k);k+=l,3===p||4===p?(c[n++]=j(k),k+=m,c[n++]=j(k),k+=m,c[n++]=j(k),k+=m,4===p?(c[n++]=j(k),k+=m):c[n++]=-1):k+=p*m}b.faces=c.subarray(0,n),b.offsetOctet+=k},q=function(a,b){var c=b.faces=new Int32Array(4*a.count);b.isBinary?p(a,b,c):o(a,b,c)},r=function(a,b){var c=a.count;if(b.isBinary){for(var d=a.properties[0],e=new DataView(b.buffer,b.offsetOctet),f=i(e,{type:d.type,offsetOctet:0}),h=0,j=g(d.type),k=g(d.type2),l=0;c>l;++l)h+=j+f(h)*k;b.offsetOctet+=h}else b.offsetLine+=c};f.importPLY=function(a,b){for(var c=j(a),e=c.elements,f=0,g=e.length;g>f;++f){var h=e[f];"vertex"===h.name?n(h,c):"face"===h.name?q(h,c):r(h,c)}var i=new d(b);return i.setVertices(c.vertices),i.setFaces(c.faces),i.setColors(c.colors),[i]},c.exports=f}),define("files/ImportSTL",["require","exports","module","mesh/Mesh","misc/Utils"],function(a,b,c){"use strict";var d=a("mesh/Mesh"),e=a("misc/Utils"),f={};f.importSTL=function(a,b){var c,g=new Uint32Array(a,80,1)[0]||0,h=84+50*g===a.byteLength,i=h?f.importBinarySTL(a,g):f.importAsciiSTL(e.ab2str(a));h&&(c=i[1],i=i[0]),g=i.length/9;for(var j=new Map,k=[0],l=new Int32Array(4*g),m=0;g>m;++m){var n=4*m,o=9*m;l[n]=f.detectNewVertex(j,i,c,o,k),l[n+1]=f.detectNewVertex(j,i,c,o+3,k),l[n+2]=f.detectNewVertex(j,i,c,o+6,k),l[n+3]=-1}var p=new d(b);return p.setVertices(i.subarray(0,3*k[0])),c&&p.setColors(c.subarray(0,3*k[0])),p.setFaces(l),[p]},f.detectNewVertex=function(a,b,c,d,e){var f=b[d],g=b[d+1],h=b[d+2],i=f+"+"+g+"+"+h,j=a.get(i);if(void 0===j){j=e[0],a.set(i,j);var k=3*j;b[k]=f,b[k+1]=g,b[k+2]=h,c&&(c[k]=c[d],c[k+1]=c[d+1],c[k+2]=c[d+2]),e[0]++}return j},f.importAsciiSTL=function(a){for(var b=a.split("\n"),c=b.length,d=new Float32Array(Math.ceil(9*c/7)),e=0,f=0;c>f;++f){var g=b[f].trim();if(g.startsWith("facet")){var h=b[f+2].trim().split(/\s+/);d[e++]=parseFloat(h[1]),d[e++]=parseFloat(h[2]),d[e++]=parseFloat(h[3]),h=b[f+3].trim().split(/\s+/),d[e++]=parseFloat(h[1]),d[e++]=parseFloat(h[2]),d[e++]=parseFloat(h[3]),h=b[f+4].trim().split(/\s+/),d[e++]=parseFloat(h[1]),d[e++]=parseFloat(h[2]),d[e++]=parseFloat(h[3])}}return d.subarray(0,e)},f.importBinarySTL=function(a,b){var c=new Uint8Array(a),d=0,e=new Uint8Array(36*b),f=new Uint8Array(2*b),g=96,h=0,i=0;for(d=0;b>d;d++){for(var j=0;36>j;++j)e[h++]=c[g++];f[i++]=c[g++],f[i++]=c[g++],g+=12}var k=new Uint16Array(f.buffer);f=new Float32Array(9*b);var l=1/31;for(d=0;b>d;++d){h=9*d;var m=k[d],n=32768&m;f[h]=f[h+3]=f[h+6]=n?(m>>10&31)*l:1,f[h+1]=f[h+4]=f[h+7]=n?(m>>5&31)*l:1,f[h+2]=f[h+5]=f[h+8]=n?(31&m)*l:1}return[new Float32Array(e.buffer),f]},c.exports=f}),define("files/Import",["require","exports","module","files/ImportOBJ","files/ImportSGL","files/ImportPLY","files/ImportSTL"],function(a,b,c){"use strict";var d=a("files/ImportOBJ"),e=a("files/ImportSGL"),f=a("files/ImportPLY"),g=a("files/ImportSTL"),h={importOBJ:d.importOBJ,importSGL:e.importSGL,importPLY:f.importPLY,importSTL:g.importSTL};c.exports=h}),define("lib/yagui",["require","exports","module"],function(a,b,c){"use strict";c.exports=window.yagui}),define("gui/GuiBackground",["require","exports","module","gui/GuiTR"],function(a,b,c){"use strict";var d=a("gui/GuiTR"),e=function(a,b){this._main=b._main,this._menu=null,this.init(a)};e.prototype={init:function(a){var b=this._menu=a.addMenu(d("backgroundTitle"));b.addButton(d("backgroundReset"),this,"resetBackground"),b.addButton(d("backgroundImport"),this,"importBackground"),b.addCheckbox(d("backgroundFill"),this._main.getBackground()._fill,this.updateFill.bind(this))},updateFill:function(a){this._main.getBackground()._fill=a,this._main.onCanvasResize()},resetBackground:function(){this._main.getBackground().deleteTexture(),this._main.render()},importBackground:function(){document.getElementById("backgroundopen").click()}},c.exports=e}),define("gui/GuiCamera",["require","exports","module","gui/GuiTR"],function(a,b,c){"use strict";var d=a("gui/GuiTR"),e=function(a,b){this._main=b._main,this._menu=null,this._camera=this._main.getCamera(),this._cameraTimer=-1,this._cbTranslation=this.cbOnTranslation.bind(this),this.init(a)};e.prototype={init:function(a){var b=this._camera,c=this._menu=a.addMenu(d("cameraTitle"));c.addTitle(d("cameraReset")),c.addDualButton(d("cameraCenter"),d("cameraFront"),this.resetCamera.bind(this),this.resetFront.bind(this)),c.addDualButton(d("cameraLeft"),d("cameraTop"),this.resetLeft.bind(this),this.resetTop.bind(this));var e={};this._ctrlProjectionTitle=c.addTitle(d("cameraProjection")),e.PERSPECTIVE=d("cameraPerspective"),e.ORTHOGRAPHIC=d("cameraOrthographic"),this._ctrlProjection=c.addCombobox("",b.getProjectionType(),this.onCameraTypeChange.bind(this),e),this._ctrlFov=c.addSlider(d("cameraFov"),b.getFov(),this.onFovChange.bind(this),10,90,1),this._ctrlFov.setVisibility("PERSPECTIVE"===b.getProjectionType());var f={};c.addTitle(d("cameraMode")),f.ORBIT=d("cameraOrbit"),f.SPHERICAL=d("cameraSpherical"),f.PLANE=d("cameraPlane"),c.addCombobox("",b.getMode(),this.onCameraModeChange.bind(this),f),this._ctrlPivot=c.addCheckbox(d("cameraPivot"),b.getUsePivot(),this.onPivotChange.bind(this))},onCameraModeChange:function(a){this._camera.setMode(a),this._main.render(),setTimeout(function(){window.umgl.drawonce()},220)},onCameraTypeChange:function(a){this._camera.setProjectionType(a),this._ctrlFov.setVisibility("PERSPECTIVE"===a),this._main.render()},onFovChange:function(a){this._camera.setFov(a),this._main.render()},onKeyDown:function(a){if(a.handled!==!0&&(a.stopPropagation(),!this._main._focusGui)){a.preventDefault();var b=a.which,c=this._main,d=c.getCamera();switch(a.handled=!0,a.shiftKey&&"CAMERA_ROTATE"===c._action&&(d.snapClosestRotation(),c.render()),b){case 37:d._moveX=-1;break;case 39:d._moveX=1;break;case 38:d._moveZ=-1;break;case 40:d._moveZ=1;break;default:a.handled=!1}a.handled===!0&&-1===this._cameraTimer&&(this._cameraTimer=window.setInterval(this._cbTranslation,16.6))}},cbOnTranslation:function(){var a=this._main;a.getCamera().updateTranslation(),a.render()},onKeyUp:function(a){if(a.handled!==!0&&(a.stopPropagation(),!this._main._focusGui)){a.preventDefault(),a.handled=!0;var b=a.which,c=this._camera;switch(b){case 37:case 39:c._moveX=0;break;case 38:case 40:c._moveZ=0;break;case 32:this.resetCamera();break;case 70:this.resetFront();break;case 84:this.resetTop();break;case 76:this.resetLeft()}-1!==this._cameraTimer&&0===c._moveX&&0===c._moveZ&&(clearInterval(this._cameraTimer),this._cameraTimer=-1)}},resetCamera:function(){this._camera.resetView(),this._main.render(),setTimeout(function(){window.umgl.drawonce()},220)},resetFront:function(){this._camera.toggleViewFront(),this._main.render(),setTimeout(function(){window.umgl.drawonce()},220)},resetLeft:function(){this._camera.toggleViewLeft(),this._main.render(),setTimeout(function(){window.umgl.drawonce()},220)},resetTop:function(){this._camera.toggleViewTop(),this._main.render(),setTimeout(function(){window.umgl.drawonce()},220)},onPivotChange:function(){this._camera.toggleUsePivot(),this._main.render()}},c.exports=e}),define("gui/GuiConfig",["require","exports","module","gui/GuiTR"],function(a,b,c){"use strict";var d=a("gui/GuiTR"),e=function(a,b){this._ctrlGui=b,this._menu=null,this.init(a)};e.prototype={init:function(a){this._langs=Object.keys(d.languages),this._menu=a.addMenu("Language"),this._menu.addCombobox("",this._langs.indexOf(d.select),this.onLangChange.bind(this),this._langs)},onLangChange:function(a){d.select=this._langs[parseInt(a,10)],this._ctrlGui.initGui()}},c.exports=e}),define("lib/FileSaver",["require","exports","module"],function(a,b,c){"use strict";c.exports=window.saveAs}),define("files/ExportOBJ",["require","exports","module","lib/glMatrix"],function(a,b,c){"use strict";var d=a("lib/glMatrix"),e=d.vec3,f={};f.exportOBJ=function(a,b){for(var c="s 0\n",d=[1,1],e=0,g=a.length;g>e;++e)c+="o mesh_"+e+"\n",c=f.addMesh(a[e],c,d,b);return new Blob([c])},f.addMesh=function(a,b,c,d){var f=a.getVertices(),g=a.getColors(),h=a.getMaterials(),i=a.getFaces(),j=a.getNbVertices(),k=a.getNbFaces(),l=a.getMatrix(),m=0,n=0,o=[0,0,0];for(m=0;j>m;++m)n=3*m,o[0]=f[n],o[1]=f[n+1],o[2]=f[n+2],e.transformMat4(o,o,l),b+="v "+o[0]+" "+o[1]+" "+o[2],b+=d?" "+g[n]+" "+g[n+1]+" "+g[n+2]+"\n":"\n";if(!d){var p=Math.ceil(j/64);for(m=0;p>m;++m){b+="#MRGB ",n=64*m;for(var q=n+(m===p-1?j%64:64);q>n;++n){b+="ff";var r=3*n,s=Math.round(255*g[r]).toString(16),t=Math.round(255*g[r+1]).toString(16),u=Math.round(255*g[r+2]).toString(16);b+=1===s.length?"0"+s:s,b+=1===t.length?"0"+t:t,b+=1===u.length?"0"+u:u}b+="\n"}for(p=Math.ceil(j/46),m=0;p>m;++m){b+="#MAT ",n=46*m;for(var v=n+(m===p-1?j%46:46);v>n;++n){var w=3*n,x=Math.round(255*h[w]).toString(16),y=Math.round(255*h[w+1]).toString(16),z=Math.round(255*h[w+2]).toString(16);b+=1===x.length?"0"+x:x,b+=1===y.length?"0"+y:y,b+=1===z.length?"0"+z:z}b+="\n"}}var A=a.getNbTexCoords(),B=a.getFacesTexCoord(),C=a.getTexCoords(),D=a.hasUV();for(m=0;A>m;++m)n=2*m,b+="vt "+C[n]+" "+C[n+1]+"\n";var E=c[0],F=c[1];for(c[0]+=j,c[1]+=A,m=0;k>m;++m){n=4*m;var G=i[n+3];D?(b+="f "+(E+i[n])+"/"+(F+B[n]),b+=" "+(E+i[n+1])+"/"+(F+B[n+1]),b+=" "+(E+i[n+2])+"/"+(F+B[n+2]),b+=G>=0?" "+(E+G)+"/"+(F+B[n+3])+"\n":"\n"):(b+="f "+(E+i[n]),b+=" "+(E+i[n+1]),b+=" "+(E+i[n+2]),b+=G>=0?" "+(E+G)+"\n":"\n")}return b},c.exports=f}),define("files/ExportPLY",["require","exports","module","misc/Utils","editing/Remesh"],function(a,b,c){"use strict";var d=a("misc/Utils"),e=a("editing/Remesh"),f={};f.exportAsciiPLY=function(a){var b=a.getVertices(),c=a.getColors(),d=a.getFaces(),e="ply\nformat ascii 1.0\ncomment created by SculptGL\n",f=a.getNbVertices(),g=a.getNbFaces(),h=0,i=0;for(e+="element vertex "+f+"\n",e+="property float x\nproperty float y\nproperty float z\n",e+="property uchar red\nproperty uchar green\nproperty uchar blue\n",e+="element face "+g+"\n",e+="property list uchar uint vertex_indices\nend_header\n",h=0;f>h;++h)i=3*h,e+=b[i]+" "+b[i+1]+" "+b[i+2]+" "+(255*c[i]|0)+" "+(255*c[i+1]|0)+" "+(255*c[i+2]|0)+"\n";for(h=0;g>h;++h){i=4*h;var j=d[i+3];e+=(j>=0?"4 ":"3 ")+d[i]+" "+d[i+1]+" "+d[i+2]+(j>=0?" "+j+"\n":"\n")}return new Blob([e])},f.exportBinaryPLY=function(a,b){var c=a.length?a:[a],f=c.length,g=0,h=0,i=0,j=0,k=0,l=0,m=0;for(g=0;f>g;++g)j+=c[g].getNbVertices(),k+=c[g].getNbFaces(),l+=c[g].getNbQuads(),m+=c[g].getNbTriangles();var n,o,p;if(b){var q={vertices:null,colors:null,faces:null};for(e.mergeArrays(c,q),n=q.vertices,o=d.convertArrayVec3toLinear(q.colors),p=q.faces,g=0;j>g;++g){i=3*g;var r=n[i+1];n[i+1]=-n[i+2],n[i+2]=r}}else n=c[0].getVertices(),o=c[0].getColors(),p=c[0].getFaces();var s=d.littleEndian?"little":"big",t="ply\nformat binary_"+s+"_endian 1.0\ncomment created by SculptGL\n";t+="element vertex "+j+"\n",t+="property float x\nproperty float y\nproperty float z\n",t+="property uchar red\nproperty uchar green\nproperty uchar blue\n",t+="element face "+k+"\n",t+="property list uchar uint vertex_indices\nend_header\n";var u=4*n.length+o.length,v=4*(4*l+3*m)+k,w=t.length+u+2*v,x=new Uint8Array(w),y=new DataView(x.buffer);h=t.length;var z=0;for(z=0;h>z;++z)x[z]=t.charCodeAt(z);for(g=0;j>g;++g)h=3*g,y.setFloat32(z,n[h],!0),z+=4,y.setFloat32(z,n[h+1],!0),z+=4,y.setFloat32(z,n[h+2],!0),z+=4,y.setUint8(z,Math.round(255*o[h])),z+=1,y.setUint8(z,Math.round(255*o[h+1])),z+=1,y.setUint8(z,Math.round(255*o[h+2])),z+=1;for(g=0;k>g;++g){h=4*g;var A=p[h+3]>=0;y.setUint8(z,A?4:3),z+=1,y.setUint32(z,p[h],!0),z+=4,y.setUint32(z,p[h+1],!0),z+=4,y.setUint32(z,p[h+2],!0),z+=4,A&&(y.setUint32(z,p[h+3],!0),z+=4)}return new Blob([x])},c.exports=f}),define("files/ExportSTL",["require","exports","module","misc/Utils"],function(a,b,c){"use strict";var d=a("misc/Utils"),e={};e.exportAsciiSTL=function(a){var b=a.getVertices(),c=a.getTriangles(),e=a.getFaceNormals(),f=new Float32Array(d.getMemory(4*e.length),0,e.length);d.normalizeArrayVec3(e,f);for(var g="solid mesh\n",h=a.getNbTriangles(),i=0;h>i;++i){var j=3*i;g+=" facet normal "+f[j]+" "+f[j+1]+" "+f[j+2]+"\n",g+="  outer loop\n";var k=3*c[j],l=3*c[j+1],m=3*c[j+2];g+="   vertex "+b[k]+" "+b[k+1]+" "+b[k+2]+"\n",g+="   vertex "+b[l]+" "+b[l+1]+" "+b[l+2]+"\n",g+="   vertex "+b[m]+" "+b[m+1]+" "+b[m+2]+"\n",g+="  endloop\n",g+=" endfacet\n"}return g+="endsolid mesh\n",new Blob([g])},e.exportBinarySTL=function(a){var b=a.getVertices(),c=a.getColors(),e=a.getTriangles(),f=a.getFaceNormals(),g=new Float32Array(d.getMemory(4*f.length),0,f.length);d.normalizeArrayVec3(f,g);var h=a.getNbTriangles(),i=new Uint8Array(84+50*h),j=new Uint8Array(new Uint32Array([h]).buffer);i.set(j,80);for(var k=new Uint8Array(b.buffer),l=new Uint8Array(g.buffer),m=84,n=0,o=31/3,p=0;h>p;++p){var q=12*p;for(n=0;12>n;++n)i[m++]=l[q++];q=3*p;var r=3*e[q],s=3*e[q+1],t=3*e[q+2],u=4*r;for(n=0;12>n;++n)i[m++]=k[u++];var v=4*s;for(n=0;12>n;++n)i[m++]=k[v++];var w=4*t;for(n=0;12>n;++n)i[m++]=k[w++];var x=Math.round((c[r]+c[s]+c[t])*o)<<10,y=Math.round((c[r+1]+c[s+1]+c[t+1])*o)<<5,z=Math.round((c[r+2]+c[s+2]+c[t+2])*o),A=x+y+z+32768;i[m++]=255&A,i[m++]=A>>8}return new Blob([i])},c.exports=e}),define("lib/zip",["require","exports","module"],function(a,b,c){"use strict";c.exports=window.zip}),define("files/ExportSketchfab",["require","exports","module","gui/GuiTR","lib/zip","files/ExportPLY"],function(a,b,c){"use strict";var d=a("gui/GuiTR"),e=a("lib/zip"),f=a("files/ExportPLY"),g={};g.exportSketchfab=function(a,b,c){var h=new XMLHttpRequest,i=c.domContainer;c.setVisibility(!0),c.sketchfab=!0,i.innerHTML="Uploading...",h.open("POST","https://api.sketchfab.com/v2/models",!0),h.onprogress=function(a){a.lengthComputable&&(i.innerHTML="Uploading : "+Math.round(100*a.loaded/a.total)+"%")};var j=function(){c.setVisibility(!1),c.sketchfab=!1};return h.onerror=j,h.onabort=j,h.onload=function(){j();var a=JSON.parse(h.responseText),c=a.uid;if(!c)return void window.alert(d("sketchfabUploadError",a.detail));window.prompt(d("sketchfabUploadProcessing"),"https://sketchfab.com/models/"+c);var e=function(){var a=new XMLHttpRequest;a.open("GET","https://api.sketchfab.com/v2/models/"+c+"/status?token="+b,!0),a.onload=function(){var b=JSON.parse(a.responseText);"FAILED"===b.processing?window.alert(d("sketchfabUploadError",b.warning.generic.join("\n"))):"SUCCEEDED"===b.processing?window.prompt(d("sketchfabUploadSuccess"),"https://sketchfab.com/models/"+c):window.setTimeout(e,5e3)},a.send()};e()},e.useWebWorkers=!0,e.workerScriptsPath="worker/",e.createWriter(new e.BlobWriter("application/zip"),function(c){var d=f.exportBinaryPLY(a.getMeshes(),!0);c.add("yourMesh.ply",new e.BlobReader(d),function(){c.close(g.exportFileSketchfab.bind(this,a,b,h))})},onerror),h},g.exportFileSketchfab=function(a,b,c,d){var e=new FormData;e.append("token",b),e.append("modelFile",d,"sculptglModel.zip"),e.append("name","My model"),e.append("tags","sculptgl"),c.send(e)},c.exports=g}),define("files/Export",["require","exports","module","files/ExportOBJ","files/ExportSGL","files/ExportPLY","files/ExportSTL","files/ExportSketchfab"],function(a,b,c){"use strict";var d=a("files/ExportOBJ"),e=a("files/ExportSGL"),f=a("files/ExportPLY"),g=a("files/ExportSTL"),h=a("files/ExportSketchfab"),i={};i.exportOBJ=d.exportOBJ,i.exportSGL=e.exportSGL,i.exportAsciiPLY=f.exportAsciiPLY,i.exportBinaryPLY=f.exportBinaryPLY,i.exportAsciiSTL=g.exportAsciiSTL,i.exportBinarySTL=g.exportBinarySTL,i.exportSketchfab=h.exportSketchfab,c.exports=i}),define("gui/GuiFiles",["require","exports","module","gui/GuiTR","lib/FileSaver","files/Export"],function(a,b,c){"use strict";var d=a("gui/GuiTR"),e=a("lib/FileSaver"),f=a("files/Export"),g=function(a,b){this._main=b._main,this._ctrlGui=b,this._menu=null,this._parent=a,this.init(a)};g.prototype={init:function(a){var b=this._menu=a.addMenu(d("fileTitle"));b.addTitle(d("fileImportTitle")),b.addButton(d("fileAdd"),this,"addFile"),b.addCheckbox(d("fileAutoMatrix"),this._main,"_autoMatrix"),b.addCheckbox(d("fileVertexSRGB"),this._main,"_vertexSRGB"),b.addTitle(d("fileExportSceneTitle")),b.addButton(d("fileExportSGL"),this,"saveFileAsSGL"),b.addButton(d("fileExportOBJ"),this,"saveFileAsOBJ"),b.addButton(d("sketchfabTitle"),this,"exportSketchfab"),b.addTitle(d("fileExportMeshTitle")),b.addButton(d("fileExportPLY"),this,"saveFileAsPLY"),b.addButton(d("fileExportSTL"),this,"saveFileAsSTL")},addFile:function(){document.getElementById("fileopen").click()},saveFileAsSGL:function(){if(0!==this._main.getMeshes().length){var a=f.exportSGL(this._main.getMeshes(),this._main);e(a,"yourMesh.sgl")}},saveFileAsOBJ:function(a){var b=this._main.getMeshes();if(0!==b.length&&(!a||(b=this._main.getSelectedMeshes(),b[0]))){var c=f.exportOBJ(b);e(c,"yourMesh.obj")}},saveFileAsPLY:function(){var a=this._main.getMesh();if(a){var b=f.exportBinaryPLY(a);e(b,"yourMesh.ply")}},saveFileAsSTL:function(){var a=this._main.getMesh();if(a){var b=f.exportBinarySTL(a);e(b,"yourMesh.stl")}},exportSketchfab:function(){var a=this._main.getMesh();if(a){var b=this._ctrlGui.getWidgetNotification();if(this._sketchfabXhr&&b.sketchfab===!0){if(!window.confirm(d("sketchfabAbort")))return;b.sketchfab=!1,this._sketchfabXhr.abort()}var c=window.prompt(d("sketchfabUploadMessage"),"guest");if(c){var e="guest"===c?"babc9a5cd4f343f9be0c7bd9cf93600c":c;this._sketchfabXhr=f.exportSketchfab(this._main,e,b)}}},onKeyDown:function(a){if(a.handled!==!0){a.stopPropagation(),this._main._focusGui||a.preventDefault();var b=a.which;a.ctrlKey&&a.altKey&&78===b?(this._main.clearScene(),a.handled=!0):!a.ctrlKey||79!==b&&73!==b?a.ctrlKey&&69===b&&(this.saveFileAsOBJ(a.altKey),a.handled=!0):(this.addFile(),a.handled=!0)}}},c.exports=g}),define("gui/GuiMesh",["require","exports","module","gui/GuiTR"],function(a,b,c){"use strict";var d=a("gui/GuiTR"),e=function(a,b){this._main=b._main,this.domVerts=null,this.domFaces=null,this.domUl=null,this.init(a)};e.prototype={init:function(a){this.domVerts=document.createElement("ul"),this.domVerts.innerHTML=d("meshNbVertices"),this.domFaces=document.createElement("ul"),this.domFaces.innerHTML=d("meshNbFaces"),this.domUl=document.createElement("span"),this.domUl.appendChild(this.domVerts),this.domUl.appendChild(this.domFaces);var b=this.domUl.style;b.cursor="default",void 0===b["float"]?b.cssFloat="right":b["float"]="right",a.domTopbar.appendChild(this.domUl)},updateMeshInfo:function(){var a=this._main.getMesh();this.domVerts.innerHTML=d("meshNbVertices")+(a?a.getNbVertices():0),this.domFaces.innerHTML=d("meshNbFaces")+(a?a.getNbFaces():0)}},c.exports=e}),define("mesh/multiresolution/MeshResolution",["require","exports","module","misc/Utils","editing/Subdivision","mesh/Mesh"],function(a,b,c){"use strict";var d=a("misc/Utils"),e=a("editing/Subdivision"),f=a("mesh/Mesh"),g=function(a,b,c){this._meshOrigin=c||new f,c&&this._meshOrigin.setID(c.getID()),this._meshOrigin.setTransformData(a),this._meshOrigin.setRender(b),this._detailsXYZ=null,this._detailsRGB=null,this._detailsPBR=null,this._vertMapping=null,this._evenMapping=!1};g.prototype={getMeshOrigin:function(){return this._meshOrigin},getDetailsVertices:function(){return this._detailsXYZ},getDetailsColors:function(){return this._detailsRGB},getDetailsMaterials:function(){return this._detailsPBR},getEvenMapping:function(){return this._evenMapping},getVerticesMapping:function(){return this._vertMapping},setDetailsVertices:function(a){this._detailsXYZ=a},setDetailsColors:function(a){this._detailsRGB=a},setDetailsMaterials:function(a){this._detailsPBR=a},setVerticesMapping:function(a){this._vertMapping=a},setEvenMapping:function(a){this._evenMapping=a},higherSynthesis:function(a){a.computePartialSubdivision(this.getVertices(),this.getColors(),this.getMaterials()),this.applyDetails()},lowerAnalysis:function(a){this.copyDataFromHigherRes(a);var b=new Float32Array(3*a.getNbVertices()),c=new Float32Array(3*a.getNbVertices()),d=new Float32Array(3*a.getNbVertices());this.computePartialSubdivision(b,c,d),a.computeDetails(b,c,d)},copyDataFromHigherRes:function(a){var b=this.getVertices(),c=this.getColors(),d=this.getMaterials(),e=this.getNbVertices(),f=a.getVertices(),g=a.getColors(),h=a.getMaterials();if(this.getEvenMapping()===!1)b.set(f.subarray(0,3*e)),c.set(g.subarray(0,3*e)),d.set(h.subarray(0,3*e));else for(var i=this.getVerticesMapping(),j=0;e>j;++j){var k=3*j,l=3*i[j];b[k]=f[l],b[k+1]=f[l+1],b[k+2]=f[l+2],c[k]=g[l],c[k+1]=g[l+1],c[k+2]=g[l+2],d[k]=h[l],d[k+1]=h[l+1],d[k+2]=h[l+2]}},computePartialSubdivision:function(a,b,c){var d=a,f=b,g=c,h=this.getVerticesMapping();if(h&&(d=new Float32Array(a.length),f=new Float32Array(b.length),g=new Float32Array(c.length)),e.partialSubdivision(this,d,f,g),h){var i=this.getEvenMapping()===!0?0:this.getNbVertices();i>0&&(a.set(d.subarray(0,3*i)),b.set(f.subarray(0,3*i)),c.set(g.subarray(0,3*i)));for(var j=i,k=a.length/3;k>j;++j){var l=3*j,m=3*h[j];a[m]=d[l],a[m+1]=d[l+1],a[m+2]=d[l+2],b[m]=f[l],b[m+1]=f[l+1],b[m+2]=f[l+2],c[m]=g[l],c[m+1]=g[l+1],c[m+2]=g[l+2]}}},applyDetails:function(){var a=this.getVerticesRingVertStartCount(),b=this.getVerticesRingVert(),c=this.getVertices(),e=this.getNormals(),f=this.getColors(),g=this.getMaterials(),h=this.getNbVertices(),i=new Float32Array(d.getMemory(4*c.length),0,c.length);i.set(c);for(var j=this.getDetailsVertices(),k=this.getDetailsColors(),l=this.getDetailsMaterials(),m=Math.min,n=Math.max,o=0;h>o;++o){var p=3*o;f[p]=m(1,n(0,f[p]+k[p])),f[p+1]=m(1,n(0,f[p+1]+k[p+1])),f[p+2]=m(1,n(0,f[p+2]+k[p+2])),g[p]=m(1,n(0,g[p]+l[p])),g[p+1]=m(1,n(0,g[p+1]+l[p+1])),g[p+2]=m(1,n(0,g[p+2]+l[p+2]));var q=i[p],r=i[p+1],s=i[p+2],t=e[p],u=e[p+1],v=e[p+2],w=t*t+u*u+v*v;if(0!==w){w=1/Math.sqrt(w),t*=w,u*=w,v*=w;var x=3*b[a[2*o]],y=i[x]-q,z=i[x+1]-r,A=i[x+2]-s;if(w=y*t+z*u+A*v,y-=t*w,z-=u*w,A-=v*w,w=y*y+z*z+A*A,0!==w){w=1/Math.sqrt(w),y*=w,z*=w,A*=w;var B=u*A-v*z,C=v*y-t*A,D=t*z-u*y,E=j[p],F=j[p+1],G=j[p+2];c[p]=q+t*E+y*F+B*G,c[p+1]=r+u*E+z*F+C*G,c[p+2]=s+v*E+A*F+D*G}}}},computeDetails:function(a,b,c){var d=this.getVerticesRingVertStartCount(),e=this.getVerticesRingVert(),f=this.getVertices(),g=this.getNormals(),h=this.getColors(),i=this.getMaterials(),j=this.getNbVertices(),k=new Float32Array(a.length);this.setDetailsVertices(k);var l=new Float32Array(a.length);this.setDetailsColors(l);var m=new Float32Array(a.length);this.setDetailsMaterials(m);for(var n=0;j>n;++n){var o=3*n;l[o]=h[o]-b[o],l[o+1]=h[o+1]-b[o+1],l[o+2]=h[o+2]-b[o+2],m[o]=i[o]-c[o],m[o+1]=i[o+1]-c[o+1],m[o+2]=i[o+2]-c[o+2];var p=g[o],q=g[o+1],r=g[o+2],s=p*p+q*q+r*r;if(0!==s){s=1/Math.sqrt(s),p*=s,q*=s,r*=s;var t=3*e[d[2*n]],u=a[t]-a[o],v=a[t+1]-a[o+1],w=a[t+2]-a[o+2];if(s=u*p+v*q+w*r,u-=p*s,v-=q*s,w-=r*s,s=u*u+v*v+w*w,0!==s){s=1/Math.sqrt(s),u*=s,v*=s,w*=s;var x=q*w-r*v,y=r*u-p*w,z=p*v-q*u,A=f[o]-a[o],B=f[o+1]-a[o+1],C=f[o+2]-a[o+2];k[o]=p*A+q*B+r*C,k[o+1]=u*A+v*B+w*C,k[o+2]=x*A+y*B+z*C}}}}},d.makeProxy(f,g,function(a){return function(){return a.apply(this.getMeshOrigin(),arguments)}}),c.exports=g}),define("mesh/multiresolution/LowRender",["require","exports","module","misc/Utils","mesh/Render","render/ShaderLib","render/Buffer"],function(a,b,c){"use strict";var d=a("misc/Utils"),e=a("mesh/Render"),f=a("render/ShaderLib"),g=a("render/Buffer"),h=function(a){this._renderOrigin=a;var b=a.getGL();this._indexBuffer=new g(b,b.ELEMENT_ARRAY_BUFFER,b.STATIC_DRAW),this._wireframeBuffer=new g(b,b.ELEMENT_ARRAY_BUFFER,b.STATIC_DRAW)};h.prototype={getRenderOrigin:function(){return this._renderOrigin},getIndexBuffer:function(){return this._indexBuffer},getWireframeBuffer:function(){return this._wireframeBuffer},isUsingDrawArrays:function(){return!1},updateBuffers:function(a){this.getIndexBuffer().update(a.getTriangles()),this.getWireframeBuffer().update(a.getWireframe())},render:function(a){f[this.getShaderName()].getOrCreate(this.getGL()).draw(this,a)},renderWireframe:function(a){f.WIREFRAME.getOrCreate(this.getGL()).draw(this,a)},release:function(){this.getIndexBuffer().release(),this.getWireframeBuffer().release()}},d.makeProxy(e,h,function(a){return function(){return a.apply(this.getRenderOrigin(),arguments)}}),c.exports=h}),define("editing/Reversion",["require","exports","module","misc/Utils"],function(a,b,c){"use strict";var d=a("misc/Utils"),e={},f=function(a){for(var b=a.getNbVertices(),c=a.getFaces(),d=a.getVerticesOnEdge(),e=a.getVerticesRingVertStartCount(),f=a.getVerticesRingFace(),g=a.getVerticesRingFaceStartCount(),h=new Int8Array(b),i=0,j=b;j>i;++i){for(var k=2*i,l=e[k+1],m=g[k],n=g[k+1],o=d[i],p=0,q=m,r=m+n;r>q;++q)p+=c[4*f[q]+3]<0?0:1;0===p?(!o&&6!==l||o&&4!==l)&&(h[i]=1):p===n?(!o&&4!==l||o&&3!==l)&&(h[i]=1):(o||5!==l)&&(h[i]=1)}return h},g=function(a,b,c){var d=0,e=a.getNbVertices();for(d=0;e>d;++d)if(0===b[d]&&1===c[d])return d;var f=a.getVerticesOnEdge();for(d=0;e>d&&(0!==b[d]||1===f[d]);++d);if(d===e)return-1;for(d=0;e>d;++d)if(0===b[d])return d;return-1},h=function(a,b,c){var e=++d.TAG_FLAG,f=a.getVerticesTagFlags(),h=a.getVerticesRingVertStartCount(),i=a.getVerticesRingVert(),j=a.getVerticesOnEdge(),k=g(a,b,c);if(!(0>k)){b[k]=1;var l=new Uint32Array(d.getMemory(4*a.getNbVertices()),0,a.getNbVertices());l[0]=k;for(var m=1;m>0;){var n=l[--m],o=h[2*n],p=o+h[2*n+1],q=0,r=++e;for(q=o;p>q;++q){var s=i[q];if(f[s]=r,1===b[s])return void(d.TAG_FLAG=e);b[s]=-1,f[s]=r}for(r=++e,q=o;p>q;++q){var t=i[q];if(0!==c[t]&&!j[t])return void(d.TAG_FLAG=e);for(var u=h[2*t],v=u+h[2*t+1],w=u;v>w;++w){var x=i[w];if(x!==n&&!(f[x]>=r-1)&&(f[x]=r,0===b[x])){for(var y=h[2*x],z=y+h[2*x+1],A=0,B=y;z>B;++B)f[i[B]]===r-1&&A++;2===A?b[x]=-1:(b[x]=1,l[m++]=x)}}}}return d.TAG_FLAG=e,b}},i=function(a){for(var b=a.getNbVertices(),c=new Int8Array(b),d=f(a),e=!0;e;){var g=h(a,c,d);if(!g)return;e=!1;for(var i=0;b>i;++i)if(0===c[i]){e=!0;break}}return c},j=function(a,b,c){var d=a.getFaceEdges(),e=a.getFaces(),f=new Int32Array(a.getNbEdges()),g=0,h=a.getNbFaces(),i=0,j=new Int32Array(h/4),k=new Int32Array(a.getNbVertices()),l=new Int32Array(h);for(g=0;h>g;++g)l[g]=-1;for(g=0;h>g;++g){var m=4*g,n=e[m],o=e[m+1],p=e[m+2],q=e[m+3],r=c[n],s=c[o],t=c[p];if(0>q){if(r+s+t===-3){j[i++]=g;continue}1===r?f[d[m+1]]=n+1:1===s?f[d[m+2]]=o+1:1===t&&(f[d[m]]=p+1)}else{var u=0,v=0,w=0;1===r?(u=n,v=p,w=f[d[m+1]]-1,f[d[m+2]]=n+1):1===s?(u=o,v=q,w=f[d[m+2]]-1,f[d[m+3]]=o+1):1===t?(u=p,v=n,w=f[d[m+3]]-1,f[d[m]]=p+1):(u=q,v=o,w=f[d[m]]-1,f[d[m+1]]=q+1);var x=k[v]-1;if(0>x)j[i]=-v-1,l[4*i+3]=u,k[v]=++i;else{var y=4*x;0>w?l[y+2]<0?(l[y+2]=u,l[y]=-2):-1===l[y]?l[y+1]=u:(l[y+1]=l[y+2],l[y+2]=u):l[y+1]===w?l[y]=u:(l[y]=l[y+1],l[y+2]===w?l[y+1]=u:(l[y+1]=l[y+2],l[y+2]=u));
}}}for(h/=4,g=0;h>g;++g){var z=j[g],A=4*g;if(0>z){if(l[A]<0||l[A+1]<0||l[A+2]<0)return!1}else{var B=4*z;l[A]=f[d[B]]-1,l[A+1]=f[d[B+1]]-1,l[A+2]=f[d[B+2]]-1}}return b.setFaces(l),j},k=function(a,b,c){var d=0,e=new Uint32Array(a.getNbVertices());b.setVerticesMapping(e);var f=b.getFaces(),g=new Float32Array(a.getNbVertices()),h=0,i=f.length;for(h=0;i>h;++h){var j=f[h];if(-1!==j){var k=g[j]-1;-1===k&&(k=d++,g[j]=k+1,e[k]=j),f[h]=k}}b.setVertices(new Float32Array(3*d));var l=a.getFaces(),m=a.getVerticesRingFace(),n=a.getVerticesRingFaceStartCount(),o=new Uint8Array(a.getNbVertices());for(i/=4,h=0;i>h;++h){var p,q,r,s,t,u,v,w,x,y,z=c[h];if(z>=0){var A=4*z;p=l[A+1],q=l[A+2],r=l[A],s=-1,t=-1}else{t=-z-1;for(var B=4*h,C=e[f[B]],D=e[f[B+1]],E=e[f[B+2]],F=e[f[B+3]],G=n[2*t],H=G+4,I=G;H>I;++I){var J=4*m[I],K=l[J],L=l[J+1],M=l[J+2],N=l[J+3];K===C?p=L:L===C?p=M:M===C?p=N:N===C&&(p=K),K===D?q=L:L===D?q=M:M===D?q=N:N===D&&(q=K),K===E?r=L:L===E?r=M:M===E?r=N:N===E&&(r=K),K===F?s=L:L===F?s=M:M===F?s=N:N===F&&(s=K)}}u=o[p],v=o[q],w=o[r],x=s>=0?o[s]:-1,y=t>=0?o[t]:-1,0===u&&(o[p]=1,e[d++]=p),0===v&&(o[q]=1,e[d++]=q),0===w&&(o[r]=1,e[d++]=r),0===x&&(o[s]=1,e[d++]=s),0===y&&(o[t]=1,e[d++]=t)}},l=function(a,b){var c=a.getVertices(),d=a.getColors(),e=a.getMaterials(),f=b.getVertices(),g=new Float32Array(f.length),h=new Float32Array(f.length);b.setColors(g),b.setMaterials(h);var i=b.getVerticesMapping(),j=0,k=b.getNbVertices();for(j=0;k>j&&!(i[j]>=k);++j);if(j===k){var l=b.getFaces(),m=l.length;for(j=0;m>j;++j){var n=l[j];n>=0&&(l[j]=i[n])}for(j=0;k>j;++j)i[j]=j;f.set(c.subarray(0,3*k)),g.set(d.subarray(0,3*k)),h.set(e.subarray(0,3*k))}else for(b.setEvenMapping(!0),j=0;k>j;++j){var o=3*j,p=3*i[j];f[o]=c[p],f[o+1]=c[p+1],f[o+2]=c[p+2],g[o]=d[p],g[o+1]=d[p+1],g[o+2]=d[p+2],h[o]=e[p],h[o+1]=e[p+1],h[o+2]=e[p+2]}},m=function(a,b,c){for(var e=a.getVerticesDuplicateStartCount(),f=b.getNbVertices(),g=new Uint32Array(2*f),h=b.getVerticesMapping(),i=a.getTexCoords(),j=new Float32Array(d.getMemory(4*a.getNbTexCoords()*2),0,2*a.getNbTexCoords()),k=new Uint32Array(f),l=f,m=0;f>m;++m){var o=h[m],p=e[2*o];if(j[2*m]=i[2*o],j[2*m+1]=i[2*o+1],0!==p){for(var q=k[m]=p-l,r=e[2*o+1],s=l,t=l+r;t>s;++s)j[2*s]=i[2*(q+s)],j[2*s+1]=i[2*(q+s)+1];g[2*m]=l,g[2*m+1]=r,l+=r}}b.setTexCoords(new Float32Array(j.subarray(0,2*l))),b.setVerticesDuplicateStartCount(g),n(a,b,c,k)},n=function(a,b,c,d){for(var e=a.getFaces(),f=a.getFacesTexCoord(),g=a.getVerticesRingFaceStartCount(),h=a.getVerticesRingFace(),i=a.getVerticesDuplicateStartCount(),j=b.getFaces(),k=new Int32Array(j),l=b.getVerticesMapping(),m=0,n=j.length;n>m;++m){var o=j[m];if(!(0>o)){var p=l[o];if(0!==i[2*p]){var q=m%4,r=c[(m-q)/4],s=-1;if(r>=0){var t,u,v=4*r;0===q?(t=e[v+1],u=e[v]):1===q?(t=e[v+2],u=e[v+1]):(t=e[v],u=e[v+2]);for(var w=g[2*p],x=w+g[2*p+1],y=w;x>y;++y){var z=4*h[y],A=e[z],B=e[z+1],C=e[z+2];if(A===t?B===u&&(s=f[z+2]):B===t?C===u&&(s=f[z]):C===t&&A===u&&(s=f[z+1]),s>=0)break}}else{r=-r-1;for(var D=g[2*r],E=D+4,F=D;E>F;++F){var G=4*h[F];if(e[G]===p?s=f[G]:e[G+1]===p?s=f[G+1]:e[G+2]===p?s=f[G+2]:e[G+3]===p&&(s=f[G+3]),s>=0)break}}k[m]=s===p?s:s-d[o]}}}b.setFacesTexCoord(k)};e.computeReverse=function(a,b){if(a.getNbFaces()%4!==0)return!1;var c=i(a);if(!c)return!1;var d=j(a,b,c);return d?(k(a,b,d),l(a,b),a.hasUV()&&m(a,b,d),b.allocateArrays(),!0):!1},c.exports=e}),define("mesh/multiresolution/Multimesh",["require","exports","module","misc/Utils","mesh/multiresolution/MeshResolution","mesh/multiresolution/LowRender","editing/Subdivision","editing/Reversion"],function(a,b,c){"use strict";var d=a("misc/Utils"),e=a("mesh/multiresolution/MeshResolution"),f=a("mesh/multiresolution/LowRender"),g=a("editing/Subdivision"),h=a("editing/Reversion"),i=function(a){a.getRender()._mesh=this,a.getTransformData()._mesh=this,this._meshes=[new e(a.getTransformData(),a.getRender(),a)],this._sel=0,this._lowRender=new f(a.getRender())};i.RENDER_HINT=0,i.NONE=0,i.SCULPT=1,i.CAMERA=2,i.PICKING=3,i.prototype={getCurrentMesh:function(){return this._meshes[this._sel]},addLevel:function(){if(this._meshes.length-1!==this._sel)return this.getCurrentMesh();var a=this.getCurrentMesh(),b=new e(a.getTransformData(),a.getRender());return b.setID(this.getID()),a.setVerticesMapping(void 0),g.fullSubdivision(a,b),b.initTopology(),this.pushMesh(b),this.getRender().initRender(),b},computeReverse:function(){if(0!==this._sel)return this.getCurrentMesh();var a=this.getCurrentMesh(),b=new e(a.getTransformData(),a.getRender());b.setID(this.getID());var c=h.computeReverse(a,b);return c?(b.initTopology(),this.unshiftMesh(b),this.getRender().initRender(),b):void 0},lowerLevel:function(){return 0===this._sel?this._meshes[0]:(this._meshes[this._sel-1].lowerAnalysis(this.getCurrentMesh()),--this._sel,this.updateResolution(),this.getCurrentMesh())},higherLevel:function(){return this._sel===this._meshes.length-1?this.getCurrentMesh():(this._meshes[this._sel+1].higherSynthesis(this.getCurrentMesh()),++this._sel,this.updateResolution(),this.getCurrentMesh())},updateResolution:function(){this.updateGeometry(),this.updateDuplicateColorsAndMaterials(),this.updateBuffers(),this._lowRender.updateBuffers(this._meshes[this.getLowIndexRender()])},selectResolution:function(a){for(;this._sel>a;)this.lowerLevel();for(;this._sel<a;)this.higherLevel()},findIndexFromMesh:function(a){for(var b=this._meshes,c=0,d=b.length;d>c;++c)if(a===b[c])return c},selectMesh:function(a){var b=this.findIndexFromMesh(a);this.selectResolution(b)},pushMesh:function(a){this._meshes.push(a),this._sel=this._meshes.length-1,this.updateResolution()},unshiftMesh:function(a){this._meshes.unshift(a),this._sel=1,this.lowerLevel()},popMesh:function(){this._meshes.pop(),this._sel=this._meshes.length-1,this.updateResolution()},shiftMesh:function(){this._meshes.shift(),this._sel=0,this.updateResolution()},deleteLower:function(){this._meshes.splice(0,this._sel),this._sel=0},deleteHigher:function(){this._meshes.splice(this._sel+1)},getLowIndexRender:function(){for(var a=5e5,b=this._sel;b>=0;){var c=this._meshes[b];if(c.getEvenMapping()===!0)return b===this._sel?b:b+1;if(c.getNbTriangles()<a)return b;--b}return 0},_renderLow:function(a){var b=this._sel;this._sel=this.getLowIndexRender(),this._lowRender.render(a),this._sel=b},_renderWireframeLow:function(a){var b=this._sel;this._sel=this.getLowIndexRender(),this._lowRender.renderWireframe(a),this._sel=b},_canUseLowRender:function(a){return this.getCurrentMesh().isUsingTexCoords()||this.isUsingDrawArrays()?!1:i.RENDER_HINT===i.PICKING||i.RENDER_HINT===i.NONE?!1:a.getMesh()===this&&i.RENDER_HINT!==i.CAMERA?!1:this.getLowIndexRender()===this._sel?!1:!0},render:function(a){return this._canUseLowRender(a)?this._renderLow(a):this.getCurrentMesh().render(a)},renderWireframe:function(a){return this._canUseLowRender(a)?this._renderWireframeLow(a):this.getCurrentMesh().renderWireframe(a)}},d.makeProxy(e,i,function(a){return function(){return a.apply(this.getCurrentMesh(),arguments)}}),c.exports=i}),define("mesh/dynamic/Subdivision",["require","exports","module","lib/glMatrix","misc/Utils","math3d/Geometry","editing/tools/Smooth"],function(a,b,c){"use strict";var d=a("lib/glMatrix"),e=a("misc/Utils"),f=a("math3d/Geometry"),g=a("editing/tools/Smooth"),h=d.vec3,i=function(a){this._mesh=a,this._linear=!1,this._verticesMap=new Map,this._states=null,this._center=[0,0,0],this._radius2=0,this._edgeMax2=0};i.prototype={subdivision:function(a,b,c,d,e){h.copy(this._center,b),this._radius2=c,this._edgeMax2=d,this._states=e;for(var f=this._mesh,g=0;g!==f.getNbTriangles();)g=f.getNbTriangles(),a=this.subdivide(a);return a},subdivide:function(a){var b=this._mesh,c=b.getNbVertices(),d=b.getNbTriangles();this._verticesMap=new Map;var f=this.initSplit(a),h=f[0],i=f[1];h.length>5&&(h=b.expandsFaces(h,3),i=new Uint8Array(h.length),i.set(f[1])),this._states.pushVertices(b.getVerticesFromFaces(h)),this._states.pushFaces(h),b.reAllocateArrays(i.length),this.subdivideTriangles(h,i);var j=0,k=b.getNbTriangles()-d,l=new Uint32Array(k);for(j=0;k>j;++j)l[j]=d+j;l=b.expandsFaces(l,1),h=l.subarray(k),this._states.pushVertices(b.getVerticesFromFaces(h)),this._states.pushFaces(h);var m=a,n=a.length;a=new Uint32Array(n+l.length),a.set(m),a.set(l,n);var o=b.getFacesTagFlags(),p=a.length,q=new Uint32Array(e.getMemory(4*p),0,p),r=0,s=++e.TAG_FLAG;for(j=0;p>j;++j){var t=a[j];o[t]!==s&&(o[t]=s,q[r++]=t)}q=new Uint32Array(q.subarray(0,r));for(var u=b.getNbTriangles();l.length>0;)b.reAllocateArrays(l.length),l=this.fillTriangles(l);for(k=b.getNbTriangles()-u,m=q,q=new Uint32Array(r+k),q.set(m),j=0;k>j;++j)q[r+j]=u+j;var v=b.getNbVertices()-c,w=new Uint32Array(v);for(j=0;v>j;++j)w[j]=c+j;if(w=b.expandsVertices(w,1),!this._linear){var x=w.subarray(v),y=new g;y.setToolMesh(b),y.smoothTangent(x,1),b.updateTopology(b.getFacesFromVertices(x))}var z=b.getVertices(),A=b.getVerticesSculptFlags(),B=this._center,C=B[0],D=B[1],E=B[2],F=e.SCULPT_FLAG;for(v=w.length,j=0;v>j;++j){var G=w[j],H=3*G,I=z[H]-C,J=z[H+1]-D,K=z[H+2]-E;A[G]=I*I+J*J+K*K<this._radius2?F:F-1}return q},initSplit:function(a){for(var b=a.length,c=e.getMemory(5*b),d=new Uint32Array(c,0,b),f=new Uint8Array(c,4*b,b),g=0,h=0;b>h;++h){var i=a[h],j=this.findSplit(i,!0);0!==j&&(f[g]=j,d[g++]=i)}return[new Uint32Array(d.subarray(0,g)),new Uint8Array(f.subarray(0,g))]},findSplit:function(){var a=[0,0,0],b=[0,0,0],c=[0,0,0],d=f.triangleInsideSphere,e=f.pointInsideTriangle;return function(f,g){var i=this._mesh,j=i.getVertices(),k=i.getFaces(),l=4*f,m=3*k[l],n=3*k[l+1],o=3*k[l+2];if(a[0]=j[m],a[1]=j[m+1],a[2]=j[m+2],b[0]=j[n],b[1]=j[n+1],b[2]=j[n+2],c[0]=j[o],c[1]=j[o+1],c[2]=j[o+2],g&&!d(this._center,this._radius2,a,b,c)&&!e(this._center,a,b,c))return 0;var p=h.sqrDist(a,b),q=h.sqrDist(b,c),r=h.sqrDist(a,c);return p>q&&p>r?p>this._edgeMax2?1:0:q>r?q>this._edgeMax2?2:0:r>this._edgeMax2?3:0}}(),subdivideTriangles:function(a,b){for(var c=this._mesh.getFaces(),d=a.length,e=0;d>e;++e){var f=a[e],g=b[e];0===g&&(g=this.findSplit(f));var h=4*f;1===g?this.halfEdgeSplit(f,c[h],c[h+1],c[h+2]):2===g?this.halfEdgeSplit(f,c[h+1],c[h+2],c[h]):3===g&&this.halfEdgeSplit(f,c[h+2],c[h],c[h+1])}},halfEdgeSplit:function(a,b,c,d){var f=this._mesh,g=f.getVertices(),h=f.getNormals(),i=f.getColors(),j=f.getMaterials(),k=f.getFaces(),l=f.getFacePosInLeaf(),m=f.getFaceLeaf(),n=f.getVerticesRingVert(),o=f.getVerticesRingFace(),p=f.getFacesStateFlags(),q=f.getVerticesStateFlags(),r=this._verticesMap,s=Math.min(b,c)+"+"+Math.max(b,c),t=!1,u=r.get(s);void 0===u&&(u=f.getNbVertices(),t=!0,r.set(s,u)),n[d].push(u);var v=4*a;k[v]=b,k[v+1]=u,k[v+2]=d,k[v+3]=-1;var w=f.getNbTriangles();v=4*w,k[v]=u,k[v+1]=c,k[v+2]=d,k[v+3]=-1,p[w]=e.STATE_FLAG,o[d].push(w),e.replaceElement(o[c],a,w);var x=m[a],y=x._iFaces;if(m[w]=x,l[w]=y.length,y.push(w),!t)return n[u].push(d),o[u].push(a,w),void f.addNbFace(1);var z=f.getNbVertices(),A=3*b,B=g[A],C=g[A+1],D=g[A+2],E=h[A],F=h[A+1],G=h[A+2],H=3*c,I=g[H],J=g[H+1],K=g[H+2],L=h[H],M=h[H+1],N=h[H+2],O=E+L,P=F+M,Q=G+N;v=3*z,h[v]=.5*O,h[v+1]=.5*P,h[v+2]=.5*Q,i[v]=.5*(i[A]+i[H]),i[v+1]=.5*(i[A+1]+i[H+1]),i[v+2]=.5*(i[A+2]+i[H+2]),j[v]=.5*(j[A]+j[H]),j[v+1]=.5*(j[A+1]+j[H+1]),j[v+2]=.5*(j[A+2]+j[H+2]);var R=0;if(this._linear)g[v]=.5*(B+I),g[v+1]=.5*(C+J),g[v+2]=.5*(D+K);else{var S=E*E+F*F+G*G;0===S?E=1:(S=1/Math.sqrt(S),E*=S,F*=S,G*=S),S=L*L+M*M+N*N,0===S?L=1:(S=1/Math.sqrt(S),L*=S,M*=S,N*=S);var T=E*L+F*M+G*N,U=0;U=-1>=T?Math.PI:T>=1?0:Math.acos(T);var V=B-I,W=C-J,X=D-K;R=.12*U,R*=Math.sqrt(V*V+W*W+X*X),S=O*O+P*P+Q*Q,S>0&&(R/=Math.sqrt(S)),0>V*(E-L)+W*(F-M)+X*(G-N)&&(R=-R),g[v]=.5*(B+I)+O*R,g[v+1]=.5*(C+J)+P*R,g[v+2]=.5*(D+K)+Q*R}q[z]=e.STATE_FLAG,n[z]=[b,c,d],o[z]=[a,w],e.replaceElement(n[b],c,u),e.replaceElement(n[c],b,u),f.addNbVertice(1),f.addNbFace(1)},fillTriangles:function(a){for(var b=this._mesh,c=b.getVerticesRingVert(),d=b.getFaces(),f=a.length,g=new Uint32Array(e.getMemory(8*f),0,2*f),h=0,i=this._verticesMap,j=0;f>j;++j){var k=a[j],l=4*k,m=d[l],n=d[l+1],o=d[l+2],p=i.get(Math.min(m,n)+"+"+Math.max(m,n)),q=i.get(Math.min(n,o)+"+"+Math.max(n,o)),r=i.get(Math.min(m,o)+"+"+Math.max(m,o)),s=c[m].length,t=c[n].length,u=c[o].length,v=0;if(p?v=q?r?t>s&&u>s?2:u>t?3:1:u>s?2:1:r&&u>t?3:1:q?v=r&&s>t?3:2:r&&(v=3),1===v)this.fillTriangle(k,m,n,o,p);else if(2===v)this.fillTriangle(k,n,o,m,q);else{if(3!==v)continue;this.fillTriangle(k,o,m,n,r)}g[h++]=k,g[h++]=b.getNbTriangles()-1}return new Uint32Array(g.subarray(0,h))},fillTriangle:function(a,b,c,d,f){var g=this._mesh,h=g.getVerticesRingVert(),i=g.getVerticesRingFace(),j=g.getFacePosInLeaf(),k=g.getFaceLeaf(),l=g.getFacesStateFlags(),m=g.getFaces(),n=4*a;m[n]=b,m[n+1]=f,m[n+2]=d,m[n+3]=-1;var o=k[a],p=o._iFaces;h[f].push(d),h[d].push(f);var q=g.getNbTriangles();i[f].push(a,q),n=4*q,m[n]=f,m[n+1]=c,m[n+2]=d,m[n+3]=-1,l[q]=e.STATE_FLAG,k[q]=o,j[q]=p.length,i[d].push(q),e.replaceElement(i[c],a,q),p.push(q),g.addNbFace(1)}},c.exports=i}),define("mesh/dynamic/Decimation",["require","exports","module","misc/Utils"],function(a,b,c){"use strict";var d=a("misc/Utils"),e=function(a){this._mesh=a,this._states=null,this._iTrisToDelete=[],this._iVertsToDelete=[],this._iVertsDecimated=[]},f=function(a,b){return a-b};e.prototype={decimation:function(a,b,c,d,e){this._states=e,this._iVertsDecimated.length=0,this._iTrisToDelete.length=0,this._iVertsToDelete.length=0;var f=Math.sqrt(c),g=this._mesh,h=g.getFacesTagFlags(),i=g.getVertices(),j=g.getFaces(),k=b[0],l=b[1],m=b[2],n=0,o=a.length,p=new Array(o);for(n=0;o>n;++n)p[n]=a[n];for(n=0;n<p.length;++n){var q=p[n];if(!(h[q]<0)){var r=4*q,s=j[r],t=j[r+1],u=j[r+2];r=3*s;var v=i[r],w=i[r+1],x=i[r+2];r=3*t;var y=i[r],z=i[r+1],A=i[r+2];r=3*u;var B=i[r],C=i[r+1],D=i[r+2],E=(v+y+B)/3-k,F=(w+z+C)/3-l,G=(x+A+D)/3-m,H=E*E+F*F+G*G;if(c>H)H=1;else{if(!(2*c>H))continue;H=(Math.sqrt(H)-f)/(f*Math.SQRT2-f);var I=H*H;H=3*I*I-4*I*H+1}E=y-v,F=z-w,G=A-x;var J=E*E+F*F+G*G;E=y-B,F=z-C,G=A-D;var K=E*E+F*F+G*G;E=v-B,F=w-C,G=x-D;var L=E*E+F*F+G*G;K>J&&L>J?d*H>J&&this.decimateTriangles(q,this.findOppositeTriangle(q,s,t),p):L>K?d*H>K&&this.decimateTriangles(q,this.findOppositeTriangle(q,t,u),p):d*H>L&&this.decimateTriangles(q,this.findOppositeTriangle(q,s,u),p)}}return this.applyDeletion(),a=this.getValidModifiedTriangles(this.getValidModifiedVertices(),p)},applyDeletion:function(){var a=this._iTrisToDelete;d.tidy(a);var b=a.length,c=0;for(c=b-1;c>=0;--c)this.deleteTriangle(a[c]);var e=this._iVertsToDelete;d.tidy(e);var f=e.length;for(c=f-1;c>=0;--c)this.deleteVertex(e[c])},getValidModifiedVertices:function(){for(var a=this._mesh,b=a.getVerticesTagFlags(),c=a.getNbVertices(),e=++d.TAG_FLAG,f=this._iVertsDecimated,g=f.length,h=new Uint32Array(d.getMemory(4*g),0,g),i=0,j=0;g>j;++j){var k=f[j];k>=c||b[k]!==e&&(b[k]=e,h[i++]=k)}return new Uint32Array(h.subarray(0,i))},getValidModifiedTriangles:function(a,b){var c=this._mesh,e=c.getFacesTagFlags(),f=c.getNbTriangles(),g=c.getFacesFromVertices(a),h=b,i=b.length;b=new Uint32Array(i+g.length),b.set(h),b.set(g,i);var j=++d.TAG_FLAG;i=b.length;for(var k=new Uint32Array(d.getMemory(4*i),0,i),l=0,m=0;i>m;++m){var n=b[m];n>=f||e[n]!==j&&(e[n]=j,k[l++]=n)}return new Uint32Array(k.subarray(0,l))},findOppositeTriangle:function(a,b,c){var e=this._mesh.getVerticesRingFace(),g=e[b],h=e[c];g.sort(f),h.sort(f);var i=d.intersectionArrays(g,h);return 2!==i.length?-1:i[0]===a?i[1]:i[0]},decimateTriangles:function(a,b,c){if(-1!==b){var d=this._mesh.getFaces(),e=4*a,f=d[e],g=d[e+1],h=d[e+2];e=4*b;var i=d[e],j=d[e+1],k=d[e+2];f===i?g===k?this.edgeCollapse(a,b,f,g,h,j,c):this.edgeCollapse(a,b,f,h,g,k,c):f===j?g===i?this.edgeCollapse(a,b,f,g,h,k,c):this.edgeCollapse(a,b,f,h,g,i,c):f===k?g===j?this.edgeCollapse(a,b,f,g,h,i,c):this.edgeCollapse(a,b,f,h,g,j,c):g===i?this.edgeCollapse(a,b,h,g,f,j,c):g===j?this.edgeCollapse(a,b,h,g,f,k,c):this.edgeCollapse(a,b,h,g,f,i,c)}},edgeCollapse:function(a,b,c,e,g,h,i){var j=this._mesh,k=j.getVertices(),l=j.getNormals(),m=j.getColors(),n=j.getMaterials(),o=j.getFaces(),p=j.getVerticesTagFlags(),q=j.getFacesTagFlags(),r=j.getVerticesRingVert(),s=j.getVerticesRingFace(),t=r[c],u=r[e],v=s[c],w=s[e];if(t.length===v.length&&u.length===w.length){var x=r[g],y=r[h],z=s[g],A=s[h];if(x.length===z.length&&y.length===A.length){this._iVertsDecimated.push(c,e),this._states.pushVertices(t),this._states.pushVertices(u),this._states.pushFaces(v),this._states.pushFaces(w),t.sort(f),u.sort(f);var B=0;if(d.intersectionArrays(t,u).length>=3)return d.removeElement(v,b),d.removeElement(w,a),z.push(b),A.push(a),B=4*a,o[B]===e?o[B]=h:o[B+1]===e?o[B+1]=h:o[B+2]=h,B=4*b,o[B]===c?o[B]=g:o[B+1]===c?o[B+1]=g:o[B+2]=g,j.computeRingVertices(c),j.computeRingVertices(e),j.computeRingVertices(g),void j.computeRingVertices(h);B=3*c;var C=3*e,D=l[B]+l[C],E=l[B+1]+l[C+1],F=l[B+2]+l[C+2],G=D*D+E*E+F*F;0===G?D=1:(G=1/Math.sqrt(G),D*=G,E*=G,F*=G),l[B]=D,l[B+1]=E,l[B+2]=F,m[B]=.5*(m[B]+m[C]),m[B+1]=.5*(m[B+1]+m[C+1]),m[B+2]=.5*(m[B+2]+m[C+2]),n[B]=.5*(n[B]+n[C]),n[B+1]=.5*(n[B+1]+n[C+1]),n[B+2]=.5*(n[B+2]+n[C+2]),d.removeElement(v,a),d.removeElement(v,b),d.removeElement(w,a),d.removeElement(w,b),d.removeElement(z,a),d.removeElement(A,b);var H=w.length,I=0;for(I=0;H>I;++I){var J=w[I];v.push(J);var K=4*J;o[K]===e?o[K]=c:o[K+1]===e?o[K+1]=c:o[K+2]=c}for(H=u.length,I=0;H>I;++I)t.push(u[I]);j.computeRingVertices(c);var L=0,M=0,N=0,O=t.length;for(I=0;O>I;++I){var P=t[I];j.computeRingVertices(P),P*=3,L+=k[P],M+=k[P+1],N+=k[P+2]}L/=O,M/=O,N/=O;var Q=D*(L-k[B])+E*(M-k[B+1])+F*(N-k[B+2]);for(k[B]=L-D*Q,k[B+1]=M-E*Q,k[B+2]=N-F*Q,p[e]=q[a]=q[b]=-1,this._iVertsToDelete.push(e),this._iTrisToDelete.push(a,b),H=v.length,I=0;H>I;++I)i.push(v[I])}}},deleteTriangle:function(a){var b=this._mesh,c=b.getVerticesRingFace(),e=b.getFacesTagFlags(),f=b.getFaces(),g=b.getFacePosInLeaf(),h=b.getFaceLeaf(),i=b.getFacesStateFlags(),j=g[a],k=h[a]._iFaces,l=k[k.length-1];a!==l&&(k[j]=l,g[l]=j),k.pop();var m=b.getNbTriangles()-1;if(m===a)return void b.addNbFace(-1);var n=4*m,o=f[n],p=f[n+1],q=f[n+2];this._states.pushVertices([o,p,q]),this._states.pushFaces([m]),d.replaceElement(c[o],m,a),d.replaceElement(c[p],m,a),d.replaceElement(c[q],m,a);var r=h[m],s=g[m];r._iFaces[s]=a,h[a]=r,g[a]=s,e[a]=e[m],i[a]=i[m],a*=4,f[a]=o,f[a+1]=p,f[a+2]=q,f[a+3]=-1,this._iVertsDecimated.push(o,p,q),b.addNbFace(-1)},deleteVertex:function(a){var b=this._mesh,c=b.getVerticesRingVert(),e=b.getVerticesRingFace(),f=b.getVertices(),g=b.getNormals(),h=b.getColors(),i=b.getMaterials(),j=b.getFaces(),k=b.getVerticesTagFlags(),l=b.getVerticesStateFlags(),m=b.getVerticesSculptFlags(),n=b.getNbVertices()-1;if(a===n)return void b.addNbVertice(-1);var o=0,p=this._states;p.pushVertices([n]);var q=e[n],r=c[n],s=q.length,t=r.length,u=0;for(u=0;s>u;++u)o=q[u],p.pushFaces([o]),o*=4,j[o]===n?j[o]=a:j[o+1]===n?j[o+1]=a:j[o+2]=a;for(u=0;t>u;++u)o=r[u],p.pushVertices([o]),d.replaceElement(c[o],n,a);c[a]=c[n].slice(),e[a]=e[n].slice(),k[a]=k[n],l[a]=l[n],m[a]=m[n];var v=3*n;o=3*a,f[o]=f[v],f[o+1]=f[v+1],f[o+2]=f[v+2],g[o]=g[v],g[o+1]=g[v+1],g[o+2]=g[v+2],h[o]=h[v],h[o+1]=h[v+1],h[o+2]=h[v+2],i[o]=i[v],i[o+1]=i[v+1],i[o+2]=i[v+2],b.addNbVertice(-1)}},c.exports=e}),define("mesh/dynamic/Topology",["require","exports","module","mesh/dynamic/Subdivision","mesh/dynamic/Decimation"],function(a,b,c){"use strict";var d=a("mesh/dynamic/Subdivision"),e=a("mesh/dynamic/Decimation"),f=function(a){this._mesh=a,this._subdivision=new d(a),this._decimation=new e(a)};f.subFactor=75,f.decFactor=0,f.linear=!1,f.prototype={getSubdivisionFactor:function(){return.01*f.subFactor},getDecimationFactor:function(){return.01*f.decFactor},subdivision:function(a,b,c,d,e){return this._subdivision._linear=f.linear,this._subdivision.subdivision(a,b,c,d,e)},decimation:function(a,b,c,d,e){return this._decimation.decimation(a,b,c,d,e)}},c.exports=f}),define("mesh/dynamic/MeshDynamic",["require","exports","module","misc/Utils","mesh/dynamic/Topology","mesh/Mesh"],function(a,b,c){"use strict";var d=a("misc/Utils"),e=a("mesh/dynamic/Topology"),f=a("mesh/Mesh"),g=function(a){f.call(this,a.getGL()),this.setTransformData(a.getTransformData()),this.setID(a.getID()),this._dynamicTopology=new e(this);var b=this.getVertexData();this._vrings=b._vertRingVert=[],this._frings=b._vertRingFace=[],this._nbFaces=0,this._nbVertices=0,this._facesStateFlags=null,this._wireframe=null,this.init(a),this.setRender(a.getRender()),a.isUsingTexCoords()&&this.setShaderName("MATCAP"),a.getRender()._mesh=this,this.initRender()};g.prototype={getDynamicTopology:function(){return this._dynamicTopology},getVerticesProxy:function(){return this.getVertices()},getNbVertices:function(){return this._nbVertices},setNbVertices:function(a){this._nbVertices=a},addNbVertice:function(a){this._nbVertices+=a},getNbFaces:function(){return this._nbFaces},getNbTriangles:function(){return this._nbFaces},setNbFaces:function(a){this._nbFaces=a},addNbFace:function(a){this._nbFaces+=a},getNbEdges:function(){return 3*this.getNbTriangles()},getFacesStateFlags:function(){return this._facesStateFlags},getRenderVertices:function(){return this.isUsingDrawArrays()?this.getVerticesDrawArrays():this.getVertices().subarray(0,3*this.getNbVertices())},getRenderNormals:function(){return this.isUsingDrawArrays()?this.getNormalsDrawArrays():this.getNormals().subarray(0,3*this.getNbVertices())},getRenderColors:function(){return this.isUsingDrawArrays()?this.getColorsDrawArrays():this.getColors().subarray(0,3*this.getNbVertices())},getRenderMaterials:function(){return this.isUsingDrawArrays()?this.getMaterialsDrawArrays():this.getMaterials().subarray(0,3*this.getNbVertices())},getRenderTriangles:function(){return this.getTriangles().subarray(0,3*this.getNbTriangles())},init:function(a){this.setVertices(a.getVertices().slice()),this.setColors(a.getColors().slice()),this.setMaterials(a.getMaterials().slice()),this.setFaces(new Int32Array(4*a.getNbTriangles())),this.setNbFaces(a.getNbTriangles()),this.setNbVertices(a.getNbVertices()),this.allocateArrays(),this.initTriangles(a),this.initRenderTriangles(),this.initVerticesTopology(),this.updateFacesAabbAndNormal(),this.updateVerticesNormal(),this.updateOctree()},updateTopology:function(a){this.updateRenderTriangles(a),this.getShowWireframe()&&this.updateWireframe(a),this.isUsingDrawArrays()&&this.updateDrawArrays(a)},getWireframe:function(){return this._wireframe||(this._wireframe=new Uint32Array(2*this.getTriangles().length),this.updateWireframe()),this._wireframe.subarray(0,2*this.getNbEdges())},setShowWireframe:function(a){this._wireframe=null,this.getRender().setShowWireframe(a)},updateWireframe:function(a){for(var b=this._wireframe,c=this.getTriangles(),d=void 0===a,e=this.isUsingDrawArrays(),f=d?this.getNbTriangles():a.length,g=0;f>g;++g){var h=d?g:a[g],i=6*h,j=3*h;e?(b[i]=b[i+5]=j,b[i+1]=b[i+2]=j+2,b[i+3]=b[i+4]=j+1):(b[i]=b[i+5]=c[j],b[i+1]=b[i+2]=c[j+1],b[i+3]=b[i+4]=c[j+2])}},updateRenderTriangles:function(a){for(var b=this.getTriangles(),c=this.getFaces(),d=void 0===a,e=d?this.getNbFaces():a.length,f=0;e>f;++f){var g=d?f:a[f],h=3*g,i=4*g;b[h]=c[i],b[h+1]=c[i+1],b[h+2]=c[i+2]}},resizeArray:function(a,b){if(!a)return null;if(a.length>=b)return a.subarray(0,2*b);var c=new a.constructor(2*b);return c.set(a),c},reAllocateArrays:function(a){this.reAllocate(a),this.isUsingDrawArrays()&&this.getDrawArraysData().reAllocateArrays(a),this.getFaceData().reAllocateArrays(a),this.getVertexData().reAllocateArrays(a),this.getOctree().reAllocateArrays(a)},reAllocate:function(a){var b=this._facesStateFlags.length,c=this.getNbTriangles(),d=c+a;(d>b||b>4*d)&&(this._facesStateFlags=this.resizeArray(this._facesStateFlags,d),this.getShowWireframe()&&(this._wireframe=this.resizeArray(this._wireframe,6*d)))},initTriangles:function(a){var b=a.getTriangles(),c=this.getNbTriangles(),d=this.getFaces();this._facesStateFlags=new Int32Array(c);for(var e=0;c>e;++e){var f=3*e,g=4*e;d[g]=b[f],d[g+1]=b[f+1],d[g+2]=b[f+2],d[g+3]=-1}},initVerticesTopology:function(){var a=this._vrings,b=this._frings,c=0,d=this.getNbVertices();for(a.length=b.length=d,c=0;d>c;++c)a[c]=[],b[c]=[];var e=this.getNbTriangles(),f=this.getTriangles();for(c=0;e>c;++c){var g=3*c;b[f[g]].push(c),b[f[g+1]].push(c),b[f[g+2]].push(c)}for(c=0;d>c;++c)this.computeRingVertices(c)},computeRingVertices:function(a){var b=++d.TAG_FLAG,c=this.getFaces(),e=this.getVerticesTagFlags(),f=this._vrings[a],g=this._frings[a];f.length=0;for(var h=g.length,i=0;h>i;++i){var j=4*g[i],k=c[j],l=c[j+1],m=c[j+2];k!==a&&e[k]!==b&&(f.push(k),e[k]=b),l!==a&&e[l]!==b&&(f.push(l),e[l]=b),m!==a&&e[m]!==b&&(f.push(m),e[m]=b)}}},d.makeProxy(f,g),c.exports=g}),define("states/StateMultiresolution",["require","exports","module"],function(a,b,c){"use strict";var d=function(a,b,c,e){switch(this._main=a,this._multimesh=b,this._mesh=b.getCurrentMesh(),this._type=c,this._sel=b._sel,c){case d.DELETE_LOWER:this._deletedMeshes=b._meshes.slice(0,b._sel);break;case d.DELETE_HIGHER:this._deletedMeshes=b._meshes.slice(b._sel+1),e||(this._vMappingState=this._mesh.getVerticesMapping());break;case d.SUBDIVISION:case d.REVERSION:e||(this._vArState=this._mesh.getVertices().slice(),this._cArState=this._mesh.getColors().slice(),this._mArState=this._mesh.getMaterials().slice())}};d.SUBDIVISION=0,d.REVERSION=1,d.SELECTION=2,d.DELETE_LOWER=3,d.DELETE_HIGHER=4,d.prototype={isNoop:function(){return!1},undo:function(){var a=this._multimesh;switch(this._type){case d.SELECTION:a.selectMesh(this._mesh);break;case d.DELETE_LOWER:Array.prototype.unshift.apply(a._meshes,this._deletedMeshes),a._sel=this._deletedMeshes.length;break;case d.DELETE_HIGHER:Array.prototype.push.apply(a._meshes,this._deletedMeshes),this._mesh.setVerticesMapping(this._vMappingState);break;case d.SUBDIVISION:this._mesh.setVertices(this._vArState.slice()),this._mesh.setColors(this._cArState.slice()),this._mesh.setMaterials(this._mArState.slice()),a.popMesh();break;case d.REVERSION:this._mesh.setVertices(this._vArState.slice()),this._mesh.setColors(this._cArState.slice()),this._mesh.setMaterials(this._mArState.slice()),a.shiftMesh()}this._main.setMesh(a)},redo:function(){var a=this._multimesh;switch(this._type){case d.SELECTION:a.selectMesh(this._mesh);break;case d.DELETE_LOWER:a.deleteLower();break;case d.DELETE_HIGHER:a.deleteHigher();break;case d.SUBDIVISION:a.pushMesh(this._mesh);break;case d.REVERSION:a.unshiftMesh(this._mesh)}this._main.setMesh(a)},createRedo:function(){return new d(this._main,this._multimesh,this._type,!0)}},c.exports=d}),define("gui/GuiTopology",["require","exports","module","gui/GuiTR","editing/Remesh","mesh/Mesh","mesh/multiresolution/Multimesh","mesh/dynamic/MeshDynamic","mesh/dynamic/Topology","states/StateMultiresolution"],function(a,b,c){"use strict";var d=a("gui/GuiTR"),e=a("editing/Remesh"),f=a("mesh/Mesh"),g=a("mesh/multiresolution/Multimesh"),h=a("mesh/dynamic/MeshDynamic"),i=a("mesh/dynamic/Topology"),j=a("states/StateMultiresolution"),k=function(a,b){this._ctrlGui=b,this._main=b._main,this._menu=null,this._ctrlResolution=null,this._ctrlDynamic=null,this.init(a)};k.prototype={init:function(a){var b=this._menu=a.addMenu(d("topologyTitle"));b.close(),b.addTitle(d("multiresTitle")),this._ctrlResolution=b.addSlider(d("multiresResolution"),1,this.onResolutionChanged.bind(this),1,1,1);var c=b.addDualButton(d("multiresReverse"),d("multiresSubdivide"),this,this,"reverse","subdivide");this._ctrlReverse=c[0],this._ctrlSubdivide=c[1],c=this._dualButtonDel=b.addDualButton(d("multiresDelLower"),d("multiresDelHigher"),this,this,"deleteLower","deleteHigher"),this._ctrlDelLower=c[0],this._ctrlDelHigher=c[1],this._ctrlDelLower.domButton.style.background=this._ctrlDelHigher.domButton.style.background="rgba(230,53,59,0.35)",b.addTitle(d("remeshTitle")),b.addSlider(d("remeshResolution"),e,"RESOLUTION",8,400,1),b.addCheckbox(d("remeshBlock"),e,"BLOCK"),b.addButton(d("remeshRemesh"),this,"remesh"),b.addTitle(d("dynamicTitle")),this._ctrlDynamic=b.addCheckbox(d("dynamicActivated"),!1,this.dynamicToggleActivate.bind(this)),this._ctrlDynSubd=b.addSlider(d("dynamicSubdivision"),i,"subFactor",0,100,1),this._ctrlDynDec=b.addSlider(d("dynamicDecimation"),i,"decFactor",0,100,1),this._ctrlDynLin=b.addCheckbox(d("dynamicLinear"),i,"linear"),this.updateDynamicVisibility(!1)},updateDynamicVisibility:function(a){this._ctrlDynSubd.setVisibility(a),this._ctrlDynDec.setVisibility(a),this._ctrlDynLin.setVisibility(a)},dynamicToggleActivate:function(){var a=this._main,b=a.getMesh();if(b){var c=b.getDynamicTopology?this.convertToStaticMesh(b):new h(b);this.updateDynamicVisibility(!b.getDynamicTopology),a.replaceMesh(b,c),a.getStates().pushStateAddRemove(c,b)}},remesh:function(){var a=this._main,b=a.getMesh();if(b){for(var c=a.getMeshes(),d=a.getSelectedMeshes().slice(),f=0,g=d.length;g>f;++f){var h=d[f];c.splice(a.getIndexMesh(h),1),d[f]=this.convertToStaticMesh(h),h===b&&(b=d[f])}var i=e.remesh(d,b);a.getStates().pushStateAddRemove(i,a.getSelectedMeshes().slice()),a.getMeshes().push(i),a.setMesh(i)}},isMultimesh:function(a){return!(!a||!a._meshes)},convertToStaticMesh:function(a){if(!a.getDynamicTopology)return a;var b=new f(a.getGL());return b.setID(a.getID()),b.setTransformData(a.getTransformData()),b.setVertices(a.getVertices().subarray(0,3*a.getNbVertices())),b.setColors(a.getColors().subarray(0,3*a.getNbVertices())),b.setMaterials(a.getMaterials().subarray(0,3*a.getNbVertices())),b.setFaces(a.getFaces().subarray(0,4*a.getNbFaces())),b.init(),b.setRender(a.getRender()),a.getRender()._mesh=b,b.initRender(),b},convertToMultimesh:function(a){if(this.isMultimesh(a))return a;var b=new g(this.convertToStaticMesh(a));return b},subdivide:function(){var a=this._main,b=a.getMesh();if(b){var c=this.convertToMultimesh(b);if(c._sel!==c._meshes.length-1)return void window.alert(d("multiresSelectHighest"));if(c.getNbTriangles()>4e5&&!window.confirm(d("multiresWarnBigMesh",4*c.getNbFaces())))return void(b!==c&&(b.getRender()._mesh=b));b!==c&&(a.replaceMesh(b,c),a.getStates().pushStateAddRemove(c,b,!0)),a.getStates().pushState(new j(a,c,j.SUBDIVISION)),c.addLevel(),a.setMesh(c),a.render()}},reverse:function(){var a=this._main,b=a.getMesh();if(b){var c=this.convertToMultimesh(b);if(0!==c._sel)return void window.alert(d("multiresSelectLowest"));var e=new j(a,c,j.REVERSION),f=c.computeReverse();if(!f)return b!==c&&(b.getRender()._mesh=b),void window.alert(d("multiresNotReversible"));b!==c&&(a.replaceMesh(b,c),a.getStates().pushStateAddRemove(c,b,!0)),a.getStates().pushState(e),a.setMesh(c),a.render()}},deleteLower:function(){var a=this._main,b=a._mesh;return this.isMultimesh(b)&&0!==b._sel?(a.getStates().pushState(new j(a,b,j.DELETE_LOWER)),b.deleteLower(),void this.updateMeshResolution()):void window.alert(d("multiresNoLower"))},deleteHigher:function(){var a=this._main,b=a.getMesh();return this.isMultimesh(b)&&b._sel!==b._meshes.length-1?(a.getStates().pushState(new j(a,b,j.DELETE_HIGHER)),b.deleteHigher(),void this.updateMeshResolution()):void window.alert(d("multiresNoHigher"))},onResolutionChanged:function(a){var b=a-1,c=this._main,d=c.getMesh();if(d){var e=this.isMultimesh(d),f=e&&d._meshes.length-1===b;this._ctrlReverse.setEnable(!e||0===b),this._ctrlSubdivide.setEnable(!e||f),this._ctrlDelLower.setEnable(e&&0!==b),this._ctrlDelHigher.setEnable(e&&!f),e&&d._sel!==b&&(c.getStates().pushState(new j(c,d,j.SELECTION)),d.selectResolution(b),this._ctrlGui.updateMeshInfo(),c.render())}},updateMeshResolution:function(){var a=this._main.getMesh();return a&&this.isMultimesh(a)?(this._ctrlResolution.setMax(a._meshes.length),void this._ctrlResolution.setValue(a._sel+1)):(this._ctrlResolution.setMax(1),void this._ctrlResolution.setValue(0))},updateMesh:function(){if(!this._main.getMesh())return void this._menu.setVisibility(!1);this._menu.setVisibility(!0),this.updateMeshResolution();var a=this._main.getMesh().getDynamicTopology;this.updateDynamicVisibility(a),this._ctrlDynamic.setValue(a,!0)}},c.exports=k}),define("gui/GuiRendering",["require","exports","module","gui/GuiTR","mesh/Render","render/ShaderLib"],function(a,b,c){"use strict";var d=a("gui/GuiTR"),e=a("mesh/Render"),f=a("render/ShaderLib"),g=f.MERGE,h=f.UV,i=f.PBR,j=f.MATCAP,k=function(a,b){
this._main=b._main,this._menu=null,this._ctrlFlatShadizfng=null,this._ctrlShowWireframe=null,this._ctrlShaders=null,this._ctrlMatcap=null,this._ctrlUV=null,this.init(a)};k.prototype={init:function(a){var b=this._menu=a.addMenu(d("renderingTitle"));b.close();var c={};c.MATCAP=d("renderingMatcap"),c.PBR=d("renderingPBR"),c.NORMAL=d("renderingNormal"),c.UV=d("renderingUV"),b.addTitle(d("renderingShader")),this._ctrlShaders=b.addCombobox("","PBR",this.onShaderChanged.bind(this),c),this._ctrlCurvature=b.addSlider(d("renderingCurvature"),20,this.onCurvatureChanged.bind(this),0,100,1),this._ctrlFilmic=b.addCheckbox(d("renderingFilmic"),g.FILMIC,this.onFilmic.bind(this));for(var f={},h=0,k=i.environments,l=k.length;l>h;++h)f[h]=k[h].name;this._ctrlEnvTitle=b.addTitle(d("renderingEnvironment")),this._ctrlEnv=b.addCombobox("",i.idEnv,this.onEnvironmentChanged.bind(this),f);for(var m={},n=0,o=j.matcaps,p=o.length;p>n;++n)m[n]=o[n].name;this._ctrlMatcapTitle=b.addTitle(d("renderingMaterial")),this._ctrlMatcap=b.addCombobox(d("renderingMatcap"),0,this.onMatcapChanged.bind(this),m),this._ctrlImportMatcap=b.addButton(d("renderingImportMatcap"),this,"importMatcap"),this._ctrlUV=b.addButton(d("renderingImportUV"),this,"importTexture"),this._ctrlExposure=b.addSlider(d("renderingExposure"),20,this.onExposureChanged.bind(this),0,100,1),b.addTitle(d("renderingExtra")),this._ctrlTransparency=b.addSlider(d("renderingTransparency"),0,this.onTransparencyChanged.bind(this),0,100,1),this._ctrlFlatShading=b.addCheckbox(d("renderingFlat"),!1,this.onFlatShading.bind(this)),this._ctrlShowWireframe=b.addCheckbox(d("renderingWireframe"),!1,this.onShowWireframe.bind(this)),e.ONLY_DRAW_ARRAYS&&this._ctrlShowWireframe.setVisibility(!1),this.addEvents()},onFilmic:function(a){g.FILMIC=a,this._main.render()},onCurvatureChanged:function(a){this._main.getMesh()&&(this._main.getMesh().setCurvature(a/20),this._main.render())},onEnvironmentChanged:function(a){i.idEnv=a,this._main.render()},onExposureChanged:function(a){i.exposure=a/20,this._main.render()},onTransparencyChanged:function(a){this._main.getMesh()&&(this._main.getMesh().setOpacity(1-a/100),this._main.render())},onShaderChanged:function(a){var b=this._main,c=b.getMesh();c&&("UV"!==a||c.hasUV()?(c.setShaderName(a),b.render()):(this.updateMesh(),window.alert("No UV on this mesh."))),this.updateVisibility()},onMatcapChanged:function(a){this._main.getMesh()&&(this._main.getMesh().setMatcap(a),this._main.render())},onFlatShading:function(a){this._main.getMesh()&&(this._main.getMesh().setFlatShading(a),this._main.render())},onShowWireframe:function(a){this._main.getMesh()&&(this._main.getMesh().setShowWireframe(a),this._main.render())},addEvents:function(){var a=this.loadTextureUV.bind(this),b=this.loadMatcap.bind(this);document.getElementById("textureopen").addEventListener("change",a,!1),document.getElementById("matcapopen").addEventListener("change",b,!1),this.removeCallback=function(){document.getElementById("textureopen").removeEventListener("change",a,!1),document.getElementById("matcapopen").removeEventListener("change",b,!1)}},removeEvents:function(){this.removeCallback&&this.removeCallback()},updateMesh:function(){var a=this._main.getMesh();return a?(this._menu.setVisibility(!0),this._ctrlShaders.setValue(a.getShaderName(),!0),this._ctrlFlatShading.setValue(a.getFlatShading(),!0),this._ctrlShowWireframe.setValue(a.getShowWireframe(),!0),this._ctrlMatcap.setValue(a.getMatcap(),!0),this._ctrlTransparency.setValue(100-100*a.getOpacity(),!0),this._ctrlCurvature.setValue(20*a.getCurvature(),!0),void this.updateVisibility()):void this._menu.setVisibility(!1)},updateVisibility:function(){var a=this._main.getMesh();if(a){var b=a.getShaderName();this._ctrlMatcapTitle.setVisibility("MATCAP"===b),this._ctrlMatcap.setVisibility("MATCAP"===b),this._ctrlImportMatcap.setVisibility("MATCAP"===b),this._ctrlExposure.setVisibility("PBR"===b),this._ctrlEnvTitle.setVisibility("PBR"===b),this._ctrlEnv.setVisibility("PBR"===b),this._ctrlUV.setVisibility("UV"===b)}},getFlatShading:function(){return this._ctrlFlatShading.getValue()},getWireframe:function(){return this._ctrlShowWireframe.getValue()},getShaderName:function(){return this._ctrlShaders.getValue()},importTexture:function(){document.getElementById("textureopen").click()},loadTextureUV:function(a){if(0!==a.target.files.length){var b=a.target.files[0];if(b.type.match("image.*")){var c=new FileReader,d=this._main;c.onload=function(a){h.texture0=void 0,h.texPath=a.target.result,d.render()},document.getElementById("textureopen").value="",c.readAsDataURL(b)}}},loadMatcap:function(a){if(0!==a.target.files.length){var b=a.target.files[0];if(b.type.match("image.*")){var c=new FileReader,d=this._main,e=this._ctrlMatcap;c.onload=function(a){var c=new Image;c.src=a.target.result,c.onload=function(){var a=j.matcaps.length;j.matcaps.push({name:b.name}),j.createTexture(d._gl,c,a);var f={};f[a]=b.name,e.addOptions(f),e.setValue(a),d.render()}},document.getElementById("matcapopen").value="",c.readAsDataURL(b)}}},importMatcap:function(){document.getElementById("matcapopen").click()},onKeyUp:function(a){87!==a.which||a.ctrlKey||this._ctrlShowWireframe.setValue(!this._ctrlShowWireframe.getValue())}},c.exports=k}),define("gui/GuiScene",["require","exports","module","gui/GuiTR","editing/Remesh","render/shaders/ShaderBase"],function(a,b,c){"use strict";var d=a("gui/GuiTR"),e=a("editing/Remesh"),f=a("render/shaders/ShaderBase"),g=function(a,b){this._main=b._main,this._menu=null,this._hideMeshes=[],this._cbToggleShowHide=this.toggleShowHide.bind(this,!0),this.init(a)};g.prototype={init:function(a){var b=this._menu=a.addMenu(d("sceneTitle"));b.addButton(d("sceneReset"),this._main,"clearScene"),b.addButton(d("sceneAddSphere"),this._main,"addSphere"),b.addButton(d("sceneAddCube"),this._main,"addCube"),b.addButton(d("sceneAddCylinder"),this._main,"addCylinder"),b.addButton(d("sceneAddTorus"),this._main,"addTorus"),b.addTitle(d("sceneSelection")),this._ctrlIsolate=b.addCheckbox(d("renderingIsolate"),!1,this.showHide.bind(this)),this._ctrlIsolate.setVisibility(!1),this._ctrlMerge=b.addButton(d("sceneMerge"),this,"merge"),this._ctrlMerge.setVisibility(!1),b.addTitle(d("renderingExtra")),b.addCheckbox(d("darkenUnselected"),f.darkenUnselected,this.onDarkenUnselected.bind(this)),b.addCheckbox(d("contourShow"),this._main._showContour,this.onShowContour.bind(this)),b.addCheckbox(d("renderingGrid"),this._main._showGrid,this.onShowGrid.bind(this)),b.addCheckbox(d("renderingSymmetryLine"),f.showSymmetryLine,this.onShowSymmetryLine.bind(this))},validatePreview:function(){this._main._meshPreview||this._main.addTorus(!0),this._main._meshPreview.setShowWireframe(!1),this._main.addNewMesh(this._main._meshPreview),this._main._meshPreview=null,this.ctrlDiscard.setVisibility(!1),this.ctrlValidate.setVisibility(!1),this._main.render()},discardPreview:function(){this._main._meshPreview=null,this.ctrlDiscard.setVisibility(!1),this.ctrlValidate.setVisibility(!1),this._main.render()},updateTorusRadius:function(a){this._main._torusRadius=a,this.updateTorus()},updateTorusRadial:function(a){this._main._torusRadial=a,this.updateTorus()},updateTorusTubular:function(a){this._main._torusTubular=a,this.updateTorus()},updateTorusWidth:function(a){return this._main._torusWidth=a,this._main._torusLength<this._main._torusWidth?void this.ctrlLE.setValue(a):void this.updateTorus()},updateTorusLength:function(a){return this._main._torusLength=a,this._main._torusLength<this._main._torusWidth?void this.ctrlWI.setValue(a):void this.updateTorus()},updateTorus:function(){this._main.addTorus(!0),this.ctrlDiscard.setVisibility(!0),this.ctrlValidate.setVisibility(!0),this._main.render()},updateMesh:function(){var a=this._main.getMeshes().length,b=this._main.getSelectedMeshes().length;this._ctrlIsolate.setVisibility(this._hideMeshes.length>0||a!==b&&b>=1),this._ctrlMerge.setVisibility(b>1)},merge:function(){var a=this._main,b=a.getSelectedMeshes();if(!(b.length<2)){var c=e.mergeMeshes(b,a.getMesh()||b[0]);a.removeMeshes(b),a.getStates().pushStateAddRemove(c,b.slice()),a.getMeshes().push(c),a.setMesh(c)}},toggleShowHide:function(a){this._ctrlIsolate.setValue(!this._ctrlIsolate.getValue(),!!a)},showHide:function(a){a?this.isolate():this.showAll(),this.updateMesh()},isolate:function(){var a=this._main,b=a.getSelectedMeshes(),c=a.getMeshes();if(c.length===b.length||c.length<2)return void this._ctrlIsolate.setValue(!1,!0);var d=this._hideMeshes;d.length=0;for(var e=0;e<c.length;++e){var f=a.getIndexSelectMesh(c[e]);0>f&&(d.push(c[e]),c.splice(e--,1))}a.getStates().pushStateRemove(d.slice()),a.getStates().pushStateCustom(this._cbToggleShowHide,this._cbToggleShowHide,!0),a.render()},showAll:function(){for(var a=this._main,b=a.getMeshes(),c=this._hideMeshes,d=0,e=c.length;e>d;++d)b.push(c[d]);a.getStates().pushStateAdd(c.slice()),a.getStates().pushStateCustom(this._cbToggleShowHide,this._cbToggleShowHide,!0),c.length=0,a.render()},onDarkenUnselected:function(a){f.darkenUnselected=a,this._main.render()},onShowSymmetryLine:function(a){f.showSymmetryLine=a,this._main.render()},onShowGrid:function(a){var b=this._main;b._showGrid=a,b.render()},onShowContour:function(a){var b=this._main;b._showContour=a,b.render()},onKeyDown:function(a){a.handled!==!0&&(a.stopPropagation(),this._main._focusGui||a.preventDefault(),73===a.which&&(this.toggleShowHide(),a.handled=!0))}},c.exports=g}),define("math3d/Picking",["require","exports","module","lib/glMatrix","math3d/Geometry","misc/Tablet","misc/Utils","gui/GuiTR"],function(a,b,c){"use strict";var d=a("lib/glMatrix"),e=a("math3d/Geometry"),f=a("misc/Tablet"),g=a("misc/Utils"),h=a("gui/GuiTR"),i=d.vec3,j=d.mat4,k=function(a,b){this._mesh=null,this._main=a,this._pickedFace=-1,this._pickedVertices=[],this._interPoint=[0,0,0],this._rLocal2=0,this._rWorld2=0,this._eyeDir=[0,0,0],this._xSym=!!b,this._pickedNormal=[0,0,0],this._alphaOrirign=[0,0,0],this._alphaSide=0,this._alphaLookAt=j.create(),this._alpha=null};k.INIT_ALPHAS_NAMES=[h("alphaSquare"),h("alphaSkin")],k.INIT_ALPHAS_PATHS=["square.jpg","skin.jpg"];var l=h("alphaNone");k.ALPHAS_NAMES={},k.ALPHAS_NAMES[l]=l,k.ALPHAS={},k.ALPHAS[k.ALPHAS_NAMES]=null,k.addAlpha=function(a,b,c,d){var e={};e._name=d,e._texture=a,e._ratioX=Math.max(1,b/c),e._ratioY=Math.max(1,c/b),e._ratioMax=Math.max(this._ratioX,this._ratioY),e._width=b,e._height=c;for(var f=1;k.ALPHAS[e._name];)e._name=d+f++;return k.ALPHAS[e._name]=e,k.ALPHAS_NAMES[e._name]=e._name,e},k.prototype={setIdAlpha:function(a){this._alpha=k.ALPHAS[a]},getAlpha:function(a,b,c){var d=this._alpha;if(!d||!d._texture)return 1;var e=this._alphaLookAt,f=this._alphaSide,g=d._ratioY*(e[0]*a+e[4]*b+e[8]*c+e[12])/(this._xSym?-f:f);if(Math.abs(g)>1)return 0;var h=d._ratioX*(e[1]*a+e[5]*b+e[9]*c+e[13])/f;if(Math.abs(h)>1)return 0;var i=d._width;return g=(.5-.5*g)*i,h=(.5-.5*h)*d._height,d._texture[(0|g)+i*(0|h)]/255},updateAlpha:function(){var a=[0,0,0],b=[0,0,0];return function(c){var d=Math.sqrt(this._rLocal2);if(this._alphaSide=d*Math.SQRT1_2,i.sub(b,this._interPoint,this._alphaOrirign),0!==i.len(b)){i.normalize(b,b);var e=this._pickedNormal;i.scaleAndAdd(b,b,e,-i.dot(b,e)),i.normalize(b,b),c||i.copy(this._alphaOrirign,this._interPoint),i.scaleAndAdd(a,this._alphaOrirign,e,d),j.lookAt(this._alphaLookAt,this._alphaOrirign,a,b)}}}(),initAlpha:function(){this.computePickedNormal(),this.updateAlpha()},getMesh:function(){return this._mesh},setLocalRadius2:function(a){this._rLocal2=a},getLocalRadius2:function(){return this._rLocal2},getLocalRadius:function(){return Math.sqrt(this._rLocal2)},getWorldRadius2:function(){return this._rWorld2},getWorldRadius:function(){return Math.sqrt(this._rWorld2)},setIntersectionPoint:function(a){this._interPoint=a},getEyeDirection:function(){return this._eyeDir},getIntersectionPoint:function(){return this._interPoint},getPickedVertices:function(){return this._pickedVertices},getPickedFace:function(){return this._pickedFace},getPickedNormal:function(){return this._pickedNormal},intersectionMouseMeshes:function(){var a=[0,0,0],b=[0,0,0],c=j.create(),d=[0,0,0];return function(e,f,g){var h=this._main;e||(e=h.getMeshes()),void 0===f&&(f=h._mouseX),void 0===g&&(g=h._mouseY);for(var k=this.unproject(f,g,0),l=this.unproject(f,g,.1),m=1/0,n=null,o=-1,p=0,q=e.length;q>p;++p){var r=e[p];if(j.invert(c,r.getMatrix()),i.transformMat4(a,k,c),i.transformMat4(b,l,c),this.intersectionRayMesh(r,a,b)){var s=this.getIntersectionPoint(),t=i.dist(a,s)*r.getScale();m>t&&(m=t,n=r,i.copy(d,s),o=this.getPickedFace())}}return this._mesh=n,i.copy(this._interPoint,d),this._pickedFace=o,-1!==o&&this.updateLocalAndWorldRadius2(),!!n}}(),intersectionMouseMesh:function(a,b,c){var d=this._main;a||(a=d.getMesh()),void 0===b&&(b=d._mouseX),void 0===c&&(c=d._mouseY);var e=this.unproject(b,c,0),f=this.unproject(b,c,.1),g=j.create();return j.invert(g,a.getMatrix()),i.transformMat4(e,e,g),i.transformMat4(f,f,g),this.intersectionRayMesh(a,e,f)},intersectionRayMesh:function(){var a=[0,0,0],b=[0,0,0],c=[0,0,0],d=[0,0,0],f=[0,0,0],g=[0,0,0];return function(h,j,k){if(this._mesh=null,this._pickedFace=-1,i.copy(f,j),i.copy(g,k),this._xSym){var l=h.getSymmetryOrigin(),m=h.getSymmetryNormal();e.mirrorPoint(f,l,m),e.mirrorPoint(g,l,m)}var n=h.getVertices(),o=h.getFaces(),p=this.getEyeDirection();i.sub(p,g,f),i.normalize(p,p);for(var q=h.intersectRay(f,p,h.getNbFaces()),r=1/0,s=q.length,t=0;s>t;++t){var u=4*q[t],v=3*o[u],w=3*o[u+1],x=3*o[u+2];a[0]=n[v],a[1]=n[v+1],a[2]=n[v+2],b[0]=n[w],b[1]=n[w+1],b[2]=n[w+2],c[0]=n[x],c[1]=n[x+1],c[2]=n[x+2];var y=e.intersectionRayTriangle(f,p,a,b,c,d);0>y&&(w=3*o[u+3],w>=0&&(b[0]=n[w],b[1]=n[w+1],b[2]=n[w+2],y=e.intersectionRayTriangle(f,p,a,c,b,d))),y>=0&&r>y&&(r=y,i.copy(this._interPoint,d),this._pickedFace=q[t])}return-1!==this._pickedFace?(this._mesh=h,this.updateLocalAndWorldRadius2(),!0):(this._rLocal2=0,!1)}}(),pickVerticesInSphere:function(a){for(var b=this._mesh,c=b.getVertices(),d=b.getVerticesSculptFlags(),e=b.getLeavesUpdate(),f=this.getIntersectionPoint(),h=b.intersectSphere(f,a,e,b.getNbFaces()),i=b.getVerticesFromFaces(h),j=i.length,k=++g.SCULPT_FLAG,l=new Uint32Array(g.getMemory(4*j+12),0,j+3),m=0,n=f[0],o=f[1],p=f[2],q=0;j>q;++q){var r=i[q],s=3*r,t=n-c[s],u=o-c[s+1],v=p-c[s+2];a>t*t+u*u+v*v&&(d[r]=k,l[m++]=r)}return this._pickedVertices=new Uint32Array(l.subarray(0,m)),this._pickedVertices},pickVerticesInSphereTopological:function(a){var b=this._mesh,c=b.getNbVertices(),d=b.getVertices(),e=b.getFaces(),f=b.getVerticesRingVertStartCount(),h=b.getVerticesRingVert(),i=h instanceof Array?h:null,j=b.getVerticesSculptFlags(),k=++g.SCULPT_FLAG,l=this.getPickedFace(),m=new Uint32Array(g.getMemory(4*c),0,c);m[0]=e[4*l];for(var n=1,o=this.getIntersectionPoint(),p=o[0],q=o[1],r=o[2],s=0;n>s;++s){var t,u,v=m[s];i?(h=i[v],t=0,u=h.length):(t=f[2*v],u=t+f[2*v+1]);for(var w=t;u>w;++w){var x=h[w];if(j[x]!==k){j[x]=k;var y=3*x,z=p-d[y],A=q-d[y+1],B=r-d[y+2];z*z+A*A+B*B>a||(m[n++]=x)}}}return this._pickedVertices=new Uint32Array(m.subarray(1,n)),this._pickedVertices},computeWorldRadius2:function(){var a=[0,0,0];return function(b){i.transformMat4(a,this.getIntersectionPoint(),this._mesh.getMatrix());var c=this._main.getSculpt().getCurrentTool().getScreenRadius();b||(c*=f.getPressureRadius());var d=this.project(a);return i.sqrDist(a,this.unproject(d[0]+c,d[1],d[2]))}}(),updateLocalAndWorldRadius2:function(){this._mesh&&(this._rWorld2=this.computeWorldRadius2(),this._rLocal2=this._rWorld2/this._mesh.getScale2())},unproject:function(a,b,c){return this._main.getCamera().unproject(a,b,c)},project:function(a){return this._main.getCamera().project(a)},computePickedNormal:function(){return!this._mesh||this._pickedFace<0?void 0:(this.polyLerp(this._mesh.getNormals(),this._pickedNormal),i.normalize(this._pickedNormal,this._pickedNormal))},polyLerp:function(a,b){var c=this._mesh.getVertices(),d=this._mesh.getFaces(),e=4*this._pickedFace,f=3*d[e],g=3*d[e+1],h=3*d[e+2],j=3*d[e+3],k=1/i.dist(this._interPoint,c.subarray(f,f+3)),l=1/i.dist(this._interPoint,c.subarray(g,g+3)),m=1/i.dist(this._interPoint,c.subarray(h,h+3)),n=j>=0?1/i.dist(this._interPoint,c.subarray(j,j+3)):0,o=1/(k+l+m+n);return i.set(b,0,0,0),i.scaleAndAdd(b,b,a.subarray(f,f+3),k*o),i.scaleAndAdd(b,b,a.subarray(g,g+3),l*o),i.scaleAndAdd(b,b,a.subarray(h,h+3),m*o),j>=0&&i.scaleAndAdd(b,b,a.subarray(j,j+3),n*o),b}},c.exports=k}),define("gui/GuiSculptingTools",["require","exports","module","lib/glMatrix","editing/tools/Tools","gui/GuiTR","math3d/Picking","misc/Utils"],function(a,b,c){"use strict";var d=a("lib/glMatrix"),e=a("editing/tools/Tools"),f=a("gui/GuiTR"),g=a("math3d/Picking"),h=a("misc/Utils"),i=d.vec3,j={};j.initGuiTools=function(a,b,c){for(var d=e.keys,f=0,g=d.length;g>f;++f){var h=d[f],i=j[h];i||(console.error("No gui for : "+h),j[h]={_ctrls:[],init:function(){}}),j[h].init(a.getTool(h),b,c),j.hide(h)}},j.hide=function(a){for(var b=0,c=j[a]._ctrls,d=c.length;d>b;++b)c[b].setVisibility(!1)},j.show=function(a){for(var b=0,c=j[a]._ctrls,d=c.length;d>b;++b)c[b].setVisibility(!0)};var k=function(a,b,c){this[a]=b?c/b:c},l=function(a,b,c,d){var e=b.addSlider(f("sculptRadius"),a._radius,function(b){k.call(a,"_radius",1,b),0===d.getSelectionRadius().getOffsetX()&&d.getSelectionRadius().setOffsetX(.01),d.renderSelectOverRtt()},5,500,1);return c._ctrlRadius=e,e},m=function(a,b,c){var d=b.addSlider(f("sculptIntensity"),100*a._intensity,k.bind(a,"_intensity",100),0,100,1);return c._ctrlIntensity=d,d},n=function(a,b){return b.addSlider(f("sculptHardness"),100*a._hardness,k.bind(a,"_hardness",100),0,100,1)},o=function(a,b){return b.addCheckbox(f("sculptCulling"),a,"_culling")},p=function(a,b,c,d){var e=b.addCheckbox(d||f("sculptNegative"),a,"_negative");return c.toggleNegative=function(){e.setValue(!e.getValue())},e},q=function(){document.getElementById("alphaopen").click()},r=function(a,b,c,d){a.push(b.addTitle(f("sculptAlphaTitle"))),void 0!==c._lockPosition&&a.push(b.addCheckbox(f("sculptLockPositon"),c,"_lockPosition")),d._ctrlAlpha=b.addCombobox(f("sculptAlphaTex"),c,"_idAlpha",g.ALPHAS_NAMES),a.push(d._ctrlAlpha),a.push(b.addButton(f("sculptImportAlpha"),q))};j.BRUSH={_ctrls:[],init:function(a,b,c){this._ctrls.push(l(a,b,this,c)),this._ctrls.push(m(a,b,this)),this._ctrls.push(p(a,b,this)),this._ctrls.push(b.addCheckbox(f("sculptClay"),a,"_clay")),this._ctrls.push(b.addCheckbox(f("sculptAccumulate"),a,"_accumulate")),this._ctrls.push(o(a,b)),r(this._ctrls,b,a,this)}},j.CREASE={_ctrls:[],init:function(a,b,c){this._ctrls.push(l(a,b,this,c)),this._ctrls.push(m(a,b,this)),this._ctrls.push(p(a,b,this)),this._ctrls.push(o(a,b)),r(this._ctrls,b,a,this)}},j.DRAG={_ctrls:[],init:function(a,b,c){this._ctrls.push(l(a,b,this,c)),r(this._ctrls,b,a,this)}},j.FLATTEN={_ctrls:[],init:function(a,b,c){this._ctrls.push(l(a,b,this,c)),this._ctrls.push(m(a,b,this)),this._ctrls.push(p(a,b,this)),this._ctrls.push(o(a,b)),r(this._ctrls,b,a,this)}},j.INFLATE={_ctrls:[],init:function(a,b,c){this._ctrls.push(l(a,b,this,c)),this._ctrls.push(m(a,b,this)),this._ctrls.push(p(a,b,this)),this._ctrls.push(o(a,b)),r(this._ctrls,b,a,this)}},j.PAINT={_ctrls:[],onMaterialChanged:function(a,b,c){i.copy(b._color,c[0].getValue()),b._material[0]=c[1].getValue()/100,b._material[1]=c[2].getValue()/100;var d=a.getMesh();d&&(d.setAlbedo(b._color),d.setRoughness(b._material[0]),d.setMetallic(b._material[1]),a.render())},resetMaterialOverride:function(a,b){this._ctrlPicker.getValue()!==b._pickColor&&this._ctrlPicker.setValue(b._pickColor);var c=a.getMesh();c&&c.getAlbedo&&(c.getAlbedo()[0]=-1,c.setRoughness(-1),c.setMetallic(-1),a.render())},onPickedMaterial:function(a,b,c,d,e,f){c.setCanvasCursor(h.cursors.dropper),a[0].setValue(d,!0),a[1].setValue(100*e,!0),a[2].setValue(100*f,!0),i.copy(b._color,d),b._material[0]=e,b._material[1]=f},onColorPick:function(a,b,c){a._pickColor=c,b.setCanvasCursor(c?h.cursors.dropper:"default"),b._action=c?"SCULPT_EDIT":"NOTHING",b.renderSelectOverRtt()},init:function(a,b,c){this._ctrls.push(l(a,b,this,c)),this._ctrls.push(m(a,b,this)),this._ctrls.push(n(a,b,this)),this._ctrls.push(o(a,b)),this._ctrls.push(b.addTitle(f("sculptPBRTitle"))),this._ctrls.push(b.addButton(f("sculptPaintAll"),a,"paintAll")),this._ctrlPicker=b.addCheckbox(f("sculptPickColor"),a._pickColor,this.onColorPick.bind(this,a,c)),this._ctrls.push(this._ctrlPicker);var d=[],e=this.onMaterialChanged.bind(this,c,a,d),g=b.addColor(f("sculptColor"),a._color,e),h=b.addSlider(f("sculptRoughness"),100*a._material[0],e,0,100,1),i=b.addSlider(f("sculptMetallic"),100*a._material[1],e,0,100,1);d.push(g,h,i),window.addEventListener("keyup",this.resetMaterialOverride.bind(this,c,a)),window.addEventListener("mouseup",this.resetMaterialOverride.bind(this,c,a)),a.setPickCallback(this.onPickedMaterial.bind(this,d,a,c)),this._ctrls.push(g,h,i),r(this._ctrls,b,a,this)}},j.PINCH={_ctrls:[],init:function(a,b,c){this._ctrls.push(l(a,b,this,c)),this._ctrls.push(m(a,b,this)),this._ctrls.push(p(a,b,this)),this._ctrls.push(o(a,b)),r(this._ctrls,b,a,this)}},j.TWIST={_ctrls:[],init:function(a,b,c){this._ctrls.push(l(a,b,this,c)),this._ctrls.push(o(a,b)),r(this._ctrls,b,a,this)}},j.LOCALSCALE={_ctrls:[],init:function(a,b,c){this._ctrls.push(l(a,b,this,c)),this._ctrls.push(o(a,b)),r(this._ctrls,b,a,this)}},j.MOVE={_ctrls:[],init:function(a,b,c){this._ctrls.push(l(a,b,this,c)),this._ctrls.push(m(a,b,this)),this._ctrls.push(b.addCheckbox(f("sculptTopologicalCheck"),a,"_topoCheck")),this._ctrls.push(p(a,b,this,f("sculptMoveAlongNormal"))),r(this._ctrls,b,a,this)}},j.SMOOTH={_ctrls:[],init:function(a,b,c){this._ctrls.push(l(a,b,this,c)),this._ctrls.push(m(a,b,this)),this._ctrls.push(b.addCheckbox(f("sculptTangentialSmoothing"),a,"_tangent")),this._ctrls.push(o(a,b)),r(this._ctrls,b,a,this)}},j.MASKING={_ctrls:[],init:function(a,b,c){this._ctrls.push(l(a,b,this,c)),this._ctrls.push(m(a,b,this)),this._ctrls.push(n(a,b,this)),this._ctrls.push(p(a,b,this)),this._ctrls.push(o(a,b)),this._main=c,this._tool=a;var d=b.addDualButton(f("sculptMaskingClear"),f("sculptMaskingInvert"),a,a,"clear","invert"),e=b.addDualButton(f("sculptMaskingBlur"),f("sculptMaskingSharpen"),a,a,"blur","sharpen");this._ctrls.push(d[0],d[1],e[0],e[1]),this._ctrls.push(b.addTitle(f("sculptExtractTitle"))),this._ctrls.push(b.addSlider(f("sculptExtractThickness"),a,"_thickness",-5,5,.001)),this._ctrls.push(b.addButton(f("sculptExtractAction"),a,"extract")),r(this._ctrls,b,a,this)}},j.TRANSFORM={_ctrls:[],init:function(){}},c.exports=j}),define("gui/GuiSculpting",["require","exports","module","gui/GuiTR","editing/tools/Tools","misc/getOptionsURL","gui/GuiSculptingTools"],function(a,b,c){"use strict";var d=a("gui/GuiTR"),e=a("editing/tools/Tools"),f=a("misc/getOptionsURL"),g=a("gui/GuiSculptingTools"),h=function(a,b){this._main=b._main,this._ctrlGui=b,this._sculpt=b._main.getSculpt(),this._toolOnRelease=-1,this._invertSign=!1,this._modalBrushRadius=!1,this._modalBrushIntensity=!1,this._lastPageX=0,this._lastPageY=0,this._refX=0,this._refY=0,this._menu=null,this._ctrlSculpt=null,this._ctrlSymmetry=null,this._ctrlContinuous=null,this._ctrlTitleCommon=null,this.init(a)};h.prototype={init:function(a){var b=this._menu=a.addMenu(d("sculptTitle"));b.open(),b.addTitle(d("sculptTool"));for(var c={},f=e.keys,h=0,i=f.length;i>h;++h){var j=f[h];c[j]=d(e[j].uiName)}this._ctrlSculpt=b.addCombobox(d("sculptTool"),this._sculpt._tool,this.onChangeTool.bind(this),c),g.initGuiTools(this._sculpt,this._menu,this._main),this._ctrlTitleCommon=b.addTitle(d("sculptCommon")),this._ctrlSymmetry=b.addCheckbox(d("sculptSymmetry"),this._sculpt._symmetry,this.onSymmetryChange.bind(this)),this._ctrlContinuous=b.addCheckbox(d("sculptContinuous"),this._sculpt,"_continuous"),g.show(this._sculpt._tool),this.addEvents(),this.onChangeTool(this._sculpt._tool)},onSymmetryChange:function(a){this._sculpt._symmetry=a,this._main.render()},addEvents:function(){var a=this.loadAlpha.bind(this);document.getElementById("alphaopen").addEventListener("change",a,!1),this.removeCallback=function(){document.getElementById("alphaopen").removeEventListener("change",a,!1)}},removeEvents:function(){this.removeCallback&&this.removeCallback()},getSelectedTool:function(){return this._ctrlSculpt.getValue()},releaseInvertSign:function(){if(this._invertSign){this._invertSign=!1;var a=g[this.getSelectedTool()];a.toggleNegative&&a.toggleNegative()}},onChangeTool:function(a){g.hide(this._sculpt._tool),this._sculpt._tool=a,g.show(a);var b=this._sculpt.canBeContinuous()===!0;this._ctrlContinuous.setVisibility(b);var c="TRANSFORM"!==a;this._ctrlSymmetry.setVisibility(c),this._ctrlTitleCommon.setVisibility(b||c),this._main.getPicking().updateLocalAndWorldRadius2()},loadAlpha:function(a){if(0!==a.target.files.length){var b=a.target.files[0];if(b.type.match("image.*")){var c=new FileReader,d=this._main,e=g[d.getSculpt()._tool];c.onload=function(a){var c=new Image;c.src=a.target.result,c.onload=d.onLoadAlphaImage.bind(d,c,b.name||"new alpha",e)},document.getElementById("alphaopen").value="",c.readAsDataURL(b)}}},addAlphaOptions:function(a){for(var b=e.keys,c=0,d=b.length;d>c;++c){var f=g[b[c]];f&&f._ctrlAlpha&&f._ctrlAlpha.addOptions(a)}},updateMesh:function(){this._menu.setVisibility(!!this._main.getMesh())},_startModalBrushRadius:function(a,b){this._refX=a,this._refY=b;var c=g[this.getSelectedTool()];if(c._ctrlRadius){var d=c._ctrlRadius.getValue();this._refX-=d,this._main.getSelectionRadius().setOffsetX(-d*this._main.getPixelRatio()),this._main.renderSelectOverRtt()}},_checkModifierKey:function(a){var b=this.getSelectedTool();if("NOTHING"===this._main._action&&(!a.shiftKey||a.altKey||a.ctrlKey||"SMOOTH"!==b&&(this._toolOnRelease=b,this._ctrlSculpt.setValue("SMOOTH")),!a.ctrlKey||a.shiftKey||a.altKey||"MASKING"!==b&&(this._toolOnRelease=b,this._ctrlSculpt.setValue("MASKING"))),a.altKey){if(this._invertSign||a.shiftKey)return!0;this._invertSign=!0;var c=g[b];return c.toggleNegative&&c.toggleNegative(),!0}return!1},onKeyDown:function(a){if(a.handled!==!0){var b=this._main,c=a.which;if(a.stopPropagation(),b._focusGui&&88!==c&&67!==c||a.preventDefault(),a.handled=!0,!this._checkModifierKey(a)&&"NOTHING"===b._action){c>=96&&105>=c&&(c-=48);var d=f(),h=d.shortcuts[c];if(h&&e[h])return this._ctrlSculpt.setValue(h);var i=g[this.getSelectedTool()];switch(c){case 46:b.deleteCurrentSelection();break;case 67:this._modalBrushIntensity=b._focusGui=!0;break;case 78:i.toggleNegative&&i.toggleNegative();break;case 83:var j=i._ctrlPicker;j&&!j.getValue()&&j.setValue(!0);break;case 88:this._modalBrushRadius||this._startModalBrushRadius(this._lastPageX,this._lastPageY),this._modalBrushRadius=b._focusGui=!0;break;default:a.handled=!1}}}},onKeyUp:function(a){var b="NOTHING"===this._main._action&&-1!==this._toolOnRelease&&!a.ctrlKey&&!a.shiftKey;(!a.altKey||b)&&this.releaseInvertSign(),b&&(this._ctrlSculpt.setValue(this._toolOnRelease),this._toolOnRelease=-1);var c=this._main;switch(a.which){case 88:this._modalBrushRadius=c._focusGui=!1,c.getSelectionRadius().setOffsetX(0),a.pageX=this._lastPageX,a.pageY=this._lastPageY,c.setMousePosition(a),c.getPicking().intersectionMouseMeshes(),c.renderSelectOverRtt();break;case 83:var d=g[this.getSelectedTool()],e=d._ctrlPicker;e&&e.getValue()&&e.setValue(!1);break;case 67:this._modalBrushIntensity=c._focusGui=!1}},onMouseUp:function(a){-1===this._toolOnRelease||a.ctrlKey||a.shiftKey||(this.releaseInvertSign(),this._ctrlSculpt.setValue(this._toolOnRelease),this._toolOnRelease=-1)},onMouseMove:function(a){var b=g[this.getSelectedTool()];if(this._modalBrushRadius&&b._ctrlRadius){var c=a.pageX-this._refX,d=a.pageY-this._refY;b._ctrlRadius.setValue(Math.sqrt(c*c+d*d)),this._main.renderSelectOverRtt()}this._modalBrushIntensity&&b._ctrlIntensity&&b._ctrlIntensity.setValue(b._ctrlIntensity.getValue()+a.pageX-this._lastPageX),this._lastPageX=a.pageX,this._lastPageY=a.pageY},onMouseOver:function(a){this._modalBrushRadius&&this._startModalBrushRadius(a.pageX,a.pageY)}},c.exports=h}),define("states/StateAddRemove",["require","exports","module"],function(a,b,c){"use strict";var d=function(a,b,c){this._main=a,this._addedMeshes=void 0!==b.length?b:[b],this._removedMeshes=void 0!==c.length?c:[c],this._selectMeshes=a.getSelectedMeshes().slice()};d.prototype={isNoop:function(){return 0===this._addedMeshes.length&&0===this._removedMeshes.length},undo:function(){var a,b,c=this._main,d=c.getMeshes(),e=this._addedMeshes;for(a=0,b=e.length;b>a;++a)d.splice(c.getIndexMesh(e[a]),1);var f=this._removedMeshes;for(a=0,b=f.length;b>a;++a)d.push(f[a]);for(a=0,b=d.length;b>a;++a){var g=d[a];g.getRender()._mesh=g,g.initRender()}var h=this._selectMeshes;c.setMesh(h[0]?h[0]:null);var i=c.getSelectedMeshes();for(i.length=0,a=0,b=h.length;b>a;++a)i.push(h[a])},redo:function(){this.undo()},createRedo:function(){return new d(this._main,this._removedMeshes,this._addedMeshes)}},c.exports=d}),define("states/StateColorAndMaterial",["require","exports","module","misc/Utils"],function(a,b,c){"use strict";var d=a("misc/Utils"),e=function(a,b){this._main=a,this._mesh=b,this._idVertState=[],this._cArState=[],this._mArState=[]};e.prototype={isNoop:function(){return 0===this._idVertState.length},undo:function(a){if(this.pullVertices(),!a){var b=this._mesh;b.updateDuplicateColorsAndMaterials(),b.updateDrawArrays(),b.updateColorBuffer(),b.updateMaterialBuffer(),this._main.setMesh(b)}},redo:function(){this.undo()},createRedo:function(){var a=new e(this._main,this._mesh);return this.pushRedoVertices(a),a},pushVertices:function(a){for(var b=this._idVertState,c=this._cArState,e=this._mArState,f=this._mesh,g=f.getColors(),h=f.getMaterials(),i=f.getVerticesStateFlags(),j=d.STATE_FLAG,k=a.length,l=0;k>l;++l){var m=a[l];i[m]!==j&&(i[m]=j,b.push(m),m*=3,c.push(g[m],g[m+1],g[m+2]),e.push(h[m],h[m+1],h[m+2]))}},pushRedoVertices:function(a){for(var b=a._mesh,c=b.getColors(),d=b.getMaterials(),e=this._idVertState,f=e.length,g=a._cArState=new Float32Array(3*f),h=a._mArState=new Float32Array(3*f),i=a._idVertState=new Uint32Array(f),j=0;f>j;++j){var k=i[j]=e[j];k*=3;var l=3*j;g[l]=c[k],g[l+1]=c[k+1],g[l+2]=c[k+2],h[l]=d[k],h[l+1]=d[k+1],h[l+2]=d[k+2]}},pullVertices:function(){for(var a=this._cArState,b=this._mArState,c=this._idVertState,d=c.length,e=this._mesh,f=e.getColors(),g=e.getMaterials(),h=0;d>h;++h){var i=3*c[h],j=3*h;f[i]=a[j],f[i+1]=a[j+1],f[i+2]=a[j+2],g[i]=b[j],g[i+1]=b[j+1],g[i+2]=b[j+2]}}},c.exports=e}),define("states/StateGeometry",["require","exports","module","lib/glMatrix","misc/Utils"],function(a,b,c){"use strict";var d=a("lib/glMatrix"),e=a("misc/Utils"),f=d.vec3,g=function(a,b){this._main=a,this._mesh=b,this._center=f.copy([0,0,0],b.getCenter()),this._idVertState=[],this._vArState=[]};g.prototype={isNoop:function(){return 0===this._idVertState.length},undo:function(a){if(this.pullVertices(),!a){var b=this._mesh;b.updateGeometry(b.getFacesFromVertices(this._idVertState),this._idVertState),b.updateGeometryBuffers(),f.copy(b.getCenter(),this._center),this._main.setMesh(b)}},redo:function(){this.undo()},createRedo:function(){var a=new g(this._main,this._mesh);return this.pushRedoVertices(a),a},pushVertices:function(a){for(var b=this._idVertState,c=this._vArState,d=this._mesh,f=d.getVertices(),g=d.getVerticesStateFlags(),h=e.STATE_FLAG,i=a.length,j=0;i>j;++j){var k=a[j];g[k]!==h&&(g[k]=h,b.push(k),k*=3,c.push(f[k],f[k+1],f[k+2]))}},pushRedoVertices:function(a){for(var b=a._mesh,c=b.getVertices(),d=this._idVertState,e=d.length,f=a._vArState=new Float32Array(3*e),g=a._idVertState=new Uint32Array(e),h=0;e>h;++h){var i=g[h]=d[h];i*=3;var j=3*h;f[j]=c[i],f[j+1]=c[i+1],f[j+2]=c[i+2]}},pullVertices:function(){for(var a=this._vArState,b=this._idVertState,c=b.length,d=this._mesh,e=d.getVertices(),f=0;c>f;++f){var g=3*b[f],h=3*f;e[g]=a[h],e[g+1]=a[h+1],e[g+2]=a[h+2]}}},c.exports=g}),define("states/StateDynamic",["require","exports","module","lib/glMatrix","misc/Utils"],function(a,b,c){"use strict";var d=a("lib/glMatrix"),e=a("misc/Utils"),f=d.vec3,g=function(a,b){
this._main=a,this._mesh=b,this._center=f.copy([0,0,0],b.getCenter()),this._nbFacesState=b.getNbFaces(),this._nbVerticesState=b.getNbVertices(),this._idVertState=[],this._fRingState=[],this._vRingState=[],this._vArState=[],this._cArState=[],this._mArState=[],this._idFaceState=[],this._fArState=[]};g.prototype={isNoop:function(){return 0===this._idVertState.length&&0===this._idFaceState.length},undo:function(a){this.pullVertices(),this.pullFaces();var b=this._mesh;b.setNbVertices(this._nbVerticesState),b.setNbFaces(this._nbFacesState),a||(b.updateGeometry(),b.updateTopology(),b.updateDuplicateColorsAndMaterials(),b.updateDrawArrays(),b.updateColorBuffer(),b.updateMaterialBuffer(),b.updateBuffers(),f.copy(b.getCenter(),this._center),this._main.setMesh(b))},redo:function(){this.undo()},createRedo:function(){var a=new g(this._main,this._mesh);return this.pushRedoVertices(a),this.pushRedoFaces(a),a},pushVertices:function(a){for(var b=this._idVertState,c=this._fRingState,d=this._vRingState,f=this._vArState,g=this._cArState,h=this._mArState,i=this._mesh,j=i.getVerticesRingFace(),k=i.getVerticesRingVert(),l=i.getVertices(),m=i.getColors(),n=i.getMaterials(),o=i.getVerticesStateFlags(),p=e.STATE_FLAG,q=a.length,r=0;q>r;++r){var s=a[r];o[s]!==p&&(o[s]=p,c.push(j[s].slice()),d.push(k[s].slice()),b.push(s),s*=3,f.push(l[s],l[s+1],l[s+2]),g.push(m[s],m[s+1],m[s+2]),h.push(n[s],n[s+1],n[s+2]))}},pushFaces:function(a){for(var b=this._idFaceState,c=this._fArState,d=this._mesh,f=d.getFaces(),g=d.getFacesStateFlags(),h=e.STATE_FLAG,i=a.length,j=0;i>j;++j){var k=a[j];g[k]!==h&&(g[k]=h,b.push(k),k*=4,c.push(f[k],f[k+1],f[k+2],f[k+3]))}},pushRedoVertices:function(a){var b=a._mesh,c=b.getNbVertices(),d=b.getVerticesRingFace(),f=b.getVerticesRingVert(),g=b.getVertices(),h=b.getColors(),i=b.getMaterials(),j=0,k=0,l=0,m=this._idVertState,n=m.length,o=this._nbVerticesState,p=Math.min(o,c),q=new Uint32Array(e.getMemory(4*c),0,c);for(j=0;n>j;++j)k=m[j],p>k&&(q[l++]=k);for(j=o;c>j;++j)q[l++]=j;n=l,q=a._idVertState=new Uint32Array(q.subarray(0,n));var r=a._fRingState=new Array(n),s=a._vRingState=new Array(n),t=a._vArState=new Float32Array(3*n),u=a._cArState=new Float32Array(3*n),v=a._mArState=new Float32Array(3*n);for(j=0;n>j;++j){k=q[j],r[j]=d[k].slice(),s[j]=f[k].slice(),k*=3;var w=3*j;t[w]=g[k],t[w+1]=g[k+1],t[w+2]=g[k+2],u[w]=h[k],u[w+1]=h[k+1],u[w+2]=h[k+2],v[w]=i[k],v[w+1]=i[k+1],v[w+2]=i[k+2]}},pushRedoFaces:function(a){var b=a._mesh,c=b.getNbFaces(),d=b.getFaces(),f=0,g=0,h=0,i=this._idFaceState,j=i.length,k=this._nbFacesState,l=Math.min(k,c),m=new Uint32Array(e.getMemory(4*c),0,c);for(f=0;j>f;++f)g=i[f],l>g&&(m[h++]=g);for(f=k;c>f;++f)m[h++]=f;j=h,m=a._idFaceState=new Uint32Array(m.subarray(0,j));var n=a._fArState=new Int32Array(4*j);for(f=0;j>f;++f){g=m[f],g*=4;var o=4*f;n[o]=d[g],n[o+1]=d[g+1],n[o+2]=d[g+2],n[o+3]=d[g+3]}},pullVertices:function(){for(var a=this._nbVerticesState,b=this._fRingState,c=this._vRingState,d=this._vArState,e=this._cArState,f=this._mArState,g=this._idVertState,h=g.length,i=this._mesh,j=i.getVerticesRingFace(),k=i.getVerticesRingVert(),l=i.getVertices(),m=i.getColors(),n=i.getMaterials(),o=0;h>o;++o){var p=g[o];if(!(p>=a)){j[p]=b[o].slice(),k[p]=c[o].slice(),p*=3;var q=3*o;l[p]=d[q],l[p+1]=d[q+1],l[p+2]=d[q+2],m[p]=e[q],m[p+1]=e[q+1],m[p+2]=e[q+2],n[p]=f[q],n[p+1]=f[q+1],n[p+2]=f[q+2]}}},pullFaces:function(){for(var a=this._nbFacesState,b=this._fArState,c=this._idFaceState,d=c.length,e=this._mesh,f=e.getFaces(),g=0;d>g;++g){var h=c[g];if(!(h>=a)){h*=4;var i=4*g;f[h]=b[i],f[h+1]=b[i+1],f[h+2]=b[i+2],f[h+3]=b[i+3]}}}},c.exports=g}),define("states/StateCustom",["require","exports","module"],function(a,b,c){"use strict";var d=function(a,b){this._undocb=a,this._redocb=b?b:a};d.prototype={isNoop:function(){return!this._undocb},undo:function(){this._undocb()},redo:function(){this._redocb()},createRedo:function(){return new d(this._undocb,this._redocb)}},c.exports=d}),define("states/States",["require","exports","module","misc/Utils","states/StateAddRemove","states/StateColorAndMaterial","states/StateGeometry","states/StateDynamic","states/StateMultiresolution","states/StateCustom"],function(a,b,c){"use strict";var d=a("misc/Utils"),e=a("states/StateAddRemove"),f=a("states/StateColorAndMaterial"),g=a("states/StateGeometry"),h=a("states/StateDynamic"),i=a("states/StateMultiresolution"),j=a("states/StateCustom"),k=function(a){this._main=a,this._undos=[],this._redos=[],this._curUndoIndex=-1};k.STACK_LENGTH=15,k.prototype={pushStateCustom:function(a,b,c){var d=new j(a,b);d.squash=c,this.pushState(d)},pushStateAddRemove:function(a,b,c){var d=new e(this._main,a,b);d.squash=c,this.pushState(d)},pushStateRemove:function(a){this.pushState(new e(this._main,[],a))},pushStateAdd:function(a){this.pushState(new e(this._main,a,[]))},pushStateColorAndMaterial:function(a){a.getDynamicTopology?this.pushState(new h(this._main,a)):this.pushState(new f(this._main,a))},pushStateGeometry:function(a){a.getDynamicTopology?this.pushState(new h(this._main,a)):this.pushState(new g(this._main,a))},pushStateMultiresolution:function(a,b){this.pushState(new i(this._main,a,b))},setNewMaxStack:function(a){k.STACK_LENGTH=a;for(var b=this._undos,c=this._redos;this._curUndoIndex>=a;)b.shift(),--this._curUndoIndex;for(;b.length>a;)b.pop(),c.shift()},pushState:function(a){++d.STATE_FLAG;var b=this._undos;-1===this._curUndoIndex?b.length=0:b.length>=k.STACK_LENGTH&&(b.shift(),--this._curUndoIndex),this._redos.length=0,++this._curUndoIndex,b.length>0&&(b.length=this._curUndoIndex),b.push(a)},getCurrentState:function(){return this._undos[this._curUndoIndex]},pushVertices:function(a){a&&a.length>0&&this.getCurrentState().pushVertices(a)},pushFaces:function(a){a&&a.length>0&&this.getCurrentState().pushFaces(a)},undo:function(){if(this._undos.length&&!(this._curUndoIndex<0)){var a=this.getCurrentState(),b=a.createRedo();b.squash=a.squash,this._redos.push(b),a.undo(),this._curUndoIndex--,a.squash===!0&&this.undo()}},redo:function(){if(this._redos.length){var a=this._redos[this._redos.length-1];a.redo(),this._curUndoIndex++,this._redos.pop(),a.squash===!0&&this.redo()}},reset:function(){this._undos.length=0,this._redos.length=0,this._curUndoIndex=-1},cleanNoop:function(){for(;this._curUndoIndex>=0&&this.getCurrentState().isNoop();)this._undos.length--,this._curUndoIndex--,this._redos.length=0}},c.exports=k}),define("gui/GuiStates",["require","exports","module","gui/GuiTR","states/States"],function(a,b,c){"use strict";var d=a("gui/GuiTR"),e=a("states/States"),f=function(a,b){this._ctrlGui=b,this._main=b._main,this._menu=null,this.init(a)};f.prototype={init:function(a){var b=this._menu=a.addMenu(d("stateTitle"));b.addButton(d("stateUndo"),this,"onUndo","CTRL+Z"),b.addButton(d("stateRedo"),this,"onRedo","CTRL+Y"),b.addTitle(d("stateMaxStack"));var c=this._main.getStates();b.addSlider("",e.STACK_LENGTH,c.setNewMaxStack.bind(c),3,50,1)},onUndo:function(){this._main.getStates().undo(),this._main.render(),this._ctrlGui.updateMesh()},onRedo:function(){this._main.getStates().redo(),this._main.render(),this._ctrlGui.updateMesh()},onKeyDown:function(a){if(a.handled!==!0){a.stopPropagation(),this._main._focusGui||a.preventDefault();var b=a.which;a.ctrlKey&&90===b?(this.onUndo(),a.handled=!0):a.ctrlKey&&89===b&&(this.onRedo(),a.handled=!0)}}},c.exports=f}),define("gui/GuiTablet",["require","exports","module","gui/GuiTR","misc/Tablet"],function(a,b,c){"use strict";var d=a("gui/GuiTR"),e=a("misc/Tablet"),f=function(a){this._menu=null,this.init(a)};f.prototype={init:function(a){var b=this._menu=a.addMenu(d("wacomTitle"));b.addCheckbox(d("wacomRadius"),e,"useOnRadius"),b.addCheckbox(d("wacomIntensity"),e,"useOnIntensity")}},c.exports=f}),define("gui/Gui",["require","exports","module","lib/yagui","gui/GuiTR","gui/GuiBackground","gui/GuiCamera","gui/GuiConfig","gui/GuiFiles","gui/GuiMesh","gui/GuiTopology","gui/GuiRendering","gui/GuiScene","gui/GuiSculpting","gui/GuiStates","gui/GuiTablet","render/shaders/ShaderContour","misc/getOptionsURL"],function(a,b,c){"use strict";var d=a("lib/yagui"),e=a("gui/GuiTR"),f=a("gui/GuiBackground"),g=a("gui/GuiCamera"),h=a("gui/GuiConfig"),i=a("gui/GuiFiles"),j=a("gui/GuiMesh"),k=a("gui/GuiTopology"),l=a("gui/GuiRendering"),m=a("gui/GuiScene"),n=a("gui/GuiSculpting"),o=a("gui/GuiStates"),p=a("gui/GuiTablet"),q=a("render/shaders/ShaderContour"),r=a("misc/getOptionsURL"),s=function(a){this._main=a,this._guiMain=null,this._sidebar=null,this._topbar=null,this._ctrlTablet=null,this._ctrlFiles=null,this._ctrlScene=null,this._ctrlStates=null,this._ctrlCamera=null,this._ctrlBackground=null,this._ctrlSculpting=null,this._ctrlTopology=null,this._ctrlRendering=null,this._ctrlNotification=null,this._ctrls=[]};s.prototype={initGui:function(){this.deleteGui(),this._guiMain=new d.GuiMain(this._main.getViewport(),this._main.onCanvasResize.bind(this._main));var a=this._ctrls;a.length=0;var b=0;this._topbar=this._guiMain.addTopbar(),a[b++]=this._ctrlFiles=new i(this._topbar,this),a[b++]=this._ctrlScene=new m(this._topbar,this),a[b++]=this._ctrlStates=new o(this._topbar,this),a[b++]=this._ctrlBackground=new f(this._topbar,this),a[b++]=this._ctrlCamera=new g(this._topbar,this),r().wacom&&(a[b++]=this._ctrlTablet=new p(this._topbar,this)),a[b++]=this._ctrlConfig=new h(this._topbar,this),a[b++]=this._ctrlMesh=new j(this._topbar,this),this._sidebar=this._guiMain.addRightSidebar(),a[b++]=this._ctrlRendering=new l(this._sidebar,this),a[b++]=this._ctrlTopology=new k(this._sidebar,this),a[b++]=this._ctrlSculpting=new n(this._sidebar,this);var c=this._topbar.addMenu("Resolution");c.addTitle("Ratio"),c.addSlider("",this._main._pixelRatio,this.onPixelRatio.bind(this),.1,1.5,.02),this.addAboutButton(),this.updateMesh(),this.setVisibility(!0)},onPixelRatio:function(a){this._main._pixelRatio=a,this._main.onCanvasResize()},onContourColor:function(a){q.color[0]=a[0],q.color[1]=a[1],q.color[2]=a[2],q.color[3]=a[3],this._main.render()},addAboutButton:function(){var a=this._topbar.addMenu();a.domContainer.innerHTML=e("about"),a.domContainer.addEventListener("mousedown",function(){window.open("http://stephaneginier.com","_blank")})},getWidgetNotification:function(){return this._ctrlNotification||(this._ctrlNotification=this._topbar.addMenu(),this._ctrlNotification.setVisibility(!1)),this._ctrlNotification},updateMesh:function(){this._ctrlRendering.updateMesh(),this._ctrlTopology.updateMesh(),this._ctrlSculpting.updateMesh(),this._ctrlScene.updateMesh(),this.updateMeshInfo()},updateMeshInfo:function(){this._ctrlMesh.updateMeshInfo()},getFlatShading:function(){return this._ctrlRendering.getFlatShading()},getWireframe:function(){return this._ctrlRendering.getWireframe()},getShaderName:function(){return this._ctrlRendering.getShaderName()},addAlphaOptions:function(a){this._ctrlSculpting.addAlphaOptions(a)},deleteGui:function(){this._guiMain&&this._guiMain.domMain.parentNode&&(this.callFunc("removeEvents"),this.setVisibility(!1),this._guiMain.domMain.parentNode.removeChild(this._guiMain.domMain))},setVisibility:function(a){this._guiMain.setVisibility(a)},callFunc:function(a,b){for(var c=0,d=this._ctrls,e=d.length;e>c;++c){var f=d[c];f&&f[a]&&f[a](b)}}},c.exports=s}),define("math3d/Camera",["require","exports","module","lib/glMatrix","misc/getOptionsURL","misc/Utils","math3d/Geometry"],function(a,b,c){"use strict";var d=a("lib/glMatrix"),e=a("misc/getOptionsURL"),f=a("misc/Utils"),g=a("math3d/Geometry"),h=d.vec2,i=d.vec3,j=d.mat3,k=d.mat4,l=d.quat,m=function(a){return a=Math.min(1,a)-1,-(a*a*a*a-1)},n=200,o=-1,p=-1,q=200,r=function(a){this._main=a;var b=e();this._mode=b.cameramode||"ORBIT",this._projectionType=b.projection||"PERSPECTIVE",this._quatRot=[0,0,0,1],this._view=k.create(),this._proj=k.create(),this._viewport=k.create(),this._lastNormalizedMouseXY=[0,0],this._width=0,this._height=0,this._speed=0,this._fov=Math.min(b.fov,150),this._trans=[0,0,30],this._moveX=0,this._moveZ=0,this._usePivot=b.pivot,this._center=[0,0,0],this._offset=[0,0,0],this._rotX=0,this._rotY=0,this._near=.05,this._far=5e3,this._timers={},this.resetView()};r.prototype={setProjectionType:function(a){this._projectionType=a,this.updateProjection(),this.updateView()},setMode:function(a){this._mode=a,"ORBIT"===a&&this.resetViewFront()},setFov:function(a){this._fov=a,this.updateView(),this.optimizeNearFar()},setUsePivot:function(a){this._usePivot=a},toggleUsePivot:function(){this._usePivot=!this._usePivot},getView:function(){return this._view},getProjection:function(){return this._proj},getProjectionType:function(){return this._projectionType},isOrthographic:function(){return"ORTHOGRAPHIC"===this._projectionType},getMode:function(){return this._mode},getFov:function(){return this._fov},getUsePivot:function(){return this._usePivot},getConstantScreen:function(){return"ORTHOGRAPHIC"===this._projectionType?1/this.getOrthoZoom():Math.min(this._proj[0],.5*this._proj[5])},start:function(){var a=[0,0,0];return function(b,c){if(this._lastNormalizedMouseXY=g.normalizedMouse(b,c,this._width,this._height),this._usePivot){var d=this._main,e=d.getPicking();e.intersectionMouseMeshes(d.getMeshes(),b,c),e.getMesh()&&(i.transformMat4(a,e.getIntersectionPoint(),e.getMesh().getMatrix()),this.setPivot(a))}}}(),setPivot:function(){var a=[0,0,0,1];return function(b){if(i.transformQuat(this._offset,this._offset,l.invert(a,this._quatRot)),i.sub(this._offset,this._offset,this._center),i.copy(this._center,b),i.add(this._offset,this._offset,this._center),i.transformQuat(this._offset,this._offset,this._quatRot),"PERSPECTIVE"===this._projectionType){var c=this.getTransZ();this._trans[2]=i.dist(this.computePosition(),this._center)*this._fov/45,this._offset[2]+=this.getTransZ()-c}else this._offset[2]=0}}(),rotate:function(){var a=[0,0],b=[0,0,0],c=[0,0,0,0];return function(d,e){var f=g.normalizedMouse(d,e,this._width,this._height);if("ORBIT"===this._mode)h.sub(a,f,this._lastNormalizedMouseXY),this.setOrbit(this._rotX-2*a[1],this._rotY+2*a[0]),this.rotateDelay([6*-a[1],6*a[0]],o);else if("PLANE"===this._mode){var j=h.dist(this._lastNormalizedMouseXY,f);h.sub(a,f,this._lastNormalizedMouseXY),i.normalize(b,i.set(b,-a[1],a[0],0)),l.mul(this._quatRot,l.setAxisAngle(c,b,2*j),this._quatRot),this.rotateDelay([b[0],b[1],b[2],6*j],o)}else if("SPHERICAL"===this._mode){var k=g.mouseOnUnitSphere(this._lastNormalizedMouseXY),m=g.mouseOnUnitSphere(f),n=Math.acos(Math.min(1,i.dot(k,m)));i.normalize(b,i.cross(b,k,m)),l.mul(this._quatRot,l.setAxisAngle(c,b,2*n),this._quatRot),this.rotateDelay([b[0],b[1],b[2],6*n],o)}this._lastNormalizedMouseXY=f,this.updateView()}}(),setOrbit:function(a,b){var c=.49*Math.PI;this._rotX=Math.max(Math.min(a,c),-c),this._rotY=b;var d=this._quatRot;l.identity(d),l.rotateX(d,d,this._rotX),l.rotateY(d,d,this._rotY)},getTransZ:function(){return"PERSPECTIVE"===this._projectionType?45*this._trans[2]/this._fov:1e3},updateView:function(){var a=[0,1,0],b=[0,0,0],c=[0,0,0],d=k.create(),e=[0,0,0];return function(){var f=this._view,g=this._trans[0],h=this._trans[1],j=this._offset;i.set(b,g-j[0],h-j[1],this.getTransZ()-j[2]),i.set(c,g-j[0],h-j[1],-j[2]),k.lookAt(f,b,c,a),k.mul(f,f,k.fromQuat(d,this._quatRot)),k.translate(f,f,i.negate(e,this._center)),window.viewmat=f}}(),optimizeNearFar:function(){var a=[0,0,0],b=[0,0,0];return function(c){if(c||(c=this._lastBBox),c){this._lastBBox=c,i.set(a,this._trans[0],this._trans[1],this.getTransZ());var d=i.dist(c,i.set(b,c[3],c[4],c[5])),e=i.dist(a,i.set(b,.5*(c[0]+c[3]),.5*(c[1]+c[4]),.5*(c[2]+c[5])));this._near=Math.max(.01,e-d),this._far=d+e,this.updateProjection()}}}(),updateProjection:function(){"PERSPECTIVE"===this._projectionType?(k.perspective(this._proj,this._fov*Math.PI/180,this._width/this._height,this._near,this._far),this._proj[10]=-1,this._proj[14]=-2*this._near):this.updateOrtho()},updateTranslation:function(){var a=this._trans;a[0]+=this._moveX*this._speed*a[2]/50/400,a[2]=Math.max(1e-5,a[2]+this._moveZ*this._speed/400),"ORTHOGRAPHIC"===this._projectionType&&this.updateOrtho(),this.updateView()},translate:function(a,b){var c=this._speed*this._trans[2]/54,d=[-a*c,b*c,0];this.setTrans(i.add(this._trans,this._trans,d)),i.scale(d,d,5),this.translateDelay(d,p)},zoom:function(a){var b=[0,0,0];i.sub(b,this._offset,this._trans),i.scale(b,b,a*this._speed/54),0>a&&(b[0]=b[1]=0),this.setTrans(i.add(this._trans,this._trans,b)),i.scale(b,b,5),this.translateDelay(b,p)},setAndFocusOnPivot:function(a,b){this.setPivot(a),this.moveToDelay(this._offset[0],this._offset[1],this._offset[2]+b)},moveToDelay:function(a,b,c){var d=[a,b,c];this.translateDelay(i.sub(d,d,this._trans),q)},setTrans:function(a){i.copy(this._trans,a),"ORTHOGRAPHIC"===this._projectionType&&this.updateOrtho(),this.updateView()},getOrthoZoom:function(){return 55e-5*Math.abs(this._trans[2])},updateOrtho:function(){var a=this.getOrthoZoom(),b=this._width*a,c=this._height*a;k.ortho(this._proj,-b,b,-c,c,-this._near,this._far)},computePosition:function(){var a=this._view,b=[-a[12],-a[13],-a[14]],c=j.create();return j.fromMat4(c,a),i.transformMat3(b,b,j.transpose(c,c))},resetView:function(){this._speed=.9*f.SCALE,this.centerDelay([0,0,0],q),this.offsetDelay([0,0,0],q);var a=[0,0,3+this._speed/30];i.sub(a,a,this._trans),this.translateDelay(a,q),this.quatDelay([0,0,0,1],q)},resetViewFront:function(){this.quatDelay([0,0,0,1],n)},resetViewBack:function(){this.quatDelay([0,1,0,0],n)},resetViewTop:function(){this.quatDelay([Math.SQRT1_2,0,0,Math.SQRT1_2],n)},resetViewBottom:function(){this.quatDelay([-Math.SQRT1_2,0,0,Math.SQRT1_2],n)},resetViewLeft:function(){this.quatDelay([0,-Math.SQRT1_2,0,Math.SQRT1_2],n)},resetViewRight:function(){this.quatDelay([0,Math.SQRT1_2,0,Math.SQRT1_2],n)},toggleViewFront:function(){Math.abs(this._quatRot[3])>.99?this.resetViewBack():this.resetViewFront()},toggleViewTop:function(){var a=this._quatRot[0]*Math.SQRT1_2+this._quatRot[3]*Math.SQRT1_2;a*a>.99?this.resetViewBottom():this.resetViewTop()},toggleViewLeft:function(){var a=-this._quatRot[1]*Math.SQRT1_2+this._quatRot[3]*Math.SQRT1_2;a*a>.99?this.resetViewRight():this.resetViewLeft()},computeWorldToScreenMatrix:function(a){return a=a||k.create(),k.mul(a,k.mul(a,this._viewport,this._proj),this._view)},unproject:function(){var a=k.create();return function(b,c,d){var e=[0,0,0];return k.invert(a,this.computeWorldToScreenMatrix(a)),i.transformMat4(e,i.set(e,b,this._height-c,d),a)}}(),project:function(){var a=k.create();return function(b){var c=[0,0,0];return i.transformMat4(c,b,this.computeWorldToScreenMatrix(a)),c[1]=this._height-c[1],c}}(),onResize:function(){var a=[0,0,0];return function(b,c){this._width=b,this._height=c;var d=this._viewport;k.identity(d),k.scale(d,d,i.set(a,.5*b,.5*c,.5)),k.translate(d,d,i.set(a,1,1,1)),this.updateProjection()}}(),snapClosestRotation:function(){var a=Math.SQRT1_2,b=.5,c=[l.fromValues(1,0,0,0),l.fromValues(0,1,0,0),l.fromValues(0,0,1,0),l.fromValues(0,0,0,1),l.fromValues(a,a,0,0),l.fromValues(a,-a,0,0),l.fromValues(a,0,a,0),l.fromValues(a,0,-a,0),l.fromValues(a,0,0,a),l.fromValues(a,0,0,-a),l.fromValues(0,a,a,0),l.fromValues(0,a,-a,0),l.fromValues(0,a,0,a),l.fromValues(0,a,0,-a),l.fromValues(0,0,a,a),l.fromValues(0,0,a,-a),l.fromValues(b,b,b,b),l.fromValues(b,b,b,-b),l.fromValues(b,b,-b,b),l.fromValues(b,b,-b,-b),l.fromValues(b,-b,b,b),l.fromValues(b,-b,b,-b),l.fromValues(b,-b,-b,b),l.fromValues(-b,b,b,b)],d=c.length;return function(){for(var a=this._quatRot,b=1/0,e=0,f=0;d>f;++f){var g=l.dot(a,c[f]);g=1-g*g,g>b||(b=g,e=f)}this.quatDelay(c[e],n)}}(),clearTimerN:function(a){window.clearInterval(this._timers[a]),this._timers[a]=0},delay:function(a,b,c){var d=c||"default";if(this._timers[d]&&this.clearTimerN(d),0===b)return a(1);if(!(0>b)){var e=0,f=(new Date).getTime();this._timers[d]=window.setInterval(function(){var c=((new Date).getTime()-f)/b;c=m(c),a(c-e,c),e=c,c>=1&&this.clearTimerN(d)}.bind(this),16.6)}},_translateDelta:function(a,b){var c=this._trans;i.scaleAndAdd(c,c,a,b),this.setTrans(c),this._main.render()},translateDelay:function(a,b){var c=this._translateDelta.bind(this,a);this.delay(c,b,"translate")},_rotDelta:function(){var a=[0,0,0,0];return function(b,c){if("ORBIT"===this._mode){var d=this._rotX+b[0]*c,e=this._rotY+b[1]*c;this.setOrbit(d,e)}else l.mul(this._quatRot,l.setAxisAngle(a,b,b[3]*c),this._quatRot);this.updateView(),this._main.render()}}(),rotateDelay:function(a,b){var c=this._rotDelta.bind(this,a);this.delay(c,b,"rotate")},_quatDelta:function(){var a=[0,0,0,0];return function(b,c){l.identity(a),l.slerp(a,a,b,c);var d=this._quatRot;if(l.mul(this._quatRot,this._quatRot,a),"ORBIT"===this._mode){var e=d[0],f=d[1],g=d[2],h=d[3];this._rotY=Math.atan2(2*(h*f+g*e),1-2*(f*f+g*g)),this._rotX=Math.atan2(2*(h*e+f*g),1-2*(g*g+e*e))}this.updateView(),this._main.render()}}(),quatDelay:function(a,b){var c=[0,0,0,0];l.conjugate(c,this._quatRot),l.mul(c,c,a),l.normalize(c,c);var d=this._quatDelta.bind(this,c);this.delay(d,b,"quat")},_centerDelta:function(a,b){i.scaleAndAdd(this._center,this._center,a,b),this.updateView(),this._main.render()},centerDelay:function(a,b){var c=[0,0,0];i.sub(c,a,this._center);var d=this._centerDelta.bind(this,c);this.delay(d,b,"center")},_offsetDelta:function(a,b){i.scaleAndAdd(this._offset,this._offset,a,b),this.updateView(),this._main.render()},offsetDelay:function(a,b){var c=[0,0,0];i.sub(c,a,this._offset);var d=this._offsetDelta.bind(this,c);this.delay(d,b,"offset")},computeFrustumFit:function(){var a=this._near;if("ORTHOGRAPHIC"===this._projectionType)return 1/Math.sin(Math.atan2(Math.min(this._width,this._height)/a*.5,1));var b=this._proj,c=a*(b[8]-1)/b[0],d=a*(1+b[8])/b[0],e=a*(1+b[9])/b[5],f=a*(b[9]-1)/b[5],g=Math.abs(d-c),h=Math.abs(e-f);return this._fov/45/Math.sin(Math.atan2(Math.min(h,g)/a*.5,1))}},c.exports=r}),define("drawables/Background",["require","exports","module","render/Buffer","render/ShaderLib"],function(a,b,c){"use strict";var d=a("render/Buffer"),e=a("render/ShaderLib"),f=function(a,b){this._main=b,this._gl=a,this._vertexBuffer=new d(a,a.ARRAY_BUFFER,a.STATIC_DRAW),this._texCoordBuffer=new d(a,a.ARRAY_BUFFER,a.STATIC_DRAW),this._fill=!0,this._monoTex=null,this._texture=null,this._texWidth=1,this._texHeight=1,this.init()};f.prototype={init:function(){this.getTexCoordBuffer().update(new Float32Array([0,0,1,0,0,1,1,1])),this._monoTex=this.createOnePixelTexture(50,50,50,255),document.getElementById("backgroundopen").addEventListener("change",this.loadBackground.bind(this),!1)},loadBackground:function(a){if(0!==a.target.files.length){var b=a.target.files[0];if(b.type.match("image.*")){var c=this,d=new FileReader;d.onload=function(a){var b=new Image;b.src=a.target.result,b.onload=function(){var a=c._main.getCanvas();c.loadBackgroundTexture(b),c.onResize(a.width,a.height),c._main.render()}},document.getElementById("backgroundopen").value="",d.readAsDataURL(b)}}},getGL:function(){return this._gl},getVertexBuffer:function(){return this._vertexBuffer},getTexCoordBuffer:function(){return this._texCoordBuffer},release:function(){this.deleteTexture(),this.getVertexBuffer().release(),this.getTexCoordBuffer().release()},onResize:function(a,b){var c=a/b/(this._texWidth/this._texHeight),d=this._fill?1/c:c,e=1>d?1:1/c,f=1>d?c:1;this.getVertexBuffer().update(new Float32Array([-e,-f,e,-f,-e,f,e,f]))},getTexture:function(){return this._texture?this._texture:this._monoTex},createOnePixelTexture:function(a,b,c,d){var e=this._gl,f=e.createTexture();return e.bindTexture(e.TEXTURE_2D,f),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,new Uint8Array([a,b,c,d])),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.bindTexture(e.TEXTURE_2D,null),f},loadBackgroundTexture:function(a){var b=this._gl;this.deleteTexture(),this._texWidth=a.width,this._texHeight=a.height,this._texture=b.createTexture(),b.bindTexture(b.TEXTURE_2D,this._texture),b.texImage2D(b.TEXTURE_2D,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,a),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,b.LINEAR),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,b.CLAMP_TO_EDGE),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.CLAMP_TO_EDGE),b.bindTexture(b.TEXTURE_2D,null)},deleteTexture:function(){this._texture&&(this._texWidth=this._texHeight=1,this._gl.deleteTexture(this._texture),this._texture=null)},render:function(){e.BACKGROUND.getOrCreate(this._gl).draw(this)}},c.exports=f}),define("drawables/Selection",["require","exports","module","lib/glMatrix","render/Buffer","render/ShaderLib"],function(a,b,c){"use strict";var d=a("lib/glMatrix"),e=a("render/Buffer"),f=a("render/ShaderLib"),g=d.mat3,h=d.mat4,i=d.vec3,j=function(a){this._gl=a,this._circleBuffer=new e(a,a.ARRAY_BUFFER,a.STATIC_DRAW),this._dotBuffer=new e(a,a.ARRAY_BUFFER,a.STATIC_DRAW),this._cacheDotMVP=h.create(),this._cacheDotSymMVP=h.create(),this._cacheCircleMVP=h.create(),this._color=new Float32Array([.8,0,0]),this._offsetX=0,this.init()},k=50;j.prototype={getGL:function(){return this._gl},getCircleBuffer:function(){return this._circleBuffer},getDotBuffer:function(){return this._dotBuffer},getCircleMVP:function(){return this._cacheCircleMVP},getDotMVP:function(){return this._cacheDotMVP},getDotSymmetryMVP:function(){return this._cacheDotSymMVP},getColor:function(){return this._color},setOffsetX:function(a){this._offsetX=a},getOffsetX:function(){return this._offsetX},init:function(){this.getCircleBuffer().update(this._getCircleVertices(1)),this.getDotBuffer().update(this._getDotVertices(.05,10))},release:function(){this.getCircleBuffer().release(),this.getDotBuffer().release()},_getCircleVertices:function(a,b,c){for(var d=b||50,e=a||1,f=2*Math.PI,g=c?1:0,h=c?d+2:d,i=new Float32Array(3*h),j=g;h>j;++j){var k=3*j,l=f*j/d;i[k]=Math.cos(l)*e,i[k+1]=Math.sin(l)*e}return i},_getDotVertices:function(a,b){return this._getCircleVertices(a,b,!0)},_updateMatricesBackground:function(){var a=h.create(),b=h.create(),c=[0,0,0];return function(d,e){var f=e.getSculpt().getCurrentTool().getScreenRadius(),g=.5*d._width,j=.5*d._height;h.ortho(a,-g,g,-j,j,-10,10),h.identity(b),h.translate(b,b,i.set(c,-g+e._mouseX+this._offsetX,j-e._mouseY,0)),h.scale(this._cacheCircleMVP,b,i.set(c,f,f,f)),h.mul(this._cacheCircleMVP,a,this._cacheCircleMVP),h.scale(this._cacheDotMVP,b,i.set(c,k,k,k)),h.mul(this._cacheDotMVP,a,this._cacheDotMVP),h.scale(this._cacheDotSymMVP,this._cacheDotSymMVP,[0,0,0])}}(),_updateMatricesMesh:function(){var a=h.create(),b=h.create(),c=[0,0,1],d=[0,0,0],e=[0,0,0];return function(f,j){var l=j.getPicking(),m=j.getPickingSymmetry(),n=Math.sqrt(l.computeWorldRadius2(!0)),o=j.getSculpt().getCurrentTool().getScreenRadius(),p=l.getMesh(),q=k*(n/o);l.polyLerp(p.getNormals(),d),i.transformMat3(d,d,g.normalFromMat4(b,p.getMatrix())),i.normalize(d,d);var r=Math.acos(i.dot(c,d));i.cross(d,c,d),h.identity(b),h.translate(b,b,i.transformMat4(e,l.getIntersectionPoint(),p.getMatrix())),h.rotate(b,b,r,d),h.mul(a,f.getProjection(),f.getView()),h.scale(this._cacheCircleMVP,b,i.set(e,n,n,n)),h.mul(this._cacheCircleMVP,a,this._cacheCircleMVP),h.scale(this._cacheDotMVP,b,i.set(e,q,q,q)),h.mul(this._cacheDotMVP,a,this._cacheDotMVP),i.transformMat4(e,m.getIntersectionPoint(),p.getMatrix()),h.identity(b),h.translate(b,b,e),h.rotate(b,b,r,d),h.scale(b,b,i.set(e,q,q,q)),h.mul(this._cacheDotSymMVP,a,b)}}(),render:function(a){if("TRANSFORM"!==a.getSculpt().getToolName()){var b=a.getPicking().getMesh()&&0===this._offsetX;b?this._updateMatricesMesh(a.getCamera(),a):this._updateMatricesBackground(a.getCamera(),a);var c="NOTHING"===a._action;i.set(this._color,.8,c&&b?0:.4,0),f.SELECTION.getOrCreate(this._gl).draw(this,c,a.getSculpt().getSymmetry())}}},c.exports=j}),define("render/WebGLCaps",["require","exports","module"],function(a,b,c){"use strict";var d={};d._gl=null,d._checkRTT={},d._webGLExtensions={},d.HALF_FLOAT=d.HALF_FLOAT_OES=36193,d.checkRTTSupport=function(a,b){var c=d._gl;if(void 0===c)return!1;var e=a+","+b;if(void 0!==d._checkRTT[e])return d._checkRTT[e];var f=c.createTexture();c.bindTexture(c.TEXTURE_2D,f),c.texImage2D(c.TEXTURE_2D,0,c.RGBA,2,2,0,c.RGBA,a,null),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,b),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,b);var g=c.createFramebuffer();c.bindFramebuffer(c.FRAMEBUFFER,g),c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,f,0);var h=d._checkRTT[e]=c.checkFramebufferStatus(c.FRAMEBUFFER)===c.FRAMEBUFFER_COMPLETE;return c.deleteTexture(f),c.deleteFramebuffer(g),c.bindTexture(c.TEXTURE_2D,null),c.bindFramebuffer(c.FRAMEBUFFER,null),h},d.hasRTTLinearHalfFloat=function(){return d._webGLExtensions.OES_texture_half_float_linear&&d.checkRTTSupport(d.HALF_FLOAT,d._gl.LINEAR)},d.hasRTTLinearFloat=function(){return d._webGLExtensions.OES_texture_float_linear&&d.checkRTTSupport(d._gl.FLOAT,d._gl.LINEAR)},d.hasRTTHalfFloat=function(){return d._webGLExtensions.OES_texture_half_float&&d.checkRTTSupport(d.HALF_FLOAT,d._gl.NEAREST)},d.hasRTTFloat=function(){return d._webGLExtensions.OES_texture_float&&d.checkRTTSupport(d._gl.FLOAT,d._gl.NEAREST)},d.getWebGLExtension=function(a){return d._webGLExtensions[a]},d.getWebGLExtensions=function(){return d._webGLExtensions},d.initWebGLExtensions=function(a){d._gl=a;for(var b=a.getSupportedExtensions(),c=d._webGLExtensions,e=0,f=b.length;f>e;++e){var g=b[e];c[g]=a.getExtension(g)}},c.exports=d}),define("drawables/Rtt",["require","exports","module","render/Buffer","render/ShaderLib","render/WebGLCaps"],function(a,b,c){"use strict";var d,e=a("render/Buffer"),f=a("render/ShaderLib"),g=a("render/WebGLCaps"),h=function(a,b,c,d){this._gl=a,this._texture=a.createTexture(),this._depth=void 0===c?a.createRenderbuffer():c,this._framebuffer=a.createFramebuffer(),this._shaderName=b||"",this._invSize=new Float32Array(2),this._vertexBuffer=null,d&&g.hasRTTHalfFloat()?this._type=g.HALF_FLOAT_OES:d&&g.hasRTTFloat()?this._type=a.FLOAT:this._type=a.UNSIGNED_BYTE,this.init()};h.prototype={getGL:function(){return this._gl},getVertexBuffer:function(){return this._vertexBuffer},getFramebuffer:function(){return this._framebuffer},getTexture:function(){return this._texture},getDepth:function(){return this._depth},getInverseSize:function(){return this._invSize},init:function(){var a=this._gl;d||(d=new e(a,a.ARRAY_BUFFER,a.STATIC_DRAW),d.update(new Float32Array([-1,-1,4,-1,-1,4]))),this._vertexBuffer=d},onResize:function(a,b){var c=this._gl;this._invSize[0]=1/a,this._invSize[1]=1/b,c.bindTexture(c.TEXTURE_2D,this._texture),c.texImage2D(c.TEXTURE_2D,0,c.RGBA,a,b,0,c.RGBA,this._type,null),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.LINEAR),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.LINEAR),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE),this._depth&&(c.bindRenderbuffer(c.RENDERBUFFER,this._depth),c.renderbufferStorage(c.RENDERBUFFER,c.DEPTH_COMPONENT16,a,b)),c.bindFramebuffer(c.FRAMEBUFFER,this._framebuffer),c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,this._texture,0),c.framebufferRenderbuffer(c.FRAMEBUFFER,c.DEPTH_ATTACHMENT,c.RENDERBUFFER,this._depth),c.bindTexture(c.TEXTURE_2D,null)},release:function(){this._texture&&this._gl.deleteTexture(this._texture),this.getVertexBuffer().release()},render:function(a){f[this._shaderName].getOrCreate(this._gl).draw(this,a)}},c.exports=h}),define("text!sdf/SDF.glsl",[],function(){return"#define PI 3.141592653589793\n#define PI_2 1.5707963267948966\n#define SQRT1_2 0.7071067811865476\n#define SQRT2 1.4142135623730951\n\n// raymarching code from https://www.shadertoy.com/view/Xds3zN\n\n// blend color for chamfer and round operators (sd is simple operator distance)\nvec3 colorBlending(const in float sd, const in vec4 a, const in vec4 b) {\n  float ra = clamp(sd / a.x, 0.0, 1.0);\n  float rb = clamp(sd / b.x, 0.0, 1.0);\n  return (a.yzw * ra + b.yzw * rb) / (ra + rb);\n}\n\nvec3 colorUnion(const in vec4 a, const in vec4 b){\n#ifdef BLEND_COLOR\n  return colorBlending(min(a.x, b.x), a, b);\n#else\n  return (a.x < b.x) ? a.yzw : b.yzw;\n#endif\n}\n\nvec3 colorInter(const in vec4 a, const in vec4 b){\n#ifdef BLEND_COLOR\n  return colorBlending(max(a.x, b.x), a, b);\n#else\n  return (a.x < b.x) ? a.yzw : b.yzw;\n#endif\n}\n\nvec2 pR45(const in vec2 p) {\n  return (p + vec2(p.y, -p.x)) * SQRT1_2;\n}\n\n/////////////\n// PRIMITIVES\n/////////////\n\nfloat cullPlane(const in vec3 p) {\n  return p.y >= -0.502 ? p.y + 0.5 : 20.0;\n}\n\nfloat sdSphere(const in vec3 p, const in float s) {\n  return length(p) - s;\n}\n\nfloat sdBox(const in vec3 p, const in vec4 b) {\n  vec3 d = abs(p) - b.xyz;\n  return min(max(d.x, max(d.y, d.z)), 0.0) + length(max(d, 0.0)) - b.w;\n}\n\nfloat sdTorus(const in vec3 p, const in vec2 t) {\n  return length(vec2(length(p.xz) - t.x, p.y)) - t.y;\n}\n\nfloat sdCapsule(const in vec3 p, const in vec2 rh) {\n  return mix(length(p.xz) - rh.x, length(vec3(p.x, abs(p.y) - rh.y, p.z)) - rh.x, step(rh.y, abs(p.y)));\n}\n\nfloat sdEllipsoid(const in  vec3 p, const in vec3 r) {\n  return (length(p / r) - 1.0) * min(min(r.x, r.y), r.z);\n}\n\n///////////////\n// COMBINATIONS\n///////////////\n\n// UNION\nfloat opUnion(const in float a, const in float b) {\n  return min(a, b);\n}\nvec4 opUnion(const in vec4 a, const in vec4 b) {\n  return (a.x < b.x) ? a : b;\n}\n\n// INTER\nfloat opInter(const in float a, const in float b) {\n  return max(a, b);\n}\nvec4 opInter(const in vec4 a, const in vec4 b) {\n  return (a.x > b.x) ? a : b;\n}\n\n// SUB\nfloat opSub(const in float a, const in float b) {\n  return max(-b, a);\n}\nvec4 opSub(const in vec4 a, const in vec4 b) {\n  // to keep b material on diff intersection instead of a mat\n  // return (-b.x > a.x) ? vec4(-b.x, b.yzw) : a);\n  return vec4(max(-b.x, a.x), a.yzw);\n}\n\n// see hg_sdf.glsl\n/////////////////////\n// COMBINATIONS ROUND\n/////////////////////\n\n// UNION ROUND (soft media mol version)\nfloat opUnionRound(const in float a, const in float b, const in float r) {\n  float e = max(r - abs(a - b), 0.0);\n  return min(a, b) - e * e * 0.25 / r;\n}\nvec4 opUnionRound(const in vec4 a, const in vec4 b, const in float r) {\n  return vec4(opUnionRound(a.x, b.x, r), colorUnion(a, b));\n}\n\n// INTER ROUND\nfloat opInterRound(const in float a, const in float b, const in float r) {\n  vec2 u = max(vec2(r + a, r + b), vec2(0.0));\n  return min(-r, max(a, b)) + length(u);\n}\nvec4 opInterRound(const in vec4 a, const in vec4 b, const in float r) {\n  return vec4(opInterRound(a.x, b.x, r), colorInter(a, b));\n}\n\n// SUB ROUND\nfloat opSubRound(const in float a, const in float b, const in float r) {\n  return opInterRound(a, -b, r);\n}\nvec4 opSubRound(const in vec4 a, const in vec4 b, const in float r) {\n  return vec4(opInterRound(a.x, -b.x, r), a.yzw);\n}\n\n///////////////////////\n// COMBINATIONS CHAMFER\n///////////////////////\n\n// UNION CHAMFER\nfloat opUnionChamfer(const in float a, const in float b, const in float r) {\n  return min(min(a, b), (a - r + b) * SQRT1_2);\n}\nvec4 opUnionChamfer(const in vec4 a, const in vec4 b, const in float r) {\n  return vec4(opUnionChamfer(a.x, b.x, r), colorUnion(a, b));\n}\n\n// INTER CHAMFER\nfloat opInterChamfer(const in float a, const in float b, const in float r) {\n  return max(max(a, b), (a + r + b) * SQRT1_2);\n}\nvec4 opInterChamfer(const in vec4 a, const in vec4 b, const in float r) {\n  return vec4(opInterChamfer(a.x, b.x, r), colorInter(a, b));\n}\n\n// SUB CHAMFER\nfloat opSubChamfer(const in float a, const in float b, const in float r) {\n  return opInterChamfer(a, -b, r);\n}\nvec4 opSubChamfer(const in vec4 a, const in vec4 b, const in float r) {\n  return vec4(opInterChamfer(a.x, -b.x, r), a.yzw);\n}\n\n//////////////////////\n// COMBINATION COLUMNS\n//////////////////////\n\n// UNION COLUMNS\nfloat opUnionColumns(const in float a, const in  float b, const in vec2 rn) {\n  float r = rn.x;\n  float n = rn.y;\n  if((a < r) && (b < r)) {\n    vec2 p = vec2(a, b);\n    float columnradius = r * SQRT2 / ((n - 1.0) * 2.0 + SQRT2);\n    p = pR45(p);\n    p.x -= SQRT1_2 * r;\n    p.x += columnradius * SQRT2;\n    if(mod(n, 2.0) == 1.0) {\n      p.y += columnradius;\n    }\n    // At this point, we have turned 45 degrees and moved at a point on the\n    // diagonal that we want to place the columns on.\n    // Now, repeat the domain along this direction and place a circle.\n    p.y = mod(p.y + columnradius, columnradius * 2.0) - columnradius;\n    float result = length(p) - columnradius;\n    result = min(result, p.x);\n    result = min(result, a);\n    return min(result, b);\n  }\n\n  return min(a, b);\n}\nvec4 opUnionColumns(const in vec4 a, const in vec4 b, const in vec2 rn) {\n  return vec4(opUnionColumns(a.x, b.x, rn), colorUnion(a, b));\n}\n\n// SUB COLUMNS\nfloat opSubColumns(const in float ain, const float b, const vec2 rn) {\n  float a = -ain;\n  float r = rn.x;\n  float n = rn.y;\n  float m = min(a, b);\n  //avoid the expensive computation where not needed (produces discontinuity though)\n  if((a < r) && (b < r)) {\n    vec2 p = vec2(a, b);\n    float columnradius = r * SQRT2 / n / 2.0;\n    columnradius = r * SQRT2 / ((n - 1.0) * 2.0 + SQRT2);\n\n    p = pR45(p);\n    p.y += columnradius;\n    p.x -= SQRT1_2 * (r + columnradius);\n\n    if(mod(n, 2.0) == 1.0) {\n      p.y += columnradius;\n    }\n    p.y = mod(p.y + columnradius, columnradius * 2.0) - columnradius;\n\n    float result = -length(p) + columnradius;\n    result = max(result, p.x);\n    result = min(result, a);\n    return -min(result, b);\n  }\n\n  return -m;\n}\nvec4 opSubColumns(const in vec4 a, const in vec4 b, const in vec2 rn) {\n  return vec4(opSubColumns(a.x, b.x, rn), a.yzw);\n}\n\n// INTER COLUMNS\nfloat opInterColumns(const in float a, const in float b, const in vec2 rn) {\n  return opSubColumns(a, -b, rn);\n}\nvec4 opInterColumns(const in vec4 a, const in vec4 b, const in vec2 rn) {\n  return vec4(opSubColumns(a.x, -b.x, rn), colorInter(a, b));\n}\n\n/////////////////////\n// COMBINATION STAIRS\n/////////////////////\n// UNION STAIRS\nfloat opUnionStairs(const in float a, const in float b, const in vec2 rn) {\n  float s = rn.x / rn.y;\n  float u = b - rn.x;\n  return min(min(a, b), 0.5 * (u + a + abs((mod(u - a + s, 2.0 * s)) - s)));\n}\nvec4 opUnionStairs(const in vec4 a, const in vec4 b, const in vec2 rn) {\n  return vec4(opUnionStairs(a.x, b.x, rn), colorUnion(a, b));\n}\n\n// INTER STAIRS\nfloat opInterStairs(const in float a, const in float b, const in vec2 rn) {\n  return -opUnionStairs(-a, -b, rn);\n}\nvec4 opInterStairs(const in vec4 a, const in vec4 b, const in vec2 rn) {\n  return vec4(-opUnionStairs(-a.x, -b.x, rn), colorInter(a, b));\n}\n\n// SUB STAIRS\nfloat opSubStairs(const in float a, const in float b, const in vec2 rn) {\n  return -opUnionStairs(-a, b, rn);\n}\nvec4 opSubStairs(const in vec4 a, const in vec4 b, const in vec2 rn) {\n  return vec4(-opUnionStairs(-a.x, b.x, rn), a.yzw);\n}\n\n/////////////\n// REPETITION\n/////////////\n\nvec3 pMod(const in vec3 p, const in vec3 size) {\n  vec3 pmod = p;\n  if(size.x > 0.0) pmod.x = mod(p.x + size.x * 0.5, size.x) - size.x * 0.5;\n  if(size.y > 0.0) pmod.y = mod(p.y + size.y * 0.5, size.y) - size.y * 0.5;\n  if(size.z > 0.0) pmod.z = mod(p.z + size.z * 0.5, size.z) - size.z * 0.5;\n  return pmod;\n}\n\n////////////\n// HELPERS\n////////////\nvec4 mapDistanceColor(const in vec3 point) {\n  %ID_MAP_DISTANCE_COLOR\n}\n\nfloat mapDistance(const in vec3 point) {\n  %ID_MAP_DISTANCE\n}\n\nvec4 castRay(const in vec3 ro, const in vec3 rd) {\n  float t = 1.0;\n  float tmax = 50.0;\n\n  float precis = 0.002;\n  for(int i = 0; i < 50; i++) {\n    float dist = mapDistance(ro + rd * t);\n    if(dist < precis || t > tmax)\n      break;\n    t += dist;\n  }\n\n  vec3 m = t > tmax ? vec3(-1.0) : mapDistanceColor(ro + rd * t).yzw;\n  return vec4(t, m);\n}\n\nfloat softshadow(const in vec3 ro, const in vec3 rd) {\n  float t = 0.02;\n  float tmax = 2.5;\n  float precis = 0.001;\n  float res = 1.0;\n  for(int i = 0; i < 16; i++) {\n    float h = mapDistance(ro + rd * t);\n    res = min(res, 20.0 * h / t);\n    t += clamp( h, 0.02, 0.10 );\n    if(h < 0.001 || t > tmax) break;\n  }\n  return clamp(res, 0.0, 1.0);\n}\n\nvec3 calcNormal(const in vec3 pos) {\n  vec3 eps = vec3(0.001, 0.0, 0.0);\n  vec3 nor = vec3(\n      mapDistance(pos + eps.xyy) - mapDistance(pos - eps.xyy),\n      mapDistance(pos + eps.yxy) - mapDistance(pos - eps.yxy),\n      mapDistance(pos + eps.yyx) - mapDistance(pos - eps.yyx));\n  return normalize(nor);\n}\n\nfloat calcAO(const in vec3 pos, const in vec3 nor) {\n  float occ = 0.0;\n  float sca = 1.0;\n  for(int i = 0; i < 5; i++) {\n      float hr = 0.01 + 0.03 * float(i);\n      vec3 aopos = nor * hr + pos;\n      occ += (hr - mapDistance(aopos)) * sca;\n      sca *= 0.95;\n  }\n  return clamp( 1.0 - 3.0 * occ, 0.0, 1.0 );\n}\n\n#ifdef TOON\nvec3 render(const in vec3 ro, const in vec3 rd) {\n  vec3 col = vec3(0.5, 0.5, 0.5);\n  vec4 res = castRay(ro, rd);\n\n  if(res.y >= 0.0) {\n    vec3 pos = ro + res.x * rd;\n    vec3 nor = calcNormal(pos);\n\n    vec3 ref = reflect( rd, nor );\n    float occ = calcAO( pos, nor );\n    vec3  lig = normalize(vec3(-0.6, 0.7, -0.5));\n    float amb = clamp(0.5 + 0.5 * nor.y, 0.0, 1.0);\n    float dif = clamp(dot(nor, lig), 0.0, 1.0);\n    float bac = clamp(dot(nor, normalize(vec3(-lig.x, 0.0, -lig.z))), 0.0, 1.0 ) * clamp( 1.0 - pos.y, 0.0, 1.0);\n    float dom = smoothstep(-0.1, 0.1, ref.y);\n    float fre = pow(clamp(1.0 + dot(nor, rd), 0.0, 1.0), 2.0);\n    float spe = pow(clamp(dot(ref, lig), 0.0, 1.0),16.0);\n\n    dif *= softshadow(pos, lig);\n    dom *= softshadow(pos, ref);\n\n    vec3 lin = vec3(0.0);\n	if (dif < 0.3) {\n		lin += 0.8 * vec3(1.00, 0.85, 0.55);\n	} else if (dif < 0.7) {\n		lin += 1.0 * vec3(1.00, 0.85, 0.55);\n	} else {\n		lin += 1.20 * vec3(1.00, 0.85, 0.55);\n	}\n    //lin += 1.20 * dif * vec3(1.00, 0.85, 0.55) * occ;\n    //lin += 1.20 * spe * vec3(1.00, 0.85, 0.55) * dif;\n    lin += 0.20 * amb * vec3(0.50, 0.70, 1.00) * occ;\n    //lin += 0.30 * dom * vec3(0.50, 0.70, 1.00) * occ;\n    //lin += 0.30 * bac * vec3(0.25, 0.25, 0.25) * occ;\n    //lin += 0.40 * fre * vec3(1.00, 1.00, 1.00) * occ;\n\n    col = res.yzw * lin;\n  }\n\n#else  // TOON\n\nvec3 render(const in vec3 ro, const in vec3 rd) {\n  vec3 col = vec3(0.5, 0.5, 0.5);\n  vec4 res = castRay(ro, rd);\n\n  if(res.y >= 0.0) {\n    vec3 pos = ro + res.x * rd;\n    vec3 nor = calcNormal(pos);\n\n    vec3 ref = reflect( rd, nor );\n    float occ = calcAO( pos, nor );\n    vec3  lig = normalize(vec3(-0.6, 0.7, -0.5));\n    float amb = clamp(0.5 + 0.5 * nor.y, 0.0, 1.0);\n    float dif = clamp(dot(nor, lig), 0.0, 1.0);\n    float bac = clamp(dot(nor, normalize(vec3(-lig.x, 0.0, -lig.z))), 0.0, 1.0 ) * clamp( 1.0 - pos.y, 0.0, 1.0);\n    float dom = smoothstep(-0.1, 0.1, ref.y);\n    float fre = pow(clamp(1.0 + dot(nor, rd), 0.0, 1.0), 2.0);\n    float spe = pow(clamp(dot(ref, lig), 0.0, 1.0),16.0);\n\n    dif *= softshadow(pos, lig);\n    dom *= softshadow(pos, ref);\n\n    vec3 lin = vec3(0.0);\n    lin += 1.20 * dif * vec3(1.00, 0.85, 0.55);\n    lin += 1.20 * spe * vec3(1.00, 0.85, 0.55) * dif;\n    lin += 0.20 * amb * vec3(0.50, 0.70, 1.00) * occ;\n    lin += 0.30 * dom * vec3(0.50, 0.70, 1.00) * occ;\n    lin += 0.30 * bac * vec3(0.25, 0.25, 0.25) * occ;\n    lin += 0.40 * fre * vec3(1.00, 1.00, 1.00) * occ;\n\n    col = res.yzw * lin;\n  }\n\n  return clamp(col, 0.0, 1.0);\n}\n\n#endif // TOON\n\n#ifdef SHADERTOY\nmat3 setCamera( const in vec3 ro, const in vec3 ta, const float cr ){\n  vec3 cw = normalize(ta-ro);\n  vec3 cp = vec3(sin(cr), cos(cr),0.0);\n  vec3 cu = normalize( cross(cw,cp) );\n  vec3 cv = normalize( cross(cu,cw) );\n  return mat3( cu, cv, cw );\n}\n\nvoid mainImage(out vec4 fragColor, in vec2 fragCoord){\n  vec2 q = fragCoord.xy / iResolution.xy;\n  vec2 p = -1.0 + 2.0 * q;\n  p.x *= iResolution.x / iResolution.y;\n  vec2 mo = iMouse.xy / iResolution.xy;\n  float time = 15.0 + iGlobalTime;\n\n  // camera\n  vec3 ro = SHADERTOY_ZOOM * vec3( -0.5 + 3.5 * cos(0.1 * time + 6.0 * mo.x), 1.0 + 2.0 * mo.y, 0.5 + 3.5 * sin(0.1 * time + 6.0 * mo.x));\n  vec3 ta = vec3(-0.5, -0.4, 0.5);\n\n  // camera-to-world transformation\n  mat3 ca = setCamera(ro, ta, 0.0);\n\n  // ray direction\n  vec3 rd = ca * normalize(vec3(p.xy, 2.0));\n\n  fragColor = vec4(render(ro, rd), 1.0);\n}\n\n#else\n\nvec3 raymarch(const in vec3 origin, const in mat3 view, const in vec2 uv, const in vec2 invSize) {\n  vec2 p = -1.0 + 2.0 * uv;\n  p.x *= invSize.y / invSize.x;\n  vec3 rd = normalize(view * vec3(p, 2.0));\n  return render(origin, rd);\n}\n\nvoid main() {\n  gl_FragColor = vec4(raymarch(uOrigin, uView, vUV, uInvSize), 1.0);\n}\n\n#endif\n";
}),define("sdf/Shader",["require","exports","module","render/shaders/ShaderBase","render/Attribute","text!sdf/SDF.glsl","lib/glMatrix"],function(a,b,c){"use strict";var d=a("render/shaders/ShaderBase"),e=a("render/Attribute"),f=a("text!sdf/SDF.glsl"),g=a("lib/glMatrix"),h=g.mat3,i=d.getCopy();i.vertexName=i.fragmentName="SDF",i.BLEND_COLOR=!0,i.uniforms={},i.attributes={},i.uniformNames=["uInvSize","uOrigin","uView"],i.vertex=["precision mediump float;","attribute vec2 aVertex;","varying vec2 vUV;","void main() {","  vUV = aVertex * 0.5 + 0.5;","  gl_Position = vec4(aVertex, 0.5, 1.0);","}"].join("\n"),i.fragment=["precision mediump float;","uniform vec3 uOrigin;","uniform mat3 uView;","uniform vec2 uInvSize;","varying vec2 vUV;","%ID_UNIFORM",f].join("\n"),i.createFragment=function(a){var b=i.fragment;i.BLEND_COLOR&&(b="#define BLEND_COLOR\n"+b);var c=[""],d=a._rootSDF.shaderDistanceMat(c);c[0]+="return "+d+";",b=b.replace("%ID_MAP_DISTANCE_COLOR",c[0]),c=[""],d=a._rootSDF.shaderDistance(c),c[0]+="return "+d+";",b=b.replace("%ID_MAP_DISTANCE",c[0]);var e=a._main.getMesh();return b=b.replace("%ID_UNIFORM",e?e.declareUniforms():"\n")},i.getOrCreate=function(){return this},i.generateProgram=function(a){var b=a._gl;this.program&&b.deleteProgram(this.program),this.vShader||(this.vShader=b.createShader(b.VERTEX_SHADER),b.shaderSource(this.vShader,this.vertex),b.compileShader(this.vShader));var c=b.createShader(b.FRAGMENT_SHADER);b.shaderSource(c,i.createFragment(a)),b.compileShader(c);var d=this.program=b.createProgram();b.attachShader(d,this.vShader),b.attachShader(d,c),b.linkProgram(d),b.useProgram(d);var e,f=b.getShaderInfoLog(this.vShader),g=b.getShaderInfoLog(c),h=b.getProgramInfoLog(d);f&&(e=this.vertexName+" (vertex)\n"+f,console.groupCollapsed(e),console.log(this.vertex),console.groupEnd(e)),g&&(e=this.fragmentName+" (fragment)\n"+g,console.groupCollapsed(e),console.log(this.fragment),console.groupEnd(e)),h&&(e=this.vertexName+","+this.fragmentName+" (program)\n"+h,console.groupCollapsed(e),console.log(this.vertex),console.log(this.fragment),console.groupEnd(e)),this.attributes.aVertex||this.initAttributes(b),i.uniformNames.length=0,i.uniformNames.push("uInvSize","uOrigin","uView");var j=a._main.getMesh();return j&&i.uniformNames.push.apply(i.uniformNames,j.getUniformNames()),this.initUniforms(b),d},i.draw=function(a,b){var c=a.getGL();b._mainSDF._dirtyScene&&(b._mainSDF._dirtyScene=!1,b.getMesh()&&b.getMesh().setSelected(!0),i.generateProgram(b._mainSDF),b.getMesh()&&b.getMesh().setSelected(!1)),c.useProgram(this.program),i.attributes.aVertex.bindToBuffer(a.getVertexBuffer()),c.uniform2fv(this.uniforms.uInvSize,a.getInverseSize());var d=b.getCamera(),e=d.unproject(.5*d._width,.5*d._height,0);c.uniform3fv(this.uniforms.uOrigin,e);var f=d._sdfView;h.normalFromMat4(f,d.getView()),h.invert(f,f),f[6]*=-1,f[7]*=-1,f[8]*=-1,c.uniformMatrix3fv(this.uniforms.uView,!1,f),b.getMesh()&&b.getMesh().updateUniforms(c,this.uniforms),c.drawArrays(c.TRIANGLES,0,3)},i.initAttributes=function(a){i.attributes.aVertex=new e(a,i.program,"aVertex",2,a.FLOAT)},c.exports=i}),define("sdf/NodeAbstract",["require","exports","module"],function(a,b,c){"use strict";var d=function(){this._uniformNames=[],this._selected=!1};d.prototype={initObjectJSON:function(a){for(var b=Object.keys(a),c=0,d=b.length;d>c;++c){var e=b[c];"u"===e[0]&&(this[e]=a[e])}},toJSON:function(){var a={};a.type=this.type;for(var b=Object.keys(this),c=0,d=b.length;d>c;++c){var e=b[c];if("u"===e[0]){var f=this[e];f.length&&(f=Array.apply([],f)),a[e]=f}}return a},_prettyFloat:function(a){var b=a.toString();return-1!==b.indexOf(".")?b:b+".0"},toStr:function(a){if(!a.length)return this._prettyFloat(a);for(var b=this._prettyFloat(a[0]),c=1,d=a.length;d>c;++c)b+=","+this._prettyFloat(a[c]);return a.length<5?"vec"+a.length+"("+b+")":"mat4("+b+")"},getSelected:function(){return this._selected},setSelected:function(a){this._selected=a},getParam:function(a){return this[a]},getParamStr:function(a){return this._selected?a:this.toStr(this.getParam(a))},getParamType:function(a){var b=this[a];return b.length?b.length<5?"vec"+b.length:"mat"+Math.sqrt(b.length):"float"},declareUniforms:function(){for(var a=this._uniformNames,b=[],c=0,d=a.length;d>c;++c){var e=a[c];b.push("uniform "+this.getParamType(e)+" "+e+";")}return b.join("\n")},updateUniforms:function(a,b){for(var c=this._uniformNames,d=0,e=c.length;e>d;++d){var f=c[d],g=this[f].length;g?5>g?a["uniform"+g+"fv"](b[f],this.getParam(f)):a["uniformMatrix"+Math.sqrt(g)+"fv"](b[f],!1,this.getParam(f)):a.uniform1f(b[f],this.getParam(f))}},getUniformNames:function(){return this._uniformNames}},c.exports=d}),define("sdf/Combinations",["require","exports","module","misc/Utils","sdf/NodeAbstract"],function(a,b,c){"use strict";var d=a("misc/Utils"),e=a("sdf/NodeAbstract"),f={};f.SHADER_UID_VAR=1;var g=function(a,b,c){var d="tmpComb_"+f.SHADER_UID_VAR++;return c[0]+=a+" "+d+" = "+b+";\n",d},h=function(a,b){e.call(this),this.op1=a,this.op2=b,a.setCombinator&&a.setCombinator(this),b.setCombinator&&b.setCombinator(this),this.uRoundRadius=.3,this.uChamferRadius=.3,this.uColumns=[.2,3],this.uStairs=[.2,3],this._uniformNames.push("uRoundRadius","uChamferRadius","uColumns","uStairs")};h.prototype={type:"BaseCombination",shaderName:"shaderName",toJSON:function(){var a=e.prototype.toJSON.call(this);return a.op1=this.op1.toJSON(),a.op2=this.op2.toJSON(),a},shaderMaterialColor:function(a){this.op1.shaderMaterialColor(a),this.op2.shaderMaterialColor(a)},shaderDistanceMat:function(a){return this.combinationDistance(a,"shaderDistanceMat","vec4")},shaderDistance:function(a){return this.combinationDistance(a,"shaderDistance","float")},resetTransitions:function(a){this.uRoundRadius=Math.abs(this.uRoundRadius)*("ROUND"===a?1:-1),this.uChamferRadius=Math.abs(this.uChamferRadius)*("CHAMFER"===a?1:-1),this.uColumns[0]=Math.abs(this.uColumns[0])*("COLUMNS"===a?1:-1),this.uStairs[0]=Math.abs(this.uStairs[0])*("STAIRS"===a?1:-1)},getShaderFunc:function(){return this.uRoundRadius>0?this.shaderName+"Round":this.uChamferRadius>0?this.shaderName+"Chamfer":this.uColumns[0]>0?this.shaderName+"Columns":this.uStairs[0]>0?this.shaderName+"Stairs":this.shaderName},extraParameter:function(){var a=this.op1._selected||this.op2._selected;return this.uRoundRadius>0?[a?"uRoundRadius":this.toStr(this.uRoundRadius)]:this.uChamferRadius>0?[a?"uChamferRadius":this.toStr(this.uChamferRadius)]:this.uColumns[0]>0?[a?"uColumns":this.toStr(this.uColumns)]:this.uStairs[0]>0?[a?"uStairs":this.toStr(this.uStairs)]:[""]},combinationDistance:function(a,b,c){var d=this.op1[b](a),e=this.op2[b](a);this.op1.op1&&(d=g(c,d,a)),this.op2.op1&&(e=g(c,e,a));var f=this.extraParameter().join(",");return f.length>1&&(f=", "+f),g(c,this.getShaderFunc()+"("+d+", "+e+f+")",a)}},d.makeProxy(e,h),f.UNION=function(a,b){h.call(this,a,b)},f.UNION.prototype={type:"UNION",shaderName:"opUnion"},d.makeProxy(h,f.UNION),f.INTER=function(a,b){h.call(this,a,b)},f.INTER.prototype={type:"INTER",shaderName:"opInter"},d.makeProxy(h,f.INTER),f.SUB=function(a,b){h.call(this,a,b)},f.SUB.prototype={type:"SUB",shaderName:"opSub"},d.makeProxy(h,f.SUB),f.SUB_INV=function(a,b){h.call(this,b,a)},f.SUB_INV.prototype=f.SUB.prototype,c.exports=f}),define("sdf/Primitives",["require","exports","module","lib/glMatrix","misc/Utils","sdf/NodeAbstract"],function(a,b,c){"use strict";var d=a("lib/glMatrix"),e=a("misc/Utils"),f=a("sdf/NodeAbstract"),g=d.mat4,h=d.vec3,i=g.create(),j=[0,0,0],k={};k.SHADER_UID_VAR=1;var l=function(a,b,c){var d="tmpPrim_"+k.SHADER_UID_VAR++;return c[0]+=a+" "+d+" = "+b+";\n",d},m=function(){f.call(this),this._matrix=g.create(),this._editMatrix=g.create(),this.uBaseTransform=g.create(),this.uBaseColor=[1,.5,.5],this.uBaseMod=[-5,-5,-5],this._uniformNames.push("uBaseTransform","uBaseColor","uBaseMod"),this._combinator=void 0};m.prototype={type:"BasePrimitive",initObjectJSON:function(a){f.prototype.initObjectJSON.call(this,a),g.invert(this._matrix,this.uBaseTransform)},setCombinator:function(a){this._combinator=a},getParam:function(a){return"uBaseTransform"===a?g.invert(this.uBaseTransform,g.mul(i,this._matrix,this._editMatrix)):this[a]},getScale:function(){return h.len(g.mul(i,this._matrix,this._editMatrix))},declareUniforms:function(){var a=f.prototype.declareUniforms.call(this)+"\n";return this._combinator&&(a=a.concat(this._combinator.declareUniforms())),a},updateUniforms:function(a,b){f.prototype.updateUniforms.call(this,a,b),this._combinator&&this._combinator.updateUniforms(a,b)},getUniformNames:function(){var a=this._uniformNames;return this._combinator&&(a=a.concat(this._combinator.getUniformNames())),a},shaderDistanceMat:function(a){var b=this.shaderDistance(a);return l("vec4","vec4("+b+", "+this.getParamStr("uBaseColor")+")",a)},getCenter:function(){return j},getMatrix:function(){return this._matrix},getEditMatrix:function(){return this._editMatrix},getScaleStr:function(){if(!this._selected)return this.toStr(this.getScale());var a=this.getParamStr("uBaseTransform");return"1.0 / length("+a+"[0] )"},getTransformPointStr:function(){return"pMod(("+this.getParamStr("uBaseTransform")+" * vec4(point, 1.0)).xyz, "+this.getParamStr("uBaseMod")+")"}},e.makeProxy(f,m),k.PLANE=function(){m.call(this)},k.PLANE.prototype={type:"PLANE",getParamStr:function(a){return"uBaseColor"===a?"vec3(0.1) * (mod(floor(5.0 * point.z) + floor(5.0 * point.x), 2.0)) + 0.4":m.prototype.getParamStr.call(this,a)},shaderDistance:function(){var a=this.getTransformPointStr();return"cullPlane("+a+") * "+this.getScaleStr()}},e.makeProxy(m,k.PLANE),k.SPHERE=function(){m.call(this),this.uSphereRadius=.4,this._uniformNames.push("uSphereRadius")},k.SPHERE.prototype={type:"SPHERE",shaderDistance:function(){var a=this.getTransformPointStr(),b=this.getParamStr("uSphereRadius");return"sdSphere("+a+", "+b+") * "+this.getScaleStr()}},e.makeProxy(m,k.SPHERE),k.BOX=function(){m.call(this),this.uBoxSides=[.2,.4,.8,.1],this._uniformNames.push("uBoxSides")},k.BOX.prototype={type:"BOX",shaderDistance:function(){var a=this.getTransformPointStr(),b=this.getParamStr("uBoxSides");return"sdBox("+a+", "+b+") * "+this.getScaleStr()}},e.makeProxy(m,k.BOX),k.TORUS=function(){m.call(this),this.uTorusRadii=[.4,.05],this._uniformNames.push("uTorusRadii")},k.TORUS.prototype={type:"TORUS",shaderDistance:function(){var a=this.getTransformPointStr(),b=this.getParamStr("uTorusRadii");return"sdTorus("+a+", "+b+") * "+this.getScaleStr()}},e.makeProxy(m,k.TORUS),k.CAPSULE=function(){m.call(this),this.uCapsuleRH=[.2,.5],this._uniformNames.push("uCapsuleRH")},k.CAPSULE.prototype={type:"CAPSULE",shaderDistance:function(){var a=this.getTransformPointStr(),b=this.getParamStr("uCapsuleRH");return"sdCapsule("+a+", "+b+") * "+this.getScaleStr()}},e.makeProxy(m,k.CAPSULE),k.ELLIPSOID=function(){m.call(this),this.uEllipsoidSides=[.2,.4,.8],this._uniformNames.push("uEllipsoidSides")},k.ELLIPSOID.prototype={type:"ELLIPSOID",shaderDistance:function(){var a=this.getTransformPointStr(),b=this.getParamStr("uEllipsoidSides");return"sdEllipsoid("+a+", "+b+") * "+this.getScaleStr()}},e.makeProxy(m,k.ELLIPSOID),c.exports=k}),define("sdf/Gui",["require","exports","module","lib/FileSaver","sdf/Shader","sdf/Combinations","sdf/Primitives","lib/glMatrix"],function(a,b,c){"use strict";var d=a("lib/FileSaver"),e=a("sdf/Shader"),f=a("sdf/Combinations"),g=a("sdf/Primitives"),h=a("lib/glMatrix"),i=h.vec3,j=function(a){this._main=a._main,this._mainSDF=a,this.initGui()};j.prototype={importFile:function(){document.getElementById("fileopen").click()},exportFile:function(){var a={root:this._mainSDF._rootSDF.toJSON(),blendColor:e.BLEND_COLOR,version:1,undoBuffer:this.undoBuffer},b=JSON.stringify(a);d(new Blob([b]),"scene.json")},exportShader:function(){var a="#define SHADERTOY\n#define SHADERTOY_ZOOM 2.0\n"+e.createFragment(this._mainSDF);d(new Blob([a]),"shadertoy.glsl")},showCredits:function(){},initGui:function(){var a=this._main._gui._topbar,b=a.addMenu("Export/Import");b.addButton("Import (json)",this,"importFile"),b.addButton("Export (json)",this,"exportFile"),b.addButton("Shadertoy (glsl)",this,"exportShader");var c=a.addMenu("Credits",this,"showCredits");c.addTitle("Raymarch template"),c.addButton("Inigo Quilez (iq)",window.open.bind(window,"https://www.shadertoy.com/view/Xds3zN","_blank")),c.addTitle("Combination op"),c.addButton("Mercuy",window.open.bind(window,"http://mercury.sexy/hg_sdf/","_blank"));var d=this._main._gui._sidebar,f=d.addMenu("SDF"),g={PRIMITIVE:"Select a primitive",SPHERE:"Sphere",BOX:"Box",TORUS:"Torus",CAPSULE:"Capsule",ELLIPSOID:"Ellipsoid"};this._ctrlPrimitive=f.addCombobox("Primitive","PRIMITIVE",this.onPrimitive.bind(this),g),this._ctrls=[],this.undoBuffer=[],this.redoBuffer=[],this.isInitialRedo=!0,this.isInitialUndo=!0;var h=f.addButton("Apply",this,"applyPrimitive");h.domButton.style.background="rgba(120, 230, 0, 0.8)",this._ctrls.push(h),f.addButton("Undo",this,"onUndo","CTRL+Z"),f.addButton("Redo",this,"onRedo","CTRL+Y"),this._ctrlBlendColor=f.addCheckbox("Blend Color",e.BLEND_COLOR,this.onBlendColor.bind(this)),this._initGuiCombination(f),this._initGuiRepetition(f),this._initGuiPrimitive(f),this.setCtrlVisibility(!1),this._ctrlPrimitive.setValue("BOX")},_initGuiRepetition:function(a){var b=this._ctrls;b.push(a.addTitle("Domain repetition")),this._ctrlRepeat=[],this._ctrlRepeat[0]=a.addCheckbox("Repeat in X",!1,this.onRepeat.bind(this,0)),b.push(a.addSlider("X dist",5,this.onRepeatDist.bind(this,0),.1,10,.01)),this._ctrlRepeat[1]=a.addCheckbox("Repeat in Y",!1,this.onRepeat.bind(this,1)),b.push(a.addSlider("Y dist",5,this.onRepeatDist.bind(this,1),.1,10,.01)),this._ctrlRepeat[2]=a.addCheckbox("Repeat in Z",!1,this.onRepeat.bind(this,2)),b.push(a.addSlider("Z dist",5,this.onRepeatDist.bind(this,2),.1,10,.01)),b.push(this._ctrlRepeat[0]),b.push(this._ctrlRepeat[1]),b.push(this._ctrlRepeat[2])},_initGuiPrimitive:function(a){var b=this._ctrls;b.push(a.addTitle("Primitive")),this._ctrlColor=a.addColor("Color",[.5,.5,1],this.onColor.bind(this)),b.push(this._ctrlColor),this._ctrlBoxX=a.addSlider("Side X",.2,this.onBoxSides.bind(this,0),.01,2,.01),this._ctrlBoxY=a.addSlider("Side Y",.4,this.onBoxSides.bind(this,1),.01,2,.01),this._ctrlBoxZ=a.addSlider("Side Z",.8,this.onBoxSides.bind(this,2),.01,2,.01),this._ctrlBoxW=a.addSlider("Radius",.2,this.onBoxSides.bind(this,3),0,1,.01),this._ctrlBoxX._primitive="BOX",this._ctrlBoxY._primitive="BOX",this._ctrlBoxZ._primitive="BOX",this._ctrlBoxW._primitive="BOX",b.push(this._ctrlBoxX),b.push(this._ctrlBoxY),b.push(this._ctrlBoxZ),b.push(this._ctrlBoxW),this._ctrlSphereR=a.addSlider("Radius",4,this.onSphereRadius.bind(this),.01,2,.01),this._ctrlSphereR._primitive="SPHERE",b.push(this._ctrlSphereR),this._ctrlTorusR1=a.addSlider("Radius",4,this.onTorusRadii.bind(this,0),.1,4,.01),this._ctrlTorusR2=a.addSlider("Thickness radius",.5,this.onTorusRadii.bind(this,1),.01,.5,.01),this._ctrlTorusR1._primitive="TORUS",this._ctrlTorusR2._primitive="TORUS",b.push(this._ctrlTorusR1),b.push(this._ctrlTorusR2),this._ctrlCapsuleR=a.addSlider("Radius",.2,this.onCapsule.bind(this,0),.01,2,.01),this._ctrlCapsuleH=a.addSlider("Height",.5,this.onCapsule.bind(this,1),.01,2,.01),this._ctrlCapsuleR._primitive="CAPSULE",this._ctrlCapsuleH._primitive="CAPSULE",b.push(this._ctrlCapsuleR),b.push(this._ctrlCapsuleH),this._ctrlEllipsoidX=a.addSlider("X",.2,this.onEllipsoid.bind(this,0),.05,2,.01),this._ctrlEllipsoidY=a.addSlider("Y",.4,this.onEllipsoid.bind(this,1),.05,2,.01),this._ctrlEllipsoidZ=a.addSlider("Z",.8,this.onEllipsoid.bind(this,2),.05,2,.01),this._ctrlEllipsoidX._primitive="ELLIPSOID",this._ctrlEllipsoidY._primitive="ELLIPSOID",this._ctrlEllipsoidZ._primitive="ELLIPSOID",b.push(this._ctrlEllipsoidX),b.push(this._ctrlEllipsoidY),b.push(this._ctrlEllipsoidZ)},_initGuiCombination:function(a){var b=this._ctrls;b.push(a.addTitle("Operator"));var c={UNION:"Union",SUB:"Difference",SUB_INV:"Difference Inverse",INTER:"Intersection"};this._ctrlCombination=a.addCombobox("Combination","UNION",this.onCombination.bind(this),c),b.push(this._ctrlCombination);var d={NONE:"None",ROUND:"Round",CHAMFER:"Chamfer",COLUMNS:"Columns",STAIRS:"Stairs"};this._ctrlTransition=a.addCombobox("Transition","ROUND",this.onTransition.bind(this),d),b.push(this._ctrlTransition),this._ctrlRoundRadius=a.addSlider("Roundness",1,this.onRoundRadius.bind(this),.01,4,.01),this._ctrlRoundRadius._transition="ROUND",b.push(this._ctrlRoundRadius),this._ctrlChamferRadius=a.addSlider("Chamfer",1,this.onChamferRadius.bind(this),.01,2,.01),this._ctrlChamferRadius._transition="CHAMFER",b.push(this._ctrlChamferRadius),this._ctrlColumnsR=a.addSlider("Radius",.3,this.onColumns.bind(this,0),.01,4,.01),this._ctrlColumnsR._transition="COLUMNS",this._ctrlColumnsN=a.addSlider("Nb repeat",3,this.onColumns.bind(this,1),0,10,.01),this._ctrlColumnsN._transition="COLUMNS",b.push(this._ctrlColumnsR),b.push(this._ctrlColumnsN),this._ctrlStairsR=a.addSlider("Radius",.3,this.onStairs.bind(this,0),.01,4,.01),this._ctrlStairsR._transition="STAIRS",this._ctrlStairsN=a.addSlider("Nb repeat",3,this.onStairs.bind(this,1),0,10,.01),this._ctrlStairsN._transition="STAIRS",b.push(this._ctrlStairsR),b.push(this._ctrlStairsN)},setCtrlVisibility:function(a,b,c){for(var d=this._ctrls,e=0,f=d.length;f>e;++e){var g=a;a&&(void 0!==d[e]._primitive&&d[e]._primitive!==b?g=!1:void 0!==d[e]._transition&&d[e]._transition!==c&&(g=!1)),d[e].setVisibility(g)}},applyPrimitive:function(){this._lastRoot=void 0,this._mainSDF._lastPrim=void 0,this._ctrlPrimitive.setValue("PRIMITIVE"),this._main.render(),this.isUndoRedo||(this.isInitialRedo&&this.redoBuffer.length>0&&this.undoBuffer.push(this.redoBuffer.pop()),this.redoBuffer=[],this.undoBuffer.push({root:this._mainSDF._rootSDF.toJSON(),blendColor:e.BLEND_COLOR,version:1}),this.isInitialUndo=!0)},onUndo:function(){var a;!this.isUndoRedo&&this.undoBuffer.length>0&&(0===this.redoBuffer.length&&(a=this.undoBuffer.pop(),this.redoBuffer.push(a)),a=this.undoBuffer.pop(),this.redoBuffer.push(a),this.isUndoRedo=!0,this._mainSDF.createRootFromJSON(JSON.stringify(a)),this.isUndoRedo=!1,this.isInitialRedo=!0,this.isInitialUndo=!1)},onRedo:function(){var a;!this.isUndoRedo&&this.redoBuffer.length>0&&(this.isInitialRedo&&(a=this.redoBuffer.pop(),this.undoBuffer.push(a),this.isInitialRedo=!1),a=this.redoBuffer.pop(),this.undoBuffer.push(a),this.isUndoRedo=!0,this._mainSDF.createRootFromJSON(JSON.stringify(a)),this.isUndoRedo=!1)},onPrimitive:function(a){this._main.render(),this._mainSDF._dirtyScene=!0,this._lastRoot&&(this._mainSDF._rootSDF=this._lastRoot);var b=!g[a];if(this.setCtrlVisibility(!b,a,this._ctrlTransition.getValue()),b)return this._mainSDF._lastPrim=void 0,void this._main.setMesh(null);var c=new g[a];i.copy(c.getParam("uBaseColor"),this._ctrlColor.getValue()),this._mainSDF._lastPrim&&i.copy(c.getCenter(),this._mainSDF._lastPrim.getCenter()),this._lastRoot=this._mainSDF._rootSDF,this._mainSDF._lastPrim=c,this._mainSDF._rootSDF=new(f[this._ctrlCombination.getValue()])(this._mainSDF._rootSDF,c),this.updateTransiton(),this._main.setMesh(c)},onCombination:function(){this._mainSDF._rootSDF=new(f[this._ctrlCombination.getValue()])(this._lastRoot,this._mainSDF._lastPrim),this.updateTransiton(),this._main.render(),this._mainSDF._dirtyScene=!0},onTransition:function(a){this.setCtrlVisibility(!0,this._ctrlPrimitive.getValue(),a),this.updateTransiton()},updateTransiton:function(){var a=this._mainSDF._rootSDF;a.uRoundRadius=this._ctrlRoundRadius.getValue(),a.uChamferRadius=this._ctrlChamferRadius.getValue(),a.uColumns[0]=this._ctrlColumnsR.getValue(),a.uColumns[1]=this._ctrlColumnsN.getValue(),a.uStairs[0]=this._ctrlStairsR.getValue(),a.uStairs[1]=this._ctrlStairsN.getValue(),a.resetTransitions(this._ctrlTransition.getValue()),this._mainSDF._dirtyScene=!0,this._main.render()},onRoundRadius:function(a){this._mainSDF._rootSDF.uRoundRadius=a,this._main.render()},onChamferRadius:function(a){this._mainSDF._rootSDF.uChamferRadius=a,this._main.render()},onColumns:function(a,b){this._mainSDF._rootSDF.uColumns[a]=b,this._main.render()},onStairs:function(a,b){this._mainSDF._rootSDF.uStairs[a]=b,this._main.render()},onColor:function(){i.copy(this._mainSDF._lastPrim.getParam("uBaseColor"),this._ctrlColor.getValue()),this._main.render()},onBlendColor:function(a){e.BLEND_COLOR=a,this._mainSDF._dirtyScene=!0,this._main.render()},onRepeat:function(a,b){this._mainSDF._lastPrim.uBaseMod[a]=Math.abs(this._mainSDF._lastPrim.uBaseMod[a])*(b>0?1:-1),this._main.render()},onRepeatDist:function(a,b){this._ctrlRepeat[a].setValue(!0),this._mainSDF._lastPrim.uBaseMod[a]=b,this._main.render()},onBoxSides:function(a,b){this._mainSDF._lastPrim.uBoxSides[a]=b,this._main.render()},onSphereRadius:function(a){this._mainSDF._lastPrim.uSphereRadius=a,this._main.render()},onTorusRadii:function(a,b){this._mainSDF._lastPrim.uTorusRadii[a]=b,this._main.render()},onCapsule:function(a,b){this._mainSDF._lastPrim.uCapsuleRH[a]=b,this._main.render()},onEllipsoid:function(a,b){this._mainSDF._lastPrim.uEllipsoidSides[a]=b,this._main.render()}},c.exports=j}),define("sdf/MainSDF",["require","exports","module","drawables/Rtt","sdf/Shader","render/ShaderLib","gui/GuiCamera","sdf/Combinations","sdf/Primitives","sdf/Gui","editing/Gizmo","lib/glMatrix"],function(a,b,c){"use strict";var d=a("drawables/Rtt"),e=a("sdf/Shader");a("render/ShaderLib").SDF=e;var f=a("gui/GuiCamera"),g=a("sdf/Combinations"),h=a("sdf/Primitives"),i=a("sdf/Gui"),j=a("editing/Gizmo"),k=a("lib/glMatrix"),l=k.mat3,m=k.mat4,n=function(a){this._main=a,this._gl=a._gl,this._rttSDF=new d(this._gl,"SDF",null),this._rootSDF=void 0,this._lastPrim=void 0,this._dirtyScene=!0,this._initScene(),this._hookSculptGL(),this.onCanvasResize(a._canvasWidth,a._canvasHeight)};n.prototype={_initScene:function(){var a=new h.PLANE;a._matrix[13]-=.3,this._rootSDF=a},_hookSculptGL:function(){var a=this._main;a.clearScene(),this._main.applyRender=this._applyRender.bind(this),this._main.onDeviceDown=this._onDeviceDown.bind(this),this._hookReadFile(),this._hookCamera(),this._hookGui(),this._hookSculpt()},_hookReadFile:function(){var a=this;this._main.getFileType=function(a){return a.toLowerCase().endsWith(".json")?"json":void 0},this._main.readFile=function(b,c){if("json"===c){var d=new FileReader;d.onload=function(b){a.createRootFromJSON(b.target.result),document.getElementById("fileopen").value=""},d.readAsText(b)}}},_hookCamera:function(){var a=this._main.getCamera();a.setFov(53),a.updateProjection(),a._sdfView=l.create(),a.setUsePivot(!1)},_onDeviceDown:function(a){var b=this._main;if(!b._focusGui){b.setMousePosition(a);var c=b._mouseX,d=b._mouseY,e=a.which;b._sculpt.start(a.shiftKey);var f=b._picking.getMesh();f?b._action="SCULPT_EDIT":a.ctrlKey?b._action="CAMERA_ZOOM":a.altKey?b._action="CAMERA_PAN_ZOOM_ALT":2===e?b._action="CAMERA_PAN":3===e?b._action="CAMERA_ZOOM":b._action="CAMERA_ROTATE",console.log(c,d),("CAMERA_ROTATE"===b._action||"CAMERA_ZOOM"===b._action)&&b._camera.start(c,d),b._lastMouseX=c,b._lastMouseY=d}},_hookSculpt:function(){var a=this._main,b=a.getPicking(),c=this._main.getSculpt();c._tool="TRANSFORM";var d=c.getCurrentTool();d._gizmo.setActivatedType(j.TRANS_XYZ|j.PLANE_XYZ|j.ROT_XYZ|j.ROT_W|j.SCALE_W),d.start=function(){var c=this.getMesh();return c&&this._gizmo.onMouseDown()?(this.pushState(),void(b._mesh=c)):(b._mesh=null,this._lastMouseX=a._mouseX,void(this._lastMouseY=a._mouseY))},d.end=function(){this._gizmo.onMouseUp();var b=Math.abs(a._mouseX-this._lastMouseX),c=Math.abs(a._mouseY-this._lastMouseY);if(!(4>b*b+c*c)){var d=this.getMesh();d&&(this.isIdentity(d.getEditMatrix())||(m.mul(d.getMatrix(),d.getMatrix(),d.getEditMatrix()),m.identity(d.getEditMatrix())))}}},_hookGui:function(){for(var a=this._main,b=a.getGui(),c=0,d=b._ctrls,e=d.length;e>c;++c){var g=d[c];g instanceof f||(g.removeEvents&&g.removeEvents(),g._menu&&g._menu.setVisibility(!1),d[c]=null)}b.updateMesh=function(){},b._ctrlCamera._ctrlProjectionTitle.setVisibility(!1),b._ctrlCamera._ctrlProjection.setVisibility(!1),b._ctrlCamera._ctrlPivot.setVisibility(!1),b._ctrlCamera._ctrlFov.setVisibility(!1),this._sdfGUI=new i(this)},onCanvasResize:function(a,b){this._rttSDF.onResize(a,b)},_applyRender:function(){var a=this._main;a._preventRender=!1;var b=this._gl;b&&(b.disable(b.DEPTH_TEST),b.bindFramebuffer(b.FRAMEBUFFER,a._rttMerge.getFramebuffer()),this._rttSDF.render(a),b.bindFramebuffer(b.FRAMEBUFFER,null),a._rttOpaque.render(a),a._selection.render(a),b.enable(b.DEPTH_TEST),a._sculpt.postRender())},createRootFromJSON:function(a){var b=JSON.parse(a);this._rootSDF=this._createNode(b.root),this._dirtyScene=!0,this._lastPrim=void 0,this._sdfGUI.applyPrimitive(),this._sdfGUI._ctrlBlendColor.setValue(b.blendColor),this._sdfGUI.undoBuffer=[],this._sdfGUI.redoBuffer=[],this._sdfGUI.isInitialRedo=!0,this._sdfGUI.isInitialUndo=!0,b.hasOwnProperty("undoBuffer")&&(this._sdfGUI.undoBuffer=b.undoBuffer),this._main.render()},_createNode:function(a){var b,c=a.type;if(g[c]){var d=this._createNode(a.op1),e=this._createNode(a.op2);b=new g[c](d,e),b.initObjectJSON(a)}else h[c]?(b=new h[c],b.initObjectJSON(a)):console.error("Unknown type :",c);return b}},c.exports=n}),define("Scene",["require","exports","module","lib/glMatrix","misc/getOptionsURL","misc/Utils","editing/Sculpt","editing/Subdivision","files/Import","gui/Gui","math3d/Camera","math3d/Picking","drawables/Background","drawables/Selection","mesh/Mesh","mesh/multiresolution/Multimesh","drawables/Primitives","states/States","mesh/Render","drawables/Rtt","render/ShaderLib","render/WebGLCaps","sdf/MainSDF"],function(a,b,c){"use strict";var d=a("lib/glMatrix"),e=a("misc/getOptionsURL"),f=a("misc/Utils"),g=a("editing/Sculpt"),h=a("editing/Subdivision"),i=a("files/Import"),j=a("gui/Gui"),k=a("math3d/Camera"),l=a("math3d/Picking"),m=a("drawables/Background"),n=a("drawables/Selection"),o=a("mesh/Mesh"),p=a("mesh/multiresolution/Multimesh"),q=a("drawables/Primitives"),r=a("states/States"),s=a("mesh/Render"),t=a("drawables/Rtt"),u=a("render/ShaderLib"),v=a("render/WebGLCaps"),w=a("sdf/MainSDF"),x=d.vec3,y=d.mat4,z=function(){this._gl=null,this._pixelRatio=1,this._viewport=document.getElementById("viewport"),this._canvas=document.getElementById("canvas"),this._canvasWidth=0,this._canvasHeight=0,this._canvasOffsetLeft=0,this._canvasOffsetTop=0,this._states=new r(this),this._sculpt=null,this._camera=new k(this),this._picking=new l(this),this._pickingSym=new l(this,!0),this._meshPreview=null,this._torusLength=.5,this._torusWidth=.1,this._torusRadius=2*Math.PI,this._torusRadial=32,this._torusTubular=128;var a=e();this._showContour=a.outline,this._showGrid=a.grid,this._grid=null,this._background=null,this._selection=null,this._meshes=[],this._selectMeshes=[],this._mesh=null,this._rttContour=null,this._rttMerge=null,this._rttOpaque=null,this._rttTransparent=null,this._focusGui=!1,this._gui=new j(this),this._preventRender=!1,this._drawFullScene=!1,this._autoMatrix=a.scalecenter,this._vertexSRGB=!0};z.prototype={start:function(){this.initWebGL(),this._gl&&(this._sculpt=new g(this),this._selection=new n(this._gl),this._background=new m(this._gl,this),this._rttContour=new t(this._gl,"CONTOUR",null),this._rttMerge=new t(this._gl,"MERGE",null),this._rttOpaque=new t(this._gl,"FXAA"),this._rttTransparent=new t(this._gl,"",this._rttOpaque.getDepth(),!0),this._grid=q.createGrid(this._gl),this.initGrid(),this.loadTextures(),this._gui.initGui(),this.onCanvasResize(),this.addSphere(),this._mainSDF=new w(this))},getBackground:function(){return this._background},getViewport:function(){return this._viewport},getCanvas:function(){return this._canvas},getPixelRatio:function(){return this._pixelRatio},getCanvasWidth:function(){return this._canvasWidth},getCanvasHeight:function(){return this._canvasHeight},getCamera:function(){return this._camera},getGui:function(){return this._gui},getMeshes:function(){return this._meshes},getMesh:function(){return this._mesh},getSelectionRadius:function(){return this._selection},getSelectedMeshes:function(){return this._selectMeshes},getPicking:function(){return this._picking},getPickingSymmetry:function(){return this._pickingSym},getSculpt:function(){return this._sculpt},getStates:function(){return this._states},setMesh:function(a){return this.setOrUnsetMesh(a)},setCanvasCursor:function(a){this._canvas.style.cursor=a},initGrid:function(){var a=this._grid;a.normalizeSize();var b=a.getMatrix();y.translate(b,b,[0,-.45,0]);var c=2.5;y.scale(b,b,[c,c,c]),this._grid.setShaderName("FLAT"),a.setFlatColor([.214,.214,.214])},setOrUnsetMesh:function(a,b){if(a)if(b){var c=this.getIndexSelectMesh(a);c>=0?this._selectMeshes.length>1&&(this._selectMeshes.splice(c,1),a=this._selectMeshes[0]):this._selectMeshes.push(a)}else this._selectMeshes.length=0,this._selectMeshes.push(a);else this._selectMeshes.length=0;return this._mesh=a,this.getGui().updateMesh(),this.render(),a},renderSelectOverRtt:function(){this._requestRender()&&(this._drawFullScene=!1)},_requestRender:function(){return this._preventRender===!0?!1:(window.requestAnimationFrame(this.applyRender.bind(this)),this._preventRender=!0,!0)},render:function(){this._drawFullScene=!0,this._requestRender()},applyRender:function(){this._preventRender=!1,this.updateMatricesAndSort();var a=this._gl;a&&(this._drawFullScene&&this._drawScene(),a.disable(a.DEPTH_TEST),a.bindFramebuffer(a.FRAMEBUFFER,this._rttMerge.getFramebuffer()),this._rttMerge.render(this),a.bindFramebuffer(a.FRAMEBUFFER,null),this._rttOpaque.render(this),this._selection.render(this),a.enable(a.DEPTH_TEST),this._sculpt.postRender())},_drawScene:function(){var a=this._gl,b=0,c=this._meshes,d=c.length;a.disable(a.DEPTH_TEST);var e=this._selectMeshes.length>0&&this._showContour&&u.CONTOUR.color[3]>0;if(e){a.bindFramebuffer(a.FRAMEBUFFER,this._rttContour.getFramebuffer()),a.clear(a.COLOR_BUFFER_BIT);for(var f=0,g=this._selectMeshes,h=g.length;h>f;++f)g[f].renderFlatColor(this)}for(a.enable(a.DEPTH_TEST),a.bindFramebuffer(a.FRAMEBUFFER,this._rttOpaque.getFramebuffer()),a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT),this._showGrid&&this._grid.render(this),b=0;d>b&&!c[b].isTransparent();++b)c[b].render(this);var i=b;for(this._meshPreview&&this._meshPreview.render(this),this._background.render(),a.bindFramebuffer(a.FRAMEBUFFER,this._rttTransparent.getFramebuffer()),a.clear(a.COLOR_BUFFER_BIT),a.enable(a.BLEND),b=0;d>b;++b)c[b].getShowWireframe()&&c[b].renderWireframe(this);for(a.depthMask(!1),a.enable(a.CULL_FACE),b=i;d>b;++b)a.cullFace(a.FRONT),c[b].render(this),a.cullFace(a.BACK),c[b].render(this);a.disable(a.CULL_FACE),e&&(a.bindFramebuffer(a.FRAMEBUFFER,this._rttOpaque.getFramebuffer()),this._rttContour.render(this)),a.depthMask(!0),a.disable(a.BLEND)},updateMatricesAndSort:function(){var a=this._meshes,b=this._camera;a.length>0&&b.optimizeNearFar(this.computeBoundingBoxScene());for(var c=0,d=a.length;d>c;++c)a[c].updateMatrices(b);a.sort(o.sortFunction),this._meshPreview&&this._meshPreview.updateMatrices(b),this._grid&&this._grid.updateMatrices(b)},initWebGL:function(){var a={antialias:!1,stencil:!0},b=document.getElementById("canvas"),c=this._gl=b.getContext("webgl",a)||b.getContext("experimental-webgl",a);return c?(v.initWebGLExtensions(c),v.getWebGLExtension("OES_element_index_uint")||(s.ONLY_DRAW_ARRAYS=!0),c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,!0),c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),c.pixelStorei(c.UNPACK_COLORSPACE_CONVERSION_WEBGL,c.NONE),c.disable(c.CULL_FACE),c.frontFace(c.CCW),c.cullFace(c.BACK),c.disable(c.BLEND),c.blendFunc(c.ONE,c.ONE_MINUS_SRC_ALPHA),c.disable(c.DEPTH_TEST),c.depthFunc(c.LEQUAL),c.depthMask(!0),c.clearColor(0,0,0,0),void c.clear(c.COLOR_BUFFER_BIT|c.DEPTH_BUFFER_BIT)):void window.alert("Could not initialise WebGL. No WebGL, no SculptGL. Sorry.")},loadTextures:function(){for(var a=this,b=this._gl,c=u.MATCAP,d=function(d,e){var f=new Image;f.src=d,f.onload=function(){c.createTexture(b,f,e),a.render()}},e=0,f=c.matcaps,g=f.length;g>e;++e)d(f[e].path,e);
this.initAlphaTextures()},initAlphaTextures:function(){for(var a=l.INIT_ALPHAS_PATHS,b=l.INIT_ALPHAS_NAMES,c=0,d=a.length;d>c;++c){var e=new Image;e.src="resources/alpha/"+a[c],e.onload=this.onLoadAlphaImage.bind(this,e,b[c])}},onCanvasResize:function(){var a=this._viewport,b=a.clientWidth*this._pixelRatio,c=a.clientHeight*this._pixelRatio;this._canvasOffsetLeft=a.offsetLeft,this._canvasOffsetTop=a.offsetTop,this._canvasWidth=b,this._canvasHeight=c,this._canvas.width=b,this._canvas.height=c,this._gl.viewport(0,0,b,c),this._camera.onResize(b,c),this._background.onResize(b,c),this._rttContour.onResize(b,c),this._rttMerge.onResize(b,c),this._rttOpaque.onResize(b,c),this._rttTransparent.onResize(b,c),this._mainSDF&&this._mainSDF.onCanvasResize(b,c),this.render()},computeBoundingBoxMeshes:function(a){for(var b=[1/0,1/0,1/0,-(1/0),-(1/0),-(1/0)],c=0,d=a.length;d>c;++c){var e=a[c].getWorldBound();e[0]<b[0]&&(b[0]=e[0]),e[1]<b[1]&&(b[1]=e[1]),e[2]<b[2]&&(b[2]=e[2]),e[3]>b[3]&&(b[3]=e[3]),e[4]>b[4]&&(b[4]=e[4]),e[5]>b[5]&&(b[5]=e[5])}return b},computeBoundingBoxScene:function(){var a=this._meshes.slice();return a.push(this._grid),this._sculpt.addSculptToScene(a),this.computeBoundingBoxMeshes(a)},normalizeAndCenterMeshes:function(a){var b=this.computeBoundingBoxMeshes(a),c=f.SCALE/x.dist([b[0],b[1],b[2]],[b[3],b[4],b[5]]),d=y.create();y.scale(d,d,[c,c,c]),y.translate(d,d,[.5*-(b[0]+b[3]),.5*-(b[1]+b[4]),.5*-(b[2]+b[5])]);for(var e=0,g=a.length;g>e;++e){var h=a[e].getMatrix();y.mul(h,d,h)}},addSphere:function(){var a=new p(q.createCube(this._gl));return a.normalizeSize(),this.subdivideClamp(a),this.addNewMesh(a)},addCube:function(){var a=new p(q.createCube(this._gl));return a.normalizeSize(),y.scale(a.getMatrix(),a.getMatrix(),[.7,.7,.7]),this.subdivideClamp(a,!0),this.addNewMesh(a)},addCylinder:function(){var a=new p(q.createCylinder(this._gl));return a.normalizeSize(),y.scale(a.getMatrix(),a.getMatrix(),[.7,.7,.7]),this.subdivideClamp(a),this.addNewMesh(a)},addTorus:function(a){var b=new p(q.createTorus(this._gl,this._torusLength,this._torusWidth,this._torusRadius,this._torusRadial,this._torusTubular));if(a){b.setShowWireframe(!0);var c=.3*f.SCALE;return y.scale(b.getMatrix(),b.getMatrix(),[c,c,c]),void(this._meshPreview=b)}b.normalizeSize(),this.subdivideClamp(b),this.addNewMesh(b)},subdivideClamp:function(a,b){for(h.LINEAR=!!b;a.getNbFaces()<5e4;)a.addLevel();a._meshes.splice(0,Math.min(a._meshes.length-4,4)),a._sel=a._meshes.length-1,h.LINEAR=!1},addNewMesh:function(a){return this._meshes.push(a),this._states.pushStateAdd(a),this.setMesh(a),a},loadScene:function(a,b){var c;"obj"===b?c=i.importOBJ(a,this._gl):"sgl"===b?c=i.importSGL(a,this._gl,this):"stl"===b?c=i.importSTL(a,this._gl):"ply"===b&&(c=i.importPLY(a,this._gl));var d=c.length;if(0!==d){for(var e=this._meshes,g=0;d>g;++g){var h=c[g]=new p(c[g]);this._vertexSRGB||f.convertArrayVec3toSRGB(h.getColors()),h.init(),h.initRender(),e.push(h)}return this._autoMatrix&&this.normalizeAndCenterMeshes(c),this._states.pushStateAdd(c),this.setMesh(e[e.length-1]),this._camera.resetView(),c}},clearScene:function(){this.getStates().reset(),this.getMeshes().length=0,this.getCamera().resetView(),this.setMesh(null),this._action="NOTHING"},deleteCurrentSelection:function(){this._mesh&&(this.removeMeshes(this._selectMeshes),this._states.pushStateRemove(this._selectMeshes.slice()),this._selectMeshes.length=0,this.setMesh(null))},removeMeshes:function(a){for(var b=this._meshes,c=0;c<a.length;++c)b.splice(this.getIndexMesh(a[c]),1)},getIndexMesh:function(a,b){for(var c=b?this._selectMeshes:this._meshes,d=a.getID(),e=0,f=c.length;f>e;++e){var g=c[e];if(g===a||g.getID()===d)return e}return-1},getIndexSelectMesh:function(a){return this.getIndexMesh(a,!0)},replaceMesh:function(a,b){var c=this.getIndexMesh(a);c>=0&&(this._meshes[c]=b),this._mesh===a&&this.setMesh(b)},onLoadAlphaImage:function(a,b,c){var d=document.createElement("canvas");d.width=a.width,d.height=a.height;var e=d.getContext("2d");e.drawImage(a,0,0);for(var f=e.getImageData(0,0,a.width,a.height).data,g=f.subarray(0,f.length/4),h=0,i=0,j=g.length;j>h;++h,i+=4)g[h]=Math.round((f[i]+f[i+1]+f[i+2])/3);b=l.addAlpha(g,a.width,a.height,b)._name;var k={};k[b]=b,this.getGui().addAlphaOptions(k),c&&c._ctrlAlpha&&c._ctrlAlpha.setValue(b)}},c.exports=z}),define("Sculptgl",["require","exports","module","misc/Polyfill","lib/glMatrix","lib/Hammer","misc/Utils","Scene","mesh/multiresolution/Multimesh"],function(a,b,c){"use strict";a("misc/Polyfill");var d=a("lib/glMatrix"),e=a("lib/Hammer"),f=a("misc/Utils"),g=a("Scene"),h=a("mesh/multiresolution/Multimesh");window.sculptgl=g;var i=d.vec3,j=function(){g.call(this),this._mouseX=0,this._mouseY=0,this._lastMouseX=0,this._lastMouseY=0,this._lastScale=0,this._action="NOTHING",this._lastNbPointers=0,this._isWheelingIn=!1,this._maskX=0,this._maskY=0,this._hammer=new e.Manager(this._canvas),this._eventProxy={},this.initHammer(),this.addEvents()},k=1,l=2,m=3;j.prototype={addEvents:function(){var a=this._canvas,b=this.onMouseWheel.bind(this);a.addEventListener("mousedown",this.onMouseDown.bind(this),!1),window.addEventListener("mouseup",this.onMouseUp.bind(this),!1),a.addEventListener("mouseout",this.onMouseOut.bind(this),!1),a.addEventListener("mouseover",this.onMouseOver.bind(this),!1),window.addEventListener("mousemove",f.throttle(this.onMouseMove.bind(this),16.66),!1),a.addEventListener("mousewheel",b,!1),a.addEventListener("DOMMouseScroll",b,!1),window.addEventListener("keydown",this.onKeyDown.bind(this),!1),window.addEventListener("keyup",this.onKeyUp.bind(this),!1);var c=this.loadFiles.bind(this),d=this.stopAndPrevent.bind(this);a.addEventListener("webglcontextlost",this.onContextLost.bind(this),!1),a.addEventListener("webglcontextrestored",this.onContextRestored.bind(this),!1),window.addEventListener("dragenter",d,!1),window.addEventListener("dragover",d,!1),window.addEventListener("drop",c,!1),document.getElementById("fileopen").addEventListener("change",c,!1)},initHammer:function(){this._hammer.options.enable=!0,this._initHammerRecognizers(),this._initHammerEvents()},_initHammerRecognizers:function(){var a=this._hammer;a.add(new e.Tap({event:"doubletap",pointers:1,taps:2,time:250,interval:450,threshold:5,posThreshold:50})),a.add(new e.Tap({event:"doubletap2fingers",pointers:2,taps:2,time:250,interval:450,threshold:5,posThreshold:50})),a.add(new e.Pan({event:"pan",pointers:0,threshold:0})),a.add(new e.Pinch({event:"pinch",pointers:2,threshold:.1})),a.get("pinch").recognizeWith(a.get("pan"))},_initHammerEvents:function(){var a=this._hammer;a.on("panstart",this.onPanStart.bind(this)),a.on("panmove",this.onPanMove.bind(this)),a.on("panend pancancel",this.onPanEnd.bind(this)),a.on("doubletap",this.onDoubleTap.bind(this)),a.on("doubletap2fingers",this.onDoubleTap2Fingers.bind(this)),a.on("pinchstart",this.onPinchStart.bind(this)),a.on("pinchin pinchout",this.onPinchInOut.bind(this))},stopAndPrevent:function(a){a.stopPropagation(),a.preventDefault()},onContextLost:function(){window.alert("Oops... WebGL context lost.")},onContextRestored:function(){window.alert("Wow... Context is restored.")},onKeyDown:function(a){this._gui.callFunc("onKeyDown",a)},onKeyUp:function(a){this._gui.callFunc("onKeyUp",a)},onPanStart:function(a){if("mouse"!==a.pointerType){this._focusGui=!1;var b=this._eventProxy;b.pageX=a.center.x,b.pageY=a.center.y,this._lastNbPointers=b.which=Math.min(2,a.pointers.length),this.onDeviceDown(b)}},onPanMove:function(a){if("mouse"!==a.pointerType){var b=this._eventProxy;b.pageX=a.center.x,b.pageY=a.center.y;var c=Math.min(2,a.pointers.length);c!==this._lastNbPointers&&(this.onDeviceUp(),b.which=c,this.onDeviceDown(b),this._lastNbPointers=c),this.onDeviceMove(b)}},onPanEnd:function(a){"mouse"!==a.pointerType&&this.onDeviceUp()},onDoubleTap:function(a){if(!this._focusGui){var b=this._eventProxy;b.pageX=a.center.x,b.pageY=a.center.y,this.setMousePosition(b);var c=this._picking,d=c.intersectionMouseMeshes(),e=this._camera,f=[0,0,0];if(!d)return this.resetCameraScene();i.transformMat4(f,c.getIntersectionPoint(),c.getMesh().getMatrix());var g=e._trans[2];e.isOrthographic()||(g=Math.min(g,i.dist(f,e.computePosition()))),e.setAndFocusOnPivot(f,g),this.render()}},onDoubleTap2Fingers:function(){this._focusGui||this.resetCameraScene()},onPinchStart:function(a){this._focusGui=!1,this._lastScale=a.scale},onPinchInOut:function(a){var b=25*(a.scale-this._lastScale);this._lastScale=a.scale,this.onDeviceWheel(b)},resetCameraScene:function(){if(this._meshes.length>0){var a=[0,0,0],b=this.computeBoundingBoxMeshes(this._meshes),c=.3*i.dist([b[0],b[1],b[2]],[b[3],b[4],b[5]]);c*=this._camera.computeFrustumFit(),i.set(a,.5*(b[0]+b[3]),.5*(b[1]+b[4]),.5*(b[2]+b[5])),this._camera.setAndFocusOnPivot(a,c)}else this._camera.resetView();this.render()},getFileType:function(a){var b=a.toLowerCase();return b.endsWith(".obj")?"obj":b.endsWith(".sgl")?"sgl":b.endsWith(".stl")?"stl":b.endsWith(".ply")?"ply":void 0},loadFiles:function(a){a.stopPropagation(),a.preventDefault();for(var b=a.dataTransfer?a.dataTransfer.files:a.target.files,c=0,d=b.length;d>c;++c){var e=b[c],f=this.getFileType(e.name);this.readFile(e,f)}},readFile:function(a,b){var c=b||this.getFileType(a.name);if(c){var d=new FileReader,e=this;d.onload=function(a){e.loadScene(a.target.result,c),document.getElementById("fileopen").value=""},"obj"===c?d.readAsText(a):d.readAsArrayBuffer(a)}},onMouseDown:function(a){a.stopPropagation(),a.preventDefault(),this._gui.callFunc("onMouseDown",a),this.onDeviceDown(a)},onMouseMove:function(a){a.stopPropagation(),a.preventDefault(),this._gui.callFunc("onMouseMove",a),this.onDeviceMove(a)},onMouseOver:function(a){this._focusGui=!1,this._gui.callFunc("onMouseOver",a)},onMouseOut:function(a){this._focusGui=!0,this._gui.callFunc("onMouseOut",a),this.onMouseUp(a)},onMouseUp:function(a){a.preventDefault(),this._gui.callFunc("onMouseUp",a),this.onDeviceUp()},onMouseWheel:function(a){a.stopPropagation(),a.preventDefault(),this._gui.callFunc("onMouseWheel",a);var b=void 0===a.wheelDelta?-a.detail:a.wheelDelta;this.onDeviceWheel(b>0?1:-1)},onDeviceUp:function(){this.setCanvasCursor("default"),h.RENDER_HINT=h.NONE,this._sculpt.end(),"MASK_EDIT"===this._action&&this._mesh&&(this._lastMouseX===this._maskX&&this._lastMouseY===this._maskY?this.getSculpt().getTool("MASKING").invert():this.getSculpt().getTool("MASKING").clear()),this._action="NOTHING",this.render(),this._states.cleanNoop()},onDeviceWheel:function(a){a>0&&!this._isWheelingIn&&(this._isWheelingIn=!0,this._camera.start(this._mouseX,this._mouseY)),this._camera.zoom(.02*a),h.RENDER_HINT=h.CAMERA,this.render(),this._timerEndWheel&&window.clearTimeout(this._timerEndWheel),this._timerEndWheel=window.setTimeout(this._endWheel.bind(this),300)},_endWheel:function(){h.RENDER_HINT=h.NONE,this._isWheelingIn=!1,this.render()},setMousePosition:function(a){this._mouseX=this._pixelRatio*(a.pageX-this._canvasOffsetLeft),this._mouseY=this._pixelRatio*(a.pageY-this._canvasOffsetTop)},onDeviceDown:function(a){if(!this._focusGui){this.setMousePosition(a);var b=this._mouseX,c=this._mouseY,d=a.which,e=!1;d===k&&(e=this._sculpt.start(a.shiftKey)),d===k&&e&&this.setCanvasCursor("none"),d===m&&a.ctrlKey?this._action="CAMERA_ZOOM":d===l?this._action="CAMERA_PAN":!e&&a.ctrlKey?(this._maskX=b,this._maskY=c,this._action="MASK_EDIT"):e&&d!==m||!a.altKey?d===m||d===k&&!e?this._action="CAMERA_ROTATE":this._action="SCULPT_EDIT":this._action="CAMERA_PAN_ZOOM_ALT",("CAMERA_ROTATE"===this._action||"CAMERA_ZOOM"===this._action)&&this._camera.start(b,c),this._lastMouseX=b,this._lastMouseY=c}},onDeviceMove:function(a){if(!this._focusGui){this.setMousePosition(a);var b=this._mouseX,c=this._mouseY,d=this._action;"CAMERA_ZOOM"===d||"CAMERA_PAN_ZOOM_ALT"===d&&!a.altKey?(h.RENDER_HINT=h.CAMERA,this._camera.zoom((b-this._lastMouseX+c-this._lastMouseY)/1e3),this.render()):"CAMERA_PAN_ZOOM_ALT"===d||"CAMERA_PAN"===d?(h.RENDER_HINT=h.CAMERA,this._camera.translate((b-this._lastMouseX)/1e3,(c-this._lastMouseY)/1e3),this.render()):"CAMERA_ROTATE"===d?(h.RENDER_HINT=h.CAMERA,a.shiftKey||this._camera.rotate(b,c),this.render()):(h.RENDER_HINT=h.PICKING,this._sculpt.preUpdate(),"SCULPT_EDIT"===d&&(h.RENDER_HINT=h.SCULPT,this._sculpt.update(this),this.getMesh().getDynamicTopology&&this._gui.updateMeshInfo())),this._lastMouseX=b,this._lastMouseY=c,this.renderSelectOverRtt()}}},f.makeProxy(g,j),c.exports=j});